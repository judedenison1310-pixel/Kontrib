{"file_contents":{"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/pages/member-dashboard.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Navigation } from \"@/components/navigation\";\nimport { PaymentModal } from \"@/components/payment-modal\";\nimport { ProjectSelectionModal } from \"@/components/project-selection-modal\";\nimport { ProgressCircle, StatusBadge, DashboardSkeleton } from \"@/components/ui/kontrib-ui\";\nimport { Users, CreditCard, ChevronRight, Clock, CheckCircle, Plus, History, Wallet } from \"lucide-react\";\nimport { getCurrentUser } from \"@/lib/auth\";\nimport { formatNaira } from \"@/lib/currency\";\nimport {\n  Group,\n  GroupMember,\n  GroupWithStats,\n  Project,\n  MemberWithContributions,\n  ContributionWithDetails,\n} from \"@shared/schema\";\n\ntype UserGroupMembership = GroupMember & { group: GroupWithStats };\n\nexport default function MemberDashboard() {\n  const user = getCurrentUser();\n  const [, setLocation] = useLocation();\n  const [projectSelectionOpen, setProjectSelectionOpen] = useState(false);\n  const [paymentModalOpen, setPaymentModalOpen] = useState(false);\n  const [selectedGroup, setSelectedGroup] = useState<Group | null>(null);\n  const [selectedProject, setSelectedProject] = useState<Project | null>(null);\n\n  const { data: userGroups = [], isLoading: groupsLoading } = useQuery<UserGroupMembership[]>({\n    queryKey: [\"/api/groups\", \"user\", user?.id],\n    enabled: !!user,\n  });\n\n  const { data: userStats, isLoading: statsLoading } = useQuery<MemberWithContributions>({\n    queryKey: [\"/api/stats\", \"user\", user?.id],\n    enabled: !!user,\n  });\n\n  const { data: paymentHistory = [], isLoading: historyLoading } = useQuery<ContributionWithDetails[]>({\n    queryKey: [\"/api/contributions\", \"user\", user?.id],\n    enabled: !!user,\n  });\n\n  const handleMakePayment = (group: Group) => {\n    setSelectedGroup(group);\n    setProjectSelectionOpen(true);\n  };\n\n  const handleViewDetails = (group: Group) => {\n    setLocation(`/group/${group.id}`);\n  };\n\n  const handleSelectProject = (project: Project) => {\n    setSelectedProject(project);\n    setPaymentModalOpen(true);\n  };\n\n  const handlePaymentModalClose = (open: boolean) => {\n    setPaymentModalOpen(open);\n    if (!open) setSelectedProject(null);\n  };\n\n  const pendingPayments = paymentHistory.filter((p) => p.status === \"pending\");\n\n  if (groupsLoading || statsLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <Navigation />\n        <DashboardSkeleton />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 pb-24 sm:pb-8\">\n      <Navigation />\n\n      <main className=\"max-w-lg mx-auto px-4 py-6 space-y-6\">\n        {/* Welcome Header */}\n        <div className=\"bg-primary rounded-2xl p-5 text-white\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-green-100 text-sm\">Welcome back,</p>\n              <h1 className=\"text-xl font-bold\">{user?.fullName?.split(\" \")[0] || \"Member\"}</h1>\n            </div>\n            <div className=\"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center\">\n              <Wallet className=\"h-6 w-6\" />\n            </div>\n          </div>\n          \n          {/* Quick Stats */}\n          <div className=\"mt-4 grid grid-cols-2 gap-3\">\n            <div className=\"bg-white/10 rounded-xl p-3\">\n              <p className=\"text-green-200 text-xs\">Total Contributed</p>\n              <p className=\"text-lg font-bold\">{userStats ? formatNaira(userStats.totalContributions) : \"₦0\"}</p>\n            </div>\n            <div className=\"bg-white/10 rounded-xl p-3\">\n              <p className=\"text-green-200 text-xs\">Active Groups</p>\n              <p className=\"text-lg font-bold\">{userGroups.length}</p>\n            </div>\n          </div>\n        </div>\n\n        {/* Pending Approvals Alert */}\n        {pendingPayments.length > 0 && (\n          <div className=\"bg-amber-50 border border-amber-200 rounded-2xl p-4 flex items-center gap-3\">\n            <div className=\"w-10 h-10 bg-amber-100 rounded-full flex items-center justify-center shrink-0\">\n              <Clock className=\"h-5 w-5 text-amber-600\" />\n            </div>\n            <div className=\"flex-1\">\n              <p className=\"font-medium text-amber-900\">Pending Approval</p>\n              <p className=\"text-sm text-amber-700\">{pendingPayments.length} payment{pendingPayments.length > 1 ? \"s\" : \"\"} waiting for admin</p>\n            </div>\n            <ChevronRight className=\"h-5 w-5 text-amber-400\" />\n          </div>\n        )}\n\n        {/* My Groups Section */}\n        <section>\n          <div className=\"flex items-center justify-between mb-4\">\n            <h2 className=\"text-lg font-bold text-gray-900\">My Groups</h2>\n            <button\n              onClick={() => setLocation(\"/join-group\")}\n              className=\"text-primary text-sm font-medium flex items-center gap-1\"\n              data-testid=\"button-join-group-header\"\n            >\n              <Plus className=\"h-4 w-4\" />\n              Join Group\n            </button>\n          </div>\n\n          {userGroups.length === 0 ? (\n            <div className=\"border-2 border-dashed border-gray-300 rounded-2xl p-8 text-center\">\n              <div className=\"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n                <Users className=\"h-8 w-8 text-gray-400\" />\n              </div>\n              <h3 className=\"text-lg font-bold text-gray-900 mb-2\">No Groups Yet</h3>\n              <p className=\"text-gray-500 mb-6\">\n                Ask your group admin for an invitation link or join an existing group\n              </p>\n              <button\n                onClick={() => setLocation(\"/join-group\")}\n                className=\"bg-primary hover:bg-primary/90 text-white font-semibold px-6 py-3 rounded-full transition-colors\"\n                data-testid=\"button-join-group\"\n              >\n                Join a Group\n              </button>\n            </div>\n          ) : (\n            <div className=\"space-y-3\">\n              {userGroups.map((membership) => {\n                const group = membership.group;\n                const progress = group.completionRate || 0;\n                const contributedAmount = parseFloat(membership.contributedAmount || \"0\");\n                \n                return (\n                  <div \n                    key={group.id}\n                    className=\"bg-white rounded-2xl p-5 border border-gray-100 shadow-sm active:bg-gray-50 transition-colors cursor-pointer\"\n                    onClick={() => handleViewDetails(group)}\n                  >\n                    <div className=\"flex items-start gap-4\">\n                      {/* Progress Circle */}\n                      <ProgressCircle \n                        percentage={progress} \n                        size={56} \n                        strokeWidth={5}\n                        showLabel={false}\n                      />\n                      \n                      {/* Group Info */}\n                      <div className=\"flex-1 min-w-0\">\n                        <h3 className=\"font-bold text-gray-900 truncate\">{group.name}</h3>\n                        <p className=\"text-sm text-gray-500\">{group.memberCount || 0} members</p>\n                        \n                        <div className=\"mt-2 flex items-center gap-3 text-sm\">\n                          <span className=\"text-primary font-medium\">{progress}% complete</span>\n                          {contributedAmount > 0 && (\n                            <>\n                              <span className=\"text-gray-300\">•</span>\n                              <span className=\"text-gray-500\">{formatNaira(contributedAmount)} paid</span>\n                            </>\n                          )}\n                        </div>\n                      </div>\n\n                      <ChevronRight className=\"h-5 w-5 text-gray-300 shrink-0 mt-1\" />\n                    </div>\n\n                    {/* Action Button */}\n                    <div className=\"mt-4 pt-4 border-t border-gray-100\">\n                      <button\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          handleMakePayment(group);\n                        }}\n                        className=\"w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 rounded-full flex items-center justify-center gap-2 transition-colors\"\n                        data-testid={`button-submit-proof-${group.id}`}\n                      >\n                        <CreditCard className=\"h-4 w-4\" />\n                        Submit Payment Proof\n                      </button>\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          )}\n        </section>\n\n        {/* Recent Payments Section */}\n        <section>\n          <div className=\"flex items-center justify-between mb-4\">\n            <h2 className=\"text-lg font-bold text-gray-900\">Recent Payments</h2>\n            {paymentHistory.length > 3 && (\n              <button\n                onClick={() => setLocation(\"/my-contributions\")}\n                className=\"text-primary text-sm font-medium\"\n                data-testid=\"button-view-all-payments\"\n              >\n                View All\n              </button>\n            )}\n          </div>\n\n          {paymentHistory.length === 0 ? (\n            <div className=\"bg-white rounded-2xl p-6 border border-gray-100 text-center\">\n              <History className=\"h-8 w-8 text-gray-300 mx-auto mb-2\" />\n              <p className=\"text-gray-500\">No payments yet</p>\n              <p className=\"text-sm text-gray-400\">Your payment history will appear here</p>\n            </div>\n          ) : (\n            <div className=\"space-y-2\">\n              {paymentHistory.slice(0, 5).map((payment) => (\n                <div key={payment.id} className=\"bg-white rounded-2xl p-4 border border-gray-100\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className={`w-10 h-10 rounded-full flex items-center justify-center ${\n                        payment.status === \"confirmed\" \n                          ? \"bg-green-100\" \n                          : payment.status === \"pending\" \n                          ? \"bg-amber-100\" \n                          : \"bg-red-100\"\n                      }`}>\n                        {payment.status === \"confirmed\" ? (\n                          <CheckCircle className=\"h-5 w-5 text-green-600\" />\n                        ) : payment.status === \"pending\" ? (\n                          <Clock className=\"h-5 w-5 text-amber-600\" />\n                        ) : (\n                          <Clock className=\"h-5 w-5 text-red-600\" />\n                        )}\n                      </div>\n                      <div>\n                        <p className=\"font-medium text-gray-900 text-sm\">{payment.groupName}</p>\n                        <p className=\"text-xs text-gray-500\">\n                          {new Date(payment.createdAt).toLocaleDateString(\"en-NG\", {\n                            day: \"numeric\",\n                            month: \"short\",\n                            year: \"numeric\"\n                          })}\n                        </p>\n                      </div>\n                    </div>\n                    <div className=\"text-right\">\n                      <p className=\"font-semibold text-gray-900\">{formatNaira(payment.amount)}</p>\n                      <StatusBadge \n                        status={payment.status as \"confirmed\" | \"pending\" | \"rejected\"} \n                        size=\"sm\" \n                      />\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </section>\n      </main>\n\n      {/* Modals */}\n      <ProjectSelectionModal\n        open={projectSelectionOpen}\n        onOpenChange={setProjectSelectionOpen}\n        group={selectedGroup}\n        onSelectProject={handleSelectProject}\n      />\n      <PaymentModal\n        open={paymentModalOpen}\n        onOpenChange={handlePaymentModalClose}\n        project={selectedProject}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":12269,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/components/create-group-modal.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Sheet, SheetContent, SheetHeader } from \"@/components/ui/sheet\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { insertGroupSchema, insertProjectSchema } from \"@shared/schema\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { getCurrentUser } from \"@/lib/auth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { getDefaultPaymentTypes } from \"@/lib/payment-types\";\nimport { z } from \"zod\";\nimport { ArrowLeft, Calendar, Building2, ChevronDown, ChevronUp, CheckCircle } from \"lucide-react\";\n\nconst createGroupFormSchema = insertGroupSchema;\ntype CreateGroupFormData = z.infer<typeof createGroupFormSchema>;\n\nconst createProjectFormSchema = insertProjectSchema.extend({\n  targetAmount: z.string().optional(),\n  selectedPaymentTypes: z.array(z.string()).min(1, \"Please select at least one payment method\"),\n  projectType: z.enum([\"target\", \"monthly\", \"yearly\", \"event\", \"emergency\"]).default(\"target\"),\n});\ntype CreateProjectFormData = z.infer<typeof createProjectFormSchema>;\n\ninterface CreateGroupModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\nexport function CreateGroupModal({ open, onOpenChange }: CreateGroupModalProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const user = getCurrentUser();\n  const [step, setStep] = useState<\"group\" | \"project\">(\"group\");\n  const [createdGroup, setCreatedGroup] = useState<{ id: string; name: string } | null>(null);\n  const [showPaymentDetails, setShowPaymentDetails] = useState(false);\n\n  const groupForm = useForm<CreateGroupFormData>({\n    resolver: zodResolver(createGroupFormSchema),\n    defaultValues: {\n      name: \"\",\n      description: \"\",\n    },\n  });\n\n  const projectForm = useForm<CreateProjectFormData>({\n    resolver: zodResolver(createProjectFormSchema),\n    defaultValues: {\n      name: \"\",\n      description: \"\",\n      targetAmount: \"\",\n      deadline: undefined,\n      groupId: \"\",\n      projectType: \"target\",\n      accountName: \"\",\n      accountNumber: \"\",\n      bankName: \"\",\n      routingNumber: \"\",\n      swiftCode: \"\",\n      zelleEmail: \"\",\n      zellePhone: \"\",\n      cashappHandle: \"\",\n      venmoHandle: \"\",\n      paypalEmail: \"\",\n      paymentInstructions: \"\",\n      selectedPaymentTypes: getDefaultPaymentTypes(),\n    },\n  });\n\n  const projectType = projectForm.watch(\"projectType\");\n  const requiresTarget = projectType === \"target\" || projectType === \"event\" || projectType === \"emergency\";\n\n  const createGroupMutation = useMutation({\n    mutationFn: async (data: CreateGroupFormData) => {\n      const response = await apiRequest(\"POST\", \"/api/groups\", {\n        ...data,\n        adminId: user?.id,\n      });\n      return response.json();\n    },\n    onSuccess: (data) => {\n      setCreatedGroup({ id: data.id, name: data.name });\n      projectForm.setValue(\"groupId\", data.id);\n      setStep(\"project\");\n      toast({\n        title: \"Group Created!\",\n        description: \"Now add your first project to start collecting.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to create group. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const createProjectMutation = useMutation({\n    mutationFn: async (data: CreateProjectFormData) => {\n      const payload = {\n        ...data,\n        targetAmount: requiresTarget ? data.targetAmount : null,\n        deadline: data.deadline && typeof data.deadline === 'string' && data.deadline.trim() ? data.deadline : undefined,\n        allowedPaymentTypes: JSON.stringify(data.selectedPaymentTypes || []),\n      };\n      const response = await apiRequest(\"POST\", `/api/groups/${createdGroup?.id}/projects`, payload);\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/groups\", \"admin\", user?.id] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/groups/all\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/groups\", createdGroup?.id, \"projects\"] });\n      toast({\n        title: \"All Set!\",\n        description: `\"${createdGroup?.name}\" is ready. Share it with your group!`,\n      });\n      handleClose();\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to create project. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleClose = () => {\n    groupForm.reset();\n    projectForm.reset();\n    setStep(\"group\");\n    setCreatedGroup(null);\n    setShowPaymentDetails(false);\n    onOpenChange(false);\n  };\n\n  const handleBack = () => {\n    if (step === \"project\") {\n      setStep(\"group\");\n    } else {\n      handleClose();\n    }\n  };\n\n  const onGroupSubmit = (data: CreateGroupFormData) => {\n    createGroupMutation.mutate(data);\n  };\n\n  const onProjectSubmit = (data: CreateProjectFormData) => {\n    createProjectMutation.mutate(data);\n  };\n\n  const projectTypes = [\n    { value: \"target\", label: \"Target Goal\", description: \"e.g. Wedding Gift, House Project\" },\n    { value: \"monthly\", label: \"Monthly Dues\", description: \"e.g. Ajo, Monthly Levy\" },\n    { value: \"yearly\", label: \"Yearly Dues\", description: \"e.g. Annual Dues, Yearly Contribution\" },\n    { value: \"event\", label: \"One-time Event\", description: \"e.g. Birthday Party, Burial\" },\n    { value: \"emergency\", label: \"Emergency Fund\", description: \"e.g. Medical, Urgent Needs\" },\n  ];\n\n  const canClose = step === \"group\" || !createdGroup;\n\n  return (\n    <Sheet open={open} onOpenChange={(isOpen) => {\n      if (!isOpen && canClose) {\n        handleClose();\n      }\n    }}>\n      <SheetContent side=\"bottom\" className=\"h-[90vh] rounded-t-3xl p-0\" onInteractOutside={(e) => {\n        if (!canClose) {\n          e.preventDefault();\n        }\n      }}>\n        <div className=\"flex flex-col h-full\">\n          <SheetHeader className=\"px-5 py-4 border-b border-gray-100\">\n            <div className=\"flex items-center justify-between\">\n              {canClose ? (\n                <button\n                  onClick={handleBack}\n                  className=\"flex items-center gap-2 text-gray-600 hover:text-gray-900\"\n                  data-testid=\"button-back\"\n                >\n                  <ArrowLeft className=\"h-5 w-5\" />\n                  <span>Back</span>\n                </button>\n              ) : (\n                <div className=\"text-sm text-amber-600 font-medium\">\n                  Complete the project to finish\n                </div>\n              )}\n              <div className=\"flex items-center gap-2\">\n                <div className={`w-2 h-2 rounded-full ${step === \"group\" ? \"bg-primary\" : \"bg-primary\"}`} />\n                <div className={`w-2 h-2 rounded-full ${step === \"project\" ? \"bg-primary\" : \"bg-gray-300\"}`} />\n              </div>\n            </div>\n          </SheetHeader>\n\n          <div className=\"flex-1 overflow-y-auto px-5 py-6\">\n            {step === \"group\" && (\n              <div className=\"space-y-6\">\n                <div>\n                  <h2 className=\"text-3xl font-bold text-gray-900\">Name your Group</h2>\n                  <p className=\"text-gray-500 mt-2\">\n                    Eg. \"Chioma's Wedding\", \"Office Ajo\", \"Church Youth\"\n                  </p>\n                </div>\n\n                <Form {...groupForm}>\n                  <form onSubmit={groupForm.handleSubmit(onGroupSubmit)} className=\"space-y-6\">\n                    <FormField\n                      control={groupForm.control}\n                      name=\"name\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormControl>\n                            <Input \n                              placeholder=\"Group Name\" \n                              className=\"h-14 text-lg rounded-2xl border-2 border-primary focus:border-primary\"\n                              autoFocus\n                              {...field}\n                              data-testid=\"input-group-name\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <button\n                      type=\"submit\"\n                      disabled={createGroupMutation.isPending || !groupForm.watch(\"name\")}\n                      className=\"w-full bg-primary hover:bg-primary/90 text-white font-semibold text-lg py-4 rounded-full disabled:opacity-50 transition-all active:scale-[0.98]\"\n                      data-testid=\"button-create-group-submit\"\n                    >\n                      {createGroupMutation.isPending ? (\n                        <div className=\"flex items-center justify-center gap-2\">\n                          <div className=\"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\n                          Creating...\n                        </div>\n                      ) : (\n                        \"Next: Add a Project\"\n                      )}\n                    </button>\n                  </form>\n                </Form>\n              </div>\n            )}\n\n            {step === \"project\" && (\n              <div className=\"space-y-6\">\n                <div className=\"flex items-center gap-3 bg-green-50 rounded-xl p-3 mb-2\">\n                  <CheckCircle className=\"h-5 w-5 text-green-600\" />\n                  <span className=\"text-green-800 font-medium\">\"{createdGroup?.name}\" created</span>\n                </div>\n\n                <div>\n                  <h2 className=\"text-2xl font-bold text-gray-900\">Add Your First Project</h2>\n                  <p className=\"text-gray-500 mt-1\">\n                    What are you collecting money for?\n                  </p>\n                </div>\n\n                <Form {...projectForm}>\n                  <form onSubmit={projectForm.handleSubmit(onProjectSubmit)} className=\"space-y-5\">\n                    <FormField\n                      control={projectForm.control}\n                      name=\"name\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel className=\"text-gray-700 font-medium\">Project Name</FormLabel>\n                          <FormControl>\n                            <Input \n                              placeholder=\"e.g. Wedding Gift, Monthly Ajo\" \n                              className=\"h-14 text-lg rounded-2xl border-2 border-gray-200 focus:border-primary\"\n                              autoFocus\n                              {...field}\n                              data-testid=\"input-project-name\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={projectForm.control}\n                      name=\"projectType\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel className=\"text-gray-700 font-medium\">Type</FormLabel>\n                          <Select onValueChange={field.onChange} defaultValue={field.value}>\n                            <FormControl>\n                              <SelectTrigger className=\"h-14 text-lg rounded-2xl border-2 border-gray-200\" data-testid=\"select-project-type\">\n                                <SelectValue placeholder=\"Select project type\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              {projectTypes.map((type) => (\n                                <SelectItem key={type.value} value={type.value}>\n                                  <div>\n                                    <div className=\"font-medium\">{type.label}</div>\n                                    <div className=\"text-xs text-gray-500\">{type.description}</div>\n                                  </div>\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    {requiresTarget && (\n                      <FormField\n                        control={projectForm.control}\n                        name=\"targetAmount\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-gray-700 font-medium\">Target Amount (₦)</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"number\" \n                                placeholder=\"e.g. 50000\" \n                                className=\"h-14 text-lg rounded-2xl border-2 border-gray-200 focus:border-primary\"\n                                {...field}\n                                data-testid=\"input-target-amount\"\n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    )}\n\n                    {!requiresTarget && (\n                      <div className=\"bg-blue-50 border border-blue-100 rounded-2xl p-4 text-sm text-blue-700\">\n                        No target needed for {projectType === \"monthly\" ? \"monthly\" : \"yearly\"} dues. \n                        Contributions will be tracked as they come in.\n                      </div>\n                    )}\n\n                    <FormField\n                      control={projectForm.control}\n                      name=\"deadline\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel className=\"text-gray-700 font-medium\">Due Date (Optional)</FormLabel>\n                          <FormControl>\n                            <div className=\"relative\">\n                              <Input \n                                type=\"date\"\n                                placeholder=\"Pick a date\"\n                                className=\"h-14 text-lg rounded-2xl border-2 border-gray-200 focus:border-primary pl-12\"\n                                {...field} \n                                value={typeof field.value === 'string' ? field.value : \"\"}\n                                onChange={(e) => field.onChange(e.target.value || undefined)}\n                                data-testid=\"input-deadline\"\n                              />\n                              <Calendar className=\"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400\" />\n                            </div>\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <div className=\"border-t border-gray-100 pt-5\">\n                      <button\n                        type=\"button\"\n                        onClick={() => setShowPaymentDetails(!showPaymentDetails)}\n                        className=\"w-full flex items-center justify-between text-left\"\n                        data-testid=\"button-toggle-payment-details\"\n                      >\n                        <div className=\"flex items-center gap-3\">\n                          <div className=\"w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center\">\n                            <Building2 className=\"h-5 w-5 text-primary\" />\n                          </div>\n                          <div>\n                            <p className=\"font-medium text-gray-900\">Payment Account Details</p>\n                            <p className=\"text-sm text-gray-500\">Bank info shown to members when paying</p>\n                          </div>\n                        </div>\n                        {showPaymentDetails ? (\n                          <ChevronUp className=\"h-5 w-5 text-gray-400\" />\n                        ) : (\n                          <ChevronDown className=\"h-5 w-5 text-gray-400\" />\n                        )}\n                      </button>\n\n                      {showPaymentDetails && (\n                        <div className=\"mt-4 space-y-4\">\n                          <FormField\n                            control={projectForm.control}\n                            name=\"bankName\"\n                            render={({ field }) => (\n                              <FormItem>\n                                <FormLabel className=\"text-gray-700\">Bank Name</FormLabel>\n                                <FormControl>\n                                  <Input \n                                    placeholder=\"e.g. GTBank, First Bank\" \n                                    className=\"h-12 rounded-xl border-2 border-gray-200 focus:border-primary\"\n                                    {...field}\n                                    value={field.value || \"\"}\n                                    data-testid=\"input-bank-name\"\n                                  />\n                                </FormControl>\n                                <FormMessage />\n                              </FormItem>\n                            )}\n                          />\n\n                          <FormField\n                            control={projectForm.control}\n                            name=\"accountNumber\"\n                            render={({ field }) => (\n                              <FormItem>\n                                <FormLabel className=\"text-gray-700\">Account Number</FormLabel>\n                                <FormControl>\n                                  <Input \n                                    placeholder=\"e.g. 0123456789\" \n                                    className=\"h-12 rounded-xl border-2 border-gray-200 focus:border-primary\"\n                                    {...field}\n                                    value={field.value || \"\"}\n                                    data-testid=\"input-account-number\"\n                                  />\n                                </FormControl>\n                                <FormMessage />\n                              </FormItem>\n                            )}\n                          />\n\n                          <FormField\n                            control={projectForm.control}\n                            name=\"accountName\"\n                            render={({ field }) => (\n                              <FormItem>\n                                <FormLabel className=\"text-gray-700\">Account Name</FormLabel>\n                                <FormControl>\n                                  <Input \n                                    placeholder=\"e.g. Chioma Okonkwo\" \n                                    className=\"h-12 rounded-xl border-2 border-gray-200 focus:border-primary\"\n                                    {...field}\n                                    value={field.value || \"\"}\n                                    data-testid=\"input-account-name\"\n                                  />\n                                </FormControl>\n                                <FormMessage />\n                              </FormItem>\n                            )}\n                          />\n\n                          <FormField\n                            control={projectForm.control}\n                            name=\"paymentInstructions\"\n                            render={({ field }) => (\n                              <FormItem>\n                                <FormLabel className=\"text-gray-700\">Additional Instructions</FormLabel>\n                                <FormControl>\n                                  <Textarea \n                                    placeholder=\"e.g. Use your name as reference\" \n                                    rows={2}\n                                    className=\"rounded-xl border-2 border-gray-200 focus:border-primary resize-none\"\n                                    {...field}\n                                    value={field.value || \"\"}\n                                    data-testid=\"input-payment-instructions\"\n                                  />\n                                </FormControl>\n                                <FormMessage />\n                              </FormItem>\n                            )}\n                          />\n                        </div>\n                      )}\n                    </div>\n\n                    <button\n                      type=\"submit\"\n                      disabled={createProjectMutation.isPending || !projectForm.watch(\"name\")}\n                      className=\"w-full bg-primary hover:bg-primary/90 text-white font-semibold text-lg py-4 rounded-full disabled:opacity-50 transition-all active:scale-[0.98] mt-6\"\n                      data-testid=\"button-create-project-submit\"\n                    >\n                      {createProjectMutation.isPending ? (\n                        <div className=\"flex items-center justify-center gap-2\">\n                          <div className=\"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\n                          Creating...\n                        </div>\n                      ) : (\n                        \"Complete Setup\"\n                      )}\n                    </button>\n                  </form>\n                </Form>\n              </div>\n            )}\n          </div>\n        </div>\n      </SheetContent>\n    </Sheet>\n  );\n}\n","path":null,"size_bytes":22099,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1383,"size_tokens":null},"client/src/pages/updates.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Navigation } from \"@/components/navigation\";\nimport { \n  Megaphone, \n  Bell, \n  Calendar,\n  Users,\n  TrendingUp,\n  AlertCircle,\n  CheckCircle,\n  Info,\n  MessageCircle\n} from \"lucide-react\";\nimport { getCurrentUser } from \"@/lib/auth\";\nimport { formatNaira } from \"@/lib/currency\";\nimport { Link } from \"wouter\";\n\nexport default function Updates() {\n  const user = getCurrentUser();\n\n  // Fetch user's notifications and updates\n  const { data: notifications = [], isLoading: notificationsLoading } = useQuery<any[]>({\n    queryKey: [\"/api/notifications\", user?.id],\n    enabled: !!user,\n  });\n\n  // Fetch group updates and announcements\n  const { data: groupUpdates = [], isLoading: updatesLoading } = useQuery<any[]>({\n    queryKey: [\"/api/group-updates\", user?.id],\n    enabled: !!user,\n  });\n\n  // Fetch user's groups for context\n  const { data: userGroups = [] } = useQuery<any[]>({\n    queryKey: [\"/api/groups\", \"user\", user?.id],\n    enabled: !!user,\n  });\n\n  const getNotificationIcon = (type: string) => {\n    switch (type) {\n      case 'payment_approved':\n        return <CheckCircle className=\"h-5 w-5 text-green-600\" />;\n      case 'payment_rejected':\n        return <AlertCircle className=\"h-5 w-5 text-red-600\" />;\n      case 'group_update':\n        return <Megaphone className=\"h-5 w-5 text-blue-600\" />;\n      case 'reminder':\n        return <Bell className=\"h-5 w-5 text-orange-600\" />;\n      case 'milestone':\n        return <TrendingUp className=\"h-5 w-5 text-purple-600\" />;\n      default:\n        return <Info className=\"h-5 w-5 text-gray-600\" />;\n    }\n  };\n\n  const getNotificationColor = (type: string) => {\n    switch (type) {\n      case 'payment_approved':\n        return 'bg-green-50 border-green-200';\n      case 'payment_rejected':\n        return 'bg-red-50 border-red-200';\n      case 'group_update':\n        return 'bg-blue-50 border-blue-200';\n      case 'reminder':\n        return 'bg-orange-50 border-orange-200';\n      case 'milestone':\n        return 'bg-purple-50 border-purple-200';\n      default:\n        return 'bg-gray-50 border-gray-200';\n    }\n  };\n\n  // Mock data for demonstration since we don't have real notifications yet\n  const mockNotifications = [\n    {\n      id: '1',\n      type: 'payment_approved',\n      title: 'Payment Approved',\n      message: 'Your contribution of ₦5,000 to \"Wedding Fund\" has been approved by the admin.',\n      groupName: 'Wedding Fund',\n      createdAt: new Date().toISOString(),\n      read: false,\n    },\n    {\n      id: '2',\n      type: 'group_update',\n      title: 'Group Milestone Reached',\n      message: 'Congratulations! \"Office Party Fund\" has reached 75% of its target amount.',\n      groupName: 'Office Party Fund',\n      createdAt: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(),\n      read: false,\n    },\n    {\n      id: '3',\n      type: 'reminder',\n      title: 'Payment Reminder',\n      message: 'Don\\'t forget to make your monthly contribution to \"Savings Circle\".',\n      groupName: 'Savings Circle',\n      createdAt: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),\n      read: true,\n    },\n  ];\n\n  const mockGroupUpdates = [\n    {\n      id: '1',\n      groupName: 'Wedding Fund',\n      title: 'Updated Bank Account Details',\n      message: 'Please note that we have updated our bank account details. Use the new account for all future contributions.',\n      priority: 'high',\n      createdAt: new Date().toISOString(),\n    },\n    {\n      id: '2',\n      groupName: 'Office Party Fund',\n      title: 'Target Amount Adjusted',\n      message: 'Based on the latest venue quotes, we have increased our target amount to ₦200,000.',\n      priority: 'medium',\n      createdAt: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(),\n    },\n  ];\n\n  if (notificationsLoading || updatesLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <Navigation />\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\n          <div className=\"animate-pulse space-y-6\">\n            <div className=\"h-32 bg-gray-200 rounded-xl\"></div>\n            <div className=\"space-y-4\">\n              {[...Array(3)].map((_, i) => (\n                <div key={i} className=\"h-24 bg-gray-200 rounded-xl\"></div>\n              ))}\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  const displayNotifications = notifications.length > 0 ? notifications : mockNotifications;\n  const displayUpdates = groupUpdates.length > 0 ? groupUpdates : mockGroupUpdates;\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 pb-20 sm:pb-0\">\n      <Navigation />\n      \n      <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\n        {/* Header */}\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">Updates & Notifications</h1>\n          <p className=\"text-gray-600\">Stay updated with your group activities and important announcements.</p>\n        </div>\n\n        {/* Quick Stats */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">Unread Notifications</p>\n                  <p className=\"text-2xl font-bold text-orange-600\">\n                    {displayNotifications.filter(n => !n.read).length}\n                  </p>\n                  <p className=\"text-xs text-orange-600\">Need attention</p>\n                </div>\n                <div className=\"w-12 h-12 bg-orange-50 rounded-full flex items-center justify-center\">\n                  <Bell className=\"text-orange-500 h-6 w-6\" />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">Active Groups</p>\n                  <p className=\"text-2xl font-bold text-nigerian-green\">\n                    {userGroups.length}\n                  </p>\n                  <p className=\"text-xs text-green-600\">Following updates</p>\n                </div>\n                <div className=\"w-12 h-12 bg-green-50 rounded-full flex items-center justify-center\">\n                  <Users className=\"text-nigerian-green h-6 w-6\" />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">Recent Updates</p>\n                  <p className=\"text-2xl font-bold text-blue-600\">\n                    {displayUpdates.length}\n                  </p>\n                  <p className=\"text-xs text-blue-600\">This week</p>\n                </div>\n                <div className=\"w-12 h-12 bg-blue-50 rounded-full flex items-center justify-center\">\n                  <Megaphone className=\"text-blue-500 h-6 w-6\" />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Recent Notifications */}\n        <Card className=\"mb-8\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center\">\n              <Bell className=\"h-5 w-5 mr-2 text-nigerian-green\" />\n              Recent Notifications\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {displayNotifications.length === 0 ? (\n              <div className=\"text-center py-8\">\n                <Bell className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No notifications yet</h3>\n                <p className=\"text-gray-600\">\n                  You'll receive notifications when admins approve payments or make announcements.\n                </p>\n              </div>\n            ) : (\n              <div className=\"space-y-4\">\n                {displayNotifications.map((notification) => (\n                  <div\n                    key={notification.id}\n                    className={`p-4 rounded-lg border transition-colors ${\n                      !notification.read ? 'bg-blue-50 border-blue-200' : 'bg-gray-50 border-gray-200'\n                    }`}\n                    data-testid={`notification-${notification.id}`}\n                  >\n                    <div className=\"flex items-start space-x-3\">\n                      <div className=\"flex-shrink-0 mt-1\">\n                        {getNotificationIcon(notification.type)}\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-center justify-between mb-1\">\n                          <h4 className=\"text-sm font-medium text-gray-900\">\n                            {notification.title}\n                          </h4>\n                          <div className=\"flex items-center space-x-2\">\n                            {!notification.read && (\n                              <Badge variant=\"secondary\" className=\"bg-blue-100 text-blue-800\">\n                                New\n                              </Badge>\n                            )}\n                            <span className=\"text-xs text-gray-500\">\n                              {new Date(notification.createdAt).toLocaleDateString()}\n                            </span>\n                          </div>\n                        </div>\n                        <p className=\"text-sm text-gray-700 mb-2\">\n                          {notification.message}\n                        </p>\n                        {notification.groupName && (\n                          <div className=\"flex items-center text-xs text-gray-500\">\n                            <Users className=\"h-3 w-3 mr-1\" />\n                            {notification.groupName}\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Group Announcements */}\n        <Card className=\"mb-8\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center\">\n              <Megaphone className=\"h-5 w-5 mr-2 text-nigerian-green\" />\n              Group Announcements\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {displayUpdates.length === 0 ? (\n              <div className=\"text-center py-8\">\n                <Megaphone className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No announcements</h3>\n                <p className=\"text-gray-600\">\n                  Group admins will post important updates and announcements here.\n                </p>\n              </div>\n            ) : (\n              <div className=\"space-y-4\">\n                {displayUpdates.map((update) => (\n                  <div\n                    key={update.id}\n                    className={`p-4 rounded-lg border ${\n                      update.priority === 'high' ? 'bg-red-50 border-red-200' :\n                      update.priority === 'medium' ? 'bg-yellow-50 border-yellow-200' :\n                      'bg-gray-50 border-gray-200'\n                    }`}\n                    data-testid={`update-${update.id}`}\n                  >\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center space-x-2 mb-2\">\n                          <h4 className=\"text-lg font-medium text-gray-900\">\n                            {update.title}\n                          </h4>\n                          {update.priority === 'high' && (\n                            <Badge variant=\"destructive\">\n                              High Priority\n                            </Badge>\n                          )}\n                          {update.priority === 'medium' && (\n                            <Badge className=\"bg-yellow-100 text-yellow-800\">\n                              Medium Priority\n                            </Badge>\n                          )}\n                        </div>\n                        <p className=\"text-sm text-gray-700 mb-3\">\n                          {update.message}\n                        </p>\n                        <div className=\"flex items-center justify-between text-sm text-gray-500\">\n                          <div className=\"flex items-center\">\n                            <Users className=\"h-4 w-4 mr-1\" />\n                            {update.groupName}\n                          </div>\n                          <div className=\"flex items-center\">\n                            <Calendar className=\"h-4 w-4 mr-1\" />\n                            {new Date(update.createdAt).toLocaleDateString()}\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","path":null,"size_bytes":13570,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent, DialogTitle, DialogDescription } from \"@/components/ui/dialog\"\nimport * as VisuallyHidden from \"@radix-ui/react-visually-hidden\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <VisuallyHidden.Root>\n          <DialogTitle>Command Menu</DialogTitle>\n          <DialogDescription>Search and select commands</DialogDescription>\n        </VisuallyHidden.Root>\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":5170,"size_tokens":null},"client/src/lib/currency.ts":{"content":"export function formatNaira(amount: string | number): string {\n  const numAmount = typeof amount === 'string' ? parseFloat(amount) : amount;\n  return new Intl.NumberFormat('en-NG', {\n    style: 'currency',\n    currency: 'NGN',\n    minimumFractionDigits: 0,\n    maximumFractionDigits: 0,\n  }).format(numAmount).replace('NGN', '₦');\n}\n\nexport function formatNumber(amount: string | number): string {\n  const numAmount = typeof amount === 'string' ? parseFloat(amount) : amount;\n  return new Intl.NumberFormat('en-NG').format(numAmount);\n}\n\nexport function calculateProgress(collected: string | number, target: string | number): number {\n  const collectedNum = typeof collected === 'string' ? parseFloat(collected) : collected;\n  const targetNum = typeof target === 'string' ? parseFloat(target) : target;\n  \n  if (targetNum === 0) return 0;\n  return Math.round((collectedNum / targetNum) * 100);\n}\n","path":null,"size_bytes":898,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n\nexport function formatNaira(amount: string | number) {\n  const num = typeof amount === 'string' ? parseFloat(amount) : amount;\n  return new Intl.NumberFormat('en-NG', {\n    style: 'currency',\n    currency: 'NGN',\n    minimumFractionDigits: 0,\n    maximumFractionDigits: 0,\n  }).format(num);\n}\n","path":null,"size_bytes":460,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":971,"size_tokens":null},"server/index.ts":{"content":"import http from \"http\";\nimport express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\nimport { handleDynamicOGTags } from \"./og-middleware\";\n\nconst app = express();\n// Increase body parser limits to handle image uploads (up to 50MB)\napp.use(express.json({ limit: \"50mb\" }));\napp.use(express.urlencoded({ extended: false, limit: \"50mb\" }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"…\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // Dynamic OG tags middleware for social media crawlers\n  app.use(async (req, res, next) => {\n    const handled = await handleDynamicOGTags(req, res, next);\n    if (!handled) {\n      next();\n    }\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  // Bind explicitly to IPv4 to avoid ENOTSUP when IPv6 (::1) is not supported\n  const host = process.env.HOST || \"127.0.0.1\";\n\n  // server.listen(\n  //   {\n  //     port,\n  //     host,\n  //     reusePort: true,\n  //   },\n  //   () => {\n  //     log(`serving on http://${host}:${port}`);\n  //   }\n  // );\n\n  const DEFAULT_PORT = parseInt(process.env.PORT || \"5000\", 10);\n\n  // In production (Render, etc.), bind to 0.0.0.0 first. In development, try localhost first.\n  const isProduction = process.env.NODE_ENV === \"production\";\n  const tryHosts = isProduction \n    ? [\"0.0.0.0\", \"127.0.0.1\", \"::\"]\n    : [process.env.HOST || \"127.0.0.1\", \"0.0.0.0\", \"::\"];\n\n  async function attemptListen(\n    port: number,\n    host: string\n  ): Promise<http.Server> {\n    return new Promise((resolve, reject) => {\n      const srv = http.createServer(app); // app already defined above\n\n      const onError = (err: NodeJS.ErrnoException) => {\n        srv.removeListener(\"listening\", onListening);\n        try {\n          srv.close();\n        } catch {}\n        reject(err);\n      };\n\n      const onListening = () => {\n        srv.removeListener(\"error\", onError);\n        resolve(srv);\n      };\n\n      srv.once(\"error\", onError);\n      srv.once(\"listening\", onListening);\n\n      try {\n        srv.listen(port, host);\n      } catch (syncErr) {\n        srv.removeListener(\"error\", onError);\n        srv.removeListener(\"listening\", onListening);\n        try {\n          srv.close();\n        } catch {}\n        reject(syncErr);\n      }\n    });\n  }\n\n  (async () => {\n    const port = DEFAULT_PORT;\n    let boundServer: http.Server | null = null;\n    const errors: { host: string; err: any }[] = [];\n\n    for (const host of tryHosts) {\n      try {\n        console.log(`Trying to listen on ${host}:${port} ...`);\n        boundServer = await attemptListen(port, host);\n        console.log(`Server listening on http://${host}:${port}`);\n        break;\n      } catch (err: any) {\n        errors.push({ host, err });\n        console.error(`Failed on ${host}:${port}`, err.code, err.message);\n      }\n    }\n\n    if (!boundServer) {\n      console.error(\"All attempts failed:\", errors);\n      process.exit(1);\n    }\n\n    boundServer.on(\"error\", (err) => {\n      console.error(\"Server error:\", err);\n    });\n  })();\n})();\n","path":null,"size_bytes":4613,"size_tokens":null},"client/src/components/payment-approval-modal.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { \n  CheckCircle, \n  XCircle, \n  User, \n  DollarSign, \n  Calendar, \n  FileText, \n  CreditCard,\n  ImageIcon\n} from \"lucide-react\";\nimport { formatNaira } from \"@/lib/currency\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { ContributionWithDetails } from \"@shared/schema\";\n\ninterface PaymentApprovalModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  contribution: ContributionWithDetails | null;\n}\n\nexport function PaymentApprovalModal({\n  open,\n  onOpenChange,\n  contribution,\n}: PaymentApprovalModalProps) {\n  const [rejectionReason, setRejectionReason] = useState(\"\");\n  const [showRejectionForm, setShowRejectionForm] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const confirmMutation = useMutation({\n    mutationFn: async (contributionId: string) => {\n      const response = await apiRequest(\"PATCH\", `/api/contributions/${contributionId}/confirm`);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/contributions\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/stats\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/groups\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n      toast({\n        title: \"Payment Confirmed\",\n        description: \"Payment has been confirmed and added to the total.\",\n      });\n      onOpenChange(false);\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to confirm payment. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const rejectMutation = useMutation({\n    mutationFn: async ({ contributionId, reason }: { contributionId: string; reason?: string }) => {\n      const response = await apiRequest(\"PATCH\", `/api/contributions/${contributionId}/reject`, {\n        reason: reason || undefined\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/contributions\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/stats\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/groups\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n      toast({\n        title: \"Payment Rejected\",\n        description: \"Payment has been rejected and contributor has been notified.\",\n      });\n      onOpenChange(false);\n      setShowRejectionForm(false);\n      setRejectionReason(\"\");\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to reject payment. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleConfirm = () => {\n    if (contribution) {\n      confirmMutation.mutate(contribution.id);\n    }\n  };\n\n  const handleReject = () => {\n    if (contribution) {\n      rejectMutation.mutate({\n        contributionId: contribution.id,\n        reason: rejectionReason.trim() || undefined\n      });\n    }\n  };\n\n  if (!contribution) return null;\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <DollarSign className=\"h-5 w-5 text-green-600\" />\n            Review Payment Submission\n          </DialogTitle>\n          <DialogDescription>\n            Review and approve or reject this payment contribution\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-6\">\n          {/* Payment Status */}\n          <div className=\"flex items-center justify-between p-4 bg-orange-50 rounded-lg\">\n            <div className=\"flex items-center gap-2\">\n              <Badge variant=\"secondary\" className=\"bg-orange-100 text-orange-800\">\n                {contribution.status.toUpperCase()}\n              </Badge>\n              <span className=\"text-sm text-orange-700\">Awaiting admin approval</span>\n            </div>\n            <div className=\"text-sm text-orange-600\">\n              Submitted {new Date(contribution.createdAt).toLocaleDateString()}\n            </div>\n          </div>\n\n          {/* Payment Details */}\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div className=\"space-y-4\">\n              <div>\n                <Label className=\"flex items-center gap-2 text-sm font-medium text-gray-700\">\n                  <User className=\"h-4 w-4\" />\n                  Contributor\n                </Label>\n                <p className=\"mt-1 text-sm font-medium text-gray-900\">\n                  {contribution.userName}\n                </p>\n              </div>\n\n              <div>\n                <Label className=\"flex items-center gap-2 text-sm font-medium text-gray-700\">\n                  <DollarSign className=\"h-4 w-4\" />\n                  Amount\n                </Label>\n                <p className=\"mt-1 text-lg font-bold text-green-600\">\n                  {formatNaira(Number(contribution.amount))}\n                </p>\n              </div>\n\n              <div>\n                <Label className=\"flex items-center gap-2 text-sm font-medium text-gray-700\">\n                  <Calendar className=\"h-4 w-4\" />\n                  Date Submitted\n                </Label>\n                <p className=\"mt-1 text-sm text-gray-900\">\n                  {new Date(contribution.createdAt).toLocaleDateString('en-NG', {\n                    year: 'numeric',\n                    month: 'long',\n                    day: 'numeric',\n                    hour: '2-digit',\n                    minute: '2-digit'\n                  })}\n                </p>\n              </div>\n            </div>\n\n            <div className=\"space-y-4\">\n              <div>\n                <Label className=\"flex items-center gap-2 text-sm font-medium text-gray-700\">\n                  <FileText className=\"h-4 w-4\" />\n                  Group/Project\n                </Label>\n                <p className=\"mt-1 text-sm font-medium text-gray-900\">\n                  {contribution.groupName}\n                  {contribution.projectName && (\n                    <span className=\"text-gray-600\"> → {contribution.projectName}</span>\n                  )}\n                </p>\n              </div>\n\n              {contribution.transactionRef && (\n                <div>\n                  <Label className=\"flex items-center gap-2 text-sm font-medium text-gray-700\">\n                    <CreditCard className=\"h-4 w-4\" />\n                    Transaction Reference\n                  </Label>\n                  <p className=\"mt-1 text-sm font-mono text-gray-900\">\n                    {contribution.transactionRef}\n                  </p>\n                </div>\n              )}\n\n              {contribution.description && (\n                <div>\n                  <Label className=\"flex items-center gap-2 text-sm font-medium text-gray-700\">\n                    <FileText className=\"h-4 w-4\" />\n                    Description\n                  </Label>\n                  <p className=\"mt-1 text-sm text-gray-900\">\n                    {contribution.description}\n                  </p>\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* Proof of Payment */}\n          {contribution.proofOfPayment && (\n            <div>\n              <Label className=\"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2\">\n                <ImageIcon className=\"h-4 w-4\" />\n                Proof of Payment\n              </Label>\n              <div className=\"border rounded-lg p-2 bg-gray-50\">\n                <img\n                  src={contribution.proofOfPayment}\n                  alt=\"Proof of payment\"\n                  className=\"max-w-full max-h-96 object-contain rounded mx-auto\"\n                />\n              </div>\n            </div>\n          )}\n\n          {/* Rejection Form */}\n          {showRejectionForm && (\n            <div className=\"p-4 bg-red-50 rounded-lg border border-red-200\">\n              <Label htmlFor=\"rejectionReason\" className=\"text-sm font-medium text-red-800\">\n                Rejection Reason (Optional)\n              </Label>\n              <Textarea\n                id=\"rejectionReason\"\n                placeholder=\"Provide a reason for rejection (optional)\"\n                value={rejectionReason}\n                onChange={(e) => setRejectionReason(e.target.value)}\n                className=\"mt-2\"\n                rows={3}\n              />\n              <p className=\"text-xs text-red-600 mt-1\">\n                The contributor will be notified with this reason.\n              </p>\n            </div>\n          )}\n        </div>\n\n        <DialogFooter className=\"gap-2\">\n          <Button variant=\"outline\" onClick={() => onOpenChange(false)}>\n            Close\n          </Button>\n          \n          {contribution.status === \"pending\" && (\n            <>\n              {showRejectionForm ? (\n                <>\n                  <Button\n                    variant=\"outline\"\n                    onClick={() => {\n                      setShowRejectionForm(false);\n                      setRejectionReason(\"\");\n                    }}\n                  >\n                    Cancel Rejection\n                  </Button>\n                  <Button\n                    variant=\"destructive\"\n                    onClick={handleReject}\n                    disabled={rejectMutation.isPending}\n                    data-testid=\"confirm-reject-button\"\n                  >\n                    <XCircle className=\"h-4 w-4 mr-2\" />\n                    {rejectMutation.isPending ? \"Rejecting...\" : \"Confirm Rejection\"}\n                  </Button>\n                </>\n              ) : (\n                <>\n                  <Button\n                    variant=\"destructive\"\n                    onClick={() => setShowRejectionForm(true)}\n                    data-testid=\"reject-button\"\n                  >\n                    <XCircle className=\"h-4 w-4 mr-2\" />\n                    Reject\n                  </Button>\n                  <Button\n                    onClick={handleConfirm}\n                    disabled={confirmMutation.isPending}\n                    className=\"bg-green-600 hover:bg-green-700\"\n                    data-testid=\"confirm-button\"\n                  >\n                    <CheckCircle className=\"h-4 w-4 mr-2\" />\n                    {confirmMutation.isPending ? \"Confirming...\" : \"Confirm Payment\"}\n                  </Button>\n                </>\n              )}\n            </>\n          )}\n\n          {contribution.status === \"confirmed\" && (\n            <Badge variant=\"secondary\" className=\"bg-green-100 text-green-800\">\n              <CheckCircle className=\"h-4 w-4 mr-1\" />\n              Already Confirmed\n            </Badge>\n          )}\n\n          {contribution.status === \"rejected\" && (\n            <Badge variant=\"secondary\" className=\"bg-red-100 text-red-800\">\n              <XCircle className=\"h-4 w-4 mr-1\" />\n              Rejected\n            </Badge>\n          )}\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}","path":null,"size_bytes":11637,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/pages/group-registration-old.tsx":{"content":"import { useState } from \"react\";\nimport { useRoute, useLocation } from \"wouter\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Users, Calendar, Target, CheckCircle, AlertCircle, Phone, MessageSquare } from \"lucide-react\";\nimport { formatNaira, calculateProgress } from \"@/lib/currency\";\nimport { getCurrentUser } from \"@/lib/auth\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\n\n// Form validation schemas\nconst registrationFormSchema = z.object({\n  username: z.string().min(3, \"Username must be at least 3 characters\").max(20, \"Username must be less than 20 characters\"),\n  fullName: z.string().min(2, \"Full name is required\"),\n  phoneNumber: z.string().regex(/^(\\+234|0)[7-9]\\d{9}$/, \"Please enter a valid Nigerian phone number\"),\n});\n\nconst otpFormSchema = z.object({\n  otp: z.string().length(6, \"OTP must be 6 digits\"),\n});\n\ntype RegistrationFormData = z.infer<typeof registrationFormSchema>;\ntype OtpFormData = z.infer<typeof otpFormSchema>;\n\nexport default function GroupRegistration() {\n  const [match, params] = useRoute(\"/register/:link\");\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const user = getCurrentUser();\n  const [isJoining, setIsJoining] = useState(false);\n  const [step, setStep] = useState<\"group-info\" | \"registration\" | \"otp-verification\" | \"success\">(\"group-info\");\n  const [otpData, setOtpData] = useState<{ phoneNumber: string; expiresAt: string } | null>(null);\n  const [newUser, setNewUser] = useState<any>(null);\n\n  const { data: group, isLoading, error } = useQuery({\n    queryKey: [\"/api/groups/registration\", params?.link],\n    enabled: !!params?.link,\n  });\n\n  const registrationForm = useForm<RegistrationFormData>({\n    resolver: zodResolver(registrationFormSchema),\n    defaultValues: {\n      username: \"\",\n      fullName: \"\",\n      phoneNumber: \"\",\n    },\n  });\n\n  const otpForm = useForm<OtpFormData>({\n    resolver: zodResolver(otpFormSchema),\n    defaultValues: {\n      otp: \"\",\n    },\n  });\n\n  const sendOtpMutation = useMutation({\n    mutationFn: async (phoneNumber: string) => {\n      const response = await apiRequest(\"POST\", \"/api/auth/send-otp\", {\n        phoneNumber,\n      });\n      return response.json();\n    },\n    onSuccess: (data, phoneNumber) => {\n      setOtpData({ phoneNumber, expiresAt: data.expiresAt });\n      setStep(\"otp-verification\");\n      toast({\n        title: \"OTP Sent!\",\n        description: `Verification code sent to ${phoneNumber}. Check your WhatsApp messages.`,\n      });\n      \n      // For development, show the OTP in console\n      if (data.developmentOtp) {\n        console.log(\"Development OTP:\", data.developmentOtp);\n        toast({\n          title: \"Development Mode\",\n          description: `OTP: ${data.developmentOtp} (Check console for details)`,\n          variant: \"default\",\n        });\n      }\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Failed to Send OTP\",\n        description: error.message || \"Please try again later.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const registerMutation = useMutation({\n    mutationFn: async (data: RegistrationFormData & { otp: string }) => {\n      if (!group) throw new Error(\"Group not found\");\n      \n      const response = await apiRequest(\"POST\", `/api/groups/${group.id}/register-with-otp`, data);\n      return response.json();\n    },\n    onSuccess: (data) => {\n      setNewUser(data.user);\n      setStep(\"success\");\n      toast({\n        title: \"Registration Successful!\",\n        description: `Welcome to ${group?.name}! You can now make contributions.`,\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Registration Failed\",\n        description: error.message || \"Please try again later.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const joinGroupMutation = useMutation({\n    mutationFn: async () => {\n      if (!group || !user) throw new Error(\"Missing group or user data\");\n      \n      const response = await apiRequest(\"POST\", `/api/groups/${group.id}/join`, {\n        userId: user.id,\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/groups\", \"user\", user?.id] });\n      toast({\n        title: \"Successfully Joined!\",\n        description: `You are now a member of ${group?.name}`,\n      });\n      setLocation(\"/member\");\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Failed to Join Group\",\n        description: error.message || \"Please try again later.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleJoinGroup = () => {\n    if (!user) {\n      setStep(\"registration\");\n      return;\n    }\n    \n    setIsJoining(true);\n    joinGroupMutation.mutate();\n  };\n\n  const handleRegistrationSubmit = (data: RegistrationFormData) => {\n    sendOtpMutation.mutate(data.phoneNumber);\n  };\n\n  const handleOtpSubmit = (data: OtpFormData) => {\n    const registrationData = registrationForm.getValues();\n    registerMutation.mutate({\n      ...registrationData,\n      otp: data.otp,\n    });\n  };\n\n  const handleLoginRedirect = () => {\n    // Store the group link in localStorage so user can return after login\n    localStorage.setItem('pendingGroupJoin', params?.link || '');\n    setLocation(\"/\");\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto mb-4\"></div>\n          <p className=\"text-gray-600 dark:text-gray-300\">Loading group details...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (error || !group) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center p-4\">\n        <Card className=\"max-w-md w-full\">\n          <CardContent className=\"pt-6\">\n            <div className=\"text-center\">\n              <AlertCircle className=\"h-12 w-12 text-red-500 mx-auto mb-4\" />\n              <h2 className=\"text-xl font-bold text-gray-900 mb-2\">Group Not Found</h2>\n              <p className=\"text-gray-600 mb-6\">\n                This group link is invalid or may have expired.\n              </p>\n              <Button onClick={() => setLocation(\"/\")} className=\"bg-nigerian-green hover:bg-forest-green\">\n                Go to Homepage\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  const progress = calculateProgress(group.collectedAmount, group.targetAmount);\n  const deadline = group.deadline ? new Date(group.deadline) : null;\n  const isExpired = deadline && deadline < new Date();\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <div className=\"container mx-auto px-4 py-8 max-w-2xl\">\n        {/* Header */}\n        <div className=\"text-center mb-8\">\n          <div className=\"w-16 h-16 bg-nigerian-green rounded-full flex items-center justify-center mx-auto mb-4\">\n            <Users className=\"text-white h-8 w-8\" />\n          </div>\n          <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">Join Group</h1>\n          <p className=\"text-gray-600\">You've been invited to contribute to a financial group</p>\n        </div>\n\n        {/* Group Info Card */}\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <div className=\"flex items-center justify-between\">\n              <CardTitle className=\"text-xl\">{group.name}</CardTitle>\n              <Badge className={group.status === \"active\" ? \"bg-green-100 text-green-800\" : \"bg-gray-100 text-gray-800\"}>\n                {group.status}\n              </Badge>\n            </div>\n            {group.description && (\n              <p className=\"text-gray-600 mt-2\">{group.description}</p>\n            )}\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-6\">\n              {/* Financial Progress */}\n              <div>\n                <div className=\"flex justify-between items-center mb-2\">\n                  <span className=\"text-sm font-medium text-gray-600\">Collection Progress</span>\n                  <span className=\"text-sm font-medium\">{progress}%</span>\n                </div>\n                <Progress value={progress} className=\"h-3 mb-3\" />\n                <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                  <div>\n                    <p className=\"text-gray-600\">Target Amount</p>\n                    <p className=\"font-semibold text-lg\">{formatNaira(group.targetAmount)}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-gray-600\">Collected</p>\n                    <p className=\"font-semibold text-lg text-green-600\">{formatNaira(group.collectedAmount)}</p>\n                  </div>\n                </div>\n              </div>\n\n              {/* Deadline */}\n              {deadline && (\n                <div className=\"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg\">\n                  <Calendar className=\"h-5 w-5 text-gray-600\" />\n                  <div>\n                    <p className=\"text-sm font-medium text-gray-900\">Collection Deadline</p>\n                    <p className={`text-sm ${isExpired ? 'text-red-600' : 'text-gray-600'}`}>\n                      {deadline.toLocaleDateString('en-NG', { \n                        year: 'numeric', \n                        month: 'long', \n                        day: 'numeric' \n                      })}\n                      {isExpired && \" (Expired)\"}\n                    </p>\n                  </div>\n                </div>\n              )}\n\n              {/* WhatsApp Link */}\n              {group.whatsappLink && (\n                <div className=\"flex items-center space-x-3 p-3 bg-green-50 rounded-lg\">\n                  <Users className=\"h-5 w-5 text-green-600\" />\n                  <div className=\"flex-1\">\n                    <p className=\"text-sm font-medium text-gray-900\">WhatsApp Group</p>\n                    <p className=\"text-sm text-gray-600\">Join the discussion group</p>\n                  </div>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => window.open(group.whatsappLink, '_blank')}\n                    className=\"border-green-600 text-green-600 hover:bg-green-50\"\n                  >\n                    Join Chat\n                  </Button>\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Action Section */}\n        <Card>\n          <CardContent className=\"pt-6\">\n            {user ? (\n              <div className=\"text-center\">\n                <CheckCircle className=\"h-12 w-12 text-green-500 mx-auto mb-4\" />\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">Ready to Join?</h3>\n                <p className=\"text-gray-600 mb-6\">\n                  You'll be able to make contributions and track the group's progress once you join.\n                </p>\n                <Button\n                  onClick={handleJoinGroup}\n                  disabled={isJoining || joinGroupMutation.isPending || isExpired}\n                  className=\"w-full bg-nigerian-green hover:bg-forest-green\"\n                >\n                  {isJoining || joinGroupMutation.isPending \n                    ? \"Joining Group...\" \n                    : isExpired \n                    ? \"Group Expired\" \n                    : \"Join Group\"\n                  }\n                </Button>\n                <p className=\"text-xs text-gray-500 mt-3\">\n                  By joining, you agree to contribute to this group's financial goal.\n                </p>\n              </div>\n            ) : (\n              <div className=\"text-center\">\n                <Users className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">Account Required</h3>\n                <p className=\"text-gray-600 mb-6\">\n                  Please create an account or login to join this group.\n                </p>\n                <div className=\"space-y-3\">\n                  <Button\n                    onClick={() => setLocation(\"/\")}\n                    className=\"w-full bg-nigerian-green hover:bg-forest-green\"\n                  >\n                    Login / Register\n                  </Button>\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":13149,"size_tokens":null},"client/src/components/copy-link-button.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Copy, Check, ExternalLink } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface CopyLinkButtonProps {\n  link: string;\n  className?: string;\n  variant?: \"default\" | \"outline\" | \"ghost\";\n  size?: \"sm\" | \"default\" | \"lg\";\n  showIcon?: boolean;\n  children?: React.ReactNode;\n}\n\nexport function CopyLinkButton({ \n  link, \n  className, \n  variant = \"outline\", \n  size = \"sm\",\n  showIcon = true,\n  children \n}: CopyLinkButtonProps) {\n  const [copied, setCopied] = useState(false);\n  const { toast } = useToast();\n\n  const handleCopy = async () => {\n    try {\n      await navigator.clipboard.writeText(link);\n      setCopied(true);\n      toast({\n        title: \"Link Copied!\",\n        description: \"Group link copied to clipboard. Share it with members.\",\n      });\n      \n      // Reset copied state after 2 seconds\n      setTimeout(() => setCopied(false), 2000);\n    } catch (error) {\n      // Fallback for browsers that don't support clipboard API\n      const textArea = document.createElement(\"textarea\");\n      textArea.value = link;\n      document.body.appendChild(textArea);\n      textArea.select();\n      document.execCommand(\"copy\");\n      document.body.removeChild(textArea);\n      \n      setCopied(true);\n      toast({\n        title: \"Link Copied!\",\n        description: \"Group link copied to clipboard. Share it with members.\",\n      });\n      \n      setTimeout(() => setCopied(false), 2000);\n    }\n  };\n\n  return (\n    <Button\n      onClick={handleCopy}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"transition-all duration-200\",\n        copied && \"bg-green-100 border-green-300 text-green-700\",\n        className\n      )}\n      data-testid=\"button-copy-link\"\n    >\n      {showIcon && (\n        copied ? (\n          <Check className=\"w-4 h-4 mr-2\" />\n        ) : (\n          <Copy className=\"w-4 h-4 mr-2\" />\n        )\n      )}\n      {children || (copied ? \"Copied!\" : \"Copy Link\")}\n    </Button>\n  );\n}\n\ninterface ShareableLinkDisplayProps {\n  link: string;\n  title?: string;\n  description?: string;\n  className?: string;\n}\n\nexport function ShareableLinkDisplay({ \n  link, \n  title = \"Group Link\", \n  description = \"Share this link with people you want to invite to your group\",\n  className \n}: ShareableLinkDisplayProps) {\n  return (\n    <div className={cn(\"space-y-3\", className)}>\n      <div>\n        <h3 className=\"text-sm font-medium text-gray-900 mb-1\">{title}</h3>\n        <p className=\"text-xs text-gray-600\">{description}</p>\n      </div>\n      \n      <div className=\"flex items-center space-x-2\">\n        <div className=\"flex-1 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2\">\n          <div className=\"flex items-center space-x-2\">\n            <ExternalLink className=\"w-4 h-4 text-gray-400\" />\n            <span className=\"text-sm text-gray-700 font-mono truncate\">\n              {link}\n            </span>\n          </div>\n        </div>\n        \n        <CopyLinkButton link={link} />\n      </div>\n      \n      <div className=\"text-xs text-gray-500\">\n        ✅ Easy to remember format • ✅ No complex codes • ✅ Works on all devices\n      </div>\n    </div>\n  );\n}","path":null,"size_bytes":3277,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"client/src/pages/make-payment.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useLocation } from \"wouter\";\nimport { Navigation } from \"@/components/navigation\";\nimport { BigButton, CardKontrib, DashboardSkeleton } from \"@/components/ui/kontrib-ui\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { PaymentAccountDetails } from \"@/components/payment-account-details\";\nimport { ArrowLeft, Upload, Users, CheckCircle, Camera, CreditCard } from \"lucide-react\";\nimport { getCurrentUser } from \"@/lib/auth\";\nimport { formatNaira } from \"@/lib/currency\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { PAYMENT_TYPES } from \"@/lib/payment-types\";\nimport { z } from \"zod\";\nimport type { GroupMember, Group, Project } from \"@shared/schema\";\n\nconst paymentSchema = z.object({\n  groupId: z.string().min(1, \"Please select a group\"),\n  purseId: z.string().optional(),\n  amount: z.string().min(1, \"Amount is required\").refine((val) => !isNaN(Number(val)) && Number(val) > 0, \"Enter a valid amount\"),\n  paymentType: z.string().min(1, \"Please select payment method\"),\n  reference: z.string().optional(),\n  notes: z.string().optional(),\n  proofOfPayment: z.string().min(1, \"Please upload proof of payment\"),\n});\n\ntype PaymentFormData = z.infer<typeof paymentSchema>;\n\nexport default function MakePayment() {\n  const user = getCurrentUser();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [, navigate] = useLocation();\n  const [selectedGroupId, setSelectedGroupId] = useState<string>(\"\");\n  const [uploading, setUploading] = useState(false);\n\n  const form = useForm<PaymentFormData>({\n    resolver: zodResolver(paymentSchema),\n    defaultValues: { groupId: \"\", purseId: \"\", amount: \"\", paymentType: \"\", reference: \"\", notes: \"\", proofOfPayment: \"\" },\n  });\n\n  type GroupMembership = GroupMember & { group: Group };\n  \n  const { data: userGroups = [], isLoading: groupsLoading } = useQuery<GroupMembership[]>({\n    queryKey: [\"/api/groups\", \"user\", user?.id],\n    enabled: !!user,\n  });\n\n  const { data: groupPurses = [] } = useQuery<Project[]>({\n    queryKey: [\"/api/groups\", selectedGroupId, \"projects\"],\n    enabled: !!selectedGroupId,\n  });\n\n  const selectedPurseId = form.watch(\"purseId\");\n  const selectedPurse = groupPurses.find(purse => purse.id === selectedPurseId);\n  const allowedPaymentTypes: string[] = selectedPurse?.allowedPaymentTypes \n    ? ((): string[] => { try { return JSON.parse(selectedPurse.allowedPaymentTypes as string); } catch { return PAYMENT_TYPES.map(t => t.value); } })()\n    : PAYMENT_TYPES.map(type => type.value);\n\n  const paymentMutation = useMutation({\n    mutationFn: async (data: PaymentFormData) => {\n      const response = await apiRequest(\"POST\", \"/api/contributions\", { ...data, userId: user?.id });\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Payment Submitted!\", description: \"Admin will review and confirm shortly.\" });\n      form.reset();\n      setSelectedGroupId(\"\");\n      queryClient.invalidateQueries({ queryKey: [\"/api/contributions\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/stats\"] });\n      navigate(\"/dashboard\");\n    },\n    onError: (error: any) => {\n      toast({ title: \"Payment Failed\", description: error.message || \"Please try again later.\", variant: \"destructive\" });\n    },\n  });\n\n  const handleFileUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file) return;\n    if (!file.type.startsWith('image/')) {\n      toast({ title: \"Invalid File\", description: \"Please upload an image\", variant: \"destructive\" });\n      return;\n    }\n    if (file.size > 5 * 1024 * 1024) {\n      toast({ title: \"File Too Large\", description: \"Max file size is 5MB\", variant: \"destructive\" });\n      return;\n    }\n    setUploading(true);\n    const reader = new FileReader();\n    reader.onloadend = () => {\n      form.setValue(\"proofOfPayment\", reader.result as string);\n      setUploading(false);\n      toast({ title: \"Uploaded!\", description: \"Payment proof ready\" });\n    };\n    reader.readAsDataURL(file);\n  };\n\n  if (groupsLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <Navigation />\n        <DashboardSkeleton />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 pb-24 sm:pb-8\">\n      <Navigation />\n      \n      <main className=\"max-w-md mx-auto px-4 py-6 space-y-6\">\n        {/* Back Button */}\n        <button\n          onClick={() => navigate(\"/dashboard\")}\n          className=\"flex items-center gap-2 text-gray-600 hover:text-gray-900 text-sm\"\n          data-testid=\"button-back\"\n        >\n          <ArrowLeft className=\"h-4 w-4\" />\n          Back to Dashboard\n        </button>\n\n        {/* Header */}\n        <div className=\"text-center\">\n          <div className=\"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4\">\n            <CreditCard className=\"h-8 w-8 text-primary\" />\n          </div>\n          <h1 className=\"text-2xl font-bold text-gray-900\">Submit Payment Proof</h1>\n          <p className=\"text-gray-600 mt-1\">Upload your payment proof for admin approval</p>\n        </div>\n\n        {userGroups.length === 0 ? (\n          <CardKontrib className=\"text-center py-8\">\n            <Users className=\"h-12 w-12 text-gray-300 mx-auto mb-3\" />\n            <h3 className=\"font-bold text-gray-900 mb-1\">No Groups Yet</h3>\n            <p className=\"text-gray-600 text-sm mb-4\">Join a group first to make contributions</p>\n            <BigButton onClick={() => navigate(\"/join-group\")} data-testid=\"button-find-groups\">\n              Find Groups to Join\n            </BigButton>\n          </CardKontrib>\n        ) : (\n          <CardKontrib>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit((data) => paymentMutation.mutate(data))} className=\"space-y-5\">\n                {/* Group Selection */}\n                <FormField\n                  control={form.control}\n                  name=\"groupId\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-gray-700 font-medium\">Select Group</FormLabel>\n                      <Select \n                        onValueChange={(value) => {\n                          field.onChange(value);\n                          setSelectedGroupId(value);\n                          form.setValue(\"purseId\", \"\");\n                        }} \n                        defaultValue={field.value}\n                      >\n                        <FormControl>\n                          <SelectTrigger className=\"h-14 rounded-xl border-2\" data-testid=\"select-group\">\n                            <SelectValue placeholder=\"Choose a group\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {userGroups.filter((m) => m.groupId).map((membership) => (\n                            <SelectItem key={membership.id} value={membership.groupId}>\n                              {membership.group.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Project Selection */}\n                {groupPurses.length > 0 && (\n                  <FormField\n                    control={form.control}\n                    name=\"purseId\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel className=\"text-gray-700 font-medium\">Select Project</FormLabel>\n                        <Select onValueChange={field.onChange} defaultValue={field.value}>\n                          <FormControl>\n                            <SelectTrigger className=\"h-14 rounded-xl border-2\">\n                              <SelectValue placeholder=\"Choose a project (optional)\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {groupPurses.map((project) => (\n                              <SelectItem key={project.id} value={project.id}>\n                                <div className=\"flex justify-between w-full\">\n                                  <span>{project.name}</span>\n                                  {project.targetAmount && parseFloat(project.targetAmount) > 0 && (\n                                    <span className=\"text-gray-500 ml-2\">{formatNaira(project.targetAmount)}</span>\n                                  )}\n                                </div>\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                )}\n\n                {/* Payment Method */}\n                <FormField\n                  control={form.control}\n                  name=\"paymentType\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-gray-700 font-medium\">Payment Method</FormLabel>\n                      <Select onValueChange={field.onChange} defaultValue={field.value}>\n                        <FormControl>\n                          <SelectTrigger className=\"h-14 rounded-xl border-2\">\n                            <SelectValue placeholder=\"How did you pay?\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {allowedPaymentTypes.map((paymentTypeValue: string) => {\n                            const paymentType = PAYMENT_TYPES.find(type => type.value === paymentTypeValue);\n                            return paymentType ? (\n                              <SelectItem key={paymentType.value} value={paymentType.value}>\n                                <span className=\"mr-2\">{paymentType.icon}</span>\n                                {paymentType.label}\n                              </SelectItem>\n                            ) : null;\n                          })}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Payment Account Details */}\n                {selectedPurse && form.watch(\"paymentType\") && (\n                  <PaymentAccountDetails \n                    project={{\n                      id: selectedPurse.id,\n                      name: selectedPurse.name,\n                      accountName: selectedPurse.accountName ?? undefined,\n                      accountNumber: selectedPurse.accountNumber ?? undefined,\n                      bankName: selectedPurse.bankName ?? undefined,\n                      routingNumber: selectedPurse.routingNumber ?? undefined,\n                      swiftCode: selectedPurse.swiftCode ?? undefined,\n                      zelleEmail: selectedPurse.zelleEmail ?? undefined,\n                      zellePhone: selectedPurse.zellePhone ?? undefined,\n                      cashappHandle: selectedPurse.cashappHandle ?? undefined,\n                      venmoHandle: selectedPurse.venmoHandle ?? undefined,\n                      paypalEmail: selectedPurse.paypalEmail ?? undefined,\n                      allowedPaymentTypes: selectedPurse.allowedPaymentTypes ?? undefined,\n                    }}\n                    selectedPaymentType={form.watch(\"paymentType\")} \n                  />\n                )}\n\n                {/* Amount */}\n                <FormField\n                  control={form.control}\n                  name=\"amount\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-gray-700 font-medium\">Amount (₦)</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"text\" \n                          placeholder=\"e.g. 5000\" \n                          className=\"h-14 text-lg rounded-xl border-2\"\n                          {...field}\n                          data-testid=\"input-amount\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Reference */}\n                <FormField\n                  control={form.control}\n                  name=\"reference\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-gray-700 font-medium\">Transaction Reference (Optional)</FormLabel>\n                      <FormControl>\n                        <Input \n                          placeholder=\"Bank reference or transaction ID\"\n                          className=\"h-14 rounded-xl border-2\"\n                          {...field}\n                          data-testid=\"input-reference\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Proof Upload */}\n                <FormField\n                  control={form.control}\n                  name=\"proofOfPayment\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-gray-700 font-medium\">Proof of Payment</FormLabel>\n                      <div className={`border-2 border-dashed rounded-xl p-6 text-center transition-colors ${\n                        field.value ? \"border-green-400 bg-green-50\" : \"border-gray-300 hover:border-gray-400\"\n                      }`}>\n                        <input\n                          type=\"file\"\n                          accept=\"image/*\"\n                          onChange={handleFileUpload}\n                          className=\"hidden\"\n                          id=\"proof-upload\"\n                          data-testid=\"file-upload\"\n                        />\n                        {field.value ? (\n                          <div className=\"space-y-3\">\n                            <div className=\"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto\">\n                              <CheckCircle className=\"h-6 w-6 text-green-600\" />\n                            </div>\n                            <p className=\"font-medium text-green-700\">Receipt Uploaded!</p>\n                            <label \n                              htmlFor=\"proof-upload\" \n                              className=\"text-sm text-primary underline cursor-pointer\"\n                            >\n                              Change Image\n                            </label>\n                          </div>\n                        ) : (\n                          <label htmlFor=\"proof-upload\" className=\"cursor-pointer block\">\n                            <div className=\"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3\">\n                              <Camera className=\"h-6 w-6 text-gray-400\" />\n                            </div>\n                            <p className=\"font-medium text-gray-700 mb-1\">\n                              {uploading ? \"Uploading...\" : \"Upload Receipt\"}\n                            </p>\n                            <p className=\"text-sm text-gray-500\">Tap to take photo or choose file</p>\n                          </label>\n                        )}\n                      </div>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Notes */}\n                <FormField\n                  control={form.control}\n                  name=\"notes\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-gray-700 font-medium\">Notes (Optional)</FormLabel>\n                      <FormControl>\n                        <Textarea \n                          placeholder=\"Any additional info for the admin...\"\n                          className=\"rounded-xl border-2 resize-none\"\n                          rows={3}\n                          {...field}\n                          data-testid=\"textarea-notes\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Submit */}\n                <BigButton\n                  type=\"submit\"\n                  loading={paymentMutation.isPending}\n                  icon={<Upload className=\"h-5 w-5\" />}\n                  data-testid=\"submit-payment-proof\"\n                >\n                  Submit Payment Proof\n                </BigButton>\n              </form>\n            </Form>\n          </CardKontrib>\n        )}\n\n        {/* Instructions */}\n        <CardKontrib className=\"bg-blue-50 border-blue-100\">\n          <h3 className=\"font-bold text-blue-900 mb-3\">How it Works</h3>\n          <div className=\"space-y-3\">\n            <div className=\"flex items-start gap-3\">\n              <div className=\"w-6 h-6 bg-primary text-white rounded-full flex items-center justify-center text-sm font-bold shrink-0\">1</div>\n              <p className=\"text-sm text-blue-800\">Transfer money to the group's bank account</p>\n            </div>\n            <div className=\"flex items-start gap-3\">\n              <div className=\"w-6 h-6 bg-primary text-white rounded-full flex items-center justify-center text-sm font-bold shrink-0\">2</div>\n              <p className=\"text-sm text-blue-800\">Take a screenshot of your bank receipt</p>\n            </div>\n            <div className=\"flex items-start gap-3\">\n              <div className=\"w-6 h-6 bg-primary text-white rounded-full flex items-center justify-center text-sm font-bold shrink-0\">3</div>\n              <p className=\"text-sm text-blue-800\">Upload it here and wait for admin approval</p>\n            </div>\n          </div>\n        </CardKontrib>\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":18745,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/lib/auth.ts":{"content":"import { User } from \"@shared/schema\";\nimport { apiRequest } from \"./queryClient\";\n\nlet currentUser: User | null = null;\nlet authInitialized = false;\n\nexport function getCurrentUser(): User | null {\n  return currentUser;\n}\n\nexport function setCurrentUser(user: User | null): void {\n  currentUser = user;\n  if (user) {\n    localStorage.setItem('currentUser', JSON.stringify(user));\n  } else {\n    localStorage.removeItem('currentUser');\n  }\n  \n  // Trigger a custom event to notify components of auth state change\n  window.dispatchEvent(new CustomEvent('authStateChanged', { detail: user }));\n}\n\nexport function isAuthInitialized(): boolean {\n  return authInitialized;\n}\n\nexport async function initializeAuth(): Promise<User | null> {\n  const stored = localStorage.getItem('currentUser');\n  if (!stored) {\n    authInitialized = true;\n    return null;\n  }\n  \n  try {\n    const storedUser = JSON.parse(stored);\n    currentUser = storedUser;\n    \n    // Try to validate session with backend (best-effort)\n    try {\n      console.log('[App] Validating session with backend...');\n      const response = await fetch(`/api/auth/me?userId=${storedUser.id}`);\n      \n      if (response.ok) {\n        const data = await response.json();\n        currentUser = data.user;\n        console.log('[App] Session validated successfully:', currentUser?.username || 'Unknown');\n      } else if (response.status === 401) {\n        // User no longer exists in database - clear session\n        console.warn('[App] User not found in database, clearing session');\n        localStorage.removeItem('currentUser');\n        currentUser = null;\n      } else {\n        // Other errors - keep local session but log warning\n        console.warn('[App] Session validation failed, using cached session');\n      }\n    } catch (fetchError) {\n      // Network error or server down - keep using localStorage\n      console.warn('[App] Cannot reach server, using cached session:', fetchError);\n    }\n    \n    authInitialized = true;\n    return currentUser;\n  } catch (error) {\n    // localStorage parse error - clear it\n    console.error('[App] Invalid session data, clearing:', error);\n    localStorage.removeItem('currentUser');\n    currentUser = null;\n    authInitialized = true;\n    return null;\n  }\n}\n\nexport function isAdmin(): boolean {\n  return currentUser?.role === 'admin';\n}\n\nexport function isMember(): boolean {\n  return currentUser?.role === 'member';\n}\n\nexport function logout(): void {\n  setCurrentUser(null);\n}\n\n// Instant login with phone number only\n// Note: Does NOT set current user - let the caller decide when to store\nexport async function instantLogin(phoneNumber: string): Promise<{ user: User; isNewUser: boolean }> {\n  const response = await apiRequest('POST', '/api/auth/instant-login', { phoneNumber });\n  \n  const data = await response.json();\n  // Only set user if they already have a profile completed (returning user)\n  if (!data.isNewUser) {\n    setCurrentUser(data.user);\n  }\n  return { user: data.user, isNewUser: data.isNewUser };\n}\n\n// Update user profile (name, role) after instant login\nexport async function updateProfile(userId: string, updates: { fullName?: string; role?: string }): Promise<User> {\n  const response = await apiRequest('POST', '/api/auth/update-profile', { userId, ...updates });\n  \n  const data = await response.json();\n  setCurrentUser(data.user);\n  return data.user;\n}\n\n// Check if user needs to complete their profile\nexport function needsProfileCompletion(): boolean {\n  return currentUser !== null && !currentUser.fullName;\n}\n","path":null,"size_bytes":3551,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContextProps>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":23567,"size_tokens":null},"client/src/components/create-project-modal.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Sheet, SheetContent, SheetHeader, SheetTitle } from \"@/components/ui/sheet\";\nimport { Input } from \"@/components/ui/input\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { insertProjectSchema } from \"@shared/schema\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { getDefaultPaymentTypes } from \"@/lib/payment-types\";\nimport { z } from \"zod\";\nimport { ArrowLeft, Calendar } from \"lucide-react\";\n\nconst createProjectFormSchema = insertProjectSchema.extend({\n  targetAmount: z.string().min(1, \"Target amount is required\"),\n  selectedPaymentTypes: z.array(z.string()).min(1, \"Please select at least one payment method\"),\n  projectType: z.string().optional(),\n});\n\ntype CreateProjectFormData = z.infer<typeof createProjectFormSchema>;\n\ninterface CreateProjectModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  groupId: string;\n  groupName: string;\n}\n\nexport function CreateProjectModal({ open, onOpenChange, groupId, groupName }: CreateProjectModalProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const form = useForm<CreateProjectFormData>({\n    resolver: zodResolver(createProjectFormSchema),\n    defaultValues: {\n      name: \"\",\n      description: \"\",\n      targetAmount: \"\",\n      deadline: undefined,\n      groupId,\n      projectType: \"target\",\n      accountName: \"\",\n      accountNumber: \"\",\n      bankName: \"\",\n      routingNumber: \"\",\n      swiftCode: \"\",\n      zelleEmail: \"\",\n      zellePhone: \"\",\n      cashappHandle: \"\",\n      venmoHandle: \"\",\n      paypalEmail: \"\",\n      paymentInstructions: \"\",\n      selectedPaymentTypes: getDefaultPaymentTypes(),\n    },\n  });\n\n  const createProjectMutation = useMutation({\n    mutationFn: async (data: CreateProjectFormData) => {\n      const payload = {\n        ...data,\n        deadline: data.deadline && typeof data.deadline === 'string' && data.deadline.trim() ? data.deadline : undefined,\n        allowedPaymentTypes: JSON.stringify(data.selectedPaymentTypes || []),\n      };\n      const response = await apiRequest(\"POST\", `/api/groups/${groupId}/projects`, payload);\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/groups\", groupId, \"projects\"] });\n      toast({\n        title: \"Project Created!\",\n        description: `\"${data.name}\" has been created successfully!`,\n      });\n      form.reset();\n      onOpenChange(false);\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to create project. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: CreateProjectFormData) => {\n    createProjectMutation.mutate(data);\n  };\n\n  const projectTypes = [\n    { value: \"target\", label: \"Target Goal (e.g. Wedding Gift)\" },\n    { value: \"monthly\", label: \"Monthly Contribution (e.g. Ajo)\" },\n    { value: \"event\", label: \"One-time Event\" },\n    { value: \"emergency\", label: \"Emergency Fund\" },\n  ];\n\n  return (\n    <Sheet open={open} onOpenChange={onOpenChange}>\n      <SheetContent side=\"bottom\" className=\"h-[90vh] rounded-t-3xl p-0\">\n        <div className=\"flex flex-col h-full\">\n          {/* Header */}\n          <SheetHeader className=\"px-5 py-4 border-b border-gray-100\">\n            <div className=\"flex items-center gap-3\">\n              <button\n                onClick={() => onOpenChange(false)}\n                className=\"flex items-center gap-2 text-gray-600 hover:text-gray-900\"\n              >\n                <ArrowLeft className=\"h-5 w-5\" />\n                <span>Back</span>\n              </button>\n            </div>\n          </SheetHeader>\n\n          {/* Content */}\n          <div className=\"flex-1 overflow-y-auto px-5 py-6\">\n            <div className=\"space-y-6\">\n              <div>\n                <h2 className=\"text-3xl font-bold text-gray-900\">Add a Project</h2>\n                <p className=\"text-gray-500 mt-2\">\n                  What are you collecting money for?\n                </p>\n              </div>\n\n              <Form {...form}>\n                <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-5\">\n                  <FormField\n                    control={form.control}\n                    name=\"name\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel className=\"text-gray-700 font-medium\">Project Name</FormLabel>\n                        <FormControl>\n                          <Input \n                            placeholder=\"e.g. Wedding Gift, Monthly Ajo\" \n                            className=\"h-14 text-lg rounded-2xl border-2 border-gray-200 focus:border-primary\"\n                            {...field}\n                            data-testid=\"input-project-name\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"projectType\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel className=\"text-gray-700 font-medium\">Type</FormLabel>\n                        <Select onValueChange={field.onChange} defaultValue={field.value}>\n                          <FormControl>\n                            <SelectTrigger className=\"h-14 text-lg rounded-2xl border-2 border-gray-200\" data-testid=\"select-project-type\">\n                              <SelectValue placeholder=\"Select project type\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {projectTypes.map((type) => (\n                              <SelectItem key={type.value} value={type.value}>\n                                {type.label}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"targetAmount\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel className=\"text-gray-700 font-medium\">Total Target Amount (₦)</FormLabel>\n                        <FormControl>\n                          <Input \n                            type=\"number\" \n                            placeholder=\"e.g. 50000\" \n                            className=\"h-14 text-lg rounded-2xl border-2 border-gray-200 focus:border-primary\"\n                            {...field}\n                            data-testid=\"input-target-amount\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"deadline\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel className=\"text-gray-700 font-medium\">Due Date (Optional)</FormLabel>\n                        <FormControl>\n                          <div className=\"relative\">\n                            <Input \n                              type=\"date\"\n                              placeholder=\"Pick a date\"\n                              className=\"h-14 text-lg rounded-2xl border-2 border-gray-200 focus:border-primary pl-12\"\n                              {...field} \n                              value={typeof field.value === 'string' ? field.value : \"\"}\n                              onChange={(e) => field.onChange(e.target.value || undefined)}\n                              data-testid=\"input-deadline\"\n                            />\n                            <Calendar className=\"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400\" />\n                          </div>\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <button\n                    type=\"submit\"\n                    disabled={createProjectMutation.isPending}\n                    className=\"w-full bg-primary hover:bg-primary/90 text-white font-semibold text-lg py-4 rounded-full disabled:opacity-50 transition-all active:scale-[0.98] mt-6\"\n                    data-testid=\"button-create-project-submit\"\n                  >\n                    {createProjectMutation.isPending ? (\n                      <div className=\"flex items-center justify-center gap-2\">\n                        <div className=\"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\n                        Creating...\n                      </div>\n                    ) : (\n                      \"Create Project\"\n                    )}\n                  </button>\n                </form>\n              </Form>\n            </div>\n          </div>\n        </div>\n      </SheetContent>\n    </Sheet>\n  );\n}\n","path":null,"size_bytes":9679,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route, Redirect, useLocation, useParams } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider, useQuery } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { useEffect, useState } from \"react\";\nimport { initializeAuth, getCurrentUser } from \"./lib/auth\";\nimport type { User } from \"@shared/schema\";\n\nconst REDIRECT_KEY = \"kontrib_redirectTo\";\n\n// Pages\nimport Landing from \"@/pages/landing\";\nimport Groups from \"@/pages/groups\";\nimport SubmitProof from \"@/pages/make-payment\";\nimport MyContributions from \"@/pages/my-contributions\";\nimport Updates from \"@/pages/updates\";\nimport GroupRegistration from \"@/pages/group-registration\";\nimport NotFound from \"@/pages/not-found\";\nimport WhatsAppIntegration from \"@/pages/whatsapp-integration\";\nimport MemberPayment from \"@/pages/member-payment\";\nimport JoinGroup from \"@/pages/join-group\";\nimport GroupDetails from \"@/pages/group-details\";\nimport ProjectDetails from \"@/pages/project-details\";\nimport GroupMembers from \"@/pages/group-members\";\nimport GroupProjects from \"@/pages/group-projects\";\n\n// Component to handle shared links - redirects logged-in users directly to project/group\nfunction SharedLinkRedirect({ user }: { user: User | null }) {\n  const params = useParams<{ groupSlug?: string; projectSlug?: string }>();\n  const [, navigate] = useLocation();\n  const [location] = useLocation();\n  \n  const { data, isLoading, isError } = useQuery({\n    queryKey: [\"/api/groups/join\", params.groupSlug, params.projectSlug],\n    queryFn: async () => {\n      const endpoint = params.projectSlug \n        ? `/api/groups/join/${params.groupSlug}/${params.projectSlug}`\n        : `/api/groups/slug/${params.groupSlug}`;\n      const url = user ? `${endpoint}?userId=${user.id}` : endpoint;\n      const response = await fetch(url, { credentials: \"include\" });\n      if (!response.ok) throw new Error(\"Group not found\");\n      return response.json();\n    },\n    enabled: !!user && !!params.groupSlug,\n  });\n\n  // Not logged in - save path and show landing\n  if (!user) {\n    localStorage.setItem(REDIRECT_KEY, location);\n    return <Landing />;\n  }\n\n  // Loading state\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"text-center\">\n          <div className=\"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-green-600 border-r-transparent mb-4\"></div>\n          <p className=\"text-gray-600\">Finding your group...</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Error or not found\n  if (isError || !data) {\n    return <NotFound />;\n  }\n\n  // Redirect to the appropriate page\n  if (data.projects && data.projects.length > 0 && params.projectSlug) {\n    // Find matching project by slug\n    const matchedProject = data.projects.find((p: any) => {\n      const pSlug = p.name.toLowerCase().replace(/[^a-z0-9\\s-]/g, '').replace(/\\s+/g, '').slice(0, 50);\n      return pSlug === params.projectSlug;\n    });\n    if (matchedProject) {\n      navigate(`/project/${matchedProject.id}`);\n      return null;\n    }\n  }\n  \n  // Default: redirect to group details\n  navigate(`/group/${data.group.id}`);\n  return null;\n}\nfunction Router() {\n  const [user, setUser] = useState<User | null>(null);\n  const [isAuthLoading, setIsAuthLoading] = useState(true);\n  const [location] = useLocation();\n\n  // Initialize auth on mount\n  useEffect(() => {\n    const handleAuthStateChange = (event: CustomEvent) => {\n      setUser(event.detail);\n    };\n\n    const checkAuth = () => {\n      const currentUser = getCurrentUser();\n      setUser(currentUser);\n    };\n\n    // Initialize auth with backend validation\n    const init = async () => {\n      await initializeAuth();\n      setUser(getCurrentUser());\n      setIsAuthLoading(false);\n    };\n    \n    init();\n    \n    // Listen for custom auth state changes\n    window.addEventListener('authStateChanged', handleAuthStateChange as EventListener);\n    window.addEventListener('storage', checkAuth);\n    \n    return () => {\n      window.removeEventListener('authStateChanged', handleAuthStateChange as EventListener);\n      window.removeEventListener('storage', checkAuth);\n    };\n  }, []);\n\n  // Store intended destination for protected routes when user is not logged in\n  useEffect(() => {\n    if (!isAuthLoading && !user) {\n      const protectedPaths = ['/groups', '/submit-proof', '/my-contributions', '/updates', '/whatsapp'];\n      const isProjectPath = location.startsWith('/project/');\n      const isGroupPath = location.startsWith('/group/');\n      const isProtectedPath = protectedPaths.some(p => location === p) || isProjectPath || isGroupPath;\n      \n      if (isProtectedPath) {\n        localStorage.setItem(REDIRECT_KEY, location);\n      }\n    }\n  }, [location, user, isAuthLoading]);\n\n  // Show loading state while auth is initializing\n  if (isAuthLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"text-center\">\n          <div className=\"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-green-600 border-r-transparent mb-4\"></div>\n          <p className=\"text-gray-600\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <Switch>\n      {/* Public routes */}\n      <Route path=\"/\" component={user ? Groups : Landing} />\n      <Route path=\"/register/:link\" component={GroupRegistration} />\n      <Route path=\"/join/:groupSlug/:projectSlug\">{() => <SharedLinkRedirect user={user} />}</Route>\n      <Route path=\"/join/:groupSlug\">{() => <SharedLinkRedirect user={user} />}</Route>\n      <Route path=\"/join-group\" component={JoinGroup} />\n      <Route path=\"/member-payment\" component={MemberPayment} />\n      \n      {/* Redirect old dashboard routes to /groups */}\n      <Route path=\"/dashboard\">{user ? <Redirect to=\"/groups\" /> : <Landing />}</Route>\n      <Route path=\"/admin\">{user ? <Redirect to=\"/groups\" /> : <Landing />}</Route>\n      <Route path=\"/member\">{user ? <Redirect to=\"/groups\" /> : <Landing />}</Route>\n      \n      {/* Protected routes - show Landing for unauthenticated users */}\n      <Route path=\"/groups\">{user ? <Groups /> : <Landing />}</Route>\n      <Route path=\"/submit-proof\">{user ? <SubmitProof /> : <Landing />}</Route>\n      <Route path=\"/my-contributions\">{user ? <MyContributions /> : <Landing />}</Route>\n      <Route path=\"/updates\">{user ? <Updates /> : <Landing />}</Route>\n      <Route path=\"/group/:groupId/members\">{user ? <GroupMembers /> : <Landing />}</Route>\n      <Route path=\"/group/:groupId/projects\">{user ? <GroupProjects /> : <Landing />}</Route>\n      <Route path=\"/group/:groupId\">{user ? <GroupDetails /> : <Landing />}</Route>\n      <Route path=\"/project/:projectId\">{user ? <ProjectDetails /> : <Landing />}</Route>\n      <Route path=\"/whatsapp\">{user ? <WhatsAppIntegration /> : <Landing />}</Route>\n      \n      {/* Short URL patterns - catches custom slugs like /groupname or /groupname/projectname */}\n      <Route path=\"/:groupSlug/:projectSlug\">\n        {(params) => {\n          const knownRoutes = ['api', 'assets', 'login', 'register', 'join', 'admin', 'dashboard', 'member', 'groups', 'group', 'project', 'submit-proof', 'my-contributions', 'updates', 'whatsapp', 'join-group', 'member-payment', 'members'];\n          if (knownRoutes.includes(params.groupSlug?.toLowerCase() || '')) {\n            return <NotFound />;\n          }\n          return <SharedLinkRedirect user={user} />;\n        }}\n      </Route>\n      <Route path=\"/:groupSlug\">\n        {(params) => {\n          const knownRoutes = ['api', 'assets', 'login', 'register', 'join', 'admin', 'dashboard', 'member', 'groups', 'group', 'project', 'submit-proof', 'my-contributions', 'updates', 'whatsapp', 'join-group', 'member-payment', 'members'];\n          if (knownRoutes.includes(params.groupSlug?.toLowerCase() || '')) {\n            return <NotFound />;\n          }\n          return <SharedLinkRedirect user={user} />;\n        }}\n      </Route>\n      \n      {/* Fallback to 404 */}\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <Toaster />\n        <Router />\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":8449,"size_tokens":null},"replit.md":{"content":"# Kontrib - Financial Group Management System\n\n## Overview\nKontrib is a full-stack web application for managing group financial contributions in Nigeria. It enables administrators to create contribution groups and projects, while members can join and make secure payments. The platform aims to provide transparent tracking, secure transactions, and efficient communication, aspiring to be the leading solution for community and group contributions in Nigeria.\n\n## User Preferences\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### UI/UX Decisions\nThe frontend uses React 18 with TypeScript and Vite, leveraging Shadcn/UI (based on Radix UI) and Tailwind CSS. It features a custom Nigerian-themed color palette and a mobile-first design, including dynamic Open Graph meta tags for social sharing.\n\n### Technical Implementations\n- **Frontend**: Utilizes React Query for state management, Wouter for routing, and React Hook Form with Zod for form validation. Client-side authentication is handled via `localStorage` with backend validation on page load.\n- **Backend**: Built with Node.js and Express.js, featuring Drizzle ORM for type-safe database operations and Zod for shared validation schemas.\n- **Authentication**: SMS-based OTP-only authentication system with role-based access control (Admin/Member) and global phone number validation. Sessions are validated against the database on page refresh with graceful fallback to cached data if backend is unreachable.\n- **Payment Processing**: Members upload proof of payment for admin approval; the system tracks transactions, progress, and payment history.\n\n### Feature Specifications\n- **Dual-Role System**: Users with one WhatsApp number can be admin of some groups and member of others. The `/api/groups/all/:userId` endpoint returns all groups with role metadata (\"admin\", \"member\", \"both\"). Dashboard shows separate \"Groups You Manage\" and \"Your Contributions\" sections. Group details page displays tabs for dual-role users.\n- **Group Management**: Admins can create groups with custom URLs, generate registration links, and manage group statuses. When an admin creates a group, they are automatically added as the first group member.\n- **Member Management**: Dedicated members page (/group/:id/members) shows all group members with name and phone. Admins can remove members with one click; removed members receive an in-app notification immediately.\n- **Project Type System**: Projects support multiple types - Target Goal (with target amount and progress tracking), Monthly Dues, Yearly Levy, Event, and Emergency. Monthly/Yearly types have no target amount and hide progress bars.\n- **Dedicated Project Pages**: Each project has its own page (/project/:id) with full details, contributors list, and payment information. Projects are clickable from group pages.\n- **Payment Account Details**: Admins can specify bank account details (Bank Name, Account Number, Account Name, Additional Instructions) when creating projects. These details are displayed to members with copy-to-clipboard buttons.\n- **WhatsApp Integration**: Generates professional sharing messages and dynamic Open Graph meta tags.\n- **Unified My Groups Page**: Single entry point for all users at /groups. Shows all groups with role badges (Admin in green, Member in blue). Filter pills allow filtering by All, Admin, or Member roles.\n- **Simplified Navigation**: Three main navigation links: My Groups, Pay, History. Logo links directly to /groups. Old dashboard routes (/dashboard, /admin) redirect to /groups.\n- **Project Contribution Transparency**: Members can view detailed contributor lists for any project, showing all confirmed contributions sorted by amount, total contributions, and remaining balance.\n- **Unified Groups Page**: Single \"My Groups\" page with filter pills (All, Admin, Member) to filter groups by role. Each group card shows role badges and context-aware action buttons.\n\n### System Design Choices\n- **Database**: PostgreSQL with Drizzle ORM for a relational schema (Users, Groups, Members, Contributions, OTPs).\n- **Modularity**: Designed for scalability and maintainability of frontend and backend components.\n- **Environment Configuration**: Supports development and production environments using environment variables.\n\n## External Dependencies\n- **@neondatabase/serverless**: PostgreSQL driver.\n- **drizzle-orm**: Type-safe ORM.\n- **@tanstack/react-query**: Server state management.\n- **@radix-ui/...**: Accessible UI component primitives.\n- **wouter**: Lightweight React router.\n- **PostgreSQL**: Primary database.\n- **Drizzle Kit**: Database migration and schema management.\n- **TypeScript**: Static type checking.\n- **Vite**: Build tool and development server.\n- **Tailwind CSS**: Utility-first CSS framework.\n- **canvas**: Node.js Canvas API for dynamic image generation.","path":null,"size_bytes":4866,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":791,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"client/src/components/notifications-panel.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Bell, Check } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { PaymentApprovalModal } from \"@/components/payment-approval-modal\";\nimport type { Notification, ContributionWithDetails, User } from \"@shared/schema\";\n\ninterface NotificationsPanelProps {\n  currentUser: User | null;\n}\n\nexport function NotificationsPanel({ currentUser }: NotificationsPanelProps) {\n  const queryClient = useQueryClient();\n  const [selectedContribution, setSelectedContribution] = useState<ContributionWithDetails | null>(null);\n  const [approvalModalOpen, setApprovalModalOpen] = useState(false);\n\n  const { data: notifications = [] } = useQuery<Notification[]>({\n    queryKey: [\"/api/notifications\", currentUser?.id],\n    enabled: !!currentUser?.id,\n  });\n\n  const { data: contributions = [] } = useQuery<ContributionWithDetails[]>({\n    queryKey: [\"/api/contributions\", \"admin\", currentUser?.id],\n    enabled: !!currentUser?.id && currentUser?.role === \"admin\",\n  });\n\n  const markReadMutation = useMutation({\n    mutationFn: async (notificationId: string) => {\n      const response = await apiRequest(\"PATCH\", `/api/notifications/${notificationId}/read`, {});\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n    },\n  });\n\n  const unreadCount = notifications.filter(n => !n.read).length;\n  const paymentNotifications = notifications.filter(n => n.type === \"payment_submitted\");\n\n  const handleNotificationClick = (notification: Notification) => {\n    // Mark as read\n    if (!notification.read) {\n      markReadMutation.mutate(notification.id);\n    }\n\n    // If it's a payment notification, open the approval modal\n    if (notification.contributionId) {\n      const contribution = contributions.find(c => c.id === notification.contributionId);\n      if (contribution) {\n        setSelectedContribution(contribution);\n        setApprovalModalOpen(true);\n      }\n    }\n  };\n\n  if (!currentUser) return null;\n\n  return (\n    <>\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <CardTitle className=\"flex items-center space-x-2\">\n              <Bell className=\"h-5 w-5\" />\n              <span>Notifications</span>\n              {unreadCount > 0 && (\n                <Badge className=\"bg-red-500 text-white\">{unreadCount}</Badge>\n              )}\n            </CardTitle>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {notifications.length === 0 ? (\n            <p className=\"text-gray-500 text-sm\">No notifications</p>\n          ) : (\n            <div className=\"space-y-3\">\n              {notifications.slice(0, 5).map((notification) => (\n                <div\n                  key={notification.id}\n                  className={`p-3 rounded-lg border cursor-pointer transition-colors ${\n                    notification.read \n                      ? \"bg-gray-50 border-gray-200\" \n                      : \"bg-blue-50 border-blue-200\"\n                  }`}\n                  onClick={() => handleNotificationClick(notification)}\n                >\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex-1\">\n                      <p className=\"font-medium text-sm\">{notification.title}</p>\n                      <p className=\"text-xs text-gray-600 mt-1\">{notification.message}</p>\n                      <p className=\"text-xs text-gray-500 mt-2\">\n                        {new Date(notification.createdAt).toLocaleDateString('en-GB', {\n                          day: 'numeric',\n                          month: 'short',\n                          hour: '2-digit',\n                          minute: '2-digit'\n                        })}\n                      </p>\n                    </div>\n                    {!notification.read && (\n                      <div className=\"w-2 h-2 bg-blue-500 rounded-full flex-shrink-0 mt-1\"></div>\n                    )}\n                  </div>\n                </div>\n              ))}\n              \n              {notifications.length > 5 && (\n                <Button variant=\"ghost\" size=\"sm\" className=\"w-full\">\n                  View All Notifications\n                </Button>\n              )}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      <PaymentApprovalModal\n        open={approvalModalOpen}\n        onOpenChange={setApprovalModalOpen}\n        contribution={selectedContribution}\n        currentUser={currentUser}\n      />\n    </>\n  );\n}","path":null,"size_bytes":4837,"size_tokens":null},"client/src/pages/join-group.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { Navigation } from \"@/components/navigation\";\nimport { ProgressCircle, BigButton, CardKontrib, StatusBadge } from \"@/components/ui/kontrib-ui\";\nimport { Input } from \"@/components/ui/input\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { getCurrentUser } from \"@/lib/auth\";\nimport { formatNaira } from \"@/lib/currency\";\nimport { ArrowLeft, Users, Target, Clock, Link2, CheckCircle, AlertCircle, Loader2 } from \"lucide-react\";\n\nconst REDIRECT_KEY = \"kontrib_redirectTo\";\n\ninterface GroupData {\n  group: {\n    id: string;\n    name: string;\n    description: string;\n    customSlug: string;\n  };\n  projects: Array<{\n    id: string;\n    name: string;\n    targetAmount: string;\n    collectedAmount: string;\n    deadline: string;\n  }>;\n  memberCount: number;\n  totalTarget: string;\n  totalCollected: string;\n  isMember: boolean;\n}\n\nexport default function JoinGroupPage() {\n  const [groupLink, setGroupLink] = useState(\"\");\n  const [extractedIdentifier, setExtractedIdentifier] = useState<{ value: string; type: \"slug\" | \"registration\" } | null>(null);\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const user = getCurrentUser();\n\n  const calculateProgress = (collected: string, target: string): number => {\n    const collectedNum = parseFloat(collected || \"0\");\n    const targetNum = parseFloat(target || \"1\");\n    return Math.round((collectedNum / targetNum) * 100);\n  };\n\n  const extractGroupIdentifier = (input: string): { value: string; type: \"slug\" | \"registration\" } | null => {\n    const trimmedInput = input.trim();\n    if (trimmedInput.match(/^[a-f0-9-]{36}$/)) return { value: trimmedInput, type: \"registration\" };\n    \n    const kontribRegisterMatch = trimmedInput.match(/kontrib\\.app\\/register\\/([^/?]+)/);\n    if (kontribRegisterMatch) return { value: kontribRegisterMatch[1], type: \"registration\" };\n    \n    const kontribJoinMatch = trimmedInput.match(/kontrib\\.app\\/join\\/([^/?]+)/);\n    if (kontribJoinMatch) {\n      const identifier = kontribJoinMatch[1];\n      return { value: identifier, type: identifier.match(/^[a-f0-9-]{36}$/) ? \"registration\" : \"slug\" };\n    }\n    \n    const kontribDirectMatch = trimmedInput.match(/kontrib\\.app\\/([^/?]+)/);\n    if (kontribDirectMatch) {\n      const identifier = kontribDirectMatch[1];\n      if (![\"join\", \"register\", \"dashboard\", \"login\", \"admin\"].includes(identifier.toLowerCase())) {\n        return { value: identifier, type: \"slug\" };\n      }\n    }\n    \n    try {\n      const url = new URL(trimmedInput);\n      const registerMatch = url.pathname.match(/\\/register\\/([^/?]+)/);\n      if (registerMatch) return { value: registerMatch[1], type: \"registration\" };\n      \n      const joinMatch = url.pathname.match(/\\/join\\/([^/?]+)/);\n      if (joinMatch) {\n        const identifier = joinMatch[1];\n        return { value: identifier, type: identifier.match(/^[a-f0-9-]{36}$/) ? \"registration\" : \"slug\" };\n      }\n      \n      const pathSegments = url.pathname.split(\"/\").filter((s) => s.length > 0);\n      if (pathSegments.length === 1) {\n        const identifier = pathSegments[0];\n        if (![\"join\", \"register\", \"dashboard\", \"login\", \"admin\"].includes(identifier.toLowerCase())) {\n          return { value: identifier, type: \"slug\" };\n        }\n      }\n    } catch {}\n    \n    if (trimmedInput.match(/^[a-zA-Z0-9_-]+$/)) return { value: trimmedInput, type: \"slug\" };\n    return null;\n  };\n\n  const { data: groupPreview, isLoading: isLoadingPreview, error: previewError } = useQuery<GroupData>({\n    queryKey: extractedIdentifier\n      ? extractedIdentifier.type === \"slug\"\n        ? [\"/api/groups/slug\", extractedIdentifier.value, user?.id]\n        : [\"/api/groups/registration\", extractedIdentifier.value, user?.id]\n      : [\"/api/groups/none\"],\n    queryFn: async () => {\n      if (!extractedIdentifier) return null;\n      const endpoint = extractedIdentifier.type === \"slug\"\n        ? `/api/groups/slug/${extractedIdentifier.value}`\n        : `/api/groups/registration/${extractedIdentifier.value}`;\n      const url = user ? `${endpoint}?userId=${user.id}` : endpoint;\n      const response = await fetch(url, { credentials: \"include\" });\n      if (!response.ok) throw new Error(\"Group not found\");\n      return response.json();\n    },\n    enabled: !!extractedIdentifier,\n  });\n\n  const joinGroupMutation = useMutation({\n    mutationFn: async () => {\n      if (!extractedIdentifier || !user || !groupPreview) throw new Error(\"Missing data\");\n      return apiRequest(\"POST\", `/api/groups/${groupPreview.group.id}/join`, { userId: user.id });\n    },\n    onSuccess: () => {\n      toast({ title: \"You're in!\", description: `Welcome to ${groupPreview?.group.name}` });\n      queryClient.invalidateQueries({ queryKey: [\"/api/groups/user\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/stats/user\"] });\n      setLocation(\"/dashboard\");\n    },\n    onError: (error: any) => {\n      toast({ title: \"Couldn't join\", description: error.message || \"Please try again\", variant: \"destructive\" });\n    },\n  });\n\n  const handleLinkInput = (value: string) => {\n    setGroupLink(value);\n    setExtractedIdentifier(extractGroupIdentifier(value));\n  };\n\n  const progressPercentage = groupPreview ? calculateProgress(groupPreview.totalCollected, groupPreview.totalTarget) : 0;\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 pb-24 sm:pb-8\">\n      <Navigation />\n\n      <main className=\"max-w-md mx-auto px-4 py-6 space-y-6\">\n        {/* Back Button */}\n        <button\n          onClick={() => setLocation(\"/dashboard\")}\n          className=\"flex items-center gap-2 text-gray-600 hover:text-gray-900 text-sm\"\n          data-testid=\"button-back\"\n        >\n          <ArrowLeft className=\"h-4 w-4\" />\n          Back to Dashboard\n        </button>\n\n        {/* Header */}\n        <div className=\"text-center\">\n          <div className=\"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4\">\n            <Users className=\"h-8 w-8 text-primary\" />\n          </div>\n          <h1 className=\"text-2xl font-bold text-gray-900\">Join a Group</h1>\n          <p className=\"text-gray-600 mt-1\">Paste the link your admin shared with you</p>\n        </div>\n\n        {/* Link Input */}\n        <CardKontrib>\n          <div className=\"flex items-center gap-3 mb-3\">\n            <Link2 className=\"h-5 w-5 text-gray-400\" />\n            <span className=\"font-medium text-gray-700\">Group Link</span>\n          </div>\n          <Input\n            placeholder=\"Paste link here...\"\n            value={groupLink}\n            onChange={(e) => handleLinkInput(e.target.value)}\n            className=\"h-14 text-lg rounded-xl border-2\"\n            data-testid=\"input-group-link\"\n          />\n          {groupLink && !extractedIdentifier && (\n            <div className=\"flex items-center gap-2 mt-3 text-amber-600 text-sm\">\n              <AlertCircle className=\"h-4 w-4\" />\n              This doesn't look like a valid link\n            </div>\n          )}\n        </CardKontrib>\n\n        {/* Loading State */}\n        {isLoadingPreview && extractedIdentifier && (\n          <CardKontrib className=\"text-center py-8\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-primary mx-auto mb-3\" />\n            <p className=\"text-gray-600\">Finding group...</p>\n          </CardKontrib>\n        )}\n\n        {/* Error State */}\n        {previewError && extractedIdentifier && (\n          <CardKontrib className=\"text-center py-8 bg-red-50 border-red-200\">\n            <AlertCircle className=\"h-12 w-12 text-red-400 mx-auto mb-3\" />\n            <h3 className=\"font-bold text-red-900 mb-1\">Group Not Found</h3>\n            <p className=\"text-red-600 text-sm\">Check the link and try again</p>\n          </CardKontrib>\n        )}\n\n        {/* Group Preview */}\n        {groupPreview && !previewError && (\n          <CardKontrib className=\"space-y-6\">\n            {/* Group Header */}\n            <div className=\"text-center\">\n              <h2 className=\"text-xl font-bold text-gray-900\">{groupPreview.group.name}</h2>\n              {groupPreview.group.description && (\n                <p className=\"text-gray-600 text-sm mt-1\">{groupPreview.group.description}</p>\n              )}\n            </div>\n\n            {/* Progress */}\n            <div className=\"flex flex-col items-center\">\n              <ProgressCircle \n                percentage={progressPercentage} \n                size={100} \n                strokeWidth={8}\n              />\n              <div className=\"mt-3 text-center\">\n                <p className=\"text-sm text-gray-500\">\n                  <span className=\"font-semibold text-primary\">{formatNaira(groupPreview.totalCollected)}</span>\n                  {\" \"}of{\" \"}\n                  <span className=\"font-medium\">{formatNaira(groupPreview.totalTarget)}</span>\n                </p>\n              </div>\n            </div>\n\n            {/* Stats */}\n            <div className=\"grid grid-cols-2 gap-3\">\n              <div className=\"bg-primary/5 rounded-xl p-4 text-center\">\n                <Users className=\"h-5 w-5 text-primary mx-auto mb-1\" />\n                <p className=\"text-xl font-bold text-gray-900\">{groupPreview.memberCount}</p>\n                <p className=\"text-xs text-gray-500\">Members</p>\n              </div>\n              <div className=\"bg-blue-50 rounded-xl p-4 text-center\">\n                <Target className=\"h-5 w-5 text-blue-600 mx-auto mb-1\" />\n                <p className=\"text-xl font-bold text-gray-900\">{groupPreview.projects.length}</p>\n                <p className=\"text-xs text-gray-500\">Projects</p>\n              </div>\n            </div>\n\n            {/* Projects Preview */}\n            {groupPreview.projects.length > 0 && (\n              <div className=\"space-y-2\">\n                <h3 className=\"text-sm font-medium text-gray-700\">Active Projects</h3>\n                {groupPreview.projects.slice(0, 3).map((project) => (\n                  <div key={project.id} className=\"bg-gray-50 rounded-xl p-3\">\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"font-medium text-gray-900 text-sm\">{project.name}</span>\n                      {project.targetAmount && parseFloat(project.targetAmount) > 0 && (\n                        <span className=\"text-primary font-semibold text-sm\">\n                          {formatNaira(project.targetAmount)}\n                        </span>\n                      )}\n                    </div>\n                  </div>\n                ))}\n                {groupPreview.projects.length > 3 && (\n                  <p className=\"text-center text-xs text-gray-500\">\n                    +{groupPreview.projects.length - 3} more projects\n                  </p>\n                )}\n              </div>\n            )}\n\n            {/* Join Button */}\n            {user ? (\n              groupPreview.isMember ? (\n                <div className=\"space-y-3\">\n                  <div className=\"bg-primary/5 border-2 border-primary rounded-xl p-4 text-center\">\n                    <CheckCircle className=\"h-6 w-6 text-primary mx-auto mb-2\" />\n                    <p className=\"font-semibold text-primary\">You're already a member!</p>\n                  </div>\n                  <BigButton\n                    onClick={() => setLocation(\"/dashboard\")}\n                    variant=\"outline\"\n                    data-testid=\"button-go-to-dashboard\"\n                  >\n                    Go to Dashboard\n                  </BigButton>\n                </div>\n              ) : (\n                <BigButton\n                  onClick={() => joinGroupMutation.mutate()}\n                  loading={joinGroupMutation.isPending}\n                  icon={<CheckCircle className=\"h-5 w-5\" />}\n                  data-testid=\"button-join-group\"\n                >\n                  Join This Group\n                </BigButton>\n              )\n            ) : (\n              <div className=\"space-y-3\">\n                <div className=\"bg-blue-50 border border-blue-200 rounded-xl p-4 text-center\">\n                  <AlertCircle className=\"h-6 w-6 text-blue-600 mx-auto mb-2\" />\n                  <p className=\"font-medium text-blue-900\">Login to join this group</p>\n                  <p className=\"text-sm text-blue-600 mt-1\">You need an account to contribute</p>\n                </div>\n                <BigButton\n                  onClick={() => {\n                    localStorage.setItem(REDIRECT_KEY, window.location.pathname);\n                    setLocation(\"/\");\n                  }}\n                  data-testid=\"button-login-to-join\"\n                >\n                  Continue with WhatsApp\n                </BigButton>\n              </div>\n            )}\n          </CardKontrib>\n        )}\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":12959,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/pages/group-landing.tsx":{"content":"import { useParams, useLocation } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Users, CheckCircle, Loader2 } from \"lucide-react\";\nimport { formatNaira, calculateProgress } from \"@/lib/currency\";\nimport { format } from \"date-fns\";\nimport { getCurrentUser } from \"@/lib/auth\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nconst REDIRECT_KEY = \"kontrib_redirectTo\";\n\ninterface GroupLandingData {\n  group: {\n    id: string;\n    name: string;\n    description: string;\n    adminId: string;\n    registrationLink: string;\n    customSlug: string;\n  };\n  projects: Array<{\n    id: string;\n    name: string;\n    description: string;\n    targetAmount: string;\n    collectedAmount: string;\n    deadline: string;\n  }>;\n  memberCount: number;\n  totalTarget: string;\n  totalCollected: string;\n  isMember?: boolean;\n}\n\nexport default function GroupLanding() {\n  const params = useParams();\n  const groupSlug = params.groupSlug;\n  const projectSlug = params.projectSlug;\n  const identifier = params.registrationId || params.link || groupSlug;\n  const [, navigate] = useLocation();\n  const user = getCurrentUser();\n  const { toast } = useToast();\n\n  const isJoinFormat = groupSlug && projectSlug;\n  const isCustomSlug = groupSlug && !params.link && !params.registrationId && !projectSlug;\n\n  const { data: groupData, isLoading: groupLoading } = useQuery<GroupLandingData>({\n    queryKey: isJoinFormat\n      ? [\"/api/groups/join\", groupSlug, projectSlug, user?.id]\n      : isCustomSlug \n        ? [\"/api/groups/slug\", identifier, user?.id]\n        : [\"/api/groups/registration\", identifier, user?.id],\n    queryFn: async () => {\n      let endpoint: string;\n      if (isJoinFormat) {\n        endpoint = `/api/groups/join/${groupSlug}/${projectSlug}`;\n      } else if (isCustomSlug) {\n        endpoint = `/api/groups/slug/${identifier}`;\n      } else {\n        endpoint = `/api/groups/registration/${identifier}`;\n      }\n      const url = user ? `${endpoint}?userId=${user.id}` : endpoint;\n      const response = await fetch(url, { credentials: \"include\" });\n      if (!response.ok) throw new Error(\"Group not found\");\n      return response.json();\n    },\n    enabled: !!(identifier || (groupSlug && projectSlug))\n  });\n\n  const joinGroupMutation = useMutation({\n    mutationFn: async () => {\n      if (!groupData || !user) throw new Error(\"Missing data\");\n      return apiRequest(\"POST\", `/api/groups/${groupData.group.id}/join`, { userId: user.id });\n    },\n    onSuccess: () => {\n      toast({ title: \"You're in!\", description: `Welcome to ${groupData?.group.name}` });\n      queryClient.invalidateQueries({ queryKey: [\"/api/groups/user\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/groups/all\"] });\n      navigate(\"/groups\");\n    },\n    onError: (error: any) => {\n      toast({ title: \"Couldn't join\", description: error.message || \"Please try again\", variant: \"destructive\" });\n    },\n  });\n\n  const getDaysRemaining = () => {\n    if (!groupData?.projects.length) return null;\n    \n    const earliestDeadline = groupData.projects\n      .filter(p => p.deadline)\n      .reduce((earliest, project) => {\n        const projectDeadline = new Date(project.deadline);\n        return !earliest || projectDeadline < earliest ? projectDeadline : earliest;\n      }, null as Date | null);\n    \n    if (!earliestDeadline) return null;\n    \n    const now = new Date();\n    const diffTime = earliestDeadline.getTime() - now.getTime();\n    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n    return {\n      days: diffDays > 0 ? diffDays : 0,\n      date: earliestDeadline\n    };\n  };\n\n  const handleJoinGroup = () => {\n    if (!user) {\n      localStorage.setItem(REDIRECT_KEY, window.location.pathname);\n      navigate(\"/\");\n      return;\n    }\n    \n    if (groupData?.isMember) {\n      navigate(\"/groups\");\n      return;\n    }\n    \n    joinGroupMutation.mutate();\n  };\n\n  if (groupLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"animate-pulse text-green-600 text-lg\">Loading...</div>\n      </div>\n    );\n  }\n\n  if (!groupData) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center p-4\">\n        <div className=\"text-center\">\n          <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">Group Not Found</h1>\n          <p className=\"text-gray-600 mb-4\">This group link may be invalid or expired.</p>\n          <Button onClick={() => navigate(\"/\")} data-testid=\"button-go-home\">\n            Go Home\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  const progressPercentage = calculateProgress(groupData.totalCollected, groupData.totalTarget);\n  const deadlineInfo = getDaysRemaining();\n  \n  const currentProject = groupData.projects.length > 0 ? groupData.projects[0] : null;\n  \n  const generateProjectSlug = (name: string) => {\n    return name\n      .toLowerCase()\n      .replace(/[^a-z0-9\\s-]/g, '')\n      .replace(/\\s+/g, '')\n      .slice(0, 50);\n  };\n  \n  const shareUrl = currentProject && groupData.group.customSlug\n    ? `kontrib.app/join/${groupData.group.customSlug}/${generateProjectSlug(currentProject.name)}`\n    : groupData.group.customSlug \n      ? `kontrib.app/join/${groupData.group.customSlug}`\n      : `kontrib.app/join/${groupData.group.registrationLink}`;\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Kontrib Logo Header */}\n      <div className=\"bg-white py-4\">\n        <div className=\"max-w-md mx-auto px-4\">\n          <div className=\"flex items-center justify-center\">\n            {/* Official Kontrib Logo */}\n            <img \n              src=\"/kontrib-logo.jpg?v=3\" \n              alt=\"Kontrib\" \n              className=\"h-24 w-auto object-contain\"\n              data-testid=\"img-kontrib-logo\"\n              onError={(e) => {\n                console.error('Logo failed to load');\n                e.currentTarget.style.display = 'none';\n              }}\n            />\n          </div>\n        </div>\n      </div>\n\n      {/* Main Content */}\n      <div className=\"max-w-md mx-auto px-4 pb-8\">\n        {/* Group Info Card */}\n        <Card className=\"bg-white rounded-2xl shadow-sm border border-gray-200 p-6 mb-4\">\n          <div className=\"flex items-start gap-4 mb-6\">\n            {/* Group Icon */}\n            <div className=\"w-14 h-14 bg-green-600 rounded-xl flex items-center justify-center flex-shrink-0 shadow-md\">\n              <Users className=\"w-7 h-7 text-white\" />\n            </div>\n            \n            {/* Group Name and Description */}\n            <div className=\"flex-1 min-w-0\">\n              <h1 className=\"text-xl font-bold text-gray-900 mb-1\" data-testid=\"text-group-name\">\n                {groupData.group.name}\n              </h1>\n              {currentProject && (\n                <p className=\"text-gray-600 text-sm\" data-testid=\"text-project-description\">\n                  {currentProject.description || currentProject.name}\n                </p>\n              )}\n            </div>\n          </div>\n\n          {/* Amount Display - Simplified */}\n          <div className=\"text-center py-4\">\n            <div className=\"text-4xl font-black text-gray-900 mb-1\" data-testid=\"text-collected-amount\">\n              {formatNaira(groupData.totalCollected)}\n            </div>\n            <div className=\"text-lg text-gray-600\">don enter</div>\n          </div>\n        </Card>\n\n        {/* Deadline Section */}\n        {deadlineInfo && (\n          <div className=\"text-center mb-4\">\n            <p className=\"text-gray-600 text-sm mb-1\">E remain till</p>\n            <p className=\"text-2xl font-bold text-gray-900\" data-testid=\"text-deadline\">\n              {format(deadlineInfo.date, \"MMM d, yyyy\")}\n            </p>\n          </div>\n        )}\n\n        {/* Join Button */}\n        {groupData?.isMember ? (\n          <Button \n            onClick={() => navigate(\"/groups\")}\n            className=\"w-full bg-green-600 hover:bg-green-700 text-white py-6 text-lg font-semibold rounded-xl shadow-lg mb-3 flex items-center justify-center gap-2\"\n            data-testid=\"button-already-member\"\n          >\n            <CheckCircle className=\"w-5 h-5\" />\n            You're Already a Member\n          </Button>\n        ) : (\n          <Button \n            onClick={handleJoinGroup}\n            disabled={joinGroupMutation.isPending}\n            className=\"w-full bg-green-600 hover:bg-green-700 text-white py-6 text-lg font-semibold rounded-xl shadow-lg mb-3 flex items-center justify-center gap-2\"\n            data-testid=\"button-join-group\"\n          >\n            {joinGroupMutation.isPending ? (\n              <Loader2 className=\"w-5 h-5 animate-spin\" />\n            ) : (\n              <Users className=\"w-5 h-5\" />\n            )}\n            {user ? \"Join Group\" : \"Continue with WhatsApp\"}\n          </Button>\n        )}\n\n        {/* Cancel/Exit Button */}\n        <Button \n          onClick={() => navigate(\"/\")}\n          variant=\"outline\"\n          className=\"w-full py-6 text-lg font-semibold rounded-xl mb-6\"\n          data-testid=\"button-cancel\"\n        >\n          Cancel\n        </Button>\n\n        {/* Info Box */}\n        <div className=\"bg-gray-100 rounded-xl p-6 text-center space-y-3\">\n          <p className=\"text-sm text-gray-600 font-medium\" data-testid=\"text-share-url\">\n            {shareUrl}\n          </p>\n          <p className=\"text-base font-semibold text-gray-900\">\n            Let's keep it transparent!\n          </p>\n          <p className=\"text-sm text-gray-700\">\n            <span className=\"font-semibold\">Join Kontrib</span> to track your contributions\n          </p>\n          <p className=\"text-sm text-gray-600\" data-testid=\"text-member-count\">\n            <span className=\"font-bold\">{groupData.memberCount}</span> Members Joined\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":10082,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"RENDER_DEPLOYMENT.md":{"content":"# Deploying Kontrib to Render.com\n\nThis guide will help you deploy your Kontrib application from Replit to Render.com for production use.\n\n## 📋 Prerequisites\n\n- Active Render.com account (free tier available)\n- PostgreSQL database on Render (or Neon/Supabase)\n- All environment variables from your Replit workspace\n- Your Kontrib project downloaded as ZIP from Replit\n\n---\n\n## 🚀 Deployment Steps\n\n### Step 1: Download Project from Replit\n\n1. In your Replit workspace, click the **three dots (⋮)** menu\n2. Select **\"Download as zip\"**\n3. Extract the ZIP file on your local machine\n4. Optional: Initialize git repository if deploying via GitHub\n   ```bash\n   cd kontrib\n   git init\n   git add .\n   git commit -m \"Initial commit for Render deployment\"\n   ```\n\n### Step 2: Create PostgreSQL Database on Render\n\n1. Go to [Render Dashboard](https://dashboard.render.com/)\n2. Click **\"New +\"** → **\"PostgreSQL\"**\n3. Configure database:\n   - **Name**: `kontrib-db` (or your preferred name)\n   - **Database**: `kontrib` \n   - **User**: (auto-generated)\n   - **Region**: Choose closest to your users\n   - **Plan**: Free or Starter\n4. Click **\"Create Database\"**\n5. **Save the \"Internal Database URL\"** - you'll need this for environment variables\n\n### Step 3: Create Web Service on Render\n\n1. In Render Dashboard, click **\"New +\"** → **\"Web Service\"**\n2. Connect your repository:\n   - **Option A**: Connect GitHub repository (if you pushed code to GitHub)\n   - **Option B**: Upload project manually (use \"Deploy from local repository\" if available)\n3. Configure service:\n   - **Name**: `kontrib` (this becomes your URL: kontrib.onrender.com)\n   - **Region**: Same as database\n   - **Branch**: `main` (or your default branch)\n   - **Runtime**: `Node`\n   - **Build Command**: `npm install && npm run build`\n   - **Start Command**: `npm run start`\n   - **Plan**: Free or Starter\n\n### Step 4: Configure Environment Variables\n\nIn your Render Web Service settings, go to **\"Environment\"** tab and add these variables:\n\n#### Required Database Variables\n```bash\nDATABASE_URL=<Your Render PostgreSQL Internal URL>\n```\n\n#### Authentication & Security\n```bash\nJWT_SECRET=<Copy from Replit>\nSESSION_SECRET=<Copy from Replit>\n```\n\n#### WhatsApp Integration (Meta Cloud API)\n```bash\nWHATSAPP_PHONE_NUMBER_ID=<Copy from Replit>\nWHATSAPP_ACCESS_TOKEN=<Copy from Replit>\nWHATSAPP_API_VERSION=v21.0\nWHATSAPP_VERIFY_TOKEN=<Copy from Replit>\n```\n\n#### Node Environment\n```bash\nNODE_ENV=production\n```\n\n#### Optional: Custom Domain Setup\n```bash\n# If using custom domain (e.g., kontrib.maxtechbd.com)\nREPL_SLUG=kontrib\n```\n\n### Step 5: Set Up Database Schema\n\nAfter the first deployment, you need to push your database schema:\n\n1. In Render Dashboard, go to your **Web Service**\n2. Click **\"Shell\"** tab (opens terminal)\n3. Run database migration:\n   ```bash\n   npm run db:push\n   ```\n4. If you see data-loss warnings, use:\n   ```bash\n   npm run db:push -- --force\n   ```\n\n### Step 6: Custom Domain Setup (Optional)\n\nTo use your custom domain `kontrib.maxtechbd.com`:\n\n1. In Render Web Service, go to **\"Settings\"** tab\n2. Scroll to **\"Custom Domain\"** section\n3. Click **\"Add Custom Domain\"**\n4. Enter: `kontrib.maxtechbd.com`\n5. Render will provide DNS records (usually CNAME or A record)\n6. Add these records to your domain provider (MaxTech BD):\n   ```\n   Type: CNAME\n   Name: kontrib\n   Value: kontrib.onrender.com\n   ```\n7. Wait for DNS propagation (5-30 minutes)\n8. Render will automatically provision SSL certificate\n\n---\n\n## ✅ Verification Checklist\n\nAfter deployment, verify everything works:\n\n- [ ] **Homepage loads**: Visit `https://kontrib.onrender.com` (or your custom domain)\n- [ ] **Database connection**: Check logs for \"Connected to database\" message\n- [ ] **WhatsApp OTP**: Test group registration with OTP verification\n- [ ] **Admin dashboard**: Log in and verify stats display correctly\n- [ ] **Payment approvals**: Test contribution submission and approval flow\n- [ ] **Custom domain**: If configured, test `https://kontrib.maxtechbd.com`\n\n---\n\n## 📊 Monitoring & Logs\n\n### View Application Logs\n1. Render Dashboard → Your Web Service\n2. Click **\"Logs\"** tab\n3. Monitor real-time logs for errors\n\n### Database Management\n1. Render Dashboard → Your PostgreSQL Database\n2. Use **\"Connect\"** tab for psql access\n3. Or use external tools like pgAdmin with connection details\n\n---\n\n## 🔄 Continuous Deployment\n\n### Option A: GitHub Auto-Deploy (Recommended)\n1. Push your Replit project to GitHub\n2. Connect GitHub to Render (done in Step 3)\n3. Every push to `main` branch auto-deploys\n\n### Option B: Manual Deploy\n1. Make changes in Replit\n2. Download as ZIP\n3. Update GitHub repository\n4. Render auto-deploys on push\n\n---\n\n## 🆘 Troubleshooting\n\n### Build Fails\n**Error**: `Cannot find module 'typescript'`\n**Fix**: Ensure `typescript` is in `dependencies` (not `devDependencies`)\n\n### Port Binding Error\n**Error**: `EADDRINUSE: address already in use`\n**Fix**: Render sets `PORT` env var automatically - code already handles this\n\n### Database Connection Fails\n**Error**: `Connection refused` or `ECONNREFUSED`\n**Fix**: \n1. Verify `DATABASE_URL` is the **Internal Database URL** from Render\n2. Ensure database and web service are in the same region\n3. Check database is running (Render Dashboard → PostgreSQL)\n\n### WhatsApp OTP Not Sending\n**Error**: `WhatsApp API error` in logs\n**Fix**:\n1. Verify `WHATSAPP_ACCESS_TOKEN` and `WHATSAPP_PHONE_NUMBER_ID` are correct\n2. Check Meta Business Suite for API quota/limits\n3. Ensure phone number format includes country code: `+234...`\n\n### Static Files 404\n**Error**: `Cannot GET /assets/index-*.js`\n**Fix**: Already handled - build process creates `dist/public/` correctly\n\n---\n\n## 💰 Cost Estimation\n\n### Render Free Tier\n- ✅ **Web Service**: Free (spins down after 15 min inactivity)\n- ✅ **PostgreSQL**: Free (expires after 90 days, 1GB storage)\n- ⚠️ **Limitation**: Slow cold starts (~30s)\n\n### Render Paid Plans\n- **Starter Plan**: $7/month (always-on, faster, custom domain with SSL)\n- **PostgreSQL**: $7/month (persistent, 10GB storage)\n\n**Recommended for Production**: \n- Web Service: Starter ($7/mo)\n- Database: Starter ($7/mo)\n- **Total**: ~$14/month\n\n---\n\n## 🔐 Security Best Practices\n\n1. **Rotate Secrets**: Change `JWT_SECRET` and `SESSION_SECRET` for production\n2. **Database Backups**: Enable automated backups in Render PostgreSQL settings\n3. **Rate Limiting**: Already implemented in code\n4. **HTTPS**: Automatic with Render (free SSL)\n5. **Environment Variables**: Never commit `.env` file to GitHub\n\n---\n\n## 📞 Support\n\nIf deployment fails:\n1. Check Render logs (Dashboard → Logs tab)\n2. Verify all environment variables are set correctly\n3. Ensure database schema is pushed (`npm run db:push`)\n4. Contact Render support: https://render.com/support\n\n---\n\n## 🎉 Success!\n\nOnce deployed, your Kontrib application will be available at:\n- **Render URL**: `https://kontrib.onrender.com`\n- **Custom Domain**: `https://kontrib.maxtechbd.com` (if configured)\n\n**Both Replit and Render versions will work independently** - you can continue developing on Replit while production runs on Render! 🚀\n","path":null,"size_bytes":7186,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n        \"2xl\": \"1rem\",\n        \"3xl\": \"1.5rem\",\n      },\n      colors: {\n        background: \"var(--background)\",\n        foreground: \"var(--foreground)\",\n        card: {\n          DEFAULT: \"var(--card)\",\n          foreground: \"var(--card-foreground)\",\n        },\n        popover: {\n          DEFAULT: \"var(--popover)\",\n          foreground: \"var(--popover-foreground)\",\n        },\n        primary: {\n          DEFAULT: \"var(--primary)\",\n          foreground: \"var(--primary-foreground)\",\n        },\n        secondary: {\n          DEFAULT: \"var(--secondary)\",\n          foreground: \"var(--secondary-foreground)\",\n        },\n        muted: {\n          DEFAULT: \"var(--muted)\",\n          foreground: \"var(--muted-foreground)\",\n        },\n        accent: {\n          DEFAULT: \"var(--accent)\",\n          foreground: \"var(--accent-foreground)\",\n        },\n        destructive: {\n          DEFAULT: \"var(--destructive)\",\n          foreground: \"var(--destructive-foreground)\",\n        },\n        border: \"var(--border)\",\n        input: \"var(--input)\",\n        ring: \"var(--ring)\",\n        kontrib: {\n          green: \"#008000\",\n          \"green-dark\": \"#006400\",\n          \"green-light\": \"#00a000\",\n          surface: \"#f0fdf4\",\n        },\n        whatsapp: \"#25D366\",\n        \"nigerian-green\": \"#008000\",\n        \"forest-green\": \"#006400\",\n        chart: {\n          \"1\": \"var(--chart-1)\",\n          \"2\": \"var(--chart-2)\",\n          \"3\": \"var(--chart-3)\",\n          \"4\": \"var(--chart-4)\",\n          \"5\": \"var(--chart-5)\",\n        },\n        sidebar: {\n          DEFAULT: \"var(--sidebar-background)\",\n          foreground: \"var(--sidebar-foreground)\",\n          primary: \"var(--sidebar-primary)\",\n          \"primary-foreground\": \"var(--sidebar-primary-foreground)\",\n          accent: \"var(--sidebar-accent)\",\n          \"accent-foreground\": \"var(--sidebar-accent-foreground)\",\n          border: \"var(--sidebar-border)\",\n          ring: \"var(--sidebar-ring)\",\n        },\n      },\n      spacing: {\n        \"safe-bottom\": \"env(safe-area-inset-bottom)\",\n        \"safe-top\": \"env(safe-area-inset-top)\",\n      },\n      minHeight: {\n        \"touch\": \"48px\",\n        \"btn\": \"56px\",\n      },\n      fontSize: {\n        \"mobile-base\": [\"16px\", \"1.5\"],\n        \"mobile-lg\": [\"18px\", \"1.4\"],\n        \"mobile-xl\": [\"20px\", \"1.3\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":3282,"size_tokens":null},"client/src/pages/member-payment.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { \n  CreditCard, \n  Upload, \n  Building2, \n  User,\n  Phone,\n  Copy,\n  Check,\n  Loader2,\n  AlertCircle,\n  CheckCircle,\n  Camera\n} from \"lucide-react\";\nimport { formatNaira } from \"@/lib/currency\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface PaymentProject {\n  id: string;\n  name: string;\n  targetAmount: string;\n  collectedAmount: string;\n  deadline: string;\n  groupId: string;\n  groupName: string;\n}\n\ninterface BankDetails {\n  bankName: string;\n  accountNumber: string;\n  accountName: string;\n}\n\nexport default function MemberPayment() {\n  const [selectedProject, setSelectedProject] = useState<string>(\"\");\n  const [amount, setAmount] = useState(\"\");\n  const [reference, setReference] = useState(\"\");\n  const [notes, setNotes] = useState(\"\");\n  const [proofFile, setProofFile] = useState<File | null>(null);\n  const [proofPreview, setProofPreview] = useState<string>(\"\");\n  const [step, setStep] = useState<\"select\" | \"instructions\" | \"upload\" | \"success\">(\"select\");\n  const [copiedField, setCopiedField] = useState<string>(\"\");\n  \n  const { toast } = useToast();\n  const user = JSON.parse(localStorage.getItem(\"user\") || \"{}\");\n\n  // Fetch user's joined groups and their projects\n  const { data: projects = [], isLoading: projectsLoading } = useQuery<PaymentProject[]>({\n    queryKey: [\"/api/contributions/member\", user.id, \"projects\"],\n    enabled: !!user.id\n  });\n\n  // Fetch bank details for the selected project's admin\n  const { data: bankDetails } = useQuery<BankDetails>({\n    queryKey: [\"/api/bank-details\", selectedProject],\n    enabled: !!selectedProject\n  });\n\n  // Submit contribution mutation\n  const submitContributionMutation = useMutation({\n    mutationFn: async (contributionData: FormData) => {\n      return apiRequest(\"POST\", \"/api/contributions\", contributionData);\n    },\n    onSuccess: () => {\n      setStep(\"success\");\n      queryClient.invalidateQueries({ queryKey: [\"/api/contributions/member\", user.id] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Payment Submission Failed\",\n        description: error.message || \"Failed to submit payment proof\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const selectedProjectData = projects.find(p => p.id === selectedProject);\n\n  const handleCopy = async (text: string, field: string) => {\n    try {\n      await navigator.clipboard.writeText(text);\n      setCopiedField(field);\n      toast({\n        title: \"Copied!\",\n        description: `${field} copied to clipboard`,\n      });\n      setTimeout(() => setCopiedField(\"\"), 2000);\n    } catch (err) {\n      toast({\n        title: \"Copy Failed\",\n        description: \"Please copy manually\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleFileSelect = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file) return;\n\n    // Validate file type\n    if (!file.type.startsWith(\"image/\")) {\n      toast({\n        title: \"Invalid File\",\n        description: \"Please select an image file\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Validate file size (max 10MB)\n    if (file.size > 10 * 1024 * 1024) {\n      toast({\n        title: \"File Too Large\",\n        description: \"Please select an image smaller than 10MB\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setProofFile(file);\n\n    // Create preview\n    const reader = new FileReader();\n    reader.onload = (e) => {\n      setProofPreview(e.target?.result as string);\n    };\n    reader.readAsDataURL(file);\n  };\n\n  const handleSubmitPayment = async () => {\n    if (!selectedProject || !amount || !proofFile) {\n      toast({\n        title: \"Missing Information\",\n        description: \"Please fill all required fields and upload proof\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const formData = new FormData();\n    formData.append(\"projectId\", selectedProject);\n    formData.append(\"userId\", user.id);\n    formData.append(\"amount\", amount);\n    formData.append(\"reference\", reference);\n    formData.append(\"notes\", notes);\n    formData.append(\"proofOfPayment\", proofFile);\n\n    submitContributionMutation.mutate(formData);\n  };\n\n  const getProgressPercentage = (project: PaymentProject) => {\n    const collected = parseFloat(project.collectedAmount || \"0\");\n    const target = parseFloat(project.targetAmount || \"1\");\n    return Math.min((collected / target) * 100, 100);\n  };\n\n  const getDaysLeft = (deadline: string) => {\n    const deadlineDate = new Date(deadline);\n    const now = new Date();\n    const diffTime = deadlineDate.getTime() - now.getTime();\n    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n    return Math.max(diffDays, 0);\n  };\n\n  if (projectsLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 p-4 flex items-center justify-center\">\n        <div className=\"flex items-center gap-2\">\n          <Loader2 className=\"h-6 w-6 animate-spin text-nigerian-green\" />\n          <span>Loading your groups...</span>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 p-4 pb-24 md:pb-4 overflow-y-auto\">\n      <div className=\"max-w-2xl mx-auto space-y-6\">\n        {/* Header */}\n        <div className=\"text-center\">\n          <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white mb-2\">\n            Make Contribution\n          </h1>\n          <p className=\"text-gray-600 dark:text-gray-400\">\n            Choose a project and submit your payment proof\n          </p>\n        </div>\n\n        {step === \"select\" && (\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <CreditCard className=\"h-5 w-5 text-nigerian-green\" />\n                Select Project & Amount\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              {projects.length === 0 ? (\n                <div className=\"text-center py-8\">\n                  <AlertCircle className=\"h-12 w-12 text-gray-400 mx-auto mb-3\" />\n                  <h3 className=\"font-medium text-gray-900 dark:text-white mb-2\">\n                    No Projects Available\n                  </h3>\n                  <p className=\"text-gray-600 dark:text-gray-300\">\n                    You haven't joined any groups with active projects yet.\n                  </p>\n                  <Button \n                    onClick={() => window.location.href = \"/groups\"}\n                    className=\"mt-4\"\n                  >\n                    Browse Groups\n                  </Button>\n                </div>\n              ) : (\n                <>\n                  <div>\n                    <Label>Select Project</Label>\n                    <Select onValueChange={setSelectedProject} value={selectedProject}>\n                      <SelectTrigger data-testid=\"project-select\">\n                        <SelectValue placeholder=\"Choose a project to contribute to\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {projects.map((project) => (\n                          <SelectItem key={project.id} value={project.id}>\n                            <div className=\"flex flex-col\">\n                              <span className=\"font-medium\">{project.name}</span>\n                              <span className=\"text-sm text-gray-500\">\n                                {project.groupName}\n                                {project.targetAmount && parseFloat(project.targetAmount) > 0 && (\n                                  <> • {formatNaira(project.collectedAmount)} / {formatNaira(project.targetAmount)}</>\n                                )}\n                              </span>\n                            </div>\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n\n                  {selectedProjectData && (\n                    <div className=\"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-3\">\n                      <div className=\"flex items-center justify-between\">\n                        <h4 className=\"font-medium\">{selectedProjectData.name}</h4>\n                        {selectedProjectData.deadline && (\n                          <Badge variant={getDaysLeft(selectedProjectData.deadline) < 7 ? \"destructive\" : \"secondary\"}>\n                            {getDaysLeft(selectedProjectData.deadline)} days left\n                          </Badge>\n                        )}\n                      </div>\n                      {selectedProjectData.targetAmount && parseFloat(selectedProjectData.targetAmount) > 0 && (\n                        <>\n                          <Progress value={getProgressPercentage(selectedProjectData)} className=\"h-2\" />\n                          <div className=\"flex justify-between text-sm text-gray-600\">\n                            <span>{formatNaira(selectedProjectData.collectedAmount)} raised</span>\n                            <span>Goal: {formatNaira(selectedProjectData.targetAmount)}</span>\n                          </div>\n                        </>\n                      )}\n                    </div>\n                  )}\n\n                  <div>\n                    <Label htmlFor=\"amount\">Contribution Amount (₦)</Label>\n                    <Input\n                      id=\"amount\"\n                      type=\"number\"\n                      placeholder=\"Enter amount\"\n                      value={amount}\n                      onChange={(e) => setAmount(e.target.value)}\n                      data-testid=\"amount-input\"\n                    />\n                  </div>\n\n                  <Button \n                    onClick={() => setStep(\"instructions\")}\n                    disabled={!selectedProject || !amount}\n                    className=\"w-full bg-nigerian-green hover:bg-forest-green\"\n                    data-testid=\"proceed-to-payment-button\"\n                  >\n                    Proceed to Payment Instructions\n                  </Button>\n                </>\n              )}\n            </CardContent>\n          </Card>\n        )}\n\n        {step === \"instructions\" && bankDetails && (\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Building2 className=\"h-5 w-5 text-nigerian-green\" />\n                Payment Instructions\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              <div className=\"p-4 bg-blue-50 border border-blue-200 rounded-lg\">\n                <h4 className=\"font-medium text-blue-900 mb-2\">Transfer Details</h4>\n                <p className=\"text-blue-700 text-sm\">\n                  Transfer {formatNaira(amount)} to the account below, then upload your payment proof.\n                </p>\n              </div>\n\n              <div className=\"space-y-4\">\n                <div className=\"grid grid-cols-3 gap-4\">\n                  <div className=\"col-span-2\">\n                    <Label className=\"text-xs text-gray-500\">BANK NAME</Label>\n                    <p className=\"font-medium\">{bankDetails.bankName}</p>\n                  </div>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => handleCopy(bankDetails.bankName, \"Bank Name\")}\n                    className=\"mt-4\"\n                  >\n                    {copiedField === \"Bank Name\" ? <Check className=\"h-4 w-4\" /> : <Copy className=\"h-4 w-4\" />}\n                  </Button>\n                </div>\n\n                <div className=\"grid grid-cols-3 gap-4\">\n                  <div className=\"col-span-2\">\n                    <Label className=\"text-xs text-gray-500\">ACCOUNT NUMBER</Label>\n                    <p className=\"font-mono font-medium text-lg\">{bankDetails.accountNumber}</p>\n                  </div>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => handleCopy(bankDetails.accountNumber, \"Account Number\")}\n                    className=\"mt-4\"\n                  >\n                    {copiedField === \"Account Number\" ? <Check className=\"h-4 w-4\" /> : <Copy className=\"h-4 w-4\" />}\n                  </Button>\n                </div>\n\n                <div className=\"grid grid-cols-3 gap-4\">\n                  <div className=\"col-span-2\">\n                    <Label className=\"text-xs text-gray-500\">ACCOUNT NAME</Label>\n                    <p className=\"font-medium\">{bankDetails.accountName}</p>\n                  </div>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => handleCopy(bankDetails.accountName, \"Account Name\")}\n                    className=\"mt-4\"\n                  >\n                    {copiedField === \"Account Name\" ? <Check className=\"h-4 w-4\" /> : <Copy className=\"h-4 w-4\" />}\n                  </Button>\n                </div>\n\n                <div className=\"p-4 bg-nigerian-green/10 border border-nigerian-green/20 rounded-lg\">\n                  <div className=\"flex items-center gap-2\">\n                    <CreditCard className=\"h-5 w-5 text-nigerian-green\" />\n                    <span className=\"font-medium text-nigerian-green\">Amount to Transfer</span>\n                  </div>\n                  <p className=\"text-2xl font-bold text-nigerian-green mt-1\">\n                    {formatNaira(amount)}\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"flex gap-2\">\n                <Button \n                  variant=\"outline\" \n                  onClick={() => setStep(\"select\")}\n                  className=\"flex-1\"\n                >\n                  Back\n                </Button>\n                <Button \n                  onClick={() => setStep(\"upload\")}\n                  className=\"flex-1 bg-nigerian-green hover:bg-forest-green\"\n                >\n                  I've Made the Transfer\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {step === \"upload\" && (\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Upload className=\"h-5 w-5 text-nigerian-green\" />\n                Upload Payment Proof\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-6 pb-6\">\n              <div className=\"p-4 bg-amber-50 border border-amber-200 rounded-lg\">\n                <p className=\"text-amber-800 text-sm\">\n                  Upload a screenshot or photo of your transfer receipt for verification.\n                </p>\n              </div>\n\n              <div>\n                <Label>Upload Proof of Payment *</Label>\n                <div className=\"mt-2\">\n                  {!proofFile ? (\n                    <label className=\"border-2 border-dashed border-gray-300 rounded-lg p-6 block cursor-pointer hover:border-nigerian-green transition-colors\">\n                      <div className=\"text-center\">\n                        <Camera className=\"h-12 w-12 text-gray-400 mx-auto mb-3\" />\n                        <p className=\"text-sm font-medium text-gray-900\">Click to upload payment proof</p>\n                        <p className=\"text-xs text-gray-500\">PNG, JPG up to 10MB</p>\n                      </div>\n                      <input\n                        type=\"file\"\n                        accept=\"image/*\"\n                        onChange={handleFileSelect}\n                        className=\"hidden\"\n                        data-testid=\"proof-upload-input\"\n                      />\n                    </label>\n                  ) : (\n                    <div className=\"space-y-2\">\n                      <div className=\"relative border rounded-lg overflow-hidden\">\n                        <img \n                          src={proofPreview} \n                          alt=\"Payment proof\" \n                          className=\"w-full h-48 object-contain bg-gray-50\"\n                        />\n                      </div>\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => {\n                          setProofFile(null);\n                          setProofPreview(\"\");\n                        }}\n                        data-testid=\"change-image-button\"\n                      >\n                        Change Image\n                      </Button>\n                    </div>\n                  )}\n                </div>\n              </div>\n\n              <div>\n                <Label htmlFor=\"reference\">Transaction Reference (Optional)</Label>\n                <Input\n                  id=\"reference\"\n                  placeholder=\"Enter transaction reference if available\"\n                  value={reference}\n                  onChange={(e) => setReference(e.target.value)}\n                  data-testid=\"reference-input\"\n                />\n              </div>\n\n              <div>\n                <Label htmlFor=\"notes\">Additional Notes (Optional)</Label>\n                <Textarea\n                  id=\"notes\"\n                  placeholder=\"Any additional information about this payment\"\n                  value={notes}\n                  onChange={(e) => setNotes(e.target.value)}\n                  data-testid=\"notes-textarea\"\n                />\n              </div>\n\n              {/* Mobile Sticky Button Area */}\n              <div className=\"flex gap-2 md:relative fixed bottom-0 left-0 right-0 p-4 bg-white dark:bg-gray-800 border-t md:border-t-0 z-10 md:p-0\">\n                <Button \n                  variant=\"outline\" \n                  onClick={() => setStep(\"instructions\")}\n                  className=\"flex-1\"\n                  data-testid=\"back-button\"\n                >\n                  Back\n                </Button>\n                <Button \n                  onClick={handleSubmitPayment}\n                  disabled={!proofFile || submitContributionMutation.isPending}\n                  className=\"flex-1 bg-nigerian-green hover:bg-forest-green\"\n                  data-testid=\"submit-payment-button\"\n                >\n                  {submitContributionMutation.isPending && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\n                  Submit Payment Proof\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {step === \"success\" && (\n          <Card>\n            <CardContent className=\"p-8 text-center\">\n              <CheckCircle className=\"h-16 w-16 text-green-500 mx-auto mb-4\" />\n              <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-2\">\n                Payment Submitted Successfully!\n              </h2>\n              <p className=\"text-gray-600 dark:text-gray-300 mb-6\">\n                Your payment proof has been submitted for verification. The admin will review and confirm your contribution shortly.\n              </p>\n              \n              <div className=\"space-y-3\">\n                <Button \n                  onClick={() => window.location.href = \"/my-contributions\"}\n                  className=\"w-full\"\n                  variant=\"outline\"\n                >\n                  View My Contributions\n                </Button>\n                <Button \n                  onClick={() => {\n                    setStep(\"select\");\n                    setSelectedProject(\"\");\n                    setAmount(\"\");\n                    setReference(\"\");\n                    setNotes(\"\");\n                    setProofFile(null);\n                    setProofPreview(\"\");\n                  }}\n                  className=\"w-full bg-nigerian-green hover:bg-forest-green\"\n                >\n                  Make Another Contribution\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}","path":null,"size_bytes":20707,"size_tokens":null},"client/src/components/payment-account-details.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Copy, CheckCircle2, AlertTriangle, Info } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useState } from \"react\";\nimport { getPaymentTypeLabel, PAYMENT_TYPES } from \"@/lib/payment-types\";\n\ninterface PaymentAccountDetailsProps {\n  project: {\n    id: string;\n    name: string;\n    accountName?: string;\n    accountNumber?: string;\n    bankName?: string;\n    routingNumber?: string;\n    swiftCode?: string;\n    zelleEmail?: string;\n    zellePhone?: string;\n    cashappHandle?: string;\n    venmoHandle?: string;\n    paypalEmail?: string;\n    paymentInstructions?: string;\n    allowedPaymentTypes?: string;\n  };\n  selectedPaymentType: string;\n}\n\nexport function PaymentAccountDetails({ project, selectedPaymentType }: PaymentAccountDetailsProps) {\n  const { toast } = useToast();\n  const [copiedField, setCopiedField] = useState<string>(\"\");\n\n  const allowedPaymentTypes = project.allowedPaymentTypes \n    ? JSON.parse(project.allowedPaymentTypes) \n    : PAYMENT_TYPES.map(type => type.value);\n\n  const copyToClipboard = async (text: string, fieldName: string) => {\n    try {\n      await navigator.clipboard.writeText(text);\n      setCopiedField(fieldName);\n      toast({\n        title: \"Copied!\",\n        description: `${fieldName} copied to clipboard`,\n      });\n      setTimeout(() => setCopiedField(\"\"), 2000);\n    } catch (error) {\n      toast({\n        title: \"Copy Failed\",\n        description: \"Unable to copy to clipboard\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const getAccountDetailsForPaymentType = (paymentType: string) => {\n    const details: Array<{ label: string; value: string; field: string }> = [];\n\n    switch (paymentType) {\n      case \"bank_transfer\":\n      case \"mobile_money\":\n        if (project.accountName) details.push({ label: \"Account Name\", value: project.accountName, field: \"accountName\" });\n        if (project.accountNumber) details.push({ label: \"Account Number\", value: project.accountNumber, field: \"accountNumber\" });\n        if (project.bankName) details.push({ label: \"Bank Name\", value: project.bankName, field: \"bankName\" });\n        break;\n      \n      case \"zelle\":\n        if (project.zelleEmail) details.push({ label: \"Zelle Email\", value: project.zelleEmail, field: \"zelleEmail\" });\n        if (project.zellePhone) details.push({ label: \"Zelle Phone\", value: project.zellePhone, field: \"zellePhone\" });\n        break;\n      \n      case \"cashapp\":\n        if (project.cashappHandle) details.push({ label: \"Cash App Handle\", value: project.cashappHandle, field: \"cashappHandle\" });\n        break;\n      \n      case \"venmo\":\n        if (project.venmoHandle) details.push({ label: \"Venmo Handle\", value: project.venmoHandle, field: \"venmoHandle\" });\n        break;\n      \n      case \"paypal\":\n        if (project.paypalEmail) details.push({ label: \"PayPal Email\", value: project.paypalEmail, field: \"paypalEmail\" });\n        break;\n      \n      case \"wire_transfer\":\n        if (project.accountName) details.push({ label: \"Account Name\", value: project.accountName, field: \"accountName\" });\n        if (project.accountNumber) details.push({ label: \"Account Number\", value: project.accountNumber, field: \"accountNumber\" });\n        if (project.bankName) details.push({ label: \"Bank Name\", value: project.bankName, field: \"bankName\" });\n        if (project.routingNumber) details.push({ label: \"Routing Number\", value: project.routingNumber, field: \"routingNumber\" });\n        if (project.swiftCode) details.push({ label: \"SWIFT Code\", value: project.swiftCode, field: \"swiftCode\" });\n        break;\n    }\n\n    return details;\n  };\n\n  if (!selectedPaymentType || !allowedPaymentTypes.includes(selectedPaymentType)) {\n    return (\n      <Card className=\"border-orange-200 bg-orange-50\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex items-center text-orange-800\">\n            <AlertTriangle className=\"h-5 w-5 mr-2\" />\n            <span>Please select a payment method to view account details</span>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const accountDetails = getAccountDetailsForPaymentType(selectedPaymentType);\n  const paymentTypeInfo = PAYMENT_TYPES.find(type => type.value === selectedPaymentType);\n\n  if (accountDetails.length === 0 && selectedPaymentType !== \"cash\") {\n    return (\n      <Card className=\"border-red-200 bg-red-50\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex items-center text-red-800\">\n            <AlertTriangle className=\"h-5 w-5 mr-2\" />\n            <span>No account details configured for {getPaymentTypeLabel(selectedPaymentType)}</span>\n          </div>\n          <p className=\"text-sm text-red-600 mt-2\">\n            Please contact the group admin to add account details for this payment method.\n          </p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <Card className=\"border-green-200 bg-green-50\">\n        <CardHeader className=\"pb-3\">\n          <CardTitle className=\"text-lg flex items-center\">\n            <CheckCircle2 className=\"h-5 w-5 mr-2 text-green-600\" />\n            Payment Details for {getPaymentTypeLabel(selectedPaymentType)}\n          </CardTitle>\n          {paymentTypeInfo && (\n            <p className=\"text-sm text-green-700\">{paymentTypeInfo.description}</p>\n          )}\n        </CardHeader>\n        \n        <CardContent className=\"space-y-4\">\n          {selectedPaymentType === \"cash\" ? (\n            <div className=\"flex items-center text-green-800\">\n              <Info className=\"h-5 w-5 mr-2\" />\n              <span>Cash payment - coordinate directly with the group admin</span>\n            </div>\n          ) : (\n            <div className=\"space-y-3\">\n              {accountDetails.map((detail, index) => (\n                <div key={index} className=\"flex items-center justify-between p-3 bg-white rounded-lg border\">\n                  <div>\n                    <p className=\"text-sm font-medium text-gray-700\">{detail.label}</p>\n                    <p className=\"text-lg font-mono text-gray-900\">{detail.value}</p>\n                  </div>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => copyToClipboard(detail.value, detail.label)}\n                    className=\"ml-4\"\n                  >\n                    {copiedField === detail.field ? (\n                      <CheckCircle2 className=\"h-4 w-4 text-green-600\" />\n                    ) : (\n                      <Copy className=\"h-4 w-4\" />\n                    )}\n                  </Button>\n                </div>\n              ))}\n            </div>\n          )}\n          \n          {/* Payment Instructions */}\n          {project.paymentInstructions && (\n            <div className=\"mt-4 p-4 bg-blue-50 rounded-lg border-l-4 border-blue-400\">\n              <div className=\"flex items-start\">\n                <Info className=\"h-5 w-5 text-blue-600 mr-2 mt-0.5\" />\n                <div>\n                  <h4 className=\"font-medium text-blue-900 mb-1\">Special Instructions</h4>\n                  <p className=\"text-sm text-blue-800 whitespace-pre-wrap\">\n                    {project.paymentInstructions}\n                  </p>\n                </div>\n              </div>\n            </div>\n          )}\n          \n          {/* General Payment Reminder */}\n          <div className=\"mt-4 p-3 bg-gray-50 rounded-lg\">\n            <p className=\"text-sm text-gray-600\">\n              <strong>📸 Remember:</strong> Take a screenshot or photo of your payment confirmation \n              and upload it as proof of payment below.\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","path":null,"size_bytes":7920,"size_tokens":null},"RENDER_READY_SUMMARY.md":{"content":"# ✅ Kontrib is Render.com Ready!\n\nYour Kontrib project is now **100% compatible** with Render.com deployment while remaining fully functional on Replit.\n\n---\n\n## 🎯 What's Been Configured\n\n### ✅ 1. Dynamic Port Configuration\n```typescript\nconst port = parseInt(process.env.PORT || '3000', 10);\n```\n- **Replit**: Uses `PORT=5000` (from environment) ✓\n- **Render**: Uses dynamically assigned `PORT` ✓\n- **Local**: Falls back to `3000` ✓\n\n### ✅ 2. Production Build Scripts\n```json\n{\n  \"build\": \"vite build && esbuild server/index.ts ...\",\n  \"start\": \"NODE_ENV=production node dist/index.js\"\n}\n```\n- Frontend builds to: `dist/public/` ✓\n- Backend builds to: `dist/index.js` ✓\n- Production ready: Static files served correctly ✓\n\n### ✅ 3. Static File Serving\n```typescript\n// server/index.ts - Lines 54-58\nif (app.get(\"env\") === \"development\") {\n  await setupVite(app, server);      // Replit dev mode\n} else {\n  serveStatic(app);                  // Render production\n}\n```\n- Development (Replit): Vite dev server with HMR ✓\n- Production (Render): Express serves `dist/public/` ✓\n- SPA routing: Catch-all route for client-side navigation ✓\n\n### ✅ 4. Environment Variables\nAll current environment variables will work on both platforms:\n- `DATABASE_URL` - PostgreSQL connection ✓\n- `JWT_SECRET` - Authentication ✓\n- `SESSION_SECRET` - Session management ✓\n- `WHATSAPP_*` - Meta WhatsApp Cloud API ✓\n- `NODE_ENV` - Environment detection ✓\n\n---\n\n## 📦 What to Download & Deploy\n\n### Files Ready for Render:\n- ✅ All source code (`client/`, `server/`, `shared/`)\n- ✅ Build configuration (`vite.config.ts`, `tsconfig.json`)\n- ✅ Dependencies (`package.json`)\n- ✅ Database schema (`shared/schema.ts`)\n- ✅ Environment setup (copy from Replit to Render)\n\n### Files to Exclude (already in `.gitignore`):\n- ❌ `node_modules/` (Render will install)\n- ❌ `dist/` (Render will build)\n- ❌ `.env` (set in Render dashboard)\n\n---\n\n## 🚀 Quick Deployment Checklist\n\n1. **Download Project**\n   - Replit → Three dots menu → Download as ZIP ✓\n\n2. **Create Render Services**\n   - PostgreSQL database (save Internal URL) ✓\n   - Web Service (Node.js runtime) ✓\n\n3. **Configure Build**\n   - Build Command: `npm install && npm run build` ✓\n   - Start Command: `npm run start` ✓\n\n4. **Set Environment Variables**\n   - Copy all secrets from Replit to Render ✓\n   - Add `NODE_ENV=production` ✓\n\n5. **Push Database Schema**\n   - Run `npm run db:push` in Render Shell ✓\n\n6. **Verify Deployment**\n   - Test registration, OTP, payments ✓\n   - Configure custom domain (optional) ✓\n\n📖 **Full Instructions**: See [RENDER_DEPLOYMENT.md](./RENDER_DEPLOYMENT.md)\n\n---\n\n## 🔄 Development Workflow\n\n### On Replit (Development)\n```bash\nnpm run dev          # Development server with HMR\nnpm run db:push      # Update database schema\n```\n- **URL**: `https://<your-repl>.replit.dev`\n- **Port**: 5000 (auto-configured)\n- **Environment**: Development mode\n\n### On Render (Production)\n```bash\n# Automatically runs on deploy:\nnpm install && npm run build\nnpm run start\n```\n- **URL**: `https://kontrib.onrender.com`\n- **Port**: Dynamically assigned by Render\n- **Environment**: Production mode\n\n---\n\n## 🎉 Result\n\n**You can now run Kontrib on BOTH platforms simultaneously:**\n\n| Platform | Purpose | URL | Database |\n|----------|---------|-----|----------|\n| **Replit** | Development & Testing | `replit.dev` | Replit PostgreSQL |\n| **Render** | Production | `onrender.com` or custom | Render PostgreSQL |\n\nBoth versions work **independently** with their own databases and configurations!\n\n---\n\n## 📊 What Stays the Same\n\n- ✅ All features work identically on both platforms\n- ✅ WhatsApp OTP verification\n- ✅ Payment approval workflows\n- ✅ Admin dashboards and stats\n- ✅ Group registration and management\n- ✅ Real-time notifications\n\n## 🔧 What's Different\n\n| Feature | Replit | Render |\n|---------|--------|--------|\n| **Hot Reload** | ✅ Yes (Vite HMR) | ❌ No (production build) |\n| **Build Time** | Instant (dev server) | ~2 minutes (full build) |\n| **Performance** | Good | Better (optimized bundles) |\n| **Uptime** | Always on | Free tier: spins down after 15min |\n| **Custom Domain** | Limited | ✅ Full support with SSL |\n\n---\n\n## 💡 Next Steps\n\n1. **Test thoroughly on Replit** (already working ✓)\n2. **Download project as ZIP** from Replit\n3. **Follow** [RENDER_DEPLOYMENT.md](./RENDER_DEPLOYMENT.md)\n4. **Deploy to Render** with custom domain `kontrib.maxtechbd.com`\n\n---\n\n## 🆘 Need Help?\n\n- **Deployment Guide**: [RENDER_DEPLOYMENT.md](./RENDER_DEPLOYMENT.md)\n- **Build Issues**: Check `npm run build` output\n- **Runtime Errors**: Check Render logs dashboard\n- **Database Issues**: Verify `DATABASE_URL` and run `db:push`\n\n---\n\n**Your Kontrib project is production-ready! 🎊**\n\nNo breaking changes were made to your Replit setup - everything continues working exactly as before.\n","path":null,"size_bytes":4951,"size_tokens":null},"client/src/components/manage-accountability-partners-modal.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Users, UserMinus, UserPlus } from \"lucide-react\";\n\ninterface ManageAccountabilityPartnersModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  groupId: string;\n  groupName: string;\n}\n\nexport function ManageAccountabilityPartnersModal({ \n  open, \n  onOpenChange, \n  groupId, \n  groupName \n}: ManageAccountabilityPartnersModalProps) {\n  const [selectedUserId, setSelectedUserId] = useState<string>(\"\");\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: members = [] } = useQuery({\n    queryKey: [\"/api/groups\", groupId, \"members\"],\n    enabled: open,\n  });\n\n  const { data: partners = [] } = useQuery({\n    queryKey: [\"/api/groups\", groupId, \"accountability-partners\"],\n    enabled: open,\n  });\n\n  const addPartnerMutation = useMutation({\n    mutationFn: async (userId: string) => {\n      return await apiRequest(`/api/groups/${groupId}/accountability-partners`, \"POST\", { userId });\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Partner Added\",\n        description: \"Accountability partner has been added successfully!\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/groups\", groupId, \"accountability-partners\"] });\n      setSelectedUserId(\"\");\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to add accountability partner\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const removePartnerMutation = useMutation({\n    mutationFn: async (userId: string) => {\n      return await apiRequest(`/api/groups/${groupId}/accountability-partners/${userId}`, \"DELETE\");\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Partner Removed\",\n        description: \"Accountability partner has been removed successfully!\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/groups\", groupId, \"accountability-partners\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to remove accountability partner\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleAddPartner = () => {\n    if (!selectedUserId) {\n      toast({\n        title: \"No Member Selected\",\n        description: \"Please select a member to add as accountability partner\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    addPartnerMutation.mutate(selectedUserId);\n  };\n\n  const handleRemovePartner = (userId: string) => {\n    removePartnerMutation.mutate(userId);\n  };\n\n  // Filter out current accountability partners from available members\n  const availableMembers = members.filter(\n    (member: any) => !partners.some((partner: any) => partner.userId === member.userId)\n  );\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[500px]\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center space-x-2\">\n            <Users className=\"h-5 w-5\" />\n            <span>Manage Accountability Partners</span>\n          </DialogTitle>\n          <p className=\"text-sm text-gray-600\">\n            Assign up to 2 accountability partners to help manage {groupName}\n          </p>\n        </DialogHeader>\n\n        <div className=\"space-y-6\">\n          {/* Current Partners */}\n          <div>\n            <Label className=\"text-base font-medium\">Current Partners ({partners.length}/2)</Label>\n            {partners.length === 0 ? (\n              <p className=\"text-sm text-gray-500 mt-2\">No accountability partners assigned yet.</p>\n            ) : (\n              <div className=\"space-y-2 mt-3\">\n                {partners.map((partner: any) => (\n                  <div\n                    key={partner.id}\n                    className=\"flex items-center justify-between p-3 bg-green-50 rounded-lg\"\n                  >\n                    <div>\n                      <p className=\"font-medium text-gray-900\">{partner.userFullName}</p>\n                      <p className=\"text-sm text-gray-600\">@{partner.userName}</p>\n                    </div>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => handleRemovePartner(partner.userId)}\n                      disabled={removePartnerMutation.isPending}\n                      className=\"text-red-600 hover:text-red-700 hover:bg-red-50\"\n                    >\n                      <UserMinus className=\"h-4 w-4 mr-1\" />\n                      Remove\n                    </Button>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n\n          {/* Add New Partner */}\n          {partners.length < 2 && availableMembers.length > 0 && (\n            <div>\n              <Label className=\"text-base font-medium\">Add New Partner</Label>\n              <div className=\"flex space-x-2 mt-3\">\n                <Select value={selectedUserId} onValueChange={setSelectedUserId}>\n                  <SelectTrigger className=\"flex-1\">\n                    <SelectValue placeholder=\"Select a member...\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {availableMembers.map((member: any) => (\n                      <SelectItem key={member.userId} value={member.userId}>\n                        {member.user.fullName} (@{member.user.username})\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <Button\n                  onClick={handleAddPartner}\n                  disabled={addPartnerMutation.isPending || !selectedUserId}\n                  className=\"bg-nigerian-green hover:bg-forest-green\"\n                >\n                  <UserPlus className=\"h-4 w-4 mr-1\" />\n                  Add\n                </Button>\n              </div>\n            </div>\n          )}\n\n          {partners.length >= 2 && (\n            <div className=\"p-3 bg-blue-50 rounded-lg\">\n              <p className=\"text-sm text-blue-800\">\n                ✓ Maximum number of accountability partners assigned (2/2)\n              </p>\n            </div>\n          )}\n\n          {availableMembers.length === 0 && partners.length < 2 && (\n            <div className=\"p-3 bg-gray-50 rounded-lg\">\n              <p className=\"text-sm text-gray-600\">\n                No available members to assign as accountability partners.\n              </p>\n            </div>\n          )}\n        </div>\n\n        <div className=\"flex justify-end\">\n          <Button\n            onClick={() => onOpenChange(false)}\n            variant=\"outline\"\n          >\n            Close\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","path":null,"size_bytes":7291,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"import * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & { value?: number }\n>(({ className, value, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"relative h-2 w-full overflow-hidden rounded-full bg-gray-200\",\n      className\n    )}\n    {...props}\n  >\n    <div\n      className=\"h-full w-full flex-1 bg-nigerian-green transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </div>\n))\nProgress.displayName = \"Progress\"\n\nexport { Progress }","path":null,"size_bytes":596,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/pages/admin-dashboard.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Navigation } from \"@/components/navigation\";\nimport { CreateGroupModal } from \"@/components/create-group-modal\";\nimport { CreateProjectModal } from \"@/components/create-project-modal\";\nimport { ManageAccountabilityPartnersModal } from \"@/components/manage-accountability-partners-modal\";\nimport { ProjectCard } from \"@/components/project-card\";\nimport { PaymentModal } from \"@/components/payment-modal\";\nimport { PaymentApprovalModal } from \"@/components/payment-approval-modal\";\nimport { StatusBadge, DashboardSkeleton } from \"@/components/ui/kontrib-ui\";\nimport { SiWhatsapp } from \"react-icons/si\";\nimport {\n  Plus,\n  Users,\n  Clock,\n  FolderPlus,\n  UserCheck,\n  CheckCircle,\n  XCircle,\n  ChevronRight,\n  ChevronDown,\n  Eye,\n  Wallet,\n} from \"lucide-react\";\nimport { getCurrentUser } from \"@/lib/auth\";\nimport { formatNaira } from \"@/lib/currency\";\nimport { Group, Project, ContributionWithDetails } from \"@shared/schema\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport default function AdminDashboard() {\n  const user = getCurrentUser();\n  const { toast } = useToast();\n  const [, setLocation] = useLocation();\n  const [createGroupModalOpen, setCreateGroupModalOpen] = useState(false);\n  const [createProjectModalOpen, setCreateProjectModalOpen] = useState(false);\n  const [managePartnersModalOpen, setManagePartnersModalOpen] = useState(false);\n  const [selectedGroup, setSelectedGroup] = useState<Group | null>(null);\n  const [selectedProject, setSelectedProject] = useState<Project | null>(null);\n  const [expandedGroupId, setExpandedGroupId] = useState<string | null>(null);\n  const [paymentModalOpen, setPaymentModalOpen] = useState(false);\n  const [approvalModalOpen, setApprovalModalOpen] = useState(false);\n  const [selectedContribution, setSelectedContribution] = useState<ContributionWithDetails | null>(null);\n\n  const { data: groups = [], isLoading: groupsLoading } = useQuery<Group[]>({\n    queryKey: [\"/api/groups\", \"admin\", user?.id],\n    enabled: !!user,\n  });\n\n  const { data: adminStats = {}, isLoading: statsLoading } = useQuery<any>({\n    queryKey: [\"/api/stats\", \"admin\", user?.id],\n    enabled: !!user,\n  });\n\n  const { data: recentContributions = [], isLoading: contributionsLoading } = useQuery<ContributionWithDetails[]>({\n    queryKey: [\"/api/contributions/admin\", user?.id],\n    enabled: !!user,\n  });\n\n  const pendingContributions = recentContributions.filter(c => c.status === \"pending\");\n\n  const handleShareGroup = (group: Group) => {\n    const groupSlug = group.customSlug || group.registrationLink;\n    const joinLink = `kontrib.app/join/${groupSlug}`;\n    const shareText = `${joinLink}\\n\\nYou have been invited to join ${group.name} on Kontrib!\\n\\nLogin to submit your contributions\\n\\nLet's keep it transparent\\n\\nKontrib.app`;\n    window.open(`https://wa.me/?text=${encodeURIComponent(shareText)}`, \"_blank\");\n  };\n\n  const handleCreateProject = (group: Group) => {\n    setSelectedGroup(group);\n    setCreateProjectModalOpen(true);\n  };\n\n  const handleManagePartners = (group: Group) => {\n    setSelectedGroup(group);\n    setManagePartnersModalOpen(true);\n  };\n\n  const toggleGroupExpansion = (groupId: string) => {\n    setExpandedGroupId(expandedGroupId === groupId ? null : groupId);\n  };\n\n  const handleContributeToProject = (project: Project) => {\n    setSelectedProject(project);\n    setPaymentModalOpen(true);\n  };\n\n  const useGroupProjects = (groupId: string) => {\n    return useQuery<Project[]>({\n      queryKey: [\"/api/groups\", groupId, \"projects\"],\n      enabled: !!groupId,\n    });\n  };\n\n  function GroupCard({ group }: { group: Group }) {\n    const { data: projects = [], isLoading: projectsLoading } = useGroupProjects(group.id);\n    const isExpanded = expandedGroupId === group.id;\n\n    return (\n      <div className=\"bg-white rounded-2xl border border-gray-100 p-5 shadow-sm\">\n        {/* Group Header */}\n        <div className=\"flex items-start gap-4\">\n          <div className=\"w-12 h-12 bg-gray-100 rounded-xl flex items-center justify-center shrink-0\">\n            <Users className=\"h-6 w-6 text-gray-600\" />\n          </div>\n          <div className=\"flex-1 min-w-0\">\n            <h3 className=\"font-bold text-gray-900 truncate\">{group.name}</h3>\n            <p className=\"text-sm text-gray-500\">{group.description || \"No description\"}</p>\n          </div>\n          <span className={`px-2 py-1 text-xs font-medium rounded-full ${\n            group.status === \"active\" ? \"bg-green-100 text-green-800\" : \"bg-gray-100 text-gray-600\"\n          }`}>\n            {group.status}\n          </span>\n        </div>\n\n        {/* Quick Actions Grid */}\n        <div className=\"mt-4 grid grid-cols-4 gap-2\">\n          <button\n            onClick={() => handleShareGroup(group)}\n            className=\"flex flex-col items-center gap-1 p-3 rounded-xl bg-[#25D366] text-white hover:bg-[#20bd5a] transition-colors\"\n            data-testid={`share-${group.id}`}\n          >\n            <SiWhatsapp className=\"h-5 w-5\" />\n            <span className=\"text-xs font-medium\">Share</span>\n          </button>\n          <button\n            onClick={() => setLocation(`/group/${group.id}`)}\n            className=\"flex flex-col items-center gap-1 p-3 rounded-xl bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors\"\n            data-testid={`view-members-${group.id}`}\n          >\n            <Eye className=\"h-5 w-5\" />\n            <span className=\"text-xs font-medium\">Members</span>\n          </button>\n          <button\n            onClick={() => handleCreateProject(group)}\n            className=\"flex flex-col items-center gap-1 p-3 rounded-xl bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors\"\n            data-testid={`add-project-${group.id}`}\n          >\n            <FolderPlus className=\"h-5 w-5\" />\n            <span className=\"text-xs font-medium\">Project</span>\n          </button>\n          <button\n            onClick={() => handleManagePartners(group)}\n            className=\"flex flex-col items-center gap-1 p-3 rounded-xl bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors\"\n            data-testid={`manage-partners-${group.id}`}\n          >\n            <UserCheck className=\"h-5 w-5\" />\n            <span className=\"text-xs font-medium\">Partners</span>\n          </button>\n        </div>\n\n        {/* Expandable Projects Section */}\n        <button\n          onClick={() => toggleGroupExpansion(group.id)}\n          className=\"mt-4 w-full flex items-center justify-between p-3 bg-gray-50 rounded-xl text-sm font-medium text-gray-600 hover:bg-gray-100 transition-colors\"\n          data-testid={`toggle-projects-${group.id}`}\n        >\n          <span>{projects.length} Project{projects.length !== 1 ? \"s\" : \"\"}</span>\n          {isExpanded ? <ChevronDown className=\"h-4 w-4\" /> : <ChevronRight className=\"h-4 w-4\" />}\n        </button>\n\n        {/* Projects List */}\n        {isExpanded && (\n          <div className=\"mt-3 space-y-3 border-t border-gray-100 pt-4\">\n            {projectsLoading ? (\n              <div className=\"flex justify-center py-4\">\n                <div className=\"w-6 h-6 border-2 border-gray-200 border-t-primary rounded-full animate-spin\" />\n              </div>\n            ) : projects.length === 0 ? (\n              <div className=\"text-center py-4\">\n                <FolderPlus className=\"h-8 w-8 text-gray-300 mx-auto mb-2\" />\n                <p className=\"text-sm text-gray-500\">No projects yet</p>\n                <button\n                  onClick={() => handleCreateProject(group)}\n                  className=\"mt-2 text-primary text-sm font-medium hover:underline\"\n                >\n                  Create First Project\n                </button>\n              </div>\n            ) : (\n              projects.map((project) => (\n                <ProjectCard\n                  key={project.id}\n                  project={project}\n                  isAdmin={true}\n                  onContribute={handleContributeToProject}\n                />\n              ))\n            )}\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  if (groupsLoading || statsLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <Navigation />\n        <DashboardSkeleton />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 pb-24 sm:pb-8\">\n      <Navigation />\n\n      <main className=\"max-w-lg mx-auto px-4 py-6 space-y-6\">\n        {/* Page Header - Clean Style */}\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-2xl font-bold text-gray-900\">My Groups</h1>\n            <p className=\"text-gray-500\">Manage your contributions</p>\n          </div>\n          {groups.length > 0 && (\n            <button\n              onClick={() => setCreateGroupModalOpen(true)}\n              className=\"w-12 h-12 bg-primary rounded-full flex items-center justify-center text-white shadow-lg hover:bg-primary/90 transition-colors\"\n              data-testid=\"button-create-group-fab\"\n            >\n              <Plus className=\"h-6 w-6\" />\n            </button>\n          )}\n        </div>\n\n        {/* Pending Approvals Alert */}\n        {pendingContributions.length > 0 && (\n          <div className=\"bg-amber-50 border border-amber-200 rounded-2xl p-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-10 h-10 bg-amber-100 rounded-full flex items-center justify-center shrink-0\">\n                <Clock className=\"h-5 w-5 text-amber-600\" />\n              </div>\n              <div className=\"flex-1\">\n                <p className=\"font-medium text-amber-900\">\n                  {pendingContributions.length} Payment{pendingContributions.length > 1 ? \"s\" : \"\"} Awaiting Approval\n                </p>\n                <p className=\"text-sm text-amber-700\">Tap to review payment proofs</p>\n              </div>\n              <ChevronRight className=\"h-5 w-5 text-amber-400\" />\n            </div>\n          </div>\n        )}\n\n        {/* Groups List or Empty State */}\n        {groups.length === 0 ? (\n          <div className=\"border-2 border-dashed border-gray-300 rounded-2xl p-8 text-center\">\n            <div className=\"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n              <Users className=\"h-8 w-8 text-gray-400\" />\n            </div>\n            <h3 className=\"text-lg font-bold text-gray-900 mb-2\">No groups yet</h3>\n            <p className=\"text-gray-500 mb-6\">\n              Start by creating your first group\n            </p>\n            <button\n              onClick={() => setCreateGroupModalOpen(true)}\n              className=\"bg-primary hover:bg-primary/90 text-white font-semibold px-6 py-3 rounded-full transition-colors\"\n              data-testid=\"button-create-first-group\"\n            >\n              Create First Group\n            </button>\n          </div>\n        ) : (\n          <div className=\"space-y-4\">\n            {groups.map((group) => (\n              <GroupCard key={group.id} group={group} />\n            ))}\n          </div>\n        )}\n\n        {/* Payment Proofs to Review */}\n        {pendingContributions.length > 0 && (\n          <section>\n            <h2 className=\"text-lg font-bold text-gray-900 mb-4\">Payment Proofs to Review</h2>\n            <div className=\"space-y-2\">\n              {pendingContributions.slice(0, 5).map((contribution) => (\n                <div\n                  key={contribution.id}\n                  className=\"bg-white rounded-2xl p-4 border border-gray-100 cursor-pointer hover:shadow-md transition-shadow\"\n                  onClick={() => {\n                    setSelectedContribution(contribution);\n                    setApprovalModalOpen(true);\n                  }}\n                >\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"w-10 h-10 bg-amber-100 rounded-full flex items-center justify-center\">\n                        <Clock className=\"h-5 w-5 text-amber-600\" />\n                      </div>\n                      <div>\n                        <p className=\"font-medium text-gray-900\">{contribution.userName}</p>\n                        <p className=\"text-sm text-gray-500\">{contribution.groupName}</p>\n                      </div>\n                    </div>\n                    <div className=\"text-right\">\n                      <p className=\"font-bold text-gray-900\">{formatNaira(Number(contribution.amount))}</p>\n                      <StatusBadge status=\"pending\" size=\"sm\" />\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </section>\n        )}\n\n        {/* Recent Transactions */}\n        {recentContributions.filter(c => c.status !== \"pending\").length > 0 && (\n          <section>\n            <h2 className=\"text-lg font-bold text-gray-900 mb-4\">Recent Transactions</h2>\n            <div className=\"space-y-2\">\n              {recentContributions.filter(c => c.status !== \"pending\").slice(0, 5).map((contribution) => (\n                <div key={contribution.id} className=\"bg-white rounded-2xl p-4 border border-gray-100\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className={`w-10 h-10 rounded-full flex items-center justify-center ${\n                        contribution.status === \"confirmed\" ? \"bg-green-100\" : \"bg-red-100\"\n                      }`}>\n                        {contribution.status === \"confirmed\" ? (\n                          <CheckCircle className=\"h-5 w-5 text-green-600\" />\n                        ) : (\n                          <XCircle className=\"h-5 w-5 text-red-600\" />\n                        )}\n                      </div>\n                      <div>\n                        <p className=\"font-medium text-gray-900 text-sm\">{contribution.userName}</p>\n                        <p className=\"text-xs text-gray-500\">{contribution.groupName}</p>\n                      </div>\n                    </div>\n                    <div className=\"text-right\">\n                      <p className=\"font-semibold text-gray-900\">{formatNaira(Number(contribution.amount))}</p>\n                      <StatusBadge \n                        status={contribution.status as \"confirmed\" | \"rejected\"} \n                        size=\"sm\" \n                      />\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </section>\n        )}\n      </main>\n\n      {/* Modals */}\n      <CreateGroupModal\n        open={createGroupModalOpen}\n        onOpenChange={setCreateGroupModalOpen}\n      />\n      {selectedGroup && (\n        <>\n          <CreateProjectModal\n            open={createProjectModalOpen}\n            onOpenChange={setCreateProjectModalOpen}\n            groupId={selectedGroup.id}\n            groupName={selectedGroup.name}\n          />\n          <ManageAccountabilityPartnersModal\n            open={managePartnersModalOpen}\n            onOpenChange={setManagePartnersModalOpen}\n            groupId={selectedGroup.id}\n            groupName={selectedGroup.name}\n          />\n        </>\n      )}\n      <PaymentModal\n        open={paymentModalOpen}\n        onOpenChange={setPaymentModalOpen}\n        project={selectedProject}\n      />\n      <PaymentApprovalModal\n        open={approvalModalOpen}\n        onOpenChange={setApprovalModalOpen}\n        contribution={selectedContribution}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":15710,"size_tokens":null},"attached_assets/content-1759769002144.md":{"content":"# Group Not Found\n\nThis group link may be invalid or expired.","path":null,"size_bytes":61,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","path":null,"size_bytes":1858,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"client/src/components/payment-modal.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Sheet, SheetContent, SheetHeader } from \"@/components/ui/sheet\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { insertContributionSchema, Project } from \"@shared/schema\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { getCurrentUser } from \"@/lib/auth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { formatNaira } from \"@/lib/currency\";\nimport { Upload, X, ArrowLeft, Building2, Copy, Check, CreditCard } from \"lucide-react\";\nimport { z } from \"zod\";\n\nconst paymentFormSchema = insertContributionSchema.extend({\n  amount: z.string().min(1, \"Amount is required\"),\n}).omit({\n  groupId: true,\n  projectId: true,\n  userId: true,\n  paymentType: true,\n  status: true,\n});\n\ntype PaymentFormData = z.infer<typeof paymentFormSchema>;\n\ninterface PaymentModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  project: Project | null;\n}\n\nexport function PaymentModal({ open, onOpenChange, project }: PaymentModalProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const user = getCurrentUser();\n  const [proofFile, setProofFile] = useState<File | null>(null);\n  const [proofPreview, setProofPreview] = useState<string>(\"\");\n  const [copiedField, setCopiedField] = useState<string | null>(null);\n\n  const form = useForm<PaymentFormData>({\n    resolver: zodResolver(paymentFormSchema),\n    defaultValues: {\n      amount: \"\",\n      description: \"\",\n      transactionRef: \"\",\n      proofOfPayment: \"\",\n    },\n  });\n\n  const handleFileUpload = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (file) {\n      if (file.size > 5 * 1024 * 1024) {\n        toast({\n          title: \"File too large\",\n          description: \"Please select a file smaller than 5MB\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      setProofFile(file);\n      const reader = new FileReader();\n      reader.onload = (e) => {\n        const result = e.target?.result as string;\n        setProofPreview(result);\n        form.setValue(\"proofOfPayment\", result);\n      };\n      reader.readAsDataURL(file);\n    }\n  };\n\n  const removeProof = () => {\n    setProofFile(null);\n    setProofPreview(\"\");\n    form.setValue(\"proofOfPayment\", \"\");\n  };\n\n  const copyToClipboard = async (text: string, fieldName: string) => {\n    try {\n      await navigator.clipboard.writeText(text);\n      setCopiedField(fieldName);\n      setTimeout(() => setCopiedField(null), 2000);\n    } catch (err) {\n      console.error(\"Failed to copy:\", err);\n    }\n  };\n\n  const createPaymentMutation = useMutation({\n    mutationFn: async (data: PaymentFormData) => {\n      if (!project || !user) throw new Error(\"Missing project or user\");\n      \n      const response = await apiRequest(\"POST\", \"/api/contributions\", {\n        ...data,\n        projectId: project.id,\n        groupId: project.groupId,\n        userId: user.id,\n        paymentType: \"bank_transfer\",\n        status: \"pending\",\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/groups\", \"user\", user?.id] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/contributions\", \"user\", user?.id] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/stats\", \"user\", user?.id] });\n      \n      toast({\n        title: \"Payment Submitted\",\n        description: \"Your contribution has been submitted and is pending admin approval.\",\n      });\n      form.reset();\n      removeProof();\n      onOpenChange(false);\n    },\n    onError: (error) => {\n      console.error(\"Payment submission error:\", error);\n      toast({\n        title: \"Payment Failed\",\n        description: error instanceof Error ? error.message : \"Failed to process payment. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: PaymentFormData) => {\n    createPaymentMutation.mutate(data);\n  };\n\n  if (!project) return null;\n\n  const hasPaymentDetails = project.accountNumber || project.bankName || project.paymentInstructions;\n  const hasTarget = project.targetAmount && parseFloat(project.targetAmount) > 0;\n  const projectTypeLabel = project.projectType === \"monthly\" ? \"Monthly Dues\" \n    : project.projectType === \"yearly\" ? \"Yearly Dues\" \n    : project.projectType === \"event\" ? \"Event Collection\"\n    : project.projectType === \"emergency\" ? \"Emergency Fund\"\n    : \"Target Goal\";\n\n  return (\n    <Sheet open={open} onOpenChange={onOpenChange}>\n      <SheetContent side=\"bottom\" className=\"h-[95vh] rounded-t-3xl p-0\">\n        <div className=\"flex flex-col h-full\">\n          {/* Header */}\n          <SheetHeader className=\"px-5 py-4 border-b border-gray-100\">\n            <div className=\"flex items-center gap-3\">\n              <button\n                onClick={() => onOpenChange(false)}\n                className=\"flex items-center gap-2 text-gray-600 hover:text-gray-900\"\n                data-testid=\"button-close-payment\"\n              >\n                <ArrowLeft className=\"h-5 w-5\" />\n                <span>Back</span>\n              </button>\n            </div>\n          </SheetHeader>\n\n          {/* Content */}\n          <div className=\"flex-1 overflow-y-auto px-5 py-6\">\n            <div className=\"space-y-6\">\n              <div>\n                <h2 className=\"text-2xl font-bold text-gray-900\">Submit Payment Proof</h2>\n                <p className=\"text-gray-500 mt-1\">\n                  For <span className=\"font-medium text-gray-700\">{project.name}</span>\n                </p>\n              </div>\n\n              {/* Project Summary */}\n              <div className=\"bg-gray-50 rounded-2xl p-4\">\n                <div className=\"flex items-center gap-2 text-sm text-gray-500 mb-3\">\n                  <CreditCard className=\"h-4 w-4\" />\n                  <span>{projectTypeLabel}</span>\n                </div>\n                <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                  {hasTarget && (\n                    <div>\n                      <p className=\"text-gray-500\">Target</p>\n                      <p className=\"font-bold text-lg\">{formatNaira(project.targetAmount!)}</p>\n                    </div>\n                  )}\n                  <div>\n                    <p className=\"text-gray-500\">Collected</p>\n                    <p className=\"font-bold text-lg text-primary\">{formatNaira(project.collectedAmount)}</p>\n                  </div>\n                </div>\n              </div>\n\n              {/* Payment Instructions */}\n              {hasPaymentDetails && (\n                <div className=\"bg-blue-50 border border-blue-100 rounded-2xl p-4 space-y-3\">\n                  <div className=\"flex items-center gap-2 text-blue-700 font-medium\">\n                    <Building2 className=\"h-5 w-5\" />\n                    <span>Where to Send Payment</span>\n                  </div>\n                  \n                  {project.bankName && (\n                    <div className=\"flex items-center justify-between bg-white rounded-xl p-3\">\n                      <div>\n                        <p className=\"text-xs text-gray-500\">Bank</p>\n                        <p className=\"font-medium text-gray-900\">{project.bankName}</p>\n                      </div>\n                      <button\n                        type=\"button\"\n                        onClick={() => copyToClipboard(project.bankName!, \"bank\")}\n                        className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n                        data-testid=\"button-copy-bank\"\n                      >\n                        {copiedField === \"bank\" ? (\n                          <Check className=\"h-4 w-4 text-green-600\" />\n                        ) : (\n                          <Copy className=\"h-4 w-4 text-gray-400\" />\n                        )}\n                      </button>\n                    </div>\n                  )}\n\n                  {project.accountNumber && (\n                    <div className=\"flex items-center justify-between bg-white rounded-xl p-3\">\n                      <div>\n                        <p className=\"text-xs text-gray-500\">Account Number</p>\n                        <p className=\"font-bold text-gray-900 text-lg tracking-wider\">{project.accountNumber}</p>\n                      </div>\n                      <button\n                        type=\"button\"\n                        onClick={() => copyToClipboard(project.accountNumber!, \"account\")}\n                        className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n                        data-testid=\"button-copy-account\"\n                      >\n                        {copiedField === \"account\" ? (\n                          <Check className=\"h-4 w-4 text-green-600\" />\n                        ) : (\n                          <Copy className=\"h-4 w-4 text-gray-400\" />\n                        )}\n                      </button>\n                    </div>\n                  )}\n\n                  {project.accountName && (\n                    <div className=\"flex items-center justify-between bg-white rounded-xl p-3\">\n                      <div>\n                        <p className=\"text-xs text-gray-500\">Account Name</p>\n                        <p className=\"font-medium text-gray-900\">{project.accountName}</p>\n                      </div>\n                      <button\n                        type=\"button\"\n                        onClick={() => copyToClipboard(project.accountName!, \"name\")}\n                        className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n                        data-testid=\"button-copy-name\"\n                      >\n                        {copiedField === \"name\" ? (\n                          <Check className=\"h-4 w-4 text-green-600\" />\n                        ) : (\n                          <Copy className=\"h-4 w-4 text-gray-400\" />\n                        )}\n                      </button>\n                    </div>\n                  )}\n\n                  {project.paymentInstructions && (\n                    <div className=\"bg-white rounded-xl p-3\">\n                      <p className=\"text-xs text-gray-500 mb-1\">Additional Instructions</p>\n                      <p className=\"text-gray-700 text-sm\">{project.paymentInstructions}</p>\n                    </div>\n                  )}\n                </div>\n              )}\n\n              {!hasPaymentDetails && (\n                <div className=\"bg-amber-50 border border-amber-100 rounded-2xl p-4 text-center\">\n                  <p className=\"text-amber-700 text-sm\">\n                    No payment details set yet. Contact your group admin for bank details.\n                  </p>\n                </div>\n              )}\n\n              <Form {...form}>\n                <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"amount\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel className=\"text-gray-700 font-medium\">Amount Paid (₦)</FormLabel>\n                        <FormControl>\n                          <Input \n                            type=\"number\" \n                            placeholder=\"e.g. 5000\" \n                            className=\"h-14 text-lg rounded-2xl border-2 border-gray-200 focus:border-primary\"\n                            {...field} \n                            data-testid=\"input-payment-amount\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"transactionRef\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel className=\"text-gray-700 font-medium\">Transaction Reference</FormLabel>\n                        <FormControl>\n                          <Input \n                            placeholder=\"Bank reference or receipt number\" \n                            className=\"h-14 rounded-2xl border-2 border-gray-200 focus:border-primary\"\n                            {...field}\n                            value={field.value || \"\"}\n                            data-testid=\"input-transaction-ref\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"description\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel className=\"text-gray-700 font-medium\">Note (Optional)</FormLabel>\n                        <FormControl>\n                          <Textarea \n                            placeholder=\"Any additional info about this payment...\" \n                            rows={2}\n                            className=\"rounded-2xl border-2 border-gray-200 focus:border-primary resize-none\"\n                            {...field}\n                            value={field.value || \"\"}\n                            data-testid=\"input-payment-note\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  {/* Proof of Payment Upload */}\n                  <div className=\"space-y-2\">\n                    <label className=\"text-sm font-medium text-gray-700\">Proof of Payment</label>\n                    <div className=\"border-2 border-dashed border-gray-300 rounded-2xl p-6 text-center\">\n                      {proofPreview ? (\n                        <div className=\"space-y-3\">\n                          <div className=\"relative inline-block\">\n                            <img \n                              src={proofPreview} \n                              alt=\"Payment proof\" \n                              className=\"max-w-full h-40 object-contain mx-auto rounded-xl\"\n                            />\n                            <button\n                              type=\"button\"\n                              onClick={removeProof}\n                              className=\"absolute -top-2 -right-2 w-8 h-8 bg-red-100 hover:bg-red-200 rounded-full flex items-center justify-center transition-colors\"\n                              data-testid=\"button-remove-proof\"\n                            >\n                              <X className=\"h-4 w-4 text-red-600\" />\n                            </button>\n                          </div>\n                          <p className=\"text-xs text-gray-500\">{proofFile?.name}</p>\n                        </div>\n                      ) : (\n                        <div className=\"space-y-3\">\n                          <div className=\"w-14 h-14 bg-gray-100 rounded-full flex items-center justify-center mx-auto\">\n                            <Upload className=\"h-6 w-6 text-gray-400\" />\n                          </div>\n                          <div>\n                            <input\n                              type=\"file\"\n                              accept=\"image/*\"\n                              onChange={handleFileUpload}\n                              className=\"hidden\"\n                              id=\"proof-upload\"\n                              data-testid=\"input-proof-upload\"\n                            />\n                            <label\n                              htmlFor=\"proof-upload\"\n                              className=\"cursor-pointer text-primary font-medium hover:underline\"\n                            >\n                              Tap to upload receipt\n                            </label>\n                          </div>\n                          <p className=\"text-xs text-gray-400\">\n                            Screenshot of bank transfer or payment receipt (Max 5MB)\n                          </p>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n\n                  <button\n                    type=\"submit\"\n                    disabled={createPaymentMutation.isPending}\n                    className=\"w-full bg-primary hover:bg-primary/90 text-white font-semibold text-lg py-4 rounded-full disabled:opacity-50 transition-all active:scale-[0.98] mt-4\"\n                    data-testid=\"button-submit-payment\"\n                  >\n                    {createPaymentMutation.isPending ? (\n                      <div className=\"flex items-center justify-center gap-2\">\n                        <div className=\"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\n                        Submitting...\n                      </div>\n                    ) : (\n                      \"Submit Payment Proof\"\n                    )}\n                  </button>\n                </form>\n              </Form>\n            </div>\n          </div>\n        </div>\n      </SheetContent>\n    </Sheet>\n  );\n}\n","path":null,"size_bytes":17503,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"client/src/components/navigation.tsx":{"content":"import { useState } from \"react\";\nimport { Link, useLocation } from \"wouter\";\nimport {\n  Users,\n  Menu,\n  CreditCard,\n  History,\n  LogOut,\n  ShieldCheck,\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Sheet, SheetContent, SheetTrigger } from \"@/components/ui/sheet\";\nimport { NotificationBell } from \"@/components/notification-bell\";\nimport { getCurrentUser, logout } from \"@/lib/auth\";\n\nexport function Navigation() {\n  const [location, setLocation] = useLocation();\n  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);\n  const user = getCurrentUser();\n\n  const handleLogout = () => {\n    logout();\n    setLocation(\"/\");\n  };\n\n  if (!user) return null;\n\n  const isActive = (path: string) => location === path;\n\n  const navLinks = [\n    { href: \"/groups\", icon: Users, label: \"My Groups\" },\n    { href: \"/submit-proof\", icon: CreditCard, label: \"Submit Proof\" },\n    { href: \"/my-contributions\", icon: History, label: \"History\" },\n  ];\n\n  return (\n    <>\n      {/* Top Header Bar - Clean White */}\n      <header className=\"bg-white border-b border-gray-100 sticky top-0 z-50 safe-top\">\n        <div className=\"max-w-7xl mx-auto px-4\">\n          <div className=\"flex justify-between items-center h-14\">\n            {/* Logo */}\n            <Link href=\"/groups\">\n              <div className=\"flex items-center gap-2\" data-testid=\"link-home\">\n                <div className=\"w-9 h-9 rounded-full bg-primary flex items-center justify-center\">\n                  <span className=\"text-white font-bold text-lg\">K</span>\n                </div>\n                <span className=\"font-bold text-lg text-gray-900\">Kontrib</span>\n              </div>\n            </Link>\n\n            {/* Secure Badge */}\n            <div className=\"flex items-center gap-2 text-primary border border-primary/20 rounded-full px-3 py-1.5\">\n              <ShieldCheck className=\"h-4 w-4\" />\n              <span className=\"text-sm font-medium\">Secure</span>\n            </div>\n\n            {/* Right side - Desktop */}\n            <div className=\"hidden sm:flex items-center gap-3\">\n              <NotificationBell userId={user.id} />\n              \n              <div className=\"flex items-center gap-2 bg-gray-100 rounded-full px-3 py-1.5\">\n                <div className=\"w-7 h-7 rounded-full bg-primary flex items-center justify-center text-sm font-medium text-white\">\n                  {user.fullName?.charAt(0)?.toUpperCase() || \"U\"}\n                </div>\n                <span className=\"text-sm font-medium text-gray-700 max-w-[100px] truncate\">\n                  {user.fullName?.split(\" \")[0] || \"User\"}\n                </span>\n              </div>\n              \n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={handleLogout}\n                className=\"text-gray-500 hover:bg-gray-100 hover:text-gray-700\"\n                data-testid=\"button-logout-desktop\"\n              >\n                <LogOut className=\"h-4 w-4\" />\n              </Button>\n            </div>\n\n            {/* Mobile - Menu */}\n            <div className=\"flex sm:hidden items-center gap-2\">\n              <NotificationBell userId={user.id} />\n              \n              <Sheet open={mobileMenuOpen} onOpenChange={setMobileMenuOpen}>\n                <SheetTrigger asChild>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className=\"text-gray-700 hover:bg-gray-100 p-2\"\n                    data-testid=\"button-mobile-menu\"\n                  >\n                    <Menu className=\"h-6 w-6\" />\n                  </Button>\n                </SheetTrigger>\n                <SheetContent side=\"right\" className=\"w-[280px] p-0\">\n                  <div className=\"flex flex-col h-full\">\n                    {/* User Info Header */}\n                    <div className=\"bg-primary text-white p-5\">\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"w-12 h-12 rounded-full bg-white/20 flex items-center justify-center text-xl font-bold\">\n                          {user.fullName?.charAt(0)?.toUpperCase() || \"U\"}\n                        </div>\n                        <div>\n                          <p className=\"font-semibold text-lg\">{user.fullName}</p>\n                          <p className=\"text-white/70 text-sm capitalize\">{user.role}</p>\n                        </div>\n                      </div>\n                    </div>\n\n                    {/* Navigation Links */}\n                    <div className=\"flex-1 py-4\">\n                      {navLinks.map((link) => (\n                        <Link\n                          key={link.href}\n                          href={link.href}\n                          onClick={() => setMobileMenuOpen(false)}\n                        >\n                          <div\n                            className={`flex items-center gap-4 px-5 py-4 transition-colors ${\n                              isActive(link.href)\n                                ? \"bg-primary/5 text-primary border-r-4 border-primary\"\n                                : \"text-gray-700 hover:bg-gray-50\"\n                            }`}\n                            data-testid={`link-mobile-${link.label.toLowerCase().replace(\" \", \"-\")}`}\n                          >\n                            <link.icon className=\"h-5 w-5\" />\n                            <span className=\"font-medium\">{link.label}</span>\n                          </div>\n                        </Link>\n                      ))}\n                    </div>\n\n                    {/* Logout Button */}\n                    <div className=\"p-4 border-t\">\n                      <Button\n                        variant=\"outline\"\n                        onClick={() => {\n                          setMobileMenuOpen(false);\n                          handleLogout();\n                        }}\n                        className=\"w-full h-12 text-red-600 border-red-200 hover:bg-red-50 hover:text-red-700\"\n                        data-testid=\"button-logout-mobile\"\n                      >\n                        <LogOut className=\"h-5 w-5 mr-2\" />\n                        Log Out\n                      </Button>\n                    </div>\n                  </div>\n                </SheetContent>\n              </Sheet>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* Bottom Navigation Bar - Mobile Only */}\n      <nav className=\"sm:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-50 safe-bottom\">\n        <div className=\"grid grid-cols-4 h-16\">\n          {navLinks.map((link) => (\n            <Link key={link.href} href={link.href}>\n              <div\n                className={`flex flex-col items-center justify-center h-full gap-1 transition-colors ${\n                  isActive(link.href)\n                    ? \"text-primary\"\n                    : \"text-gray-500\"\n                }`}\n                data-testid={`nav-${link.label.toLowerCase().replace(\" \", \"-\")}`}\n              >\n                <link.icon className={`h-5 w-5 ${isActive(link.href) ? \"stroke-[2.5]\" : \"\"}`} />\n                <span className=\"text-[10px] font-medium\">{link.label}</span>\n              </div>\n            </Link>\n          ))}\n        </div>\n      </nav>\n\n      {/* Desktop Sidebar/Secondary Nav */}\n      <div className=\"hidden sm:block bg-white border-b border-gray-200\">\n        <div className=\"max-w-7xl mx-auto px-4\">\n          <div className=\"flex items-center gap-1 h-12 overflow-x-auto\">\n            {navLinks.map((link) => (\n              <Link key={link.href} href={link.href}>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className={`h-9 px-4 rounded-full transition-all ${\n                    isActive(link.href)\n                      ? \"bg-primary/10 text-primary font-semibold\"\n                      : \"text-gray-600 hover:bg-gray-100\"\n                  }`}\n                  data-testid={`nav-desktop-${link.label.toLowerCase().replace(\" \", \"-\")}`}\n                >\n                  <link.icon className=\"h-4 w-4 mr-2\" />\n                  {link.label}\n                </Button>\n              </Link>\n            ))}\n          </div>\n        </div>\n      </div>\n    </>\n  );\n}\n","path":null,"size_bytes":8326,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\n\ninterface BadgeProps extends React.HTMLAttributes<HTMLDivElement> {\n  variant?: \"default\" | \"secondary\" | \"destructive\" | \"outline\"\n}\n\nconst Badge = React.forwardRef<HTMLDivElement, BadgeProps>(\n  ({ className, variant = \"default\", ...props }, ref) => {\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n          {\n            \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\": variant === \"default\",\n            \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\": variant === \"secondary\",\n            \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\": variant === \"destructive\",\n            \"text-foreground\": variant === \"outline\",\n          },\n          className\n        )}\n        {...props}\n      />\n    )\n  }\n)\nBadge.displayName = \"Badge\"\n\nexport { Badge }","path":null,"size_bytes":1119,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":1901,"size_tokens":null},"client/src/pages/groups.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Navigation } from \"@/components/navigation\";\nimport { CreateGroupModal } from \"@/components/create-group-modal\";\nimport { CreateProjectModal } from \"@/components/create-project-modal\";\nimport { GroupCard } from \"@/components/group-card\";\nimport { ProjectCard } from \"@/components/project-card\";\nimport { ShareableLinkDisplay, CopyLinkButton } from \"@/components/copy-link-button\";\nimport { \n  Users, \n  Plus, \n  Search,\n  FolderPlus,\n  ChevronDown,\n  ChevronUp,\n  Settings,\n  Target,\n  Calendar,\n  MessageCircle,\n  UserPlus,\n  Eye,\n  UserCheck\n} from \"lucide-react\";\nimport { getCurrentUser, isAdmin } from \"@/lib/auth\";\nimport { formatNaira } from \"@/lib/currency\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Group, Project } from \"@shared/schema\";\n\nexport default function Groups() {\n  const user = getCurrentUser();\n  const userIsAdmin = isAdmin();\n  const { toast } = useToast();\n  const [createGroupModalOpen, setCreateGroupModalOpen] = useState(false);\n  const [createProjectModalOpen, setCreateProjectModalOpen] = useState(false);\n  const [selectedGroup, setSelectedGroup] = useState<Group | null>(null);\n  const [expandedGroups, setExpandedGroups] = useState<Set<string>>(new Set());\n  const [searchTerm, setSearchTerm] = useState(\"\");\n\n  // Fetch groups based on user role\n  const { data: groups = [], isLoading } = useQuery<any[]>({\n    queryKey: userIsAdmin ? [\"/api/groups\", \"admin\", user?.id] : [\"/api/groups\", \"user\", user?.id],\n    enabled: !!user,\n  });\n\n  // Extract groups for member data structure\n  const actualGroups = userIsAdmin ? groups : groups.map(membership => membership.group);\n\n  // Filter groups based on search\n  const filteredGroups = actualGroups.filter((group) =>\n    group.name?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    group.description?.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  // Hook to fetch projects for a specific group\n  const useGroupProjects = (groupId: string) => {\n    return useQuery<Project[]>({\n      queryKey: [\"/api/groups\", groupId, \"projects\"],\n      enabled: !!groupId && expandedGroups.has(groupId),\n    });\n  };\n\n  // Hook to fetch members for a specific group\n  const useGroupMembers = (groupId: string) => {\n    return useQuery<any[]>({\n      queryKey: [\"/api/groups\", groupId, \"members\"],\n      enabled: !!groupId && expandedGroups.has(groupId),\n    });\n  };\n\n  const toggleGroupExpansion = (groupId: string) => {\n    const newExpanded = new Set(expandedGroups);\n    if (newExpanded.has(groupId)) {\n      newExpanded.delete(groupId);\n    } else {\n      newExpanded.add(groupId);\n    }\n    setExpandedGroups(newExpanded);\n  };\n\n  const handleCreateProject = (group: Group) => {\n    setSelectedGroup(group);\n    setCreateProjectModalOpen(true);\n  };\n\n  const handleManageGroup = (group: Group) => {\n    // TODO: Implement group management\n    toast({\n      title: \"Group Management\",\n      description: \"Group management features coming soon!\",\n    });\n  };\n\n  const handleContributeToProject = (project: Project) => {\n    // Navigate to make payment page with project pre-selected\n    window.location.href = \"/make-payment\";\n  };\n\n  const handleViewMembers = (group: Group) => {\n    // Toggle group expansion to show members\n    toggleGroupExpansion(group.id);\n  };\n\n  const handleShareGroup = (group: any) => {\n    const shareUrl = `${window.location.origin}/${group.customSlug || group.registrationLink}`;\n    \n    // WhatsApp-specific share (opens WhatsApp directly with pre-filled message)\n    const shareText = `🎯 You're invited to join \"${group.name}\" on Kontrib!\\n\\n💰 Manage contributions with transparency and ease.\\n\\n${shareUrl}`;\n    const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(shareText)}`;\n    \n    // Open WhatsApp directly instead of using navigator.share\n    // This ensures the URL is in the message where WhatsApp can detect it\n    window.open(whatsappUrl, '_blank');\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\n        <Navigation />\n        <div className=\"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\n          <div className=\"animate-pulse space-y-6\">\n            <div className=\"h-32 bg-gray-200 dark:bg-gray-700 rounded-xl\"></div>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {[...Array(6)].map((_, i) => (\n                <div key={i} className=\"h-48 bg-gray-200 dark:bg-gray-700 rounded-xl\"></div>\n              ))}\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 pb-20 sm:pb-0\">\n      <Navigation />\n      \n      <div className=\"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\n        {/* Header */}\n        <div className=\"mb-8\">\n          <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between\">\n            <div>\n              <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white mb-2\">\n                {userIsAdmin ? \"My Groups\" : \"Groups\"}\n              </h1>\n              <p className=\"text-gray-600 dark:text-gray-300\">\n                {userIsAdmin \n                  ? \"Manage your contribution groups and track member progress.\"\n                  : \"View and contribute to your active groups.\"\n                }\n              </p>\n            </div>\n            {userIsAdmin && (\n              <Button \n                onClick={() => setCreateGroupModalOpen(true)}\n                className=\"mt-4 sm:mt-0 bg-nigerian-green hover:bg-forest-green\"\n                data-testid=\"create-group-button\"\n              >\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Create Group\n              </Button>\n            )}\n          </div>\n        </div>\n\n        {/* Search */}\n        <Card className=\"mb-6\">\n          <CardContent className=\"p-4\">\n            <div className=\"relative\">\n              <Search className=\"absolute left-3 top-3 h-4 w-4 text-gray-400\" />\n              <Input\n                placeholder=\"Search groups by name or description...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10\"\n                data-testid=\"search-groups\"\n              />\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Groups Grid */}\n        {filteredGroups.length === 0 ? (\n          <Card>\n            <CardContent className=\"text-center py-12\">\n              {actualGroups.length === 0 ? (\n                <>\n                  <Users className=\"h-16 w-16 text-gray-400 mx-auto mb-4\" />\n                  <h3 className=\"text-xl font-medium text-gray-900 dark:text-white mb-2\">\n                    {userIsAdmin ? \"No Groups Created\" : \"No Groups Joined\"}\n                  </h3>\n                  <p className=\"text-gray-600 dark:text-gray-300 mb-6\">\n                    {userIsAdmin \n                      ? \"Create your first group to start collecting contributions from members.\"\n                      : \"You haven't joined any contribution groups yet. Ask a group admin for an invitation link.\"\n                    }\n                  </p>\n                  {userIsAdmin && (\n                    <Button \n                      onClick={() => setCreateGroupModalOpen(true)}\n                      className=\"bg-nigerian-green hover:bg-forest-green\"\n                    >\n                      <Plus className=\"h-4 w-4 mr-2\" />\n                      Create Your First Group\n                    </Button>\n                  )}\n                </>\n              ) : (\n                <>\n                  <Search className=\"h-16 w-16 text-gray-400 mx-auto mb-4\" />\n                  <h3 className=\"text-xl font-medium text-gray-900 dark:text-white mb-2\">No Results Found</h3>\n                  <p className=\"text-gray-600 dark:text-gray-300\">\n                    No groups match your search criteria.\n                  </p>\n                  <Button\n                    variant=\"outline\"\n                    onClick={() => setSearchTerm(\"\")}\n                    className=\"mt-4\"\n                  >\n                    Clear Search\n                  </Button>\n                </>\n              )}\n            </CardContent>\n          </Card>\n        ) : (\n          <div className=\"space-y-6\">\n            {filteredGroups.map((group) => {\n              // Handle different data structures for admin vs member groups\n              const userContribution = userIsAdmin ? undefined : \n                groups.find(membership => membership.group?.id === group.id)?.contributedAmount;\n              const isExpanded = expandedGroups.has(group.id);\n              \n              return (\n                <GroupWithProjects \n                  key={group.id} \n                  group={group} \n                  isExpanded={isExpanded}\n                  userContribution={userContribution}\n                />\n              );\n            })}\n          </div>\n        )}\n\n        {/* Quick Stats Summary */}\n        {actualGroups.length > 0 && (\n          <div className=\"mt-8\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Summary</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4\">\n                  <div className=\"text-center\">\n                    <p className=\"text-2xl font-bold text-nigerian-green\">\n                      {actualGroups.length}\n                    </p>\n                    <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                      {userIsAdmin ? \"Groups Created\" : \"Groups Joined\"}\n                    </p>\n                  </div>\n                  <div className=\"text-center\">\n                    <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n                      {actualGroups.reduce((sum, group) => sum + (group.memberCount || 0), 0)}\n                    </p>\n                    <p className=\"text-sm text-gray-600 dark:text-gray-400\">Total Members</p>\n                  </div>\n                  <div className=\"text-center\">\n                    <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n                      {actualGroups.reduce((sum, group) => sum + (group.projectCount || 0), 0)}\n                    </p>\n                    <p className=\"text-sm text-gray-600 dark:text-gray-400\">Total Projects</p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        )}\n      </div>\n\n      {/* Create Group Modal */}\n      <CreateGroupModal\n        open={createGroupModalOpen}\n        onOpenChange={setCreateGroupModalOpen}\n      />\n\n      {/* Create Project Modal */}\n      {selectedGroup && (\n        <CreateProjectModal\n          open={createProjectModalOpen}\n          onOpenChange={setCreateProjectModalOpen}\n          groupId={selectedGroup.id}\n          groupName={selectedGroup.name}\n        />\n      )}\n    </div>\n  );\n\n  // Component to display group with its projects\n  function GroupWithProjects({ \n    group, \n    isExpanded, \n    userContribution \n  }: { \n    group: Group; \n    isExpanded: boolean; \n    userContribution?: string;\n  }) {\n    const { data: projects = [], isLoading: projectsLoading } = useGroupProjects(group.id);\n    const { data: members = [], isLoading: membersLoading } = useGroupMembers(group.id);\n\n    return (\n      <Card className=\"hover:shadow-lg transition-shadow\">\n        <CardContent className=\"p-6\">\n          {/* Group Header */}\n          <div className=\"flex items-start justify-between mb-4\">\n            <div className=\"flex-1\">\n              <GroupCard\n                group={group}\n                isAdmin={userIsAdmin}\n                onManage={handleManageGroup}\n                onShare={handleShareGroup}\n                onMakePayment={!userIsAdmin ? () => {} : undefined}\n                userContribution={userContribution}\n              />\n            </div>\n          </div>\n\n          {/* Shareable Link Display for Admins */}\n          {userIsAdmin && (\n            <div className=\"mb-6\">\n              <ShareableLinkDisplay\n                link={`${window.location.origin}/join/${group.registrationLink}`}\n                title=\"Share Group Link\"\n                description=\"Share this easy-to-remember link with people you want to invite\"\n              />\n            </div>\n          )}\n\n          {/* Group Action Buttons */}\n          <div className=\"flex flex-wrap gap-2 mb-4\">\n            {userIsAdmin && (\n              <Button\n                onClick={() => handleCreateProject(group)}\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"flex-1 min-w-[120px]\"\n                data-testid={`create-project-${group.id}`}\n              >\n                <FolderPlus className=\"h-4 w-4 mr-1\" />\n                Add Project\n              </Button>\n            )}\n            \n            <Button\n              onClick={() => toggleGroupExpansion(group.id)}\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"flex-1 min-w-[120px]\"\n              data-testid={`toggle-projects-${group.id}`}\n            >\n              {isExpanded ? (\n                <>\n                  <ChevronUp className=\"h-4 w-4 mr-1\" />\n                  Hide Projects\n                </>\n              ) : (\n                <>\n                  <ChevronDown className=\"h-4 w-4 mr-1\" />\n                  View Projects ({(group as any).projectCount || 0})\n                </>\n              )}\n            </Button>\n\n            {userIsAdmin && (\n              <Button\n                onClick={() => handleViewMembers(group)}\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"flex-1 min-w-[120px]\"\n                data-testid={`view-members-${group.id}`}\n              >\n                <UserCheck className=\"h-4 w-4 mr-1\" />\n                View Members ({(group as any).memberCount || 0})\n              </Button>\n            )}\n\n            <Button\n              onClick={() => handleShareGroup(group)}\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"flex-1 min-w-[120px]\"\n              data-testid={`share-group-${group.id}`}\n            >\n              <MessageCircle className=\"h-4 w-4 mr-1\" />\n              Share Group\n            </Button>\n          </div>\n\n          {/* Expanded Content - Members and Projects */}\n          {isExpanded && (\n            <div className=\"border-t pt-4 space-y-6\">\n              {/* Members Section */}\n              {userIsAdmin && (\n                <div>\n                  <div className=\"flex items-center justify-between mb-4\">\n                    <h4 className=\"font-semibold text-gray-900 dark:text-white flex items-center\">\n                      <Users className=\"h-5 w-5 mr-2 text-nigerian-green\" />\n                      Members in {group.name}\n                    </h4>\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"text-sm text-gray-600 dark:text-gray-400\">\n                        {members.length} member{members.length !== 1 ? 's' : ''}\n                      </span>\n                    </div>\n                  </div>\n\n                  {membersLoading ? (\n                    <div className=\"flex items-center justify-center py-4\">\n                      <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-nigerian-green\"></div>\n                      <span className=\"ml-2 text-sm text-gray-600\">Loading members...</span>\n                    </div>\n                  ) : members.length === 0 ? (\n                    <div className=\"text-center py-6 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n                      <UserPlus className=\"h-8 w-8 text-gray-400 mx-auto mb-2\" />\n                      <p className=\"text-sm text-gray-600 dark:text-gray-300\">\n                        No members have joined this group yet. Share the group link to invite members.\n                      </p>\n                    </div>\n                  ) : (\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3\">\n                      {members.map((member) => (\n                        <Card key={member.id} className=\"p-4\">\n                          <div className=\"flex items-center gap-3\">\n                            <div className=\"w-10 h-10 bg-nigerian-green rounded-full flex items-center justify-center\">\n                              <Users className=\"h-5 w-5 text-white\" />\n                            </div>\n                            <div className=\"flex-1 min-w-0\">\n                              <p className=\"font-medium text-gray-900 dark:text-white truncate\">\n                                {member.user?.fullName || 'Unknown Member'}\n                              </p>\n                              <p className=\"text-sm text-gray-600 dark:text-gray-400 truncate\">\n                                @{member.user?.username || 'unknown'}\n                              </p>\n                              <p className=\"text-xs text-gray-500\">\n                                Joined {new Date(member.joinedAt).toLocaleDateString()}\n                              </p>\n                            </div>\n                            <div className=\"text-right\">\n                              <p className=\"text-sm font-medium text-nigerian-green\">\n                                {formatNaira(member.contributedAmount || \"0\")}\n                              </p>\n                              <p className=\"text-xs text-gray-500\">contributed</p>\n                            </div>\n                          </div>\n                        </Card>\n                      ))}\n                    </div>\n                  )}\n                </div>\n              )}\n\n              {/* Projects Section */}\n              <div>\n                <div className=\"flex items-center justify-between mb-4\">\n                  <h4 className=\"font-semibold text-gray-900 dark:text-white flex items-center\">\n                    <Target className=\"h-5 w-5 mr-2 text-nigerian-green\" />\n                    Projects in {group.name}\n                  </h4>\n                  {userIsAdmin && (\n                    <Button\n                      onClick={() => handleCreateProject(group)}\n                      size=\"sm\"\n                      className=\"bg-nigerian-green hover:bg-forest-green\"\n                    >\n                      <Plus className=\"h-4 w-4 mr-1\" />\n                      New Project\n                    </Button>\n                  )}\n                </div>\n\n                {projectsLoading ? (\n                <div className=\"flex items-center justify-center py-8\">\n                  <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-nigerian-green\"></div>\n                  <span className=\"ml-2 text-gray-600\">Loading projects...</span>\n                </div>\n              ) : projects.length === 0 ? (\n                <div className=\"text-center py-8 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n                  <FolderPlus className=\"h-12 w-12 text-gray-400 mx-auto mb-3\" />\n                  <h5 className=\"text-lg font-medium text-gray-900 dark:text-white mb-2\">\n                    No projects yet\n                  </h5>\n                  <p className=\"text-gray-600 dark:text-gray-300 mb-4\">\n                    {userIsAdmin \n                      ? \"Create your first project to start collecting contributions for specific goals.\"\n                      : \"No projects have been created in this group yet.\"\n                    }\n                  </p>\n                  {userIsAdmin && (\n                    <Button\n                      onClick={() => handleCreateProject(group)}\n                      className=\"bg-nigerian-green hover:bg-forest-green\"\n                    >\n                      <Plus className=\"h-4 w-4 mr-2\" />\n                      Create First Project\n                    </Button>\n                  )}\n                </div>\n              ) : (\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  {projects.map((project) => (\n                    <div key={project.id} className=\"relative\">\n                      <ProjectCard\n                        project={project}\n                        isAdmin={userIsAdmin}\n                        onContribute={handleContributeToProject}\n                      />\n                      {userIsAdmin && (\n                        <div className=\"absolute top-2 right-2\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => {\n                              // TODO: Implement project management\n                              toast({\n                                title: \"Project Management\",\n                                description: \"Project management features coming soon!\",\n                              });\n                            }}\n                          >\n                            <Settings className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      )}\n                    </div>\n                  ))}\n                </div>\n              )}\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    );\n  }\n}","path":null,"size_bytes":21721,"size_tokens":null},"server/storage.ts":{"content":"import { \n  type User, \n  type Group, \n  type GroupMember, \n  type Project,\n  type AccountabilityPartner,\n  type Contribution,\n  type Notification,\n  type OtpVerification,\n  type InsertUser, \n  type InsertGroup, \n  type InsertGroupMember, \n  type InsertProject,\n  type InsertAccountabilityPartner,\n  type InsertContribution,\n  type InsertNotification,\n  type InsertOtpVerification,\n  type GroupWithStats,\n  type GroupWithRole,\n  type MemberWithContributions,\n  type ContributionWithDetails,\n  type ProjectWithStats,\n  type AccountabilityPartnerWithDetails\n} from \"@shared/schema\";\nimport { randomUUID } from \"crypto\";\n\nexport interface IStorage {\n  // User methods\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  getUserByPhoneNumber(phoneNumber: string): Promise<User | undefined>;\n  findOrCreateUserByPhone(phoneNumber: string): Promise<User>;\n  updateUserProfile(userId: string, updates: { fullName?: string; role?: string }): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  \n  // Group methods\n  getGroup(id: string): Promise<Group | undefined>;\n  getGroupByRegistrationLink(link: string): Promise<Group | undefined>;\n  getGroupByCustomSlug(slug: string): Promise<Group | undefined>;\n  getGroupsByAdmin(adminId: string): Promise<GroupWithStats[]>;\n  getAllUserGroups(userId: string): Promise<GroupWithRole[]>;\n  createGroup(group: InsertGroup, adminId: string): Promise<Group>;\n  updateGroup(id: string, updates: Partial<Group>): Promise<Group | undefined>;\n  \n  // Group member methods\n  getGroupMembers(groupId: string): Promise<(GroupMember & { user: User })[]>;\n  getUserGroups(userId: string): Promise<(GroupMember & { group: Group })[]>;\n  addGroupMember(member: InsertGroupMember): Promise<GroupMember>;\n  getGroupMember(groupId: string, userId: string): Promise<GroupMember | undefined>;\n  removeGroupMember(memberId: string): Promise<boolean>;\n  \n  // Project methods\n  getProjectsByGroup(groupId: string): Promise<ProjectWithStats[]>;\n  getProject(id: string): Promise<Project | undefined>;\n  getProjectByCustomSlug(customSlug: string): Promise<Project | undefined>;\n  createProject(project: InsertProject): Promise<Project>;\n  updateProject(id: string, updates: Partial<Project>): Promise<Project | undefined>;\n  \n  // Accountability Partner methods\n  getGroupAccountabilityPartners(groupId: string): Promise<AccountabilityPartnerWithDetails[]>;\n  addAccountabilityPartner(partner: InsertAccountabilityPartner): Promise<AccountabilityPartner>;\n  removeAccountabilityPartner(groupId: string, userId: string): Promise<boolean>;\n\n  // Contribution methods\n  getGroupContributions(groupId: string): Promise<ContributionWithDetails[]>;\n  getProjectContributions(projectId: string): Promise<ContributionWithDetails[]>;\n  createContribution(contribution: InsertContribution): Promise<Contribution>;\n  confirmContribution(contributionId: string): Promise<Contribution | undefined>;\n  \n  // Notification methods\n  getUserNotifications(userId: string): Promise<Notification[]>;\n  createNotification(notification: InsertNotification): Promise<Notification>;\n  createRejectionNotification(contribution: Contribution, reason?: string): Promise<void>;\n  markNotificationRead(notificationId: string): Promise<void>;\n  \n  getUserContributions(userId: string): Promise<ContributionWithDetails[]>;\n  getAdminContributions(adminId: string): Promise<ContributionWithDetails[]>;\n  updateContribution(id: string, updates: Partial<Contribution>): Promise<Contribution | undefined>;\n  \n  // Stats methods\n  getUserStats(userId: string): Promise<MemberWithContributions>;\n  getAdminStats(adminId: string): Promise<{\n    totalCollections: string;\n    activeMembers: number;\n    pendingPayments: number;\n    completionRate: number;\n  }>;\n  \n  // OTP Verification methods\n  sendOtp(phoneNumber: string): Promise<{ code: string; expiresAt: string }>;\n  createOtpVerification(otp: InsertOtpVerification): Promise<OtpVerification>;\n  getActiveOtpVerification(phoneNumber: string): Promise<OtpVerification | undefined>;\n  verifyOtp(phoneNumber: string, otp: string): Promise<boolean>;\n  cleanupExpiredOtps(): Promise<void>;\n}\n\nexport class MemStorage implements IStorage {\n  private users: Map<string, User>;\n  private groups: Map<string, Group>;\n  private groupMembers: Map<string, GroupMember>;\n  private projects: Map<string, Project>;\n  private accountabilityPartners: Map<string, AccountabilityPartner>;\n  private contributions: Map<string, Contribution>;\n  private notifications: Map<string, Notification>;\n  private otpVerifications: Map<string, OtpVerification>;\n\n  constructor() {\n    this.users = new Map();\n    this.groups = new Map();\n    this.groupMembers = new Map();\n    this.projects = new Map();\n    this.accountabilityPartners = new Map();\n    this.contributions = new Map();\n    this.notifications = new Map();\n    this.otpVerifications = new Map();\n  }\n\n  async getUser(id: string): Promise<User | undefined> {\n    return this.users.get(id);\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    return Array.from(this.users.values()).find(user => user.username === username);\n  }\n\n  async getUserByPhoneNumber(phoneNumber: string): Promise<User | undefined> {\n    return Array.from(this.users.values()).find(user => user.phoneNumber === phoneNumber);\n  }\n\n  async findOrCreateUserByPhone(phoneNumber: string): Promise<User> {\n    const existingUser = await this.getUserByPhoneNumber(phoneNumber);\n    if (existingUser) {\n      return existingUser;\n    }\n    \n    const id = randomUUID();\n    const user: User = {\n      id,\n      username: null,\n      password: null,\n      fullName: null,\n      phoneNumber,\n      role: \"member\",\n      profileCompletedAt: null,\n      createdAt: new Date(),\n    };\n    this.users.set(id, user);\n    return user;\n  }\n\n  async updateUserProfile(userId: string, updates: { fullName?: string; role?: string }): Promise<User | undefined> {\n    const user = this.users.get(userId);\n    if (!user) return undefined;\n    \n    // Validate role at storage layer as extra safety\n    const validRoles = ['admin', 'member'];\n    const validatedRole = updates.role && validRoles.includes(updates.role) ? updates.role : user.role;\n    \n    const updatedUser: User = {\n      ...user,\n      fullName: updates.fullName ?? user.fullName,\n      role: validatedRole,\n      profileCompletedAt: updates.fullName ? new Date() : user.profileCompletedAt,\n    };\n    this.users.set(userId, updatedUser);\n    return updatedUser;\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const id = randomUUID();\n    const user: User = { \n      ...insertUser, \n      id,\n      role: insertUser.role || \"member\"\n    };\n    this.users.set(id, user);\n    return user;\n  }\n\n  async getGroup(id: string): Promise<Group | undefined> {\n    return this.groups.get(id);\n  }\n\n  async getGroupByRegistrationLink(link: string): Promise<Group | undefined> {\n    return Array.from(this.groups.values()).find(group => group.registrationLink === link);\n  }\n\n  async getGroupByCustomSlug(slug: string): Promise<Group | undefined> {\n    return Array.from(this.groups.values()).find(group => group.customSlug === slug);\n  }\n\n  async getGroupsByAdmin(adminId: string): Promise<GroupWithStats[]> {\n    const adminGroups = Array.from(this.groups.values()).filter(group => group.adminId === adminId);\n    \n    return adminGroups.map(group => {\n      const members = Array.from(this.groupMembers.values()).filter(member => member.groupId === group.id);\n      const memberCount = members.length;\n      \n      // Calculate stats based on projects instead of group target\n      const groupProjects = Array.from(this.projects.values()).filter(project => project.groupId === group.id);\n      const totalProjectTarget = groupProjects.reduce((sum, project) => sum + Number(project.targetAmount), 0);\n      const totalProjectCollected = groupProjects.reduce((sum, project) => sum + Number(project.collectedAmount), 0);\n      \n      const completionRate = totalProjectTarget > 0 ? \n        Math.round((totalProjectCollected / totalProjectTarget) * 100) : 0;\n      \n      const pendingPayments = 0; // Will be calculated based on project contributions\n\n      return {\n        ...group,\n        memberCount,\n        projectCount: groupProjects.length,\n        completionRate,\n        pendingPayments\n      };\n    });\n  }\n\n  async getAllUserGroups(userId: string): Promise<GroupWithRole[]> {\n    const groupMap = new Map<string, GroupWithRole>();\n    \n    // Get groups where user is admin\n    const adminGroups = Array.from(this.groups.values()).filter(group => group.adminId === userId);\n    \n    for (const group of adminGroups) {\n      const members = Array.from(this.groupMembers.values()).filter(m => m.groupId === group.id);\n      const groupProjects = Array.from(this.projects.values()).filter(p => p.groupId === group.id);\n      const totalTarget = groupProjects.reduce((sum, p) => sum + Number(p.targetAmount || 0), 0);\n      const totalCollected = groupProjects.reduce((sum, p) => sum + Number(p.collectedAmount || 0), 0);\n      const completionRate = totalTarget > 0 ? Math.round((totalCollected / totalTarget) * 100) : 0;\n      \n      // Count pending approvals for admin\n      const pendingApprovals = Array.from(this.contributions.values())\n        .filter(c => c.groupId === group.id && c.status === \"pending\").length;\n      \n      groupMap.set(group.id, {\n        ...group,\n        memberCount: members.length,\n        projectCount: groupProjects.length,\n        completionRate,\n        pendingPayments: 0,\n        role: 'admin',\n        pendingApprovals,\n      });\n    }\n    \n    // Get groups where user is member\n    const memberships = Array.from(this.groupMembers.values()).filter(m => m.userId === userId);\n    \n    for (const membership of memberships) {\n      const group = this.groups.get(membership.groupId);\n      if (!group) continue;\n      \n      const members = Array.from(this.groupMembers.values()).filter(m => m.groupId === group.id);\n      const groupProjects = Array.from(this.projects.values()).filter(p => p.groupId === group.id);\n      const totalTarget = groupProjects.reduce((sum, p) => sum + Number(p.targetAmount || 0), 0);\n      const totalCollected = groupProjects.reduce((sum, p) => sum + Number(p.collectedAmount || 0), 0);\n      const completionRate = totalTarget > 0 ? Math.round((totalCollected / totalTarget) * 100) : 0;\n      \n      // Count my pending payments in this group\n      const myPendingPayments = Array.from(this.contributions.values())\n        .filter(c => c.groupId === group.id && c.userId === userId && c.status === \"pending\").length;\n      \n      const existing = groupMap.get(group.id);\n      if (existing) {\n        // User is both admin and member\n        existing.role = 'both';\n        existing.myPendingPayments = myPendingPayments;\n      } else {\n        groupMap.set(group.id, {\n          ...group,\n          memberCount: members.length,\n          projectCount: groupProjects.length,\n          completionRate,\n          pendingPayments: 0,\n          role: 'member',\n          myPendingPayments,\n        });\n      }\n    }\n    \n    return Array.from(groupMap.values());\n  }\n\n  async createGroup(insertGroup: InsertGroup, adminId: string): Promise<Group> {\n    const id = randomUUID();\n    \n    // Create user-friendly registration code from group name\n    const baseCode = insertGroup.name\n      .toLowerCase()\n      .replace(/[^a-z0-9\\s]/g, '') // Remove special characters\n      .replace(/\\s+/g, '') // Remove spaces\n      .substring(0, 15); // Limit length\n    \n    // Add year to make it unique and memorable\n    const currentYear = new Date().getFullYear();\n    const registrationLink = `${baseCode}${currentYear}`;\n    \n    // Create custom URL slug from group name (keep existing logic)\n    const groupSlug = baseCode;\n\n    // Auto-generate WhatsApp sharing link with new format\n    let whatsappLink = insertGroup.whatsappLink;\n    if (!whatsappLink) {\n      const joinLink = `kontrib.app/join/${groupSlug}`;\n      const message = `${joinLink}\\n\\nYou have been invited to join ${insertGroup.name} on Kontrib!\\n\\nLogin to submit your contributions\\n\\nLet's keep it transparent\\n\\nKontrib.app`;\n      whatsappLink = `https://wa.me/?text=${encodeURIComponent(message)}`;\n    }\n    \n    const group: Group = {\n      ...insertGroup,\n      id,\n      description: insertGroup.description || null,\n      registrationLink,\n      customSlug: groupSlug,\n      status: \"active\",\n      adminId,\n      createdAt: new Date(),\n      whatsappLink,\n    };\n    this.groups.set(id, group);\n    \n    // Automatically add admin as first group member\n    await this.addGroupMember({\n      groupId: id,\n      userId: adminId,\n    });\n    \n    return group;\n  }\n\n  async updateGroup(id: string, updates: Partial<Group>): Promise<Group | undefined> {\n    const group = this.groups.get(id);\n    if (!group) return undefined;\n    \n    const updatedGroup = { ...group, ...updates };\n    this.groups.set(id, updatedGroup);\n    return updatedGroup;\n  }\n\n  async getGroupMembers(groupId: string): Promise<(GroupMember & { user: User })[]> {\n    const members = Array.from(this.groupMembers.values()).filter(member => member.groupId === groupId);\n    return members.map(member => {\n      const user = this.users.get(member.userId)!;\n      return { ...member, user };\n    });\n  }\n\n  async getUserGroups(userId: string): Promise<(GroupMember & { group: GroupWithStats })[]> {\n    const memberships = Array.from(this.groupMembers.values()).filter(member => member.userId === userId);\n    return memberships.map(membership => {\n      const group = this.groups.get(membership.groupId)!;\n      \n      // Calculate stats for the group\n      const members = Array.from(this.groupMembers.values()).filter(member => member.groupId === group.id);\n      const memberCount = members.length;\n      \n      const groupProjects = Array.from(this.projects.values()).filter(project => project.groupId === group.id);\n      const projectCount = groupProjects.length;\n      \n      const totalProjectTarget = groupProjects.reduce((sum, project) => sum + Number(project.targetAmount), 0);\n      const totalProjectCollected = groupProjects.reduce((sum, project) => sum + Number(project.collectedAmount), 0);\n      \n      const completionRate = totalProjectTarget > 0 ? \n        Math.round((totalProjectCollected / totalProjectTarget) * 100) : 0;\n      \n      const pendingPayments = Array.from(this.contributions.values())\n        .filter(contrib => contrib.groupId === group.id && contrib.status === \"pending\").length;\n\n      const groupWithStats: GroupWithStats = {\n        ...group,\n        memberCount,\n        projectCount,\n        completionRate,\n        pendingPayments\n      };\n      \n      return { ...membership, group: groupWithStats };\n    });\n  }\n\n  async addGroupMember(insertMember: InsertGroupMember): Promise<GroupMember> {\n    const id = randomUUID();\n    const member: GroupMember = {\n      ...insertMember,\n      id,\n      contributedAmount: \"0\",\n      status: \"active\",\n      joinedAt: new Date(),\n    };\n    this.groupMembers.set(id, member);\n    return member;\n  }\n\n  async getGroupMember(groupId: string, userId: string): Promise<GroupMember | undefined> {\n    return Array.from(this.groupMembers.values())\n      .find(member => member.groupId === groupId && member.userId === userId);\n  }\n\n  async removeGroupMember(memberId: string): Promise<boolean> {\n    if (this.groupMembers.has(memberId)) {\n      this.groupMembers.delete(memberId);\n      return true;\n    }\n    return false;\n  }\n\n  // Project methods\n  async getProjectsByGroup(groupId: string): Promise<ProjectWithStats[]> {\n    const projects = Array.from(this.projects.values())\n      .filter(project => project.groupId === groupId);\n    \n    return projects.map(project => {\n      const contributions = Array.from(this.contributions.values())\n        .filter(c => c.projectId === project.id);\n      \n      const contributionCount = contributions.length;\n      const completionRate = Number(project.targetAmount) > 0 \n        ? Math.round((Number(project.collectedAmount) / Number(project.targetAmount)) * 100)\n        : 0;\n      \n      return {\n        ...project,\n        contributionCount,\n        completionRate,\n      };\n    });\n  }\n\n  async getProject(id: string): Promise<Project | undefined> {\n    return this.projects.get(id);\n  }\n\n  async getProjectByCustomSlug(customSlug: string): Promise<Project | undefined> {\n    return Array.from(this.projects.values()).find(project => project.customSlug === customSlug);\n  }\n\n  async createProject(insertProject: InsertProject): Promise<Project> {\n    const id = randomUUID();\n    \n    // Get the group to create project URL slug\n    const group = this.groups.get(insertProject.groupId);\n    const groupSlug = group?.customSlug || \"group\";\n    \n    // Generate clean URL slug from project name\n    const projectSlug = insertProject.name\n      .toLowerCase()\n      .replace(/[^a-z0-9\\s-]/g, '') // Remove special characters except spaces and hyphens\n      .replace(/\\s+/g, '') // Remove all spaces\n      .slice(0, 50); // Limit length\n    \n    const customSlug = `${groupSlug}/${projectSlug}`;\n\n    const project: Project = {\n      ...insertProject,\n      id,\n      collectedAmount: \"0\",\n      customSlug,\n      createdAt: new Date(),\n      description: insertProject.description || null,\n      deadline: insertProject.deadline ? \n        (typeof insertProject.deadline === 'string' ? new Date(insertProject.deadline) : insertProject.deadline) \n        : null,\n      status: insertProject.status || \"active\",\n      // Ensure all account fields are null if not provided\n      accountName: insertProject.accountName || null,\n      accountNumber: insertProject.accountNumber || null,\n      bankName: insertProject.bankName || null,\n      routingNumber: insertProject.routingNumber || null,\n      swiftCode: insertProject.swiftCode || null,\n      zelleEmail: insertProject.zelleEmail || null,\n      zellePhone: insertProject.zellePhone || null,\n      cashappHandle: insertProject.cashappHandle || null,\n      venmoHandle: insertProject.venmoHandle || null,\n      paypalEmail: insertProject.paypalEmail || null,\n      paymentInstructions: insertProject.paymentInstructions || null,\n      allowedPaymentTypes: insertProject.allowedPaymentTypes || null,\n    };\n\n    this.projects.set(id, project);\n    return project;\n  }\n\n  async updateProject(id: string, updates: Partial<Project>): Promise<Project | undefined> {\n    const project = this.projects.get(id);\n    if (!project) return undefined;\n    \n    // Handle deadline conversion if it's a string\n    if (updates.deadline && typeof updates.deadline === 'string') {\n      updates.deadline = new Date(updates.deadline);\n    }\n    \n    const updatedProject = { ...project, ...updates };\n    this.projects.set(id, updatedProject);\n    return updatedProject;\n  }\n\n  // Accountability Partner methods\n  async getGroupAccountabilityPartners(groupId: string): Promise<AccountabilityPartnerWithDetails[]> {\n    const partners = Array.from(this.accountabilityPartners.values())\n      .filter(partner => partner.groupId === groupId);\n    \n    return partners.map(partner => {\n      const user = this.users.get(partner.userId);\n      if (!user) {\n        console.error(`User not found for accountability partner: ${partner.userId}`);\n        return {\n          ...partner,\n          userName: \"Unknown User\",\n          userFullName: \"Unknown User\",\n        };\n      }\n      return {\n        ...partner,\n        userName: user.username,\n        userFullName: user.fullName,\n      };\n    });\n  }\n\n  async addAccountabilityPartner(insertPartner: InsertAccountabilityPartner): Promise<AccountabilityPartner> {\n    const id = randomUUID();\n    const partner: AccountabilityPartner = {\n      ...insertPartner,\n      id,\n      assignedAt: new Date(),\n    };\n\n    this.accountabilityPartners.set(id, partner);\n    return partner;\n  }\n\n  async removeAccountabilityPartner(groupId: string, userId: string): Promise<boolean> {\n    const partner = Array.from(this.accountabilityPartners.values())\n      .find(p => p.groupId === groupId && p.userId === userId);\n    \n    if (partner) {\n      this.accountabilityPartners.delete(partner.id);\n      return true;\n    }\n    return false;\n  }\n\n  async getGroupContributions(groupId: string): Promise<ContributionWithDetails[]> {\n    const contributions = Array.from(this.contributions.values())\n      .filter(contrib => contrib.groupId === groupId)\n      .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n    \n    return contributions.map(contrib => {\n      const user = this.users.get(contrib.userId)!;\n      const group = this.groups.get(contrib.groupId)!;\n      return {\n        ...contrib,\n        userName: user.fullName,\n        groupName: group.name\n      };\n    });\n  }\n\n  async getProjectContributions(projectId: string): Promise<ContributionWithDetails[]> {\n    const contributions = Array.from(this.contributions.values())\n      .filter(contrib => contrib.projectId === projectId)\n      .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n    \n    return contributions.map(contrib => {\n      const user = this.users.get(contrib.userId)!;\n      const group = this.groups.get(contrib.groupId)!;\n      const project = this.projects.get(contrib.projectId!)!;\n      return {\n        ...contrib,\n        userName: user.fullName,\n        groupName: group.name,\n        projectName: project.name\n      };\n    });\n  }\n\n  async getUserContributions(userId: string): Promise<ContributionWithDetails[]> {\n    const contributions = Array.from(this.contributions.values())\n      .filter(contrib => contrib.userId === userId)\n      .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n    \n    return contributions.map(contrib => {\n      const user = this.users.get(contrib.userId)!;\n      const group = this.groups.get(contrib.groupId)!;\n      const project = contrib.projectId ? this.projects.get(contrib.projectId) : null;\n      return {\n        ...contrib,\n        userName: user.fullName,\n        groupName: group.name,\n        projectName: project?.name\n      };\n    });\n  }\n\n  async getAdminContributions(adminId: string): Promise<ContributionWithDetails[]> {\n    // Get all groups managed by this admin\n    const adminGroups = Array.from(this.groups.values()).filter(group => group.adminId === adminId);\n    const groupIds = adminGroups.map(group => group.id);\n    \n    // Get all contributions for these groups\n    const contributions = Array.from(this.contributions.values())\n      .filter(contrib => groupIds.includes(contrib.groupId))\n      .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n    \n    return contributions.map(contrib => {\n      const user = this.users.get(contrib.userId)!;\n      const group = this.groups.get(contrib.groupId)!;\n      const project = contrib.projectId ? this.projects.get(contrib.projectId) : null;\n      return {\n        ...contrib,\n        userName: user.fullName,\n        groupName: group.name,\n        projectName: project?.name\n      };\n    });\n  }\n\n  async createContribution(insertContribution: InsertContribution): Promise<Contribution> {\n    const id = randomUUID();\n    const contribution: Contribution = {\n      ...insertContribution,\n      id,\n      status: \"pending\", // All contributions start as pending until admin confirms\n      createdAt: new Date(),\n      description: insertContribution.description || null,\n      transactionRef: insertContribution.transactionRef || null,\n      proofOfPayment: insertContribution.proofOfPayment || null,\n      projectId: insertContribution.projectId || null,\n      paymentNotes: insertContribution.paymentNotes || null,\n    };\n    this.contributions.set(id, contribution);\n\n    // Send notifications to admin and accountability partners\n    await this.createPaymentNotifications(contribution);\n\n    // Don't update amounts yet - wait for admin confirmation\n    return contribution;\n  }\n\n  async confirmContribution(contributionId: string): Promise<Contribution | undefined> {\n    const contribution = this.contributions.get(contributionId);\n    if (!contribution) return undefined;\n\n    // Update status to confirmed\n    contribution.status = \"confirmed\";\n    \n    // Update project collected amount if contribution is for a specific project\n    if (contribution.projectId) {\n      const project = this.projects.get(contribution.projectId);\n      if (project) {\n        const newCollectedAmount = (Number(project.collectedAmount) + Number(contribution.amount)).toString();\n        await this.updateProject(project.id, { collectedAmount: newCollectedAmount });\n      }\n    }\n\n    // Update member contributed amount\n    const member = await this.getGroupMember(contribution.groupId, contribution.userId);\n    if (member) {\n      const newContributedAmount = (Number(member.contributedAmount) + Number(contribution.amount)).toString();\n      this.groupMembers.set(member.id, { ...member, contributedAmount: newContributedAmount });\n    }\n\n    // Send confirmation notification to the contributor\n    await this.createConfirmationNotifications(contribution);\n\n    return contribution;\n  }\n\n  // Helper method to create confirmation notifications\n  private async createConfirmationNotifications(contribution: Contribution): Promise<void> {\n    const user = this.users.get(contribution.userId);\n    const group = this.groups.get(contribution.groupId);\n    const project = contribution.projectId ? this.projects.get(contribution.projectId) : null;\n    \n    if (!user || !group) {\n      console.error(\"User or group not found for confirmation notification\");\n      return;\n    }\n    \n    const contributionAmount = new Intl.NumberFormat('en-NG', {\n      style: 'currency',\n      currency: 'NGN'\n    }).format(Number(contribution.amount));\n\n    const entityName = project ? project.name : group.name;\n\n    // Notify the contributor that their payment was confirmed\n    await this.createNotification({\n      userId: contribution.userId,\n      type: \"payment_confirmed\",\n      title: \"Payment Confirmed!\",\n      message: `Your payment of ${contributionAmount} for ${entityName} has been confirmed and added to the total.`,\n      contributionId: contribution.id,\n      projectId: contribution.projectId,\n    });\n  }\n\n  async updateContribution(id: string, updates: Partial<Contribution>): Promise<Contribution | undefined> {\n    const contribution = this.contributions.get(id);\n    if (!contribution) return undefined;\n    \n    const updatedContribution = { ...contribution, ...updates };\n    this.contributions.set(id, updatedContribution);\n    return updatedContribution;\n  }\n\n  async getUserStats(userId: string): Promise<MemberWithContributions> {\n    const user = this.users.get(userId)!;\n    const userContributions = Array.from(this.contributions.values())\n      .filter(contrib => contrib.userId === userId);\n    \n    const totalContributions = userContributions\n      .reduce((sum, contrib) => sum + Number(contrib.amount), 0)\n      .toString();\n    \n    const groupCount = Array.from(this.groupMembers.values())\n      .filter(member => member.userId === userId && member.status === \"active\").length;\n    \n    return {\n      ...user,\n      totalContributions,\n      groupCount,\n      status: \"active\"\n    };\n  }\n\n  async getAdminStats(adminId: string): Promise<{\n    totalCollections: string;\n    activeMembers: number;\n    pendingPayments: number;\n    completionRate: number;\n  }> {\n    const adminGroups = Array.from(this.groups.values()).filter(group => group.adminId === adminId);\n    \n    // Calculate total collections from all projects in admin's groups\n    const allProjects = Array.from(this.projects.values()).filter(project => \n      adminGroups.some(group => group.id === project.groupId)\n    );\n    const totalCollections = allProjects\n      .reduce((sum, project) => sum + Number(project.collectedAmount), 0)\n      .toString();\n    \n    const activeMembers = Array.from(this.groupMembers.values())\n      .filter(member => \n        adminGroups.some(group => group.id === member.groupId) && \n        member.status === \"active\"\n      ).length;\n    \n    let totalPendingPayments = 0;\n    let totalGroups = adminGroups.length;\n    let completedGroups = 0;\n    \n    adminGroups.forEach(group => {\n      // Count pending payments based on contribution status\n      const groupContributions = Array.from(this.contributions.values())\n        .filter(contrib => contrib.groupId === group.id && contrib.status === \"pending\");\n      totalPendingPayments += groupContributions.length;\n      \n      // Calculate completion based on projects\n      const groupProjects = Array.from(this.projects.values()).filter(project => project.groupId === group.id);\n      const totalTarget = groupProjects.reduce((sum, project) => sum + Number(project.targetAmount), 0);\n      const totalCollected = groupProjects.reduce((sum, project) => sum + Number(project.collectedAmount), 0);\n      \n      if (totalTarget > 0 && totalCollected >= totalTarget) {\n        completedGroups++;\n      }\n    });\n    \n    const completionRate = totalGroups > 0 ? Math.round((completedGroups / totalGroups) * 100) : 0;\n    \n    return {\n      totalCollections,\n      activeMembers,\n      pendingPayments: totalPendingPayments,\n      completionRate\n    };\n  }\n\n  // Notification methods\n  async getUserNotifications(userId: string): Promise<Notification[]> {\n    return Array.from(this.notifications.values())\n      .filter(notification => notification.userId === userId)\n      .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n  }\n\n  async createNotification(insertNotification: InsertNotification): Promise<Notification> {\n    const id = randomUUID();\n    const notification: Notification = {\n      ...insertNotification,\n      id,\n      read: false,\n      createdAt: new Date(),\n      contributionId: insertNotification.contributionId || null,\n      projectId: insertNotification.projectId || null,\n    };\n    this.notifications.set(id, notification);\n    return notification;\n  }\n\n  async markNotificationRead(notificationId: string): Promise<void> {\n    const notification = this.notifications.get(notificationId);\n    if (notification) {\n      notification.read = true;\n      this.notifications.set(notificationId, notification);\n    }\n  }\n\n  // Helper method to create payment notifications\n  private async createPaymentNotifications(contribution: Contribution): Promise<void> {\n    const user = this.users.get(contribution.userId);\n    const group = this.groups.get(contribution.groupId);\n    const project = contribution.projectId ? this.projects.get(contribution.projectId) : null;\n    \n    if (!user || !group) {\n      console.error(\"User or group not found for notification\");\n      return;\n    }\n    \n    const contributionAmount = new Intl.NumberFormat('en-NG', {\n      style: 'currency',\n      currency: 'NGN'\n    }).format(Number(contribution.amount));\n\n    const entityName = project ? project.name : group.name;\n\n    // Notify group admin\n    await this.createNotification({\n      userId: group.adminId,\n      type: \"payment_submitted\",\n      title: \"New Payment Submitted\",\n      message: `${user.fullName} submitted a payment of ${contributionAmount} for ${entityName}. Please review and confirm.`,\n      contributionId: contribution.id,\n      projectId: contribution.projectId,\n    });\n\n    // Notify accountability partners\n    const partners = await this.getGroupAccountabilityPartners(contribution.groupId);\n    for (const partner of partners) {\n      await this.createNotification({\n        userId: partner.userId,\n        type: \"payment_submitted\",\n        title: \"Payment Submitted for Review\",\n        message: `${user.fullName} submitted a payment of ${contributionAmount} for ${entityName}. You can review the payment details.`,\n        contributionId: contribution.id,\n        projectId: contribution.projectId,\n      });\n    }\n  }\n\n  // Helper method to create rejection notifications\n  async createRejectionNotification(contribution: Contribution, reason?: string): Promise<void> {\n    const user = this.users.get(contribution.userId);\n    const group = this.groups.get(contribution.groupId);\n    const project = contribution.projectId ? this.projects.get(contribution.projectId) : null;\n    \n    if (!user || !group) {\n      console.error(\"User or group not found for rejection notification\");\n      return;\n    }\n    \n    const contributionAmount = new Intl.NumberFormat('en-NG', {\n      style: 'currency',\n      currency: 'NGN'\n    }).format(Number(contribution.amount));\n\n    const entityName = project ? project.name : group.name;\n    const reasonText = reason ? ` Reason: ${reason}` : '';\n\n    // Notify the contributor that their payment was rejected\n    await this.createNotification({\n      userId: contribution.userId,\n      type: \"payment_rejected\",\n      title: \"Payment Rejected\",\n      message: `Your payment of ${contributionAmount} for ${entityName} was rejected.${reasonText} Please contact the admin for clarification.`,\n      contributionId: contribution.id,\n      projectId: contribution.projectId,\n    });\n  }\n\n  // OTP Verification methods\n  async sendOtp(phoneNumber: string): Promise<{ code: string; expiresAt: string }> {\n    // Generate a 6-digit OTP\n    const code = Math.floor(100000 + Math.random() * 900000).toString();\n    \n    // Set expiration to 10 minutes from now\n    const expiresAt = new Date(Date.now() + 10 * 60 * 1000);\n    \n    // Create OTP verification record\n    await this.createOtpVerification({\n      phoneNumber,\n      otp: code,\n      expiresAt\n    });\n    \n    // Import WhatsApp service and send OTP\n    try {\n      const { whatsappService } = await import(\"./whatsapp-service\");\n      const sent = await whatsappService.sendOTP(phoneNumber, code);\n      \n      if (!sent) {\n        console.error(\"Failed to send WhatsApp OTP, falling back to console log\");\n        console.log(`OTP for ${phoneNumber}: ${code}`);\n      }\n    } catch (error) {\n      console.error(\"WhatsApp service error, falling back to console log:\", error);\n      console.log(`OTP for ${phoneNumber}: ${code}`);\n    }\n    \n    return {\n      code,\n      expiresAt: expiresAt.toISOString()\n    };\n  }\n\n  async createOtpVerification(insertOtp: InsertOtpVerification): Promise<OtpVerification> {\n    const id = randomUUID();\n    const otp: OtpVerification = {\n      ...insertOtp,\n      id,\n      verified: false,\n      attempts: 0,\n      createdAt: new Date()\n    };\n    \n    // Clean up any existing OTPs for this phone number\n    this.otpVerifications.forEach((existingOtp, key) => {\n      if (existingOtp.phoneNumber === otp.phoneNumber) {\n        this.otpVerifications.delete(key);\n      }\n    });\n    \n    this.otpVerifications.set(id, otp);\n    return otp;\n  }\n\n  async getActiveOtpVerification(phoneNumber: string): Promise<OtpVerification | undefined> {\n    const now = new Date();\n    return Array.from(this.otpVerifications.values()).find(\n      otp => otp.phoneNumber === phoneNumber && \n             !otp.verified && \n             otp.expiresAt > now &&\n             otp.attempts < 3\n    );\n  }\n\n  async verifyOtp(phoneNumber: string, otpCode: string): Promise<boolean> {\n    const verification = await this.getActiveOtpVerification(phoneNumber);\n    if (!verification) return false;\n\n    verification.attempts += 1;\n    \n    if (verification.otp === otpCode) {\n      verification.verified = true;\n      this.otpVerifications.set(verification.id, verification);\n      return true;\n    }\n    \n    this.otpVerifications.set(verification.id, verification);\n    return false;\n  }\n\n  async cleanupExpiredOtps(): Promise<void> {\n    const now = new Date();\n    const expiredKeys: string[] = [];\n    \n    this.otpVerifications.forEach((otp, key) => {\n      if (otp.expiresAt < now) {\n        expiredKeys.push(key);\n      }\n    });\n    \n    expiredKeys.forEach(key => this.otpVerifications.delete(key));\n  }\n}\n\n// Database Storage implementation using Drizzle ORM\nimport { db } from \"./db\";\nimport { users as usersTable, groups as groupsTable, groupMembers as groupMembersTable, projects as projectsTable, accountabilityPartners as accountabilityPartnersTable, contributions as contributionsTable, notifications as notificationsTable, otpVerifications as otpVerificationsTable } from \"@shared/schema\";\nimport { eq, and, gt, lt, sql as drizzleSql, desc, inArray } from \"drizzle-orm\";\n\nexport class DbStorage implements IStorage {\n  async getUser(id: string): Promise<User | undefined> {\n    const result = await db.select().from(usersTable).where(eq(usersTable.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const result = await db.select().from(usersTable).where(eq(usersTable.username, username)).limit(1);\n    return result[0];\n  }\n\n  async getUserByPhoneNumber(phoneNumber: string): Promise<User | undefined> {\n    const result = await db.select().from(usersTable).where(eq(usersTable.phoneNumber, phoneNumber)).limit(1);\n    return result[0];\n  }\n\n  async findOrCreateUserByPhone(phoneNumber: string): Promise<User> {\n    const existingUser = await this.getUserByPhoneNumber(phoneNumber);\n    if (existingUser) {\n      return existingUser;\n    }\n    \n    const result = await db.insert(usersTable).values({\n      phoneNumber,\n      role: \"member\",\n    }).returning();\n    return result[0];\n  }\n\n  async updateUserProfile(userId: string, updates: { fullName?: string; role?: string }): Promise<User | undefined> {\n    const updateData: Partial<User> = {};\n    if (updates.fullName !== undefined) {\n      updateData.fullName = updates.fullName;\n      updateData.profileCompletedAt = new Date();\n    }\n    if (updates.role !== undefined) {\n      // Validate role at storage layer as extra safety\n      const validRoles = ['admin', 'member'];\n      if (validRoles.includes(updates.role)) {\n        updateData.role = updates.role;\n      }\n    }\n    \n    const result = await db\n      .update(usersTable)\n      .set(updateData)\n      .where(eq(usersTable.id, userId))\n      .returning();\n    return result[0];\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const result = await db.insert(usersTable).values(insertUser).returning();\n    return result[0];\n  }\n\n  async getGroup(id: string): Promise<Group | undefined> {\n    const result = await db.select().from(groupsTable).where(eq(groupsTable.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getGroupByRegistrationLink(link: string): Promise<Group | undefined> {\n    const result = await db.select().from(groupsTable).where(eq(groupsTable.registrationLink, link)).limit(1);\n    return result[0];\n  }\n\n  async getGroupByCustomSlug(slug: string): Promise<Group | undefined> {\n    const result = await db.select().from(groupsTable).where(eq(groupsTable.customSlug, slug)).limit(1);\n    return result[0];\n  }\n\n  async getGroupsByAdmin(adminId: string): Promise<GroupWithStats[]> {\n    const adminGroups = await db.select().from(groupsTable).where(eq(groupsTable.adminId, adminId));\n    \n    const groupsWithStats = await Promise.all(adminGroups.map(async (group) => {\n      const memberCountResult = await db\n        .select({ count: drizzleSql<number>`count(*)::int` })\n        .from(groupMembersTable)\n        .where(eq(groupMembersTable.groupId, group.id));\n      const memberCount = memberCountResult[0]?.count || 0;\n\n      const groupProjects = await db.select().from(projectsTable).where(eq(projectsTable.groupId, group.id));\n      \n      const totalProjectTarget = groupProjects.reduce((sum, project) => sum + Number(project.targetAmount), 0);\n      const totalProjectCollected = groupProjects.reduce((sum, project) => sum + Number(project.collectedAmount), 0);\n      \n      const completionRate = totalProjectTarget > 0 ? Math.round((totalProjectCollected / totalProjectTarget) * 100) : 0;\n      const pendingPayments = 0;\n\n      return {\n        ...group,\n        memberCount,\n        projectCount: groupProjects.length,\n        completionRate,\n        pendingPayments\n      };\n    }));\n\n    return groupsWithStats;\n  }\n\n  async getAllUserGroups(userId: string): Promise<GroupWithRole[]> {\n    const groupMap = new Map<string, GroupWithRole>();\n    \n    // Get groups where user is admin\n    const adminGroups = await db.select().from(groupsTable).where(eq(groupsTable.adminId, userId));\n    \n    for (const group of adminGroups) {\n      const memberCountResult = await db\n        .select({ count: drizzleSql<number>`count(*)::int` })\n        .from(groupMembersTable)\n        .where(eq(groupMembersTable.groupId, group.id));\n      const memberCount = memberCountResult[0]?.count || 0;\n      \n      const groupProjects = await db.select().from(projectsTable).where(eq(projectsTable.groupId, group.id));\n      const totalTarget = groupProjects.reduce((sum, p) => sum + Number(p.targetAmount || 0), 0);\n      const totalCollected = groupProjects.reduce((sum, p) => sum + Number(p.collectedAmount || 0), 0);\n      const completionRate = totalTarget > 0 ? Math.round((totalCollected / totalTarget) * 100) : 0;\n      \n      // Count pending approvals for admin\n      const pendingApprovalsResult = await db\n        .select({ count: drizzleSql<number>`count(*)::int` })\n        .from(contributionsTable)\n        .where(and(eq(contributionsTable.groupId, group.id), eq(contributionsTable.status, \"pending\")));\n      const pendingApprovals = pendingApprovalsResult[0]?.count || 0;\n      \n      groupMap.set(group.id, {\n        ...group,\n        memberCount,\n        projectCount: groupProjects.length,\n        completionRate,\n        pendingPayments: 0,\n        role: 'admin',\n        pendingApprovals,\n      });\n    }\n    \n    // Get groups where user is member\n    const memberships = await db\n      .select()\n      .from(groupMembersTable)\n      .leftJoin(groupsTable, eq(groupMembersTable.groupId, groupsTable.id))\n      .where(eq(groupMembersTable.userId, userId));\n    \n    for (const row of memberships) {\n      const group = row.groups;\n      if (!group) continue;\n      \n      const memberCountResult = await db\n        .select({ count: drizzleSql<number>`count(*)::int` })\n        .from(groupMembersTable)\n        .where(eq(groupMembersTable.groupId, group.id));\n      const memberCount = memberCountResult[0]?.count || 0;\n      \n      const groupProjects = await db.select().from(projectsTable).where(eq(projectsTable.groupId, group.id));\n      const totalTarget = groupProjects.reduce((sum, p) => sum + Number(p.targetAmount || 0), 0);\n      const totalCollected = groupProjects.reduce((sum, p) => sum + Number(p.collectedAmount || 0), 0);\n      const completionRate = totalTarget > 0 ? Math.round((totalCollected / totalTarget) * 100) : 0;\n      \n      // Count my pending payments in this group\n      const myPendingResult = await db\n        .select({ count: drizzleSql<number>`count(*)::int` })\n        .from(contributionsTable)\n        .where(and(\n          eq(contributionsTable.groupId, group.id),\n          eq(contributionsTable.userId, userId),\n          eq(contributionsTable.status, \"pending\")\n        ));\n      const myPendingPayments = myPendingResult[0]?.count || 0;\n      \n      const existing = groupMap.get(group.id);\n      if (existing) {\n        // User is both admin and member\n        existing.role = 'both';\n        existing.myPendingPayments = myPendingPayments;\n      } else {\n        groupMap.set(group.id, {\n          ...group,\n          memberCount,\n          projectCount: groupProjects.length,\n          completionRate,\n          pendingPayments: 0,\n          role: 'member',\n          myPendingPayments,\n        });\n      }\n    }\n    \n    return Array.from(groupMap.values());\n  }\n\n  async createGroup(insertGroup: InsertGroup, adminId: string): Promise<Group> {\n    const baseCode = insertGroup.name\n      .toLowerCase()\n      .replace(/[^a-z0-9\\s]/g, '')\n      .replace(/\\s+/g, '')\n      .substring(0, 15);\n    \n    const currentYear = new Date().getFullYear();\n    const registrationLink = `${baseCode}${currentYear}`;\n    const groupSlug = baseCode;\n\n    let whatsappLink = insertGroup.whatsappLink;\n    if (!whatsappLink) {\n      const joinLink = `kontrib.app/join/${groupSlug}`;\n      const message = `${joinLink}\\n\\nYou have been invited to join ${insertGroup.name} on Kontrib!\\n\\nLogin to submit your contributions\\n\\nLet's keep it transparent\\n\\nKontrib.app`;\n      whatsappLink = `https://wa.me/?text=${encodeURIComponent(message)}`;\n    }\n\n    const result = await db.insert(groupsTable).values({\n      ...insertGroup,\n      registrationLink,\n      customSlug: groupSlug,\n      adminId,\n      whatsappLink,\n    }).returning();\n    \n    const group = result[0];\n    \n    // Automatically add admin as first group member\n    await this.addGroupMember({\n      groupId: group.id,\n      userId: adminId,\n    });\n    \n    return group;\n  }\n\n  async updateGroup(id: string, updates: Partial<Group>): Promise<Group | undefined> {\n    const result = await db.update(groupsTable).set(updates).where(eq(groupsTable.id, id)).returning();\n    return result[0];\n  }\n\n  async getGroupMembers(groupId: string): Promise<(GroupMember & { user: User })[]> {\n    const result = await db\n      .select()\n      .from(groupMembersTable)\n      .leftJoin(usersTable, eq(groupMembersTable.userId, usersTable.id))\n      .where(eq(groupMembersTable.groupId, groupId));\n\n    return result.map(row => ({\n      ...row.group_members,\n      user: row.users!\n    }));\n  }\n\n  async getUserGroups(userId: string): Promise<(GroupMember & { group: Group })[]> {\n    const result = await db\n      .select()\n      .from(groupMembersTable)\n      .leftJoin(groupsTable, eq(groupMembersTable.groupId, groupsTable.id))\n      .where(eq(groupMembersTable.userId, userId));\n\n    return result\n      .filter(row => row.groups !== null)\n      .map(row => ({\n        ...row.group_members,\n        group: row.groups!\n      }));\n  }\n\n  async addGroupMember(member: InsertGroupMember): Promise<GroupMember> {\n    const result = await db.insert(groupMembersTable).values(member).returning();\n    return result[0];\n  }\n\n  async getGroupMember(groupId: string, userId: string): Promise<GroupMember | undefined> {\n    const result = await db\n      .select()\n      .from(groupMembersTable)\n      .where(and(eq(groupMembersTable.groupId, groupId), eq(groupMembersTable.userId, userId)))\n      .limit(1);\n    return result[0];\n  }\n\n  async removeGroupMember(memberId: string): Promise<boolean> {\n    const result = await db\n      .delete(groupMembersTable)\n      .where(eq(groupMembersTable.id, memberId))\n      .returning();\n    return result.length > 0;\n  }\n\n  async getProjectsByGroup(groupId: string): Promise<ProjectWithStats[]> {\n    const groupProjects = await db.select().from(projectsTable).where(eq(projectsTable.groupId, groupId));\n    \n    const projectsWithStats = await Promise.all(groupProjects.map(async (project) => {\n      const contributionsResult = await db\n        .select({ count: drizzleSql<number>`count(*)::int` })\n        .from(contributionsTable)\n        .where(eq(contributionsTable.projectId, project.id));\n      const contributionCount = contributionsResult[0]?.count || 0;\n\n      const completionRate = Number(project.targetAmount) > 0\n        ? Math.round((Number(project.collectedAmount) / Number(project.targetAmount)) * 100)\n        : 0;\n\n      return {\n        ...project,\n        contributionCount,\n        completionRate\n      };\n    }));\n\n    return projectsWithStats;\n  }\n\n  async getProject(id: string): Promise<Project | undefined> {\n    const result = await db.select().from(projectsTable).where(eq(projectsTable.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getProjectByCustomSlug(customSlug: string): Promise<Project | undefined> {\n    const result = await db.select().from(projectsTable).where(eq(projectsTable.customSlug, customSlug)).limit(1);\n    return result[0];\n  }\n\n  async createProject(project: InsertProject): Promise<Project> {\n    const baseSlug = project.name\n      .toLowerCase()\n      .replace(/[^a-z0-9\\s]/g, '')\n      .replace(/\\s+/g, '')\n      .substring(0, 15);\n\n    const { deadline, ...restProject } = project;\n    const result = await db.insert(projectsTable).values({\n      ...restProject,\n      deadline: deadline ? (typeof deadline === 'string' ? new Date(deadline) : deadline) : null,\n      customSlug: baseSlug\n    }).returning();\n    return result[0];\n  }\n\n  async updateProject(id: string, updates: Partial<Project>): Promise<Project | undefined> {\n    const result = await db.update(projectsTable).set(updates).where(eq(projectsTable.id, id)).returning();\n    return result[0];\n  }\n\n  async getGroupAccountabilityPartners(groupId: string): Promise<AccountabilityPartnerWithDetails[]> {\n    const result = await db\n      .select()\n      .from(accountabilityPartnersTable)\n      .leftJoin(usersTable, eq(accountabilityPartnersTable.userId, usersTable.id))\n      .where(eq(accountabilityPartnersTable.groupId, groupId));\n\n    return result.map(row => ({\n      ...row.accountability_partners,\n      userName: row.users!.username,\n      userFullName: row.users!.fullName\n    }));\n  }\n\n  async addAccountabilityPartner(partner: InsertAccountabilityPartner): Promise<AccountabilityPartner> {\n    const result = await db.insert(accountabilityPartnersTable).values(partner).returning();\n    return result[0];\n  }\n\n  async removeAccountabilityPartner(groupId: string, userId: string): Promise<boolean> {\n    const result = await db\n      .delete(accountabilityPartnersTable)\n      .where(and(eq(accountabilityPartnersTable.groupId, groupId), eq(accountabilityPartnersTable.userId, userId)))\n      .returning();\n    return result.length > 0;\n  }\n\n  async getGroupContributions(groupId: string): Promise<ContributionWithDetails[]> {\n    const result = await db\n      .select()\n      .from(contributionsTable)\n      .leftJoin(usersTable, eq(contributionsTable.userId, usersTable.id))\n      .leftJoin(projectsTable, eq(contributionsTable.projectId, projectsTable.id))\n      .leftJoin(groupsTable, eq(contributionsTable.groupId, groupsTable.id))\n      .where(eq(contributionsTable.groupId, groupId))\n      .orderBy(desc(contributionsTable.createdAt));\n\n    return result.map(row => ({\n      ...row.contributions,\n      userName: row.users!.username,\n      groupName: row.groups!.name,\n      projectName: row.projects?.name\n    }));\n  }\n\n  async getProjectContributions(projectId: string): Promise<ContributionWithDetails[]> {\n    const result = await db\n      .select()\n      .from(contributionsTable)\n      .leftJoin(usersTable, eq(contributionsTable.userId, usersTable.id))\n      .leftJoin(projectsTable, eq(contributionsTable.projectId, projectsTable.id))\n      .leftJoin(groupsTable, eq(contributionsTable.groupId, groupsTable.id))\n      .where(eq(contributionsTable.projectId, projectId))\n      .orderBy(desc(contributionsTable.createdAt));\n\n    return result.map(row => ({\n      ...row.contributions,\n      userName: row.users!.username,\n      groupName: row.groups!.name,\n      projectName: row.projects?.name\n    }));\n  }\n\n  async createContribution(contribution: InsertContribution): Promise<Contribution> {\n    const result = await db.insert(contributionsTable).values(contribution).returning();\n    return result[0];\n  }\n\n  async confirmContribution(contributionId: string): Promise<Contribution | undefined> {\n    const contribution = await db\n      .select()\n      .from(contributionsTable)\n      .where(eq(contributionsTable.id, contributionId))\n      .limit(1);\n\n    if (!contribution[0]) return undefined;\n\n    const updatedContribution = await db\n      .update(contributionsTable)\n      .set({ status: 'confirmed' })\n      .where(eq(contributionsTable.id, contributionId))\n      .returning();\n\n    if (contribution[0].projectId) {\n      const project = await db\n        .select()\n        .from(projectsTable)\n        .where(eq(projectsTable.id, contribution[0].projectId))\n        .limit(1);\n\n      if (project[0]) {\n        const newCollected = Number(project[0].collectedAmount) + Number(contribution[0].amount);\n        await db\n          .update(projectsTable)\n          .set({ collectedAmount: newCollected.toString() })\n          .where(eq(projectsTable.id, contribution[0].projectId));\n      }\n    }\n\n    const member = await db\n      .select()\n      .from(groupMembersTable)\n      .where(and(\n        eq(groupMembersTable.groupId, contribution[0].groupId),\n        eq(groupMembersTable.userId, contribution[0].userId)\n      ))\n      .limit(1);\n\n    if (member[0]) {\n      const newAmount = Number(member[0].contributedAmount) + Number(contribution[0].amount);\n      await db\n        .update(groupMembersTable)\n        .set({ contributedAmount: newAmount.toString() })\n        .where(eq(groupMembersTable.id, member[0].id));\n    }\n\n    return updatedContribution[0];\n  }\n\n  async getUserContributions(userId: string): Promise<ContributionWithDetails[]> {\n    const result = await db\n      .select()\n      .from(contributionsTable)\n      .leftJoin(usersTable, eq(contributionsTable.userId, usersTable.id))\n      .leftJoin(projectsTable, eq(contributionsTable.projectId, projectsTable.id))\n      .leftJoin(groupsTable, eq(contributionsTable.groupId, groupsTable.id))\n      .where(eq(contributionsTable.userId, userId))\n      .orderBy(desc(contributionsTable.createdAt));\n\n    return result.map(row => ({\n      ...row.contributions,\n      userName: row.users!.username,\n      groupName: row.groups!.name,\n      projectName: row.projects?.name\n    }));\n  }\n\n  async getAdminContributions(adminId: string): Promise<ContributionWithDetails[]> {\n    const adminGroups = await db.select().from(groupsTable).where(eq(groupsTable.adminId, adminId));\n    const groupIds = adminGroups.map(g => g.id);\n\n    if (groupIds.length === 0) return [];\n\n    const result = await db\n      .select()\n      .from(contributionsTable)\n      .leftJoin(usersTable, eq(contributionsTable.userId, usersTable.id))\n      .leftJoin(projectsTable, eq(contributionsTable.projectId, projectsTable.id))\n      .leftJoin(groupsTable, eq(contributionsTable.groupId, groupsTable.id))\n      .where(inArray(contributionsTable.groupId, groupIds))\n      .orderBy(desc(contributionsTable.createdAt));\n\n    return result.map(row => ({\n      ...row.contributions,\n      userName: row.users!.username,\n      groupName: row.groups!.name,\n      projectName: row.projects?.name\n    }));\n  }\n\n  async updateContribution(id: string, updates: Partial<Contribution>): Promise<Contribution | undefined> {\n    const result = await db.update(contributionsTable).set(updates).where(eq(contributionsTable.id, id)).returning();\n    return result[0];\n  }\n\n  async getUserNotifications(userId: string): Promise<Notification[]> {\n    const result = await db\n      .select()\n      .from(notificationsTable)\n      .where(eq(notificationsTable.userId, userId))\n      .orderBy(desc(notificationsTable.createdAt));\n    return result;\n  }\n\n  async createNotification(notification: InsertNotification): Promise<Notification> {\n    const result = await db.insert(notificationsTable).values(notification).returning();\n    return result[0];\n  }\n\n  async createRejectionNotification(contribution: Contribution, reason?: string): Promise<void> {\n    const user = await this.getUser(contribution.userId);\n    const group = await this.getGroup(contribution.groupId);\n    const project = contribution.projectId ? await this.getProject(contribution.projectId) : null;\n    \n    if (!user || !group) {\n      console.error(\"User or group not found for rejection notification\");\n      return;\n    }\n    \n    const contributionAmount = new Intl.NumberFormat('en-NG', {\n      style: 'currency',\n      currency: 'NGN'\n    }).format(Number(contribution.amount));\n    \n    const entityName = project ? project.name : group.name;\n    \n    let message = `Your payment of ${contributionAmount} for ${entityName} was not approved.`;\n    if (reason) {\n      message += ` Reason: ${reason}`;\n    }\n    \n    await this.createNotification({\n      userId: contribution.userId,\n      type: \"payment_rejected\",\n      title: \"Payment Not Approved\",\n      message,\n      contributionId: contribution.id,\n      projectId: contribution.projectId\n    });\n  }\n\n  async markNotificationRead(notificationId: string): Promise<void> {\n    await db.update(notificationsTable).set({ read: true }).where(eq(notificationsTable.id, notificationId));\n  }\n\n  async getUserStats(userId: string): Promise<MemberWithContributions> {\n    const contributions = await this.getUserContributions(userId);\n    const totalContributions = contributions\n      .filter(c => c.status === 'confirmed')\n      .reduce((sum, c) => sum + Number(c.amount), 0);\n\n    const userGroups = await this.getUserGroups(userId);\n    const user = await this.getUser(userId);\n    if (!user) throw new Error('User not found');\n\n    return {\n      ...user,\n      totalContributions: totalContributions.toString(),\n      groupCount: userGroups.length,\n      status: 'active'\n    };\n  }\n\n  async getAdminStats(adminId: string): Promise<{\n    totalCollections: string;\n    activeMembers: number;\n    pendingPayments: number;\n    completionRate: number;\n  }> {\n    const adminGroups = await db.select().from(groupsTable).where(eq(groupsTable.adminId, adminId));\n    const groupIds = adminGroups.map(g => g.id);\n\n    if (groupIds.length === 0) {\n      return { totalCollections: '0', activeMembers: 0, pendingPayments: 0, completionRate: 0 };\n    }\n\n    const membersResult = await db\n      .select({ count: drizzleSql<number>`count(DISTINCT ${groupMembersTable.userId})::int` })\n      .from(groupMembersTable)\n      .where(inArray(groupMembersTable.groupId, groupIds));\n\n    const contributionsResult = await db\n      .select()\n      .from(contributionsTable)\n      .where(inArray(contributionsTable.groupId, groupIds));\n\n    const totalCollections = contributionsResult\n      .filter(c => c.status === 'confirmed')\n      .reduce((sum, c) => sum + Number(c.amount), 0);\n\n    const pendingPayments = contributionsResult.filter(c => c.status === 'pending').length;\n    const activeMembers = membersResult[0]?.count || 0;\n\n    return {\n      totalCollections: totalCollections.toString(),\n      activeMembers,\n      pendingPayments,\n      completionRate: 0\n    };\n  }\n\n  async sendOtp(phoneNumber: string): Promise<{ code: string; expiresAt: string }> {\n    const code = Math.floor(100000 + Math.random() * 900000).toString();\n    const expiresAt = new Date(Date.now() + 10 * 60 * 1000);\n\n    await this.createOtpVerification({\n      phoneNumber,\n      otp: code,\n      expiresAt\n    });\n\n    try {\n      const { whatsappService } = await import(\"./whatsapp-service\");\n      const sent = await whatsappService.sendOTP(phoneNumber, code);\n\n      if (!sent) {\n        console.error(\"Failed to send WhatsApp OTP, falling back to console log\");\n        console.log(`OTP for ${phoneNumber}: ${code}`);\n      }\n    } catch (error) {\n      console.error(\"WhatsApp service error, falling back to console log:\", error);\n      console.log(`OTP for ${phoneNumber}: ${code}`);\n    }\n\n    return {\n      code,\n      expiresAt: expiresAt.toISOString()\n    };\n  }\n\n  async createOtpVerification(insertOtp: InsertOtpVerification): Promise<OtpVerification> {\n    await db.delete(otpVerificationsTable).where(eq(otpVerificationsTable.phoneNumber, insertOtp.phoneNumber));\n    const result = await db.insert(otpVerificationsTable).values(insertOtp).returning();\n    return result[0];\n  }\n\n  async getActiveOtpVerification(phoneNumber: string): Promise<OtpVerification | undefined> {\n    const now = new Date();\n    const result = await db\n      .select()\n      .from(otpVerificationsTable)\n      .where(\n        and(\n          eq(otpVerificationsTable.phoneNumber, phoneNumber),\n          eq(otpVerificationsTable.verified, false),\n          gt(otpVerificationsTable.expiresAt, now),\n          lt(otpVerificationsTable.attempts, 3)\n        )\n      )\n      .limit(1);\n    return result[0];\n  }\n\n  async verifyOtp(phoneNumber: string, otpCode: string): Promise<boolean> {\n    const verification = await this.getActiveOtpVerification(phoneNumber);\n    if (!verification) return false;\n\n    await db\n      .update(otpVerificationsTable)\n      .set({ attempts: verification.attempts + 1 })\n      .where(eq(otpVerificationsTable.id, verification.id));\n\n    if (verification.otp === otpCode) {\n      await db\n        .update(otpVerificationsTable)\n        .set({ verified: true })\n        .where(eq(otpVerificationsTable.id, verification.id));\n      return true;\n    }\n\n    return false;\n  }\n\n  async cleanupExpiredOtps(): Promise<void> {\n    const now = new Date();\n    await db.delete(otpVerificationsTable).where(lt(otpVerificationsTable.expiresAt, now));\n  }\n}\n\nexport const storage = new DbStorage();\n","path":null,"size_bytes":60967,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"client/src/pages/dashboard.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Navigation } from \"@/components/navigation\";\nimport { \n  TrendingUp, \n  Users, \n  Target, \n  Calendar, \n  CreditCard, \n  CheckCircle,\n  Clock,\n  AlertCircle\n} from \"lucide-react\";\nimport { getCurrentUser, isAdmin } from \"@/lib/auth\";\nimport { formatNaira } from \"@/lib/currency\";\nimport { Link } from \"wouter\";\n\nexport default function Dashboard() {\n  const user = getCurrentUser();\n  const userIsAdmin = isAdmin();\n\n  // Fetch user-specific data for members or admin data for admins\n  const { data: userStats = {}, isLoading: statsLoading } = useQuery<any>({\n    queryKey: userIsAdmin ? [\"/api/stats\", \"admin\", user?.id] : [\"/api/stats\", \"user\", user?.id],\n    enabled: !!user,\n  });\n\n  const { data: userGroups = [], isLoading: groupsLoading } = useQuery<any[]>({\n    queryKey: userIsAdmin ? [\"/api/groups\", \"admin\", user?.id] : [\"/api/groups\", \"user\", user?.id],\n    enabled: !!user,\n  });\n\n  const { data: recentContributions = [], isLoading: contributionsLoading } = useQuery<any[]>({\n    queryKey: userIsAdmin ? [\"/api/contributions/admin\", user?.id] : [\"/api/contributions/user\", user?.id],\n    enabled: !!user,\n  });\n\n  if (statsLoading || groupsLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <Navigation />\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\n          <div className=\"animate-pulse space-y-6\">\n            <div className=\"h-32 bg-gray-200 rounded-xl\"></div>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n              {[...Array(3)].map((_, i) => (\n                <div key={i} className=\"h-24 bg-gray-200 rounded-xl\"></div>\n              ))}\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 pb-20 sm:pb-0\">\n      <Navigation />\n      \n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\n        {/* Dashboard Header */}\n        <div className=\"mb-8\">\n          <div className=\"bg-gradient-to-r from-nigerian-green to-forest-green rounded-xl p-6 text-white\">\n            <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between\">\n              <div>\n                <h2 className=\"text-2xl font-bold mb-2\">\n                  {userIsAdmin ? \"Admin Dashboard\" : \"My Dashboard\"}\n                </h2>\n                <p className=\"text-green-100\">Welcome back, {user?.fullName}</p>\n                <p className=\"text-green-200 text-sm\">\n                  {userIsAdmin \n                    ? `Managing ${userGroups.length} active groups`\n                    : `Member of ${userGroups.length} groups`\n                  }\n                </p>\n              </div>\n              <div className=\"mt-4 sm:mt-0\">\n                <div className=\"text-right\">\n                  <p className=\"text-green-100 text-sm\">Your Role</p>\n                  <Badge variant=\"secondary\" className=\"bg-white/20 text-white border-white/30\">\n                    {userIsAdmin ? \"Group Admin\" : \"Group Member\"}\n                  </Badge>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {userIsAdmin ? (\n          // Admin Dashboard Content\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\n            <Card>\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm font-medium text-gray-600\">Total Collections</p>\n                    <p className=\"text-2xl font-bold text-nigerian-green\">\n                      {formatNaira(userStats.totalCollections || 0)}\n                    </p>\n                    <p className=\"text-xs text-green-600\">All groups combined</p>\n                  </div>\n                  <div className=\"w-12 h-12 bg-green-50 rounded-full flex items-center justify-center\">\n                    <TrendingUp className=\"text-nigerian-green h-6 w-6\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm font-medium text-gray-600\">Active Members</p>\n                    <p className=\"text-2xl font-bold text-gray-900\">\n                      {userStats.activeMembers || 0}\n                    </p>\n                    <p className=\"text-xs text-blue-600\">Across all groups</p>\n                  </div>\n                  <div className=\"w-12 h-12 bg-blue-50 rounded-full flex items-center justify-center\">\n                    <Users className=\"text-blue-500 h-6 w-6\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm font-medium text-gray-600\">Pending Approvals</p>\n                    <p className=\"text-2xl font-bold text-orange-600\">\n                      {userStats.pendingPayments || 0}\n                    </p>\n                    <p className=\"text-xs text-orange-600\">Need attention</p>\n                  </div>\n                  <div className=\"w-12 h-12 bg-orange-50 rounded-full flex items-center justify-center\">\n                    <Clock className=\"text-orange-500 h-6 w-6\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm font-medium text-gray-600\">Success Rate</p>\n                    <p className=\"text-2xl font-bold text-green-600\">\n                      {userStats.completionRate || 0}%\n                    </p>\n                    <p className=\"text-xs text-green-600\">Collection rate</p>\n                  </div>\n                  <div className=\"w-12 h-12 bg-green-50 rounded-full flex items-center justify-center\">\n                    <Target className=\"text-green-500 h-6 w-6\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        ) : (\n          // Member Dashboard Content\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\n            <Card>\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm font-medium text-gray-600\">My Total Contributions</p>\n                    <p className=\"text-2xl font-bold text-nigerian-green\">\n                      {formatNaira(userStats.totalContributed || 0)}\n                    </p>\n                    <p className=\"text-xs text-green-600\">Across all groups</p>\n                  </div>\n                  <div className=\"w-12 h-12 bg-green-50 rounded-full flex items-center justify-center\">\n                    <CreditCard className=\"text-nigerian-green h-6 w-6\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm font-medium text-gray-600\">Active Groups</p>\n                    <p className=\"text-2xl font-bold text-gray-900\">\n                      {userGroups.length}\n                    </p>\n                    <p className=\"text-xs text-blue-600\">Currently joined</p>\n                  </div>\n                  <div className=\"w-12 h-12 bg-blue-50 rounded-full flex items-center justify-center\">\n                    <Users className=\"text-blue-500 h-6 w-6\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm font-medium text-gray-600\">Pending Payments</p>\n                    <p className=\"text-2xl font-bold text-orange-600\">\n                      {userStats.pendingContributions || 0}\n                    </p>\n                    <p className=\"text-xs text-orange-600\">Awaiting approval</p>\n                  </div>\n                  <div className=\"w-12 h-12 bg-orange-50 rounded-full flex items-center justify-center\">\n                    <Clock className=\"text-orange-500 h-6 w-6\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        )}\n\n        {/* Groups Overview */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <CardTitle>\n                  {userIsAdmin ? \"My Groups\" : \"Groups I've Joined\"}\n                </CardTitle>\n                {userIsAdmin && (\n                  <Link href=\"/groups\">\n                    <Button variant=\"outline\" size=\"sm\">\n                      Manage All\n                    </Button>\n                  </Link>\n                )}\n              </div>\n            </CardHeader>\n            <CardContent>\n              {userGroups.length === 0 ? (\n                <div className=\"text-center py-6\">\n                  <Users className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                  <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\n                    {userIsAdmin ? \"No groups created\" : \"No groups joined\"}\n                  </h3>\n                  <p className=\"text-gray-600 mb-4\">\n                    {userIsAdmin \n                      ? \"Create your first group to start collecting contributions.\"\n                      : \"Join a group to start contributing and track your progress.\"\n                    }\n                  </p>\n                  {userIsAdmin && (\n                    <Link href=\"/groups\">\n                      <Button className=\"bg-nigerian-green hover:bg-forest-green\">\n                        Create Group\n                      </Button>\n                    </Link>\n                  )}\n                </div>\n              ) : (\n                <div className=\"space-y-4\">\n                  {userGroups.slice(0, 3).map((group: any) => (\n                    <div key={group.id} className=\"p-4 border rounded-lg hover:bg-gray-50\">\n                      <div className=\"flex items-center justify-between mb-2\">\n                        <h4 className=\"font-medium text-gray-900\">{group.name}</h4>\n                        <Badge variant=\"secondary\" className=\"text-xs\">\n                          {group.memberCount || 0} members\n                        </Badge>\n                      </div>\n                      {!userIsAdmin && group.targetAmount && (\n                        <div className=\"space-y-2\">\n                          <div className=\"flex justify-between text-sm\">\n                            <span className=\"text-gray-600\">Progress</span>\n                            <span className=\"font-medium\">\n                              {formatNaira(group.collectedAmount || 0)} / {formatNaira(group.targetAmount)}\n                            </span>\n                          </div>\n                          <Progress \n                            value={((group.collectedAmount || 0) / group.targetAmount) * 100} \n                            className=\"h-2\"\n                          />\n                        </div>\n                      )}\n                    </div>\n                  ))}\n                  {userGroups.length > 3 && (\n                    <div className=\"text-center pt-2\">\n                      <Link href=\"/groups\">\n                        <Button variant=\"ghost\" size=\"sm\">\n                          View All Groups ({userGroups.length})\n                        </Button>\n                      </Link>\n                    </div>\n                  )}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          {/* Recent Activity */}\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <CardTitle>Recent Activity</CardTitle>\n                <Link href={userIsAdmin ? \"/groups\" : \"/my-contributions\"}>\n                  <Button variant=\"outline\" size=\"sm\">\n                    View All\n                  </Button>\n                </Link>\n              </div>\n            </CardHeader>\n            <CardContent>\n              {recentContributions.length === 0 ? (\n                <div className=\"text-center py-6\">\n                  <CheckCircle className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                  <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No recent activity</h3>\n                  <p className=\"text-gray-600 mb-4\">\n                    {userIsAdmin \n                      ? \"Contributions will appear here when members start making payments.\"\n                      : \"Your contributions and updates will appear here.\"\n                    }\n                  </p>\n                  {!userIsAdmin && (\n                    <Link href=\"/make-payment\">\n                      <Button className=\"bg-nigerian-green hover:bg-forest-green\">\n                        Make Payment\n                      </Button>\n                    </Link>\n                  )}\n                </div>\n              ) : (\n                <div className=\"space-y-3\">\n                  {recentContributions.slice(0, 5).map((contribution: any) => (\n                    <div key={contribution.id} className=\"flex items-center space-x-3 p-3 border rounded-lg\">\n                      <div className={`w-8 h-8 rounded-full flex items-center justify-center ${\n                        contribution.status === 'confirmed' ? 'bg-green-100' :\n                        contribution.status === 'pending' ? 'bg-orange-100' : 'bg-red-100'\n                      }`}>\n                        {contribution.status === 'confirmed' ? (\n                          <CheckCircle className=\"h-4 w-4 text-green-600\" />\n                        ) : contribution.status === 'pending' ? (\n                          <Clock className=\"h-4 w-4 text-orange-600\" />\n                        ) : (\n                          <AlertCircle className=\"h-4 w-4 text-red-600\" />\n                        )}\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"text-sm font-medium text-gray-900 truncate\">\n                          {userIsAdmin ? contribution.userName : contribution.groupName}\n                        </p>\n                        <p className=\"text-xs text-gray-500\">\n                          {new Date(contribution.createdAt).toLocaleDateString()}\n                        </p>\n                      </div>\n                      <div className=\"text-sm font-medium text-gray-900\">\n                        {formatNaira(Number(contribution.amount))}\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}","path":null,"size_bytes":15753,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n:root {\n  --background: hsl(0, 0%, 100%);\n  --foreground: hsl(0, 0%, 10%);\n  --muted: hsl(120, 5%, 96%);\n  --muted-foreground: hsl(0, 0%, 45%);\n  --popover: hsl(0, 0%, 100%);\n  --popover-foreground: hsl(0, 0%, 10%);\n  --card: hsl(0, 0%, 100%);\n  --card-foreground: hsl(0, 0%, 10%);\n  --border: hsl(0, 0%, 90%);\n  --input: hsl(0, 0%, 90%);\n  --primary: hsl(120, 100%, 25%);\n  --primary-foreground: hsl(0, 0%, 100%);\n  --secondary: hsl(120, 20%, 95%);\n  --secondary-foreground: hsl(120, 100%, 20%);\n  --accent: hsl(120, 30%, 92%);\n  --accent-foreground: hsl(120, 100%, 20%);\n  --destructive: hsl(0, 72%, 51%);\n  --destructive-foreground: hsl(0, 0%, 100%);\n  --ring: hsl(120, 100%, 25%);\n  --radius: 0.75rem;\n  \n  /* WhatsApp-inspired Kontrib theme */\n  --kontrib-green: #008000;\n  --kontrib-green-dark: #006400;\n  --kontrib-green-light: #00a000;\n  --kontrib-surface: #f0fdf4;\n  --kontrib-success: #22c55e;\n  --kontrib-warning: #f59e0b;\n  --kontrib-error: #ef4444;\n  --naira-color: #008000;\n  \n  /* Legacy aliases */\n  --nigerian-green: #008000;\n  --forest-green: #006400;\n  --surface: #f0fdf4;\n}\n\n.dark {\n  --background: hsl(0, 0%, 7%);\n  --foreground: hsl(0, 0%, 95%);\n  --muted: hsl(0, 0%, 15%);\n  --muted-foreground: hsl(0, 0%, 60%);\n  --popover: hsl(0, 0%, 10%);\n  --popover-foreground: hsl(0, 0%, 95%);\n  --card: hsl(0, 0%, 10%);\n  --card-foreground: hsl(0, 0%, 95%);\n  --border: hsl(0, 0%, 20%);\n  --input: hsl(0, 0%, 20%);\n  --primary: hsl(120, 100%, 35%);\n  --primary-foreground: hsl(0, 0%, 100%);\n  --secondary: hsl(0, 0%, 15%);\n  --secondary-foreground: hsl(120, 100%, 50%);\n  --accent: hsl(0, 0%, 18%);\n  --accent-foreground: hsl(120, 100%, 50%);\n  --destructive: hsl(0, 72%, 45%);\n  --destructive-foreground: hsl(0, 0%, 100%);\n  --ring: hsl(120, 100%, 35%);\n  --radius: 0.75rem;\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  html {\n    -webkit-tap-highlight-color: transparent;\n    scroll-behavior: smooth;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n    font-size: 16px;\n    line-height: 1.5;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n  }\n\n  .font-open-sauce {\n    font-family: 'Open Sans', sans-serif;\n  }\n\n  .font-circular {\n    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\n    font-weight: 900;\n    letter-spacing: -0.02em;\n  }\n\n  h1, h2, h3, h4, h5, h6 {\n    @apply font-bold tracking-tight;\n  }\n\n  h1 {\n    @apply text-2xl sm:text-3xl;\n  }\n\n  h2 {\n    @apply text-xl sm:text-2xl;\n  }\n\n  h3 {\n    @apply text-lg sm:text-xl;\n  }\n}\n\n@layer components {\n  .btn-kontrib {\n    @apply inline-flex items-center justify-center gap-2 px-6 py-4 text-lg font-semibold text-white rounded-xl transition-all duration-200 active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed;\n    background-color: var(--kontrib-green);\n    min-height: 56px;\n    touch-action: manipulation;\n  }\n\n  .btn-kontrib:hover:not(:disabled) {\n    background-color: var(--kontrib-green-dark);\n  }\n\n  .btn-kontrib:active:not(:disabled) {\n    background-color: var(--kontrib-green-dark);\n    transform: scale(0.98);\n  }\n\n  .btn-kontrib-outline {\n    @apply inline-flex items-center justify-center gap-2 px-6 py-4 text-lg font-semibold rounded-xl border-2 transition-all duration-200 active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed;\n    color: var(--kontrib-green);\n    border-color: var(--kontrib-green);\n    background: transparent;\n    min-height: 56px;\n    touch-action: manipulation;\n  }\n\n  .btn-kontrib-outline:hover:not(:disabled) {\n    background-color: var(--kontrib-surface);\n  }\n\n  .card-kontrib {\n    @apply bg-white rounded-2xl border border-gray-100 shadow-sm p-5;\n  }\n\n  .input-kontrib {\n    @apply w-full px-4 py-4 text-lg border-2 border-gray-200 rounded-xl transition-colors duration-200 focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20;\n    min-height: 56px;\n  }\n\n  .status-paid {\n    @apply inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium rounded-full;\n    background-color: #dcfce7;\n    color: #166534;\n  }\n\n  .status-pending {\n    @apply inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium rounded-full;\n    background-color: #fef3c7;\n    color: #92400e;\n  }\n\n  .status-unpaid {\n    @apply inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium rounded-full;\n    background-color: #fee2e2;\n    color: #991b1b;\n  }\n\n  .whatsapp-btn {\n    @apply inline-flex items-center justify-center gap-2 px-6 py-4 text-lg font-semibold text-white rounded-xl transition-all duration-200 active:scale-[0.98];\n    background-color: #25D366;\n    min-height: 56px;\n    touch-action: manipulation;\n  }\n\n  .whatsapp-btn:hover {\n    background-color: #20bd5a;\n  }\n\n  .progress-circle {\n    @apply relative inline-flex items-center justify-center;\n  }\n\n  .skeleton-kontrib {\n    @apply animate-pulse bg-gray-200 rounded-lg;\n  }\n}\n\n@layer utilities {\n  .nigerian-green {\n    color: var(--nigerian-green);\n  }\n  \n  .bg-nigerian-green {\n    background-color: var(--nigerian-green);\n  }\n\n  .bg-kontrib-green {\n    background-color: var(--kontrib-green);\n  }\n\n  .bg-kontrib-surface {\n    background-color: var(--kontrib-surface);\n  }\n  \n  .border-nigerian-green {\n    border-color: var(--nigerian-green);\n  }\n\n  .border-kontrib-green {\n    border-color: var(--kontrib-green);\n  }\n  \n  .text-naira {\n    color: var(--naira-color);\n  }\n\n  .text-kontrib-green {\n    color: var(--kontrib-green);\n  }\n\n  .touch-target {\n    min-height: 48px;\n    min-width: 48px;\n  }\n\n  .safe-bottom {\n    padding-bottom: max(1rem, env(safe-area-inset-bottom));\n  }\n\n  .safe-top {\n    padding-top: max(1rem, env(safe-area-inset-top));\n  }\n\n  .scrollbar-hide {\n    -ms-overflow-style: none;\n    scrollbar-width: none;\n  }\n  \n  .scrollbar-hide::-webkit-scrollbar {\n    display: none;\n  }\n}\n","path":null,"size_bytes":5898,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, integer, timestamp, boolean, decimal } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  username: text(\"username\"), // Optional - for legacy users\n  password: text(\"password\"), // Optional - not used with instant login\n  fullName: text(\"full_name\"), // Optional - users can add after onboarding\n  phoneNumber: text(\"phone_number\").notNull(), // Primary identifier (find by phone)\n  role: text(\"role\").notNull().default(\"member\"), // \"admin\" or \"member\"\n  profileCompletedAt: timestamp(\"profile_completed_at\"), // When user added their name\n  createdAt: timestamp(\"created_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n});\n\nexport const groups = pgTable(\"groups\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  description: text(\"description\"),\n  whatsappLink: text(\"whatsapp_link\"),\n  registrationLink: text(\"registration_link\").notNull().unique(),\n  customSlug: text(\"custom_slug\").unique(), // For kontrib.app/customslug URLs\n  status: text(\"status\").notNull().default(\"active\"), // \"active\", \"completed\", \"paused\"\n  adminId: varchar(\"admin_id\").notNull().references(() => users.id),\n  createdAt: timestamp(\"created_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n});\n\nexport const groupMembers = pgTable(\"group_members\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  groupId: varchar(\"group_id\").notNull().references(() => groups.id),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  contributedAmount: decimal(\"contributed_amount\", { precision: 15, scale: 2 }).notNull().default(\"0\"),\n  status: text(\"status\").notNull().default(\"active\"), // \"active\", \"pending\", \"inactive\"\n  joinedAt: timestamp(\"joined_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n});\n\nexport const projects = pgTable(\"projects\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  groupId: varchar(\"group_id\").notNull().references(() => groups.id),\n  name: text(\"name\").notNull(),\n  description: text(\"description\"),\n  projectType: text(\"project_type\").notNull().default(\"target\"), // \"target\", \"monthly\", \"yearly\", \"event\", \"emergency\"\n  targetAmount: decimal(\"target_amount\", { precision: 15, scale: 2 }), // Optional for monthly/yearly types\n  collectedAmount: decimal(\"collected_amount\", { precision: 15, scale: 2 }).notNull().default(\"0\"),\n  customSlug: text(\"custom_slug\").unique(), // For kontrib.app/groupname/pursename URLs\n  deadline: timestamp(\"deadline\"),\n  status: text(\"status\").notNull().default(\"active\"), // \"active\", \"completed\", \"paused\"\n  // Custom OG image for link previews (stored in object storage)\n  ogImage: text(\"og_image\"), // URL to custom OG image in object storage\n  // Account details for contributions\n  accountName: text(\"account_name\"),\n  accountNumber: text(\"account_number\"),\n  bankName: text(\"bank_name\"),\n  routingNumber: text(\"routing_number\"), // For US banks\n  swiftCode: text(\"swift_code\"), // For international transfers\n  // Alternative payment methods\n  zelleEmail: text(\"zelle_email\"),\n  zellePhone: text(\"zelle_phone\"),\n  cashappHandle: text(\"cashapp_handle\"),\n  venmoHandle: text(\"venmo_handle\"),\n  paypalEmail: text(\"paypal_email\"),\n  // Payment instructions and preferred methods\n  paymentInstructions: text(\"payment_instructions\"),\n  allowedPaymentTypes: text(\"allowed_payment_types\"), // JSON array of allowed payment types\n  createdAt: timestamp(\"created_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n});\n\nexport const accountabilityPartners = pgTable(\"accountability_partners\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  groupId: varchar(\"group_id\").notNull().references(() => groups.id),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  assignedAt: timestamp(\"assigned_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n});\n\nexport const contributions = pgTable(\"contributions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  groupId: varchar(\"group_id\").notNull().references(() => groups.id),\n  projectId: varchar(\"project_id\").references(() => projects.id), // Optional: contribution can be for specific project\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  amount: decimal(\"amount\", { precision: 15, scale: 2 }).notNull(),\n  description: text(\"description\"),\n  status: text(\"status\").notNull().default(\"pending\"), // \"confirmed\", \"pending\", \"failed\"\n  transactionRef: text(\"transaction_ref\"),\n  proofOfPayment: text(\"proof_of_payment\"), // Base64 encoded image or file path\n  paymentType: text(\"payment_type\").notNull(), // \"bank_transfer\", \"zelle\", \"cashapp\", \"venmo\", \"paypal\", \"wire_transfer\"\n  paymentNotes: text(\"payment_notes\"), // Additional notes about the payment method used\n  createdAt: timestamp(\"created_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n});\n\nexport const otpVerifications = pgTable(\"otp_verifications\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  phoneNumber: text(\"phone_number\").notNull(),\n  otp: text(\"otp\").notNull(),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  verified: boolean(\"verified\").notNull().default(false),\n  attempts: integer(\"attempts\").notNull().default(0),\n  createdAt: timestamp(\"created_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n});\n\nexport const deviceTokens = pgTable(\"device_tokens\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  token: text(\"token\").notNull().unique(),\n  deviceInfo: text(\"device_info\"),\n  lastUsed: timestamp(\"last_used\").notNull().default(sql`CURRENT_TIMESTAMP`),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  createdAt: timestamp(\"created_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n});\n\n// Insert schemas\nexport const insertUserSchema = createInsertSchema(users).omit({\n  id: true,\n  profileCompletedAt: true,\n  createdAt: true,\n});\n\n// Schema for instant login - just phone number\nexport const instantLoginSchema = z.object({\n  phoneNumber: z.string().min(10, \"Please enter a valid phone number\"),\n});\n\n// Schema for updating profile after onboarding\nexport const updateProfileSchema = z.object({\n  fullName: z.string().min(2, \"Please enter your full name\"),\n  role: z.enum([\"admin\", \"member\"]).optional(),\n});\n\nexport const insertGroupSchema = createInsertSchema(groups).omit({\n  id: true,\n  registrationLink: true,\n  customSlug: true,\n  adminId: true,\n  createdAt: true,\n});\n\nexport const insertGroupMemberSchema = createInsertSchema(groupMembers).omit({\n  id: true,\n  contributedAmount: true,\n  status: true,\n  joinedAt: true,\n});\n\nexport const insertProjectSchema = createInsertSchema(projects).omit({\n  id: true,\n  collectedAmount: true,\n  customSlug: true,\n  createdAt: true,\n}).extend({\n  projectType: z.enum([\"target\", \"monthly\", \"yearly\", \"event\", \"emergency\"]).default(\"target\"),\n  targetAmount: z.string().optional().nullable(), // Optional for monthly/yearly types\n  deadline: z.string().optional().or(z.date().optional()),\n  allowedPaymentTypes: z.string().optional(), // JSON string of payment types\n});\n\nexport const insertAccountabilityPartnerSchema = createInsertSchema(accountabilityPartners).omit({\n  id: true,\n  assignedAt: true,\n});\n\n// Notifications table\nexport const notifications = pgTable(\"notifications\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id), // Who should receive the notification\n  type: text(\"type\").notNull(), // \"payment_submitted\", \"payment_confirmed\", etc.\n  title: text(\"title\").notNull(),\n  message: text(\"message\").notNull(),\n  contributionId: varchar(\"contribution_id\").references(() => contributions.id),\n  projectId: varchar(\"project_id\").references(() => projects.id),\n  read: boolean(\"read\").notNull().default(false),\n  createdAt: timestamp(\"created_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n});\n\nexport const insertContributionSchema = createInsertSchema(contributions).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertNotificationSchema = createInsertSchema(notifications).omit({\n  id: true,\n  read: true,\n  createdAt: true,\n});\n\nexport const insertOtpVerificationSchema = createInsertSchema(otpVerifications).omit({\n  id: true,\n  verified: true,\n  attempts: true,\n  createdAt: true,\n});\n\n// Types\nexport type User = typeof users.$inferSelect;\nexport type Group = typeof groups.$inferSelect;\nexport type GroupMember = typeof groupMembers.$inferSelect;\nexport type Project = typeof projects.$inferSelect;\nexport type AccountabilityPartner = typeof accountabilityPartners.$inferSelect;\nexport type Contribution = typeof contributions.$inferSelect;\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type InsertGroup = z.infer<typeof insertGroupSchema>;\nexport type InsertGroupMember = z.infer<typeof insertGroupMemberSchema>;\nexport type InsertProject = z.infer<typeof insertProjectSchema>;\nexport type InsertAccountabilityPartner = z.infer<typeof insertAccountabilityPartnerSchema>;\nexport type InsertContribution = z.infer<typeof insertContributionSchema>;\nexport type Notification = typeof notifications.$inferSelect;\nexport type InsertNotification = z.infer<typeof insertNotificationSchema>;\nexport type OtpVerification = typeof otpVerifications.$inferSelect;\nexport type InsertOtpVerification = z.infer<typeof insertOtpVerificationSchema>;\nexport type InstantLogin = z.infer<typeof instantLoginSchema>;\nexport type UpdateProfile = z.infer<typeof updateProfileSchema>;\nexport type DeviceToken = typeof deviceTokens.$inferSelect;\n\n// Extended types for UI\nexport type GroupWithStats = Group & {\n  memberCount: number;\n  projectCount: number;\n  completionRate: number;\n  pendingPayments: number;\n};\n\nexport type MemberWithContributions = User & {\n  totalContributions: string;\n  groupCount: number;\n  status: string;\n};\n\nexport type ProjectWithStats = Project & {\n  contributionCount: number;\n  completionRate: number;\n};\n\nexport type ContributionWithDetails = Contribution & {\n  userName: string;\n  groupName: string;\n  projectName?: string;\n};\n\nexport type AccountabilityPartnerWithDetails = AccountabilityPartner & {\n  userName: string;\n  userFullName: string;\n};\n\nexport type GroupWithRole = GroupWithStats & {\n  role: 'admin' | 'member' | 'both';\n  pendingApprovals?: number;\n  myPendingPayments?: number;\n};\n","path":null,"size_bytes":10579,"size_tokens":null},"client/src/pages/whatsapp-integration.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { \n  MessageCircle, \n  Share2, \n  Copy, \n  ExternalLink,\n  Users,\n  Target,\n  Calendar,\n  CheckCircle2,\n  Clock,\n  TrendingUp\n} from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { getCurrentUser } from \"@/lib/auth\";\nimport { formatNaira } from \"@/lib/currency\";\nimport { Group, Project, ContributionWithDetails } from \"@shared/schema\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useLocation } from \"wouter\";\n\nexport default function WhatsAppIntegration() {\n  const user = getCurrentUser();\n  const { toast } = useToast();\n  const [, setLocation] = useLocation();\n  const [selectedGroup, setSelectedGroup] = useState<Group | null>(null);\n  const [selectedProject, setSelectedProject] = useState<Project | null>(null);\n\n  const { data: groups = [] } = useQuery<Group[]>({\n    queryKey: [`/api/groups/all/${user?.id}`],\n    enabled: !!user,\n  });\n\n  const { data: projects = [] } = useQuery<Project[]>({\n    queryKey: [`/api/groups/${selectedGroup?.id}/projects`],\n    enabled: !!selectedGroup,\n  });\n\n  const { data: contributions = [] } = useQuery<ContributionWithDetails[]>({\n    queryKey: [`/api/contributions/user/${user?.id}`],\n    enabled: !!user,\n  });\n\n  const generateProjectSlug = (name: string) => {\n    return name\n      .toLowerCase()\n      .replace(/[^a-z0-9\\s-]/g, '')\n      .replace(/\\s+/g, '')\n      .slice(0, 50);\n  };\n\n  const generateJoinLink = (group: Group, project?: Project) => {\n    const baseUrl = \"kontrib.app\";\n    const groupSlug = group.customSlug || group.registrationLink;\n    if (project) {\n      return `${baseUrl}/join/${groupSlug}/${generateProjectSlug(project.name)}`;\n    }\n    return `${baseUrl}/join/${groupSlug}`;\n  };\n\n  const generateWhatsAppLink = (group: Group, project?: Project) => {\n    const joinLink = generateJoinLink(group, project);\n    \n    let message = `${joinLink}\\n\\n`;\n    message += `You have been invited to join ${group.name} on Kontrib!\\n\\n`;\n    \n    if (project) {\n      message += `Login to submit your contributions to ${project.name}\\n\\n`;\n    } else {\n      message += `Login to submit your contributions\\n\\n`;\n    }\n    \n    message += `Let's keep it transparent\\n\\n`;\n    message += `Kontrib.app`;\n    \n    return `https://wa.me/?text=${encodeURIComponent(message)}`;\n  };\n\n  const copyToClipboard = (text: string) => {\n    navigator.clipboard.writeText(text);\n    toast({\n      title: \"Copied!\",\n      description: \"Link copied to clipboard\",\n    });\n  };\n\n  const openWhatsApp = (whatsappUrl: string) => {\n    window.open(whatsappUrl, '_blank');\n  };\n\n  const getContributionStatus = () => {\n    if (!user) return null;\n    \n    const userContributions = contributions.filter(c => c.userId === user.id);\n    const pendingCount = userContributions.filter(c => c.status === 'pending').length;\n    const confirmedCount = userContributions.filter(c => c.status === 'confirmed').length;\n    const totalAmount = userContributions\n      .filter(c => c.status === 'confirmed')\n      .reduce((sum, c) => sum + Number(c.amount), 0);\n\n    return { pendingCount, confirmedCount, totalAmount };\n  };\n\n  const status = getContributionStatus();\n\n  if (!user) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center\">\n        <Card className=\"w-full max-w-md\">\n          <CardHeader>\n            <CardTitle>Access Required</CardTitle>\n            <CardDescription>Please log in to access WhatsApp integration</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Button onClick={() => setLocation(\"/\")}>Go to Login</Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 p-4\">\n      <div className=\"max-w-6xl mx-auto space-y-6\">\n        {/* Header */}\n        <div className=\"text-center space-y-2\">\n          <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">WhatsApp Integration</h1>\n          <p className=\"text-gray-600 dark:text-gray-300\">\n            Share your contribution groups and track status through WhatsApp\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n          {/* Link Preview Card */}\n          <div className=\"space-y-4\">\n            <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white\">Share Groups</h2>\n            \n            {/* Group Selection */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-sm\">Select Group</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                {groups.length === 0 ? (\n                  <p className=\"text-gray-500 text-sm\">No groups available</p>\n                ) : (\n                  groups.map((group) => (\n                    <div\n                      key={group.id}\n                      className={`p-3 border rounded-lg cursor-pointer transition-colors hover:bg-gray-50 dark:hover:bg-gray-800 ${\n                        selectedGroup?.id === group.id ? 'border-green-500 bg-green-50 dark:bg-green-900/20' : 'border-gray-200 dark:border-gray-700'\n                      }`}\n                      onClick={() => {\n                        setSelectedGroup(group);\n                        setSelectedProject(null);\n                      }}\n                      data-testid={`group-select-${group.id}`}\n                    >\n                      <div className=\"flex justify-between items-start\">\n                        <div>\n                          <h3 className=\"font-medium text-gray-900 dark:text-white\">{group.name}</h3>\n                          <p className=\"text-sm text-gray-500\">{group.description}</p>\n                        </div>\n                        <Badge variant=\"secondary\">{group.status}</Badge>\n                      </div>\n                    </div>\n                  ))\n                )}\n              </CardContent>\n            </Card>\n\n            {/* Project Selection */}\n            {selectedGroup && (\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-sm\">Select Project (Optional)</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-3\">\n                  {projects.length === 0 ? (\n                    <p className=\"text-gray-500 text-sm\">No projects in this group</p>\n                  ) : (\n                    projects.map((project) => (\n                      <div\n                        key={project.id}\n                        className={`p-3 border rounded-lg cursor-pointer transition-colors hover:bg-gray-50 dark:hover:bg-gray-800 ${\n                          selectedProject?.id === project.id ? 'border-green-500 bg-green-50 dark:bg-green-900/20' : 'border-gray-200 dark:border-gray-700'\n                        }`}\n                        onClick={() => setSelectedProject(project)}\n                        data-testid={`project-select-${project.id}`}\n                      >\n                        <div className=\"space-y-2\">\n                          <div className=\"flex justify-between items-start\">\n                            <h3 className=\"font-medium text-gray-900 dark:text-white\">{project.name}</h3>\n                            <Badge variant=\"outline\">\n                              {Math.round((Number(project.collectedAmount) / Number(project.targetAmount)) * 100)}%\n                            </Badge>\n                          </div>\n                          <div className=\"grid grid-cols-2 gap-2 text-sm text-gray-600 dark:text-gray-400\">\n                            <div className=\"flex items-center gap-1\">\n                              <Target className=\"h-3 w-3\" />\n                              {formatNaira(Number(project.targetAmount))}\n                            </div>\n                            <div className=\"flex items-center gap-1\">\n                              <Calendar className=\"h-3 w-3\" />\n                              {new Date(project.deadline || '').toLocaleDateString()}\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n                    ))\n                  )}\n                </CardContent>\n              </Card>\n            )}\n\n            {/* WhatsApp Preview Card */}\n            {selectedGroup && (\n              <Card className=\"border-2 border-primary/30\">\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2 text-primary\">\n                    <MessageCircle className=\"h-5 w-5\" />\n                    WhatsApp Message Preview\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  {/* Preview of the message - styled like WhatsApp */}\n                  <div className=\"bg-[#dcf8c6] p-4 rounded-lg border border-green-200 shadow-sm\">\n                    <div className=\"space-y-3 text-sm text-gray-800\">\n                      {/* Join Link */}\n                      <p className=\"text-blue-600 font-medium\">\n                        {generateJoinLink(selectedGroup, selectedProject || undefined)}\n                      </p>\n                      \n                      {/* Invitation */}\n                      <p>\n                        You have been invited to join <span className=\"font-semibold\">{selectedGroup.name}</span> on Kontrib!\n                      </p>\n                      \n                      {/* Call to action */}\n                      {selectedProject ? (\n                        <p>\n                          Login to submit your contributions to <span className=\"font-semibold\">{selectedProject.name}</span>\n                        </p>\n                      ) : (\n                        <p>Login to submit your contributions</p>\n                      )}\n                      \n                      {/* Tagline */}\n                      <p className=\"italic text-gray-600\">Let's keep it transparent</p>\n                      \n                      {/* Brand */}\n                      <p className=\"font-semibold text-gray-700\">Kontrib.app</p>\n                    </div>\n                  </div>\n\n                  {/* Action Buttons */}\n                  <div className=\"flex flex-wrap gap-2\">\n                    <Button\n                      onClick={() => openWhatsApp(generateWhatsAppLink(selectedGroup, selectedProject || undefined))}\n                      className=\"btn-kontrib flex-1\"\n                      data-testid=\"share-whatsapp\"\n                    >\n                      <MessageCircle className=\"h-4 w-4 mr-2\" />\n                      Share on WhatsApp\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      onClick={() => {\n                        const joinLink = generateJoinLink(selectedGroup, selectedProject || undefined);\n                        copyToClipboard(`https://${joinLink}`);\n                      }}\n                      data-testid=\"copy-link\"\n                    >\n                      <Copy className=\"h-4 w-4 mr-2\" />\n                      Copy Link\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n          </div>\n\n          {/* Contribution Status Panel */}\n          <div className=\"space-y-4\">\n            <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white\">Your Contribution Status</h2>\n            \n            {status && (\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <TrendingUp className=\"h-5 w-5\" />\n                    Overview\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"grid grid-cols-3 gap-4\">\n                    <div className=\"text-center p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg\">\n                      <div className=\"flex items-center justify-center mb-2\">\n                        <Clock className=\"h-6 w-6 text-orange-600 dark:text-orange-400\" />\n                      </div>\n                      <div className=\"text-2xl font-bold text-orange-600 dark:text-orange-400\">\n                        {status.pendingCount}\n                      </div>\n                      <div className=\"text-sm text-gray-600 dark:text-gray-400\">Pending</div>\n                    </div>\n                    <div className=\"text-center p-4 bg-green-50 dark:bg-green-900/20 rounded-lg\">\n                      <div className=\"flex items-center justify-center mb-2\">\n                        <CheckCircle2 className=\"h-6 w-6 text-green-600 dark:text-green-400\" />\n                      </div>\n                      <div className=\"text-2xl font-bold text-green-600 dark:text-green-400\">\n                        {status.confirmedCount}\n                      </div>\n                      <div className=\"text-sm text-gray-600 dark:text-gray-400\">Confirmed</div>\n                    </div>\n                    <div className=\"text-center p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg\">\n                      <div className=\"flex items-center justify-center mb-2\">\n                        <Target className=\"h-6 w-6 text-blue-600 dark:text-blue-400\" />\n                      </div>\n                      <div className=\"text-lg font-bold text-blue-600 dark:text-blue-400\">\n                        {formatNaira(status.totalAmount)}\n                      </div>\n                      <div className=\"text-sm text-gray-600 dark:text-gray-400\">Total Paid</div>\n                    </div>\n                  </div>\n\n                  <Separator />\n\n                  <div className=\"space-y-3\">\n                    <h3 className=\"font-medium text-gray-900 dark:text-white\">Recent Contributions</h3>\n                    {contributions.slice(0, 5).map((contribution) => (\n                      <div key={contribution.id} className=\"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n                        <div className=\"flex items-center space-x-3\">\n                          <div className={`w-3 h-3 rounded-full ${\n                            contribution.status === 'pending' ? 'bg-orange-400' :\n                            contribution.status === 'confirmed' ? 'bg-green-400' : 'bg-red-400'\n                          }`}></div>\n                          <div>\n                            <div className=\"font-medium text-gray-900 dark:text-white\">\n                              {contribution.groupName}\n                              {contribution.projectName && (\n                                <span className=\"text-gray-500\"> → {contribution.projectName}</span>\n                              )}\n                            </div>\n                            <div className=\"text-sm text-gray-500\">\n                              {new Date(contribution.createdAt).toLocaleDateString()}\n                            </div>\n                          </div>\n                        </div>\n                        <div className=\"text-right\">\n                          <div className=\"font-semibold text-gray-900 dark:text-white\">\n                            {formatNaira(Number(contribution.amount))}\n                          </div>\n                          <Badge \n                            variant={contribution.status === 'confirmed' ? 'default' : 'secondary'}\n                            className=\"text-xs\"\n                          >\n                            {contribution.status.toUpperCase()}\n                          </Badge>\n                        </div>\n                      </div>\n                    ))}\n                    \n                    {contributions.length === 0 && (\n                      <div className=\"text-center py-8 text-gray-500\">\n                        <Users className=\"h-12 w-12 mx-auto mb-2 text-gray-300\" />\n                        <p>No contributions yet</p>\n                      </div>\n                    )}\n                  </div>\n\n                  <Button \n                    variant=\"outline\" \n                    className=\"w-full\"\n                    onClick={() => setLocation(user.role === 'admin' ? '/admin' : '/dashboard')}\n                    data-testid=\"view-dashboard\"\n                  >\n                    View Full Dashboard\n                  </Button>\n                </CardContent>\n              </Card>\n            )}\n\n            {/* Quick Actions */}\n            <Card>\n              <CardHeader>\n                <CardTitle>Quick Actions</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                <Button \n                  variant=\"outline\" \n                  className=\"w-full justify-start\"\n                  onClick={() => setLocation('/')}\n                  data-testid=\"create-contribution\"\n                >\n                  <Target className=\"h-4 w-4 mr-2\" />\n                  Make a Contribution\n                </Button>\n                {user.role === 'admin' && (\n                  <>\n                    <Button \n                      variant=\"outline\" \n                      className=\"w-full justify-start\"\n                      onClick={() => setLocation('/admin')}\n                      data-testid=\"manage-groups\"\n                    >\n                      <Users className=\"h-4 w-4 mr-2\" />\n                      Manage Groups\n                    </Button>\n                    <Button \n                      variant=\"outline\" \n                      className=\"w-full justify-start\"\n                      onClick={() => setLocation('/admin')}\n                      data-testid=\"approve-payments\"\n                    >\n                      <CheckCircle2 className=\"h-4 w-4 mr-2\" />\n                      Approve Payments\n                    </Button>\n                  </>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":18370,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"server/whatsapp-service.ts":{"content":"interface MetaWhatsAppResponse {\n  messaging_product: string;\n  contacts: Array<{\n    input: string;\n    wa_id: string;\n  }>;\n  messages: Array<{\n    id: string;\n    message_status?: string;\n  }>;\n}\n\ninterface MetaWhatsAppError {\n  error: {\n    message: string;\n    type: string;\n    code: number;\n    error_data?: {\n      messaging_product: string;\n      details: string;\n    };\n    error_subcode?: number;\n    fbtrace_id: string;\n  };\n}\n\nclass WhatsAppService {\n  private accessToken: string;\n  private phoneNumberId: string;\n  private apiVersion: string = \"v21.0\";\n  private baseUrl: string;\n\n  constructor() {\n    this.accessToken = process.env.META_WHATSAPP_TOKEN || process.env.WHATSAPP_ACCESS_TOKEN!;\n    this.phoneNumberId = process.env.META_PHONE_NUMBER_ID || process.env.WHATSAPP_PHONE_NUMBER_ID!;\n    this.baseUrl = `https://graph.facebook.com/${this.apiVersion}/${this.phoneNumberId}`;\n\n    if (!this.accessToken || !this.phoneNumberId) {\n      throw new Error(\"Missing required Meta WhatsApp API credentials\");\n    }\n\n    console.log(\"Meta WhatsApp Cloud API Service initialized:\", {\n      phoneNumberId: this.phoneNumberId,\n      apiVersion: this.apiVersion,\n      baseUrl: this.baseUrl\n    });\n  }\n\n  async sendOTP(phoneNumber: string, otpCode: string): Promise<boolean> {\n    try {\n      const cleanPhoneNumber = phoneNumber.replace(/[^\\d]/g, \"\");\n      \n      const isDevelopment = process.env.NODE_ENV === \"development\";\n      \n      if (isDevelopment) {\n        console.log(`Sending OTP via Meta WhatsApp to: ${cleanPhoneNumber}`);\n      } else {\n        console.log(`Sending OTP via Meta WhatsApp to: ${cleanPhoneNumber.substring(0, 3)}***${cleanPhoneNumber.substring(cleanPhoneNumber.length - 3)}`);\n      }\n      \n      const payload = {\n        messaging_product: \"whatsapp\",\n        to: cleanPhoneNumber,\n        type: \"template\",\n        template: {\n          name: \"kontrib_app\",\n          language: {\n            code: \"en\"\n          },\n          components: [\n            {\n              type: \"body\",\n              parameters: [\n                {\n                  type: \"text\",\n                  text: otpCode\n                }\n              ]\n            },\n            {\n              type: \"button\",\n              sub_type: \"url\",\n              index: \"0\",\n              parameters: [\n                {\n                  type: \"text\",\n                  text: otpCode\n                }\n              ]\n            }\n          ]\n        }\n      };\n\n      const response = await fetch(`${this.baseUrl}/messages`, {\n        method: \"POST\",\n        headers: {\n          \"Authorization\": `Bearer ${this.accessToken}`,\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(payload)\n      });\n\n      const result = await response.json() as MetaWhatsAppResponse | MetaWhatsAppError;\n\n      if (!response.ok) {\n        const error = result as MetaWhatsAppError;\n        \n        if (isDevelopment) {\n          console.error(\"Meta WhatsApp API Error (Development):\", {\n            status: response.status,\n            error_code: error.error.code,\n            error_message: error.error.message,\n            error_type: error.error.type,\n            details: error.error.error_data?.details,\n            to: cleanPhoneNumber\n          });\n        } else {\n          console.error(\"Meta WhatsApp API Error (Production):\", {\n            status: response.status,\n            error_code: error.error.code,\n            error_message: error.error.message,\n            timestamp: new Date().toISOString(),\n            to_masked: cleanPhoneNumber.substring(0, 3) + \"***\" + cleanPhoneNumber.substring(cleanPhoneNumber.length - 3)\n          });\n        }\n        \n        return false;\n      }\n\n      const successResult = result as MetaWhatsAppResponse;\n      \n      if (isDevelopment) {\n        console.log(\"Meta WhatsApp OTP sent successfully (Development):\", {\n          messageId: successResult.messages[0].id,\n          status: successResult.messages[0].message_status || \"sent\",\n          to: phoneNumber,\n          waId: successResult.contacts[0].wa_id\n        });\n      } else {\n        console.log(\"Meta WhatsApp OTP sent successfully (Production):\", {\n          messageId: successResult.messages[0].id,\n          status: successResult.messages[0].message_status || \"sent\",\n          timestamp: new Date().toISOString(),\n          to_masked: cleanPhoneNumber.substring(0, 3) + \"***\" + cleanPhoneNumber.substring(cleanPhoneNumber.length - 3)\n        });\n      }\n      \n      return true;\n    } catch (error) {\n      console.error(\"Meta WhatsApp service error:\", error);\n      return false;\n    }\n  }\n\n  async sendMessage(phoneNumber: string, message: string): Promise<boolean> {\n    try {\n      const cleanPhoneNumber = phoneNumber.replace(/[^\\d]/g, \"\");\n      \n      const isDevelopment = process.env.NODE_ENV === \"development\";\n      \n      if (isDevelopment) {\n        console.log(`Sending message via Meta WhatsApp to: ${cleanPhoneNumber}`);\n      }\n      \n      const payload = {\n        messaging_product: \"whatsapp\",\n        to: cleanPhoneNumber,\n        type: \"text\",\n        text: {\n          body: message\n        }\n      };\n\n      const response = await fetch(`${this.baseUrl}/messages`, {\n        method: \"POST\",\n        headers: {\n          \"Authorization\": `Bearer ${this.accessToken}`,\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(payload)\n      });\n\n      const result = await response.json() as MetaWhatsAppResponse | MetaWhatsAppError;\n\n      if (!response.ok) {\n        const error = result as MetaWhatsAppError;\n        console.error(\"Meta WhatsApp API Error:\", {\n          status: response.status,\n          error_code: error.error.code,\n          error_message: error.error.message,\n          error_type: error.error.type\n        });\n        return false;\n      }\n\n      const successResult = result as MetaWhatsAppResponse;\n      \n      if (isDevelopment) {\n        console.log(\"Meta WhatsApp message sent successfully:\", {\n          messageId: successResult.messages[0].id,\n          to: phoneNumber,\n          waId: successResult.contacts[0].wa_id\n        });\n      }\n      \n      return true;\n    } catch (error) {\n      console.error(\"Meta WhatsApp service error:\", error);\n      return false;\n    }\n  }\n\n  isValidWhatsAppNumber(phoneNumber: string): boolean {\n    const cleanNumber = phoneNumber.replace(/[^\\d+]/g, \"\");\n    return /^\\+[1-9]\\d{1,14}$/.test(cleanNumber);\n  }\n}\n\nexport const whatsappService = new WhatsAppService();\n","path":null,"size_bytes":6553,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/components/notification-bell.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { \n  Bell, \n  DollarSign, \n  CheckCircle, \n  XCircle, \n  Clock,\n  X\n} from \"lucide-react\";\nimport { formatNaira } from \"@/lib/currency\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { Notification, ContributionWithDetails } from \"@shared/schema\";\n\ninterface NotificationBellProps {\n  userId: string;\n  onContributionClick?: (contribution: ContributionWithDetails) => void;\n}\n\nexport function NotificationBell({ userId, onContributionClick }: NotificationBellProps) {\n  const [open, setOpen] = useState(false);\n  const [, setLocation] = useLocation();\n  const queryClient = useQueryClient();\n\n  const { data: notifications = [] } = useQuery<Notification[]>({\n    queryKey: [\"/api/notifications\", userId],\n    enabled: !!userId,\n  });\n\n  const { data: contributions = [] } = useQuery<ContributionWithDetails[]>({\n    queryKey: [\"/api/contributions/admin\", userId],\n    enabled: !!userId,\n  });\n\n  const markReadMutation = useMutation({\n    mutationFn: async (notificationId: string) => {\n      const response = await apiRequest(\"PATCH\", `/api/notifications/${notificationId}/read`);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\", userId] });\n    },\n  });\n\n  const dismissMutation = useMutation({\n    mutationFn: async (notificationId: string) => {\n      const response = await apiRequest(\"DELETE\", `/api/notifications/${notificationId}`);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\", userId] });\n    },\n  });\n\n  const handleDismiss = (e: React.MouseEvent, notificationId: string) => {\n    e.stopPropagation();\n    dismissMutation.mutate(notificationId);\n  };\n\n  const unreadNotifications = notifications.filter(n => !n.read);\n  const pendingContributions = contributions.filter(c => c.status === 'pending');\n  const totalUnreadCount = unreadNotifications.length;\n\n  const handleNotificationClick = async (notification: Notification) => {\n    if (!notification.read) {\n      markReadMutation.mutate(notification.id);\n    }\n\n    // If this is a payment notification and we have a contribution handler, open the contribution\n    if (notification.contributionId && onContributionClick) {\n      const contribution = contributions.find(c => c.id === notification.contributionId);\n      if (contribution) {\n        onContributionClick(contribution);\n        setOpen(false);\n      }\n    }\n  };\n\n  const getNotificationIcon = (type: string, status?: string) => {\n    switch (type) {\n      case 'payment_submitted':\n        return <DollarSign className=\"h-4 w-4 text-orange-600\" />;\n      case 'payment_confirmed':\n        return <CheckCircle className=\"h-4 w-4 text-green-600\" />;\n      case 'payment_rejected':\n        return <XCircle className=\"h-4 w-4 text-red-600\" />;\n      default:\n        return <Bell className=\"h-4 w-4 text-gray-600\" />;\n    }\n  };\n\n  const formatNotificationTime = (date: string) => {\n    const now = new Date();\n    const notificationDate = new Date(date);\n    const diffInMs = now.getTime() - notificationDate.getTime();\n    const diffInMins = Math.floor(diffInMs / (1000 * 60));\n    const diffInHours = Math.floor(diffInMs / (1000 * 60 * 60));\n    const diffInDays = Math.floor(diffInMs / (1000 * 60 * 60 * 24));\n\n    if (diffInMins < 60) {\n      return diffInMins === 0 ? 'Just now' : `${diffInMins}m ago`;\n    } else if (diffInHours < 24) {\n      return `${diffInHours}h ago`;\n    } else {\n      return `${diffInDays}d ago`;\n    }\n  };\n\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger asChild>\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"relative\"\n          data-testid=\"notification-bell\"\n        >\n          <Bell className=\"h-5 w-5 text-gray-600\" />\n          {totalUnreadCount > 0 && (\n            <Badge \n              variant=\"destructive\" \n              className=\"absolute -top-2 -right-2 h-5 w-5 flex items-center justify-center p-0 text-xs\"\n            >\n              {totalUnreadCount > 9 ? '9+' : totalUnreadCount}\n            </Badge>\n          )}\n        </Button>\n      </PopoverTrigger>\n      <PopoverContent className=\"w-96 p-0\" align=\"end\">\n        <div className=\"border-b px-4 py-3\">\n          <h3 className=\"font-semibold text-gray-900\">Notifications</h3>\n          <p className=\"text-sm text-gray-600\">\n            {totalUnreadCount > 0 ? `${totalUnreadCount} unread notifications` : 'All caught up!'}\n          </p>\n        </div>\n\n        <ScrollArea className=\"max-h-96\">\n          <div className=\"p-2\">\n            {notifications.length === 0 ? (\n              <div className=\"text-center py-8 px-4\">\n                <Bell className=\"h-12 w-12 text-gray-300 mx-auto mb-3\" />\n                <p className=\"text-sm text-gray-500\">No notifications yet</p>\n              </div>\n            ) : (\n              <div className=\"space-y-1\">\n                {notifications.map((notification) => (\n                  <div\n                    key={notification.id}\n                    className={`p-3 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors relative group ${\n                      !notification.read ? 'bg-blue-50 border-l-4 border-l-blue-500' : 'bg-white'\n                    }`}\n                    onClick={() => handleNotificationClick(notification)}\n                    data-testid={`notification-${notification.id}`}\n                  >\n                    <button\n                      onClick={(e) => handleDismiss(e, notification.id)}\n                      className=\"absolute top-2 right-2 p-1 rounded-full hover:bg-gray-200 opacity-0 group-hover:opacity-100 transition-opacity\"\n                      data-testid={`dismiss-notification-${notification.id}`}\n                    >\n                      <X className=\"h-3 w-3 text-gray-500\" />\n                    </button>\n                    <div className=\"flex items-start gap-3 pr-6\">\n                      <div className=\"flex-shrink-0\">\n                        {getNotificationIcon(notification.type)}\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-start justify-between\">\n                          <p className={`text-sm font-medium ${\n                            !notification.read ? 'text-gray-900' : 'text-gray-700'\n                          }`}>\n                            {notification.title}\n                          </p>\n                          {!notification.read && (\n                            <div className=\"w-2 h-2 bg-blue-500 rounded-full flex-shrink-0 mt-1\"></div>\n                          )}\n                        </div>\n                        <p className=\"text-sm text-gray-600 mt-1 line-clamp-2\">\n                          {notification.message}\n                        </p>\n                        <p className=\"text-xs text-gray-500 mt-2\">\n                          {formatNotificationTime(notification.createdAt.toString())}\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n            \n            {pendingContributions.length > 0 && (\n              <>\n                <div className=\"border-t pt-3 mt-3\">\n                  <h4 className=\"text-sm font-semibold text-gray-900 mb-2 flex items-center gap-2\">\n                    <Clock className=\"h-4 w-4 text-orange-600\" />\n                    Pending Approvals ({pendingContributions.length})\n                  </h4>\n                  <div className=\"space-y-2\">\n                    {pendingContributions.slice(0, 3).map((contribution) => (\n                      <div\n                        key={contribution.id}\n                        className=\"p-2 bg-orange-50 rounded border-l-4 border-l-orange-500 cursor-pointer hover:bg-orange-100 transition-colors\"\n                        onClick={() => {\n                          setLocation(`/group/${contribution.groupId}/pending`);\n                          setOpen(false);\n                        }}\n                        data-testid={`pending-contribution-${contribution.id}`}\n                      >\n                        <div className=\"flex items-center justify-between\">\n                          <div>\n                            <p className=\"text-sm font-medium text-gray-900\">\n                              {contribution.userName}\n                            </p>\n                            <p className=\"text-xs text-gray-600\">\n                              {contribution.groupName}\n                              {contribution.projectName && (\n                                <span> → {contribution.projectName}</span>\n                              )}\n                            </p>\n                          </div>\n                          <p className=\"text-sm font-semibold text-orange-600\">\n                            {formatNaira(Number(contribution.amount))}\n                          </p>\n                        </div>\n                      </div>\n                    ))}\n                    {pendingContributions.length > 3 && (\n                      <p className=\"text-xs text-gray-500 text-center\">\n                        +{pendingContributions.length - 3} more pending...\n                      </p>\n                    )}\n                  </div>\n                </div>\n              </>\n            )}\n          </div>\n        </ScrollArea>\n\n        {notifications.length > 10 && (\n          <div className=\"border-t p-3 text-center\">\n            <Button variant=\"ghost\" size=\"sm\" className=\"text-sm\">\n              View all notifications\n            </Button>\n          </div>\n        )}\n      </PopoverContent>\n    </Popover>\n  );\n}","path":null,"size_bytes":10188,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":2263,"size_tokens":null},"client/src/pages/landing.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Input } from \"@/components/ui/input\";\nimport { Form, FormControl, FormField, FormItem, FormMessage } from \"@/components/ui/form\";\nimport { Users, Shield, ArrowRight, Lock, CheckCircle2 } from \"lucide-react\";\nimport { SiWhatsapp } from \"react-icons/si\";\nimport { type User as UserType } from \"@shared/schema\";\nimport { sendOtp, verifyOtp, updateProfile } from \"@/lib/auth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { z } from \"zod\";\nimport kontribLogo from \"@assets/8_1764455185903.png\";\nimport heroImage from \"@assets/stock_images/african_people_smili_bbf3eb72.jpg\";\n\nconst phoneSchema = z.object({\n  phoneNumber: z.string().min(10, \"Enter your WhatsApp number\"),\n});\n\nconst otpSchema = z.object({\n  otp: z.string().length(6, \"Enter the 6-digit code\"),\n});\n\nconst profileSchema = z.object({\n  fullName: z.string().min(2, \"Enter your name\"),\n});\n\ntype PhoneFormData = z.infer<typeof phoneSchema>;\ntype OtpFormData = z.infer<typeof otpSchema>;\ntype ProfileFormData = z.infer<typeof profileSchema>;\n\nconst REDIRECT_KEY = \"kontrib_redirectTo\";\n\nexport default function Landing() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [step, setStep] = useState<\"phone\" | \"otp\" | \"profile\" | \"role\">(\"phone\");\n  const [phoneNumber, setPhoneNumber] = useState(\"\");\n  const [newUser, setNewUser] = useState<UserType | null>(null);\n  const [devOtp, setDevOtp] = useState<string | null>(null);\n  const otpInputRefs = useRef<(HTMLInputElement | null)[]>([]);\n\n  const getRedirectPath = () => {\n    const storedPath = localStorage.getItem(REDIRECT_KEY);\n    if (storedPath) {\n      localStorage.removeItem(REDIRECT_KEY);\n      return storedPath;\n    }\n    return \"/groups\";\n  };\n\n  const phoneForm = useForm<PhoneFormData>({\n    resolver: zodResolver(phoneSchema),\n    defaultValues: { phoneNumber: \"\" },\n  });\n\n  const otpForm = useForm<OtpFormData>({\n    resolver: zodResolver(otpSchema),\n    defaultValues: { otp: \"\" },\n  });\n\n  const profileForm = useForm<ProfileFormData>({\n    resolver: zodResolver(profileSchema),\n    defaultValues: { fullName: \"\" },\n  });\n\n  const sendOtpMutation = useMutation({\n    mutationFn: async (phone: string) => {\n      return sendOtp(phone);\n    },\n    onSuccess: (data) => {\n      setStep(\"otp\");\n      if (data.developmentOtp) {\n        setDevOtp(data.developmentOtp);\n      }\n      toast({ \n        title: \"Code sent!\", \n        description: \"Check your WhatsApp for the 6-digit code\" \n      });\n    },\n    onError: (error: Error) => {\n      toast({ \n        title: \"Couldn't send code\", \n        description: error.message || \"Please check your number and try again\", \n        variant: \"destructive\" \n      });\n    },\n  });\n\n  const verifyOtpMutation = useMutation({\n    mutationFn: async (otp: string) => {\n      return verifyOtp(phoneNumber, otp);\n    },\n    onSuccess: (data) => {\n      if (data.verified && data.user) {\n        setNewUser(data.user);\n        if (data.isNewUser) {\n          setStep(\"profile\");\n          toast({ title: \"Phone verified!\", description: \"Let's set up your profile\" });\n        } else {\n          toast({ \n            title: \"Welcome back!\", \n            description: `Good to see you, ${data.user.fullName || 'friend'}!` \n          });\n          setLocation(getRedirectPath());\n        }\n      }\n    },\n    onError: (error: Error) => {\n      toast({ \n        title: \"Invalid code\", \n        description: error.message || \"Please check and try again\", \n        variant: \"destructive\" \n      });\n      otpForm.reset();\n    },\n  });\n\n  const profileMutation = useMutation({\n    mutationFn: async (data: { fullName: string; role?: string }) => {\n      if (!newUser) throw new Error(\"No user\");\n      return updateProfile(newUser.id, data);\n    },\n    onSuccess: (user) => {\n      toast({ title: \"Welcome to Kontrib!\", description: `You're all set, ${user.fullName}!` });\n      setLocation(getRedirectPath());\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Error\", description: error.message || \"Try again\", variant: \"destructive\" });\n    },\n  });\n\n  const onPhoneSubmit = (data: PhoneFormData) => {\n    setPhoneNumber(data.phoneNumber);\n    sendOtpMutation.mutate(data.phoneNumber);\n  };\n\n  const onOtpSubmit = (data: OtpFormData) => {\n    verifyOtpMutation.mutate(data.otp);\n  };\n\n  const onProfileSubmit = (data: ProfileFormData) => {\n    setStep(\"role\");\n    profileForm.setValue(\"fullName\", data.fullName);\n  };\n\n  const selectRole = (role: \"member\" | \"admin\") => {\n    const fullName = profileForm.getValues(\"fullName\");\n    profileMutation.mutate({ fullName, role });\n  };\n\n  const handleOtpChange = (index: number, value: string) => {\n    if (!/^\\d*$/.test(value)) return;\n    \n    const currentOtp = otpForm.getValues(\"otp\").split(\"\");\n    currentOtp[index] = value.slice(-1);\n    const newOtp = currentOtp.join(\"\").slice(0, 6);\n    otpForm.setValue(\"otp\", newOtp);\n    \n    if (value && index < 5) {\n      otpInputRefs.current[index + 1]?.focus();\n    }\n    \n    if (newOtp.length === 6) {\n      verifyOtpMutation.mutate(newOtp);\n    }\n  };\n\n  const handleOtpKeyDown = (index: number, e: React.KeyboardEvent) => {\n    if (e.key === \"Backspace\" && !otpForm.getValues(\"otp\")[index] && index > 0) {\n      otpInputRefs.current[index - 1]?.focus();\n    }\n  };\n\n  const handleOtpPaste = (e: React.ClipboardEvent) => {\n    e.preventDefault();\n    const pasted = e.clipboardData.getData(\"text\").replace(/\\D/g, \"\").slice(0, 6);\n    otpForm.setValue(\"otp\", pasted);\n    if (pasted.length === 6) {\n      verifyOtpMutation.mutate(pasted);\n    }\n  };\n\n  useEffect(() => {\n    if (step === \"otp\") {\n      otpInputRefs.current[0]?.focus();\n    }\n  }, [step]);\n\n  return (\n    <div className=\"min-h-screen relative overflow-hidden\">\n      {/* Background with gradient overlay */}\n      <div \n        className=\"absolute inset-0 bg-cover bg-center\"\n        style={{ backgroundImage: `url(${heroImage})` }}\n      />\n      <div className=\"absolute inset-0 bg-gradient-to-br from-gray-900/95 via-gray-900/90 to-emerald-900/80\" />\n      \n      {/* Decorative elements */}\n      <div className=\"absolute top-20 right-10 w-72 h-72 bg-emerald-500/10 rounded-full blur-3xl\" />\n      <div className=\"absolute bottom-20 left-10 w-96 h-96 bg-emerald-500/5 rounded-full blur-3xl\" />\n      \n      {/* Content */}\n      <div className=\"relative z-10 min-h-screen flex flex-col\">\n        <header className=\"px-6 py-5 flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <img src={kontribLogo} alt=\"Kontrib\" className=\"w-10 h-10\" />\n            <span className=\"text-xl font-bold text-white\">Kontrib</span>\n          </div>\n        </header>\n\n        <main className=\"flex-1 flex flex-col items-center justify-center px-6 pb-8\">\n          \n          {step === \"phone\" && (\n            <div className=\"w-full max-w-sm\">\n              {/* Glass card */}\n              <div className=\"bg-white/10 backdrop-blur-xl rounded-3xl p-8 border border-white/20 shadow-2xl\">\n                <div className=\"text-center mb-8\">\n                  <h1 className=\"text-3xl font-black text-white leading-tight mb-3\">\n                    Group Money,<br />Made Simple\n                  </h1>\n                  <p className=\"text-white/70 text-sm\">\n                    Everyone sees every kobo. Instantly.\n                  </p>\n                </div>\n\n                <Form {...phoneForm}>\n                  <form onSubmit={phoneForm.handleSubmit(onPhoneSubmit)} className=\"space-y-4\">\n                    <FormField\n                      control={phoneForm.control}\n                      name=\"phoneNumber\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormControl>\n                            <Input \n                              placeholder=\"+234 XXX XXX XXXX\" \n                              className=\"h-14 text-base px-5 rounded-2xl border-0 bg-white/20 backdrop-blur text-white placeholder:text-white/50 text-center font-medium focus:ring-2 focus:ring-emerald-400\" \n                              type=\"tel\"\n                              {...field}\n                              data-testid=\"input-phone\"\n                            />\n                          </FormControl>\n                          <FormMessage className=\"text-red-300\" />\n                        </FormItem>\n                      )}\n                    />\n                    <button\n                      type=\"submit\"\n                      disabled={sendOtpMutation.isPending}\n                      className=\"w-full h-14 bg-emerald-500 hover:bg-emerald-400 text-white font-bold rounded-2xl flex items-center justify-center gap-2 transition-all shadow-lg shadow-emerald-500/30 active:scale-[0.98]\"\n                      data-testid=\"button-continue\"\n                    >\n                      {sendOtpMutation.isPending ? (\n                        <div className=\"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\n                      ) : (\n                        <>\n                          <SiWhatsapp className=\"h-5 w-5\" />\n                          Continue with WhatsApp\n                        </>\n                      )}\n                    </button>\n                  </form>\n                </Form>\n\n                {/* Trust indicators */}\n                <div className=\"mt-8 pt-6 border-t border-white/10\">\n                  <div className=\"flex items-center justify-center gap-6 text-white/50 text-xs\">\n                    <div className=\"flex items-center gap-1\">\n                      <CheckCircle2 className=\"w-3.5 h-3.5 text-emerald-400\" />\n                      <span>Transparent</span>\n                    </div>\n                    <div className=\"flex items-center gap-1\">\n                      <CheckCircle2 className=\"w-3.5 h-3.5 text-emerald-400\" />\n                      <span>Secure</span>\n                    </div>\n                    <div className=\"flex items-center gap-1\">\n                      <CheckCircle2 className=\"w-3.5 h-3.5 text-emerald-400\" />\n                      <span>Free</span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {step === \"otp\" && (\n            <div className=\"w-full max-w-sm\">\n              <div className=\"bg-white/10 backdrop-blur-xl rounded-3xl p-8 border border-white/20 shadow-2xl\">\n                <button\n                  onClick={() => {\n                    setStep(\"phone\");\n                    otpForm.reset();\n                    setDevOtp(null);\n                  }}\n                  className=\"flex items-center gap-2 text-white/60 hover:text-white mb-6 transition-colors\"\n                  data-testid=\"button-back-phone\"\n                >\n                  <ArrowRight className=\"h-4 w-4 rotate-180\" />\n                  <span className=\"text-sm font-medium\">Back</span>\n                </button>\n                \n                <div className=\"text-center mb-6\">\n                  <div className=\"w-14 h-14 bg-emerald-500/20 rounded-2xl flex items-center justify-center mx-auto mb-4\">\n                    <Lock className=\"h-7 w-7 text-emerald-400\" />\n                  </div>\n                  <h2 className=\"text-2xl font-black text-white\">\n                    Enter Code\n                  </h2>\n                  <p className=\"text-white/60 mt-2 text-sm\">\n                    Sent to <span className=\"text-white font-medium\">{phoneNumber}</span>\n                  </p>\n                </div>\n\n                {devOtp && (\n                  <div className=\"bg-yellow-500/20 border border-yellow-500/30 rounded-xl p-3 text-center mb-4\">\n                    <p className=\"text-sm text-yellow-200\">\n                      Dev: <span className=\"font-bold tracking-wider\">{devOtp}</span>\n                    </p>\n                  </div>\n                )}\n\n                <Form {...otpForm}>\n                  <form onSubmit={otpForm.handleSubmit(onOtpSubmit)} className=\"space-y-5\">\n                    <div className=\"flex justify-center gap-2\" onPaste={handleOtpPaste}>\n                      {[0, 1, 2, 3, 4, 5].map((index) => (\n                        <input\n                          key={index}\n                          ref={(el) => (otpInputRefs.current[index] = el)}\n                          type=\"text\"\n                          inputMode=\"numeric\"\n                          maxLength={1}\n                          className=\"w-11 h-13 text-center text-xl font-bold border-0 rounded-xl bg-white/20 text-white focus:ring-2 focus:ring-emerald-400 focus:outline-none\"\n                          value={otpForm.watch(\"otp\")[index] || \"\"}\n                          onChange={(e) => handleOtpChange(index, e.target.value)}\n                          onKeyDown={(e) => handleOtpKeyDown(index, e)}\n                          disabled={verifyOtpMutation.isPending}\n                          data-testid={`input-otp-${index}`}\n                        />\n                      ))}\n                    </div>\n                    \n                    <button\n                      type=\"submit\"\n                      disabled={verifyOtpMutation.isPending || otpForm.watch(\"otp\").length < 6}\n                      className=\"w-full h-14 bg-emerald-500 hover:bg-emerald-400 disabled:opacity-50 text-white font-bold rounded-2xl flex items-center justify-center gap-2 transition-all\"\n                      data-testid=\"button-verify-otp\"\n                    >\n                      {verifyOtpMutation.isPending ? (\n                        <div className=\"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\n                      ) : (\n                        \"Verify\"\n                      )}\n                    </button>\n                  </form>\n                </Form>\n\n                <div className=\"text-center mt-4\">\n                  <button\n                    onClick={() => sendOtpMutation.mutate(phoneNumber)}\n                    disabled={sendOtpMutation.isPending}\n                    className=\"text-emerald-400 font-medium hover:underline disabled:opacity-50 text-sm\"\n                    data-testid=\"button-resend-otp\"\n                  >\n                    {sendOtpMutation.isPending ? \"Sending...\" : \"Resend code\"}\n                  </button>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {step === \"profile\" && (\n            <div className=\"w-full max-w-sm\">\n              <div className=\"bg-white/10 backdrop-blur-xl rounded-3xl p-8 border border-white/20 shadow-2xl\">\n                <button\n                  onClick={() => setStep(\"otp\")}\n                  className=\"flex items-center gap-2 text-white/60 hover:text-white mb-6 transition-colors\"\n                  data-testid=\"button-back-otp\"\n                >\n                  <ArrowRight className=\"h-4 w-4 rotate-180\" />\n                  <span className=\"text-sm font-medium\">Back</span>\n                </button>\n                \n                <div className=\"mb-6\">\n                  <h2 className=\"text-2xl font-black text-white\">\n                    What's your name?\n                  </h2>\n                  <p className=\"text-white/60 mt-2 text-sm\">So your group knows who you are</p>\n                </div>\n\n                <Form {...profileForm}>\n                  <form onSubmit={profileForm.handleSubmit(onProfileSubmit)} className=\"space-y-4\">\n                    <FormField\n                      control={profileForm.control}\n                      name=\"fullName\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormControl>\n                            <Input \n                              placeholder=\"Your full name\" \n                              className=\"h-14 text-base px-5 rounded-2xl border-0 bg-white/20 backdrop-blur text-white placeholder:text-white/50 font-medium focus:ring-2 focus:ring-emerald-400\" \n                              autoFocus\n                              {...field}\n                              data-testid=\"input-fullname\"\n                            />\n                          </FormControl>\n                          <FormMessage className=\"text-red-300\" />\n                        </FormItem>\n                      )}\n                    />\n                    <button\n                      type=\"submit\"\n                      className=\"w-full h-14 bg-emerald-500 hover:bg-emerald-400 text-white font-bold rounded-2xl flex items-center justify-center gap-2 transition-all\"\n                      data-testid=\"button-next\"\n                    >\n                      Continue\n                      <ArrowRight className=\"h-5 w-5\" />\n                    </button>\n                  </form>\n                </Form>\n              </div>\n            </div>\n          )}\n\n          {step === \"role\" && (\n            <div className=\"w-full max-w-sm\">\n              <div className=\"bg-white/10 backdrop-blur-xl rounded-3xl p-8 border border-white/20 shadow-2xl\">\n                <button\n                  onClick={() => setStep(\"profile\")}\n                  disabled={profileMutation.isPending}\n                  className=\"flex items-center gap-2 text-white/60 hover:text-white mb-6 transition-colors disabled:opacity-50\"\n                  data-testid=\"button-back-profile\"\n                >\n                  <ArrowRight className=\"h-4 w-4 rotate-180\" />\n                  <span className=\"text-sm font-medium\">Back</span>\n                </button>\n                \n                <div className=\"mb-6\">\n                  <h2 className=\"text-2xl font-black text-white\">\n                    How will you use Kontrib?\n                  </h2>\n                  <p className=\"text-white/60 mt-2 text-sm\">You can always do both later</p>\n                </div>\n\n                <div className=\"space-y-3\">\n                  <button\n                    onClick={() => selectRole(\"member\")}\n                    disabled={profileMutation.isPending}\n                    className=\"w-full bg-white/10 hover:bg-white/20 border border-white/20 hover:border-emerald-400/50 rounded-2xl p-4 text-left transition-all active:scale-[0.98] disabled:opacity-50\"\n                    data-testid=\"button-role-member\"\n                  >\n                    <div className=\"flex items-center gap-4\">\n                      <div className=\"w-12 h-12 bg-emerald-500/20 rounded-xl flex items-center justify-center flex-shrink-0\">\n                        <Users className=\"h-6 w-6 text-emerald-400\" />\n                      </div>\n                      <div>\n                        <p className=\"font-bold text-white\">Join a Group</p>\n                        <p className=\"text-white/50 text-sm\">Pay and track contributions</p>\n                      </div>\n                    </div>\n                  </button>\n\n                  <button\n                    onClick={() => selectRole(\"admin\")}\n                    disabled={profileMutation.isPending}\n                    className=\"w-full bg-white/10 hover:bg-white/20 border border-white/20 hover:border-emerald-400/50 rounded-2xl p-4 text-left transition-all active:scale-[0.98] disabled:opacity-50\"\n                    data-testid=\"button-role-admin\"\n                  >\n                    <div className=\"flex items-center gap-4\">\n                      <div className=\"w-12 h-12 bg-emerald-500/20 rounded-xl flex items-center justify-center flex-shrink-0\">\n                        <Shield className=\"h-6 w-6 text-emerald-400\" />\n                      </div>\n                      <div>\n                        <p className=\"font-bold text-white\">Create a Group</p>\n                        <p className=\"text-white/50 text-sm\">Manage and approve payments</p>\n                      </div>\n                    </div>\n                  </button>\n                </div>\n\n                {profileMutation.isPending && (\n                  <div className=\"flex items-center justify-center gap-3 text-emerald-400 py-4 mt-4\">\n                    <div className=\"w-5 h-5 border-2 border-emerald-400/30 border-t-emerald-400 rounded-full animate-spin\" />\n                    <span className=\"font-medium text-sm\">Setting up...</span>\n                  </div>\n                )}\n              </div>\n            </div>\n          )}\n        </main>\n\n        <footer className=\"px-6 py-4\">\n          <div className=\"flex items-center justify-center text-xs text-white/40\">\n            <span>kontrib.app &middot; 2025</span>\n          </div>\n        </footer>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":20868,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5742,"size_tokens":null},"client/src/lib/payment-types.ts":{"content":"// Payment type definitions for Nigerian and diaspora users\n\nexport interface PaymentTypeOption {\n  value: string;\n  label: string;\n  description: string;\n  icon: string;\n  countries: string[]; // Which countries this payment method is popular in\n  requiresAccount?: boolean; // Whether this payment method needs account details\n}\n\nexport const PAYMENT_TYPES: PaymentTypeOption[] = [\n  // Nigerian payment methods\n  {\n    value: \"bank_transfer\",\n    label: \"Bank Transfer\",\n    description: \"Transfer to Nigerian bank account\",\n    icon: \"🏦\",\n    countries: [\"NG\"],\n    requiresAccount: true,\n  },\n  {\n    value: \"mobile_money\",\n    label: \"Mobile Money\",\n    description: \"PalmPay, Opay, Moniepoint transfers\",\n    icon: \"📱\",\n    countries: [\"NG\"],\n    requiresAccount: true,\n  },\n  // US-based payment methods for diaspora\n  {\n    value: \"zelle\",\n    label: \"Zelle\",\n    description: \"Quick transfers with phone or email\",\n    icon: \"⚡\",\n    countries: [\"US\"],\n    requiresAccount: true,\n  },\n  {\n    value: \"cashapp\",\n    label: \"Cash App\",\n    description: \"Send money using $cashtag\",\n    icon: \"💰\",\n    countries: [\"US\"],\n    requiresAccount: true,\n  },\n  {\n    value: \"venmo\",\n    label: \"Venmo\",\n    description: \"Social payments with @username\",\n    icon: \"💙\",\n    countries: [\"US\"],\n    requiresAccount: true,\n  },\n  {\n    value: \"paypal\",\n    label: \"PayPal\",\n    description: \"Send money via email address\",\n    icon: \"🌐\",\n    countries: [\"US\", \"GLOBAL\"],\n    requiresAccount: true,\n  },\n  // International options\n  {\n    value: \"wire_transfer\",\n    label: \"Wire Transfer\",\n    description: \"International bank wire transfer\",\n    icon: \"🌍\",\n    countries: [\"GLOBAL\"],\n    requiresAccount: true,\n  },\n  {\n    value: \"crypto\",\n    label: \"Cryptocurrency\",\n    description: \"Bitcoin, USDT, or other digital currencies\",\n    icon: \"₿\",\n    countries: [\"GLOBAL\"],\n    requiresAccount: true,\n  },\n  // Cash options\n  {\n    value: \"cash\",\n    label: \"Cash\",\n    description: \"Physical cash payment\",\n    icon: \"💵\",\n    countries: [\"NG\", \"US\", \"GLOBAL\"],\n    requiresAccount: false,\n  }\n];\n\nexport const getPaymentTypeLabel = (value: string): string => {\n  const paymentType = PAYMENT_TYPES.find(type => type.value === value);\n  return paymentType ? `${paymentType.icon} ${paymentType.label}` : value;\n};\n\nexport const getPaymentTypesByCountry = (country: string): PaymentTypeOption[] => {\n  return PAYMENT_TYPES.filter(type => \n    type.countries.includes(country) || type.countries.includes(\"GLOBAL\")\n  );\n};\n\n// Default payment types for different user contexts\nexport const getDefaultPaymentTypes = (): string[] => {\n  // Return most common payment types for Nigerian and diaspora users\n  return [\"bank_transfer\", \"mobile_money\", \"zelle\", \"cashapp\", \"paypal\"];\n};","path":null,"size_bytes":2798,"size_tokens":null},"client/src/pages/my-contributions.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Navigation } from \"@/components/navigation\";\nimport {\n  History,\n  Search,\n  Filter,\n  CheckCircle,\n  Clock,\n  XCircle,\n  Eye,\n  Calendar,\n  CreditCard,\n  TrendingUp,\n  X,\n  Users,\n  FileText,\n  Image,\n} from \"lucide-react\";\nimport { getCurrentUser } from \"@/lib/auth\";\nimport { formatNaira } from \"@/lib/currency\";\nimport { Link } from \"wouter\";\nimport { ContributionWithDetails, MemberWithContributions } from \"@shared/schema\";\n\nexport default function MyContributions() {\n  const user = getCurrentUser();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState<string>(\"all\");\n  const [selectedContribution, setSelectedContribution] = useState<ContributionWithDetails | null>(null);\n\n  // Fetch user's contributions\n  const { data: contributions = [], isLoading } = useQuery<ContributionWithDetails[]>({\n    queryKey: [\"/api/contributions\", \"user\", user?.id],\n    enabled: !!user,\n  });\n\n  // Fetch user's stats\n  const { data: userStats } = useQuery<MemberWithContributions>({\n    queryKey: [\"/api/stats\", \"user\", user?.id],\n    enabled: !!user,\n  });\n\n  // Filter contributions based on search and status\n  const filteredContributions = contributions.filter((contribution) => {\n    const matchesSearch =\n      contribution.groupName\n        ?.toLowerCase()\n        .includes(searchTerm.toLowerCase()) ||\n      contribution.projectName\n        ?.toLowerCase()\n        .includes(searchTerm.toLowerCase()) ||\n      contribution.transactionRef?.toLowerCase().includes(searchTerm.toLowerCase());\n\n    const matchesStatus =\n      statusFilter === \"all\" || contribution.status === statusFilter;\n\n    return matchesSearch && matchesStatus;\n  });\n\n  // Group contributions by status for summary\n  const contributionSummary = {\n    confirmed: contributions.filter((c) => c.status === \"confirmed\").length,\n    pending: contributions.filter((c) => c.status === \"pending\").length,\n    rejected: contributions.filter((c) => c.status === \"rejected\").length,\n    total: contributions.length,\n  };\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case \"confirmed\":\n        return <CheckCircle className=\"h-5 w-5 text-green-600\" />;\n      case \"pending\":\n        return <Clock className=\"h-5 w-5 text-orange-600\" />;\n      case \"rejected\":\n        return <XCircle className=\"h-5 w-5 text-red-600\" />;\n      default:\n        return <Clock className=\"h-5 w-5 text-gray-600\" />;\n    }\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case \"confirmed\":\n        return \"bg-green-100 text-green-800 border-green-200\";\n      case \"pending\":\n        return \"bg-orange-100 text-orange-800 border-orange-200\";\n      case \"rejected\":\n        return \"bg-red-100 text-red-800 border-red-200\";\n      default:\n        return \"bg-gray-100 text-gray-800 border-gray-200\";\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <Navigation />\n        <div className=\"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\n          <div className=\"animate-pulse space-y-6\">\n            <div className=\"h-32 bg-gray-200 rounded-xl\"></div>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n              {[...Array(3)].map((_, i) => (\n                <div key={i} className=\"h-24 bg-gray-200 rounded-xl\"></div>\n              ))}\n            </div>\n            <div className=\"h-96 bg-gray-200 rounded-xl\"></div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 pb-20 sm:pb-0\">\n      <Navigation />\n\n      <div className=\"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\n        {/* Header */}\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">\n            My Contributions\n          </h1>\n          <p className=\"text-gray-600\">\n            Track your payment history and status across all groups.\n          </p>\n        </div>\n\n        {/* Summary Stats */}\n        {/* <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8\">\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">\n                    Total Contributed\n                  </p>\n                  <p className=\"text-2xl font-bold text-nigerian-green\">\n                    {formatNaira(userStats.totalContributed || 0)}\n                  </p>\n                  <p className=\"text-xs text-green-600\">All groups</p>\n                </div>\n                <div className=\"w-12 h-12 bg-green-50 rounded-full flex items-center justify-center\">\n                  <TrendingUp className=\"text-nigerian-green h-6 w-6\" />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">Confirmed</p>\n                  <p className=\"text-2xl font-bold text-green-600\">\n                    {contributionSummary.confirmed}\n                  </p>\n                  <p className=\"text-xs text-green-600\">Approved payments</p>\n                </div>\n                <div className=\"w-12 h-12 bg-green-50 rounded-full flex items-center justify-center\">\n                  <CheckCircle className=\"text-green-500 h-6 w-6\" />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">Pending</p>\n                  <p className=\"text-2xl font-bold text-orange-600\">\n                    {contributionSummary.pending}\n                  </p>\n                  <p className=\"text-xs text-orange-600\">Awaiting approval</p>\n                </div>\n                <div className=\"w-12 h-12 bg-orange-50 rounded-full flex items-center justify-center\">\n                  <Clock className=\"text-orange-500 h-6 w-6\" />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">\n                    Total Payments\n                  </p>\n                  <p className=\"text-2xl font-bold text-gray-900\">\n                    {contributionSummary.total}\n                  </p>\n                  <p className=\"text-xs text-gray-600\">All time</p>\n                </div>\n                <div className=\"w-12 h-12 bg-gray-50 rounded-full flex items-center justify-center\">\n                  <History className=\"text-gray-500 h-6 w-6\" />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div> */}\n\n        {/* Filters and Search */}\n        <Card className=\"mb-6\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4\">\n              <div className=\"flex-1\">\n                <div className=\"relative\">\n                  <Search className=\"absolute left-3 top-3 h-4 w-4 text-gray-400\" />\n                  <Input\n                    placeholder=\"Search by group, purse, or reference...\"\n                    value={searchTerm}\n                    onChange={(e) => setSearchTerm(e.target.value)}\n                    className=\"pl-10\"\n                    data-testid=\"search-contributions\"\n                  />\n                </div>\n              </div>\n              <div className=\"sm:w-48\">\n                <Select value={statusFilter} onValueChange={setStatusFilter}>\n                  <SelectTrigger>\n                    <Filter className=\"h-4 w-4 mr-2\" />\n                    <SelectValue placeholder=\"Filter by status\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">All Status</SelectItem>\n                    <SelectItem value=\"confirmed\">Confirmed</SelectItem>\n                    <SelectItem value=\"pending\">Pending</SelectItem>\n                    <SelectItem value=\"rejected\">Rejected</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Contributions List */}\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center justify-between\">\n              <CardTitle className=\"flex items-center\">\n                <History className=\"h-5 w-5 mr-2 text-nigerian-green\" />\n                Payment History\n              </CardTitle>\n              <Link href=\"/submit-proof\">\n                <Button className=\"bg-nigerian-green hover:bg-forest-green\">\n                  <CreditCard className=\"h-4 w-4 mr-2\" />\n                  Submit Proof\n                </Button>\n              </Link>\n            </div>\n          </CardHeader>\n          <CardContent>\n            {filteredContributions.length === 0 ? (\n              <div className=\"text-center py-12\">\n                {contributions.length === 0 ? (\n                  <>\n                    <CreditCard className=\"h-16 w-16 text-gray-400 mx-auto mb-4\" />\n                    <h3 className=\"text-xl font-medium text-gray-900 mb-2\">\n                      No Contributions Yet\n                    </h3>\n                    <p className=\"text-gray-600 mb-6\">\n                      You haven't made any contributions yet. Start by making\n                      your first payment.\n                    </p>\n                    <Link href=\"/submit-proof\">\n                      <Button className=\"bg-nigerian-green hover:bg-forest-green\">\n                        <CreditCard className=\"h-4 w-4 mr-2\" />\n                        Submit Your First Proof\n                      </Button>\n                    </Link>\n                  </>\n                ) : (\n                  <>\n                    <Search className=\"h-16 w-16 text-gray-400 mx-auto mb-4\" />\n                    <h3 className=\"text-xl font-medium text-gray-900 mb-2\">\n                      No Results Found\n                    </h3>\n                    <p className=\"text-gray-600\">\n                      No contributions match your current search and filter\n                      criteria.\n                    </p>\n                    <Button\n                      variant=\"outline\"\n                      onClick={() => {\n                        setSearchTerm(\"\");\n                        setStatusFilter(\"all\");\n                      }}\n                      className=\"mt-4\"\n                    >\n                      Clear Filters\n                    </Button>\n                  </>\n                )}\n              </div>\n            ) : (\n              <div className=\"space-y-3\">\n                {filteredContributions.map((contribution) => (\n                  <div\n                    key={contribution.id}\n                    className={`p-4 border rounded-xl hover:bg-gray-50 cursor-pointer transition-colors ${\n                      contribution.status === \"pending\"\n                        ? \"border-orange-200 bg-orange-50/30\"\n                        : contribution.status === \"confirmed\"\n                          ? \"border-green-200 bg-green-50/30\"\n                          : contribution.status === \"rejected\"\n                            ? \"border-red-200 bg-red-50/30\"\n                            : \"border-gray-200\"\n                    }`}\n                    onClick={() => setSelectedContribution(contribution)}\n                    data-testid={`contribution-${contribution.id}`}\n                  >\n                    {/* Top row: Icon, Group name, and Amount */}\n                    <div className=\"flex items-start gap-3\">\n                      <div className=\"flex-shrink-0 mt-0.5\">\n                        {getStatusIcon(contribution.status)}\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-start justify-between gap-2\">\n                          <div className=\"min-w-0 flex-1\">\n                            <h4 className=\"font-semibold text-gray-900 truncate text-base\">\n                              {contribution.groupName}\n                            </h4>\n                            {contribution.projectName && (\n                              <p className=\"text-sm text-gray-500 truncate\">\n                                {contribution.projectName}\n                              </p>\n                            )}\n                          </div>\n                          <div className=\"text-right flex-shrink-0\">\n                            <p className=\"text-lg font-bold text-gray-900 whitespace-nowrap\">\n                              {formatNaira(Number(contribution.amount))}\n                            </p>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n\n                    {/* Bottom row: Date, Status, Details */}\n                    <div className=\"flex items-center justify-between mt-3 pt-3 border-t border-gray-100\">\n                      <div className=\"flex items-center gap-3 text-sm\">\n                        <div className=\"flex items-center text-gray-500\">\n                          <Calendar className=\"h-3.5 w-3.5 mr-1\" />\n                          {new Date(contribution.createdAt).toLocaleDateString(\"en-NG\", {\n                            day: \"numeric\",\n                            month: \"short\"\n                          })}\n                        </div>\n                        <Badge\n                          className={`text-xs ${getStatusColor(contribution.status)}`}\n                        >\n                          {contribution.status.toUpperCase()}\n                        </Badge>\n                      </div>\n                      <Button variant=\"ghost\" size=\"sm\" className=\"h-8 px-3 text-sm\">\n                        <Eye className=\"h-3.5 w-3.5 mr-1\" />\n                        Details\n                      </Button>\n                    </div>\n\n                    {contribution.paymentNotes && (\n                      <div className=\"mt-3 pt-3 border-t border-gray-200\">\n                        <p className=\"text-sm text-gray-600\">\n                          <span className=\"font-medium\">Notes:</span>{\" \"}\n                          {contribution.paymentNotes}\n                        </p>\n                      </div>\n                    )}\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Contribution Details Dialog */}\n      <Dialog open={!!selectedContribution} onOpenChange={() => setSelectedContribution(null)}>\n        <DialogContent className=\"max-w-md mx-4 rounded-2xl\">\n          <DialogHeader>\n            <DialogTitle className=\"text-xl font-bold\">Payment Details</DialogTitle>\n          </DialogHeader>\n          \n          {selectedContribution && (\n            <div className=\"space-y-4\">\n              {/* Status Badge */}\n              <div className=\"flex items-center justify-center\">\n                <Badge className={`text-sm px-4 py-1.5 ${getStatusColor(selectedContribution.status)}`}>\n                  {getStatusIcon(selectedContribution.status)}\n                  <span className=\"ml-2\">{selectedContribution.status.toUpperCase()}</span>\n                </Badge>\n              </div>\n\n              {/* Amount */}\n              <div className=\"text-center py-4 bg-gray-50 rounded-xl\">\n                <p className=\"text-3xl font-bold text-gray-900\">\n                  {formatNaira(Number(selectedContribution.amount))}\n                </p>\n              </div>\n\n              {/* Details List */}\n              <div className=\"space-y-3\">\n                <div className=\"flex items-start gap-3 p-3 bg-gray-50 rounded-lg\">\n                  <Users className=\"h-5 w-5 text-gray-500 mt-0.5\" />\n                  <div>\n                    <p className=\"text-sm text-gray-500\">Group</p>\n                    <p className=\"font-medium text-gray-900\">{selectedContribution.groupName}</p>\n                  </div>\n                </div>\n\n                {selectedContribution.projectName && (\n                  <div className=\"flex items-start gap-3 p-3 bg-gray-50 rounded-lg\">\n                    <FileText className=\"h-5 w-5 text-gray-500 mt-0.5\" />\n                    <div>\n                      <p className=\"text-sm text-gray-500\">Project</p>\n                      <p className=\"font-medium text-gray-900\">{selectedContribution.projectName}</p>\n                    </div>\n                  </div>\n                )}\n\n                <div className=\"flex items-start gap-3 p-3 bg-gray-50 rounded-lg\">\n                  <Calendar className=\"h-5 w-5 text-gray-500 mt-0.5\" />\n                  <div>\n                    <p className=\"text-sm text-gray-500\">Date Submitted</p>\n                    <p className=\"font-medium text-gray-900\">\n                      {new Date(selectedContribution.createdAt).toLocaleDateString(\"en-NG\", {\n                        weekday: \"long\",\n                        day: \"numeric\",\n                        month: \"long\",\n                        year: \"numeric\"\n                      })}\n                    </p>\n                  </div>\n                </div>\n\n                {selectedContribution.transactionRef && (\n                  <div className=\"flex items-start gap-3 p-3 bg-gray-50 rounded-lg\">\n                    <CreditCard className=\"h-5 w-5 text-gray-500 mt-0.5\" />\n                    <div>\n                      <p className=\"text-sm text-gray-500\">Reference</p>\n                      <p className=\"font-medium text-gray-900 break-all\">{selectedContribution.transactionRef}</p>\n                    </div>\n                  </div>\n                )}\n\n                {selectedContribution.paymentNotes && (\n                  <div className=\"flex items-start gap-3 p-3 bg-gray-50 rounded-lg\">\n                    <FileText className=\"h-5 w-5 text-gray-500 mt-0.5\" />\n                    <div>\n                      <p className=\"text-sm text-gray-500\">Notes</p>\n                      <p className=\"font-medium text-gray-900\">{selectedContribution.paymentNotes}</p>\n                    </div>\n                  </div>\n                )}\n\n                {selectedContribution.proofOfPayment && (\n                  <div className=\"flex items-start gap-3 p-3 bg-gray-50 rounded-lg\">\n                    <Image className=\"h-5 w-5 text-gray-500 mt-0.5\" />\n                    <div className=\"flex-1\">\n                      <p className=\"text-sm text-gray-500 mb-2\">Payment Proof</p>\n                      <img \n                        src={selectedContribution.proofOfPayment} \n                        alt=\"Payment proof\" \n                        className=\"w-full rounded-lg border\"\n                      />\n                    </div>\n                  </div>\n                )}\n              </div>\n\n              {/* Close Button */}\n              <Button \n                onClick={() => setSelectedContribution(null)}\n                className=\"w-full mt-4\"\n                variant=\"outline\"\n              >\n                Close\n              </Button>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":20182,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1419,"size_tokens":null},"client/src/components/project-card.tsx":{"content":"import { Project, ProjectWithStats } from \"@shared/schema\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Target, Calendar, TrendingUp, ChevronRight, CreditCard } from \"lucide-react\";\nimport { formatNaira } from \"@/lib/currency\";\nimport { useLocation } from \"wouter\";\n\ninterface ProjectCardProps {\n  project: Project | ProjectWithStats;\n  isAdmin?: boolean;\n  onManage?: (project: Project) => void;\n  onContribute?: (project: Project) => void;\n  showViewContributors?: boolean;\n}\n\nexport function ProjectCard({ \n  project, \n  isAdmin = false, \n  onManage, \n  onContribute,\n  showViewContributors = true\n}: ProjectCardProps) {\n  const [, setLocation] = useLocation();\n  \n  const hasTarget = project.targetAmount && parseFloat(project.targetAmount) > 0;\n  const progress = hasTarget \n    ? Math.min(Math.round((parseFloat(project.collectedAmount) / parseFloat(project.targetAmount!)) * 100), 100)\n    : 0;\n  \n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case \"completed\":\n        return \"bg-green-100 text-green-800\";\n      case \"active\":\n        return \"bg-blue-100 text-blue-800\";\n      case \"paused\":\n        return \"bg-orange-100 text-orange-800\";\n      default:\n        return \"bg-gray-100 text-gray-800\";\n    }\n  };\n\n  const getProjectTypeLabel = (type: string | undefined) => {\n    switch (type) {\n      case \"monthly\": return \"Monthly Dues\";\n      case \"yearly\": return \"Yearly Dues\";\n      case \"event\": return \"Event\";\n      case \"emergency\": return \"Emergency\";\n      default: return \"Target Goal\";\n    }\n  };\n\n  const handleCardClick = () => {\n    setLocation(`/project/${project.id}`);\n  };\n\n  return (\n    <div \n      className=\"bg-white rounded-2xl p-5 border border-gray-100 shadow-sm hover:shadow-md transition-all cursor-pointer active:bg-gray-50\"\n      onClick={handleCardClick}\n      data-testid={`project-card-${project.id}`}\n    >\n      <div className=\"flex items-start justify-between mb-3\">\n        <div className=\"flex-1\">\n          <div className=\"flex items-center gap-2 mb-1\">\n            <h4 className=\"font-bold text-gray-900\">{project.name}</h4>\n            <Badge className={`${getStatusColor(project.status)} text-xs`}>\n              {project.status}\n            </Badge>\n          </div>\n          <p className=\"text-sm text-gray-500\">{getProjectTypeLabel(project.projectType)}</p>\n        </div>\n        <ChevronRight className=\"h-5 w-5 text-gray-300 shrink-0\" />\n      </div>\n\n      {/* Stats */}\n      <div className=\"grid grid-cols-2 gap-3 mb-4\">\n        {hasTarget ? (\n          <>\n            <div className=\"bg-gray-50 rounded-xl p-3\">\n              <p className=\"text-xs text-gray-500 flex items-center gap-1\">\n                <Target className=\"h-3 w-3\" />\n                Target\n              </p>\n              <p className=\"font-bold text-gray-900\">{formatNaira(project.targetAmount!)}</p>\n            </div>\n            <div className=\"bg-green-50 rounded-xl p-3\">\n              <p className=\"text-xs text-gray-500\">Collected</p>\n              <p className=\"font-bold text-primary\">{formatNaira(project.collectedAmount)}</p>\n            </div>\n          </>\n        ) : (\n          <div className=\"col-span-2 bg-green-50 rounded-xl p-3\">\n            <p className=\"text-xs text-gray-500\">Total Collected</p>\n            <p className=\"font-bold text-xl text-primary\">{formatNaira(project.collectedAmount)}</p>\n          </div>\n        )}\n      </div>\n\n      {/* Progress bar - only for target-based projects */}\n      {hasTarget && (\n        <div className=\"mb-4\">\n          <div className=\"flex justify-between items-center mb-1\">\n            <span className=\"text-xs text-gray-500\">Progress</span>\n            <span className=\"text-xs font-medium text-primary\">{progress}%</span>\n          </div>\n          <Progress value={progress} className=\"h-2\" />\n        </div>\n      )}\n\n      {/* Deadline */}\n      {project.deadline && (\n        <div className=\"flex items-center gap-2 text-sm text-gray-500 mb-4\">\n          <Calendar className=\"h-4 w-4\" />\n          <span>Due: {new Date(project.deadline).toLocaleDateString(\"en-NG\", { \n            day: \"numeric\", \n            month: \"short\", \n            year: \"numeric\" \n          })}</span>\n        </div>\n      )}\n\n      {/* Actions */}\n      <div className=\"pt-3 border-t border-gray-100 flex gap-2\">\n        <button\n          onClick={(e) => {\n            e.stopPropagation();\n            onContribute?.(project);\n          }}\n          className=\"flex-1 bg-primary hover:bg-primary/90 text-white font-medium py-2.5 rounded-xl flex items-center justify-center gap-2 transition-colors\"\n          data-testid={`button-contribute-${project.id}`}\n        >\n          <CreditCard className=\"h-4 w-4\" />\n          Submit Proof\n        </button>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":4858,"size_tokens":null},"client/src/pages/group-registration.tsx":{"content":"import { useState } from \"react\";\nimport { useRoute, useLocation, useParams } from \"wouter\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Users,\n  Calendar,\n  Target,\n  CheckCircle,\n  AlertCircle,\n  Phone,\n  MessageSquare,\n  ArrowLeft,\n} from \"lucide-react\";\nimport { formatNaira, calculateProgress } from \"@/lib/currency\";\nimport { getCurrentUser } from \"@/lib/auth\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { type User } from \"@shared/schema\";\n\nconst REDIRECT_KEY = \"kontrib_redirectTo\";\n\n// Form validation schemas\nconst registrationFormSchema = z.object({\n  fullName: z.string().min(2, \"Full name is required\"),\n  username: z\n    .string()\n    .min(3, \"Username must be at least 3 characters\")\n    .max(20, \"Username must be less than 20 characters\"),\n  phoneNumber: z\n    .string()\n    .regex(\n      /^\\+?[1-9]\\d{1,14}$/,\n      \"Please enter a valid phone number with country code (e.g., +234, +1, +44)\",\n    ),\n});\n\nconst otpFormSchema = z.object({\n  otp: z.string().length(6, \"OTP must be 6 digits\"),\n});\n\ntype RegistrationFormData = z.infer<typeof registrationFormSchema>;\ntype OtpFormData = z.infer<typeof otpFormSchema>;\n\nexport default function GroupRegistration() {\n  const [match, params] = useRoute(\"/register/:link\");\n  const urlParams = useParams();\n  const registrationLink = params?.link || urlParams.link;\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const user = getCurrentUser();\n  const [step, setStep] = useState<\n    \"group-info\" | \"registration\" | \"otp-verification\" | \"success\"\n  >(\"group-info\");\n  const [otpData, setOtpData] = useState<{\n    phoneNumber: string;\n    expiresAt: string;\n  } | null>(null);\n  const [newUser, setNewUser] = useState<User | null>(null);\n\n  const {\n    data: groupData,\n    isLoading,\n    error,\n  } = useQuery({\n    queryKey: [\"/api/groups/registration\", registrationLink],\n    enabled: !!registrationLink,\n  });\n\n  const group = groupData?.group;\n\n  const { data: purses = [] } = useQuery({\n    queryKey: [\"/api/groups\", group?.id, \"purses\"],\n    enabled: !!group,\n  });\n\n  const registrationForm = useForm<RegistrationFormData>({\n    resolver: zodResolver(registrationFormSchema),\n    defaultValues: {\n      fullName: \"\",\n      username: \"\",\n      phoneNumber: \"\",\n    },\n  });\n\n  const otpForm = useForm<OtpFormData>({\n    resolver: zodResolver(otpFormSchema),\n    defaultValues: {\n      otp: \"\",\n    },\n  });\n\n  const sendOtpMutation = useMutation({\n    mutationFn: async (phoneNumber: string) => {\n      const response = await apiRequest(\"POST\", \"/api/auth/send-otp\", {\n        phoneNumber,\n      });\n      return response.json();\n    },\n    onSuccess: (data, phoneNumber) => {\n      setOtpData({ phoneNumber, expiresAt: data.expiresAt });\n      setStep(\"otp-verification\");\n      toast({\n        title: \"OTP Sent!\",\n        description: data.fallback\n          ? `Verification code sent (development mode). Check console for OTP.`\n          : `Verification code sent to ${phoneNumber} via WhatsApp.`,\n      });\n\n      // For development, show the OTP in console\n      if (data.developmentOtp) {\n        console.log(\"Development OTP:\", data.developmentOtp);\n        toast({\n          title: \"Development Mode\",\n          description: `OTP: ${data.developmentOtp} (Check console for details)`,\n          variant: \"default\",\n        });\n      }\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Failed to Send OTP\",\n        description: error.message || \"Please try again later.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const registerMutation = useMutation({\n    mutationFn: async (data: RegistrationFormData & { otp: string }) => {\n      if (!group) throw new Error(\"Group not found\");\n\n      const response = await apiRequest(\n        \"POST\",\n        `/api/groups/${group.id}/register-with-otp`,\n        data,\n      );\n      return response.json();\n    },\n    onSuccess: (data) => {\n      setNewUser(data.user);\n      setStep(\"success\");\n      toast({\n        title: \"Registration Successful!\",\n        description: `Welcome to ${group?.name}! You can now make contributions.`,\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Registration Failed\",\n        description: error.message || \"Please try again later.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const joinGroupMutation = useMutation({\n    mutationFn: async () => {\n      if (!group || !user) throw new Error(\"Missing group or user data\");\n\n      const response = await apiRequest(\n        \"POST\",\n        `/api/groups/${group.id}/join`,\n        {\n          userId: user.id,\n        },\n      );\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({\n        queryKey: [\"/api/groups\", \"user\", user?.id],\n      });\n      toast({\n        title: \"Successfully Joined!\",\n        description: `You are now a member of ${group?.name}`,\n      });\n      setLocation(\"/member\");\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Failed to Join Group\",\n        description: error.message || \"Please try again later.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleJoinGroup = () => {\n    if (!user) {\n      setStep(\"registration\");\n      return;\n    }\n\n    joinGroupMutation.mutate();\n  };\n\n  const handleRegistrationSubmit = (data: RegistrationFormData) => {\n    sendOtpMutation.mutate(data.phoneNumber);\n  };\n\n  const handleOtpSubmit = (data: OtpFormData) => {\n    const registrationData = registrationForm.getValues();\n    registerMutation.mutate({\n      ...registrationData,\n      otp: data.otp,\n    });\n  };\n\n  const handleLoginRedirect = () => {\n    localStorage.setItem(REDIRECT_KEY, window.location.pathname);\n    setLocation(\"/\");\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto mb-4\"></div>\n          <p className=\"text-gray-600 dark:text-gray-300\">\n            Loading group details...\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  if (error || !group) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center p-4\">\n        <Card className=\"w-full max-w-md\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center space-x-2 text-red-600 dark:text-red-400\">\n              <AlertCircle className=\"h-6 w-6\" />\n              <span>Group Not Found</span>\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-gray-600 dark:text-gray-300 mb-4\">\n              The group you're looking for doesn't exist or the link has\n              expired.\n            </p>\n            <Button\n              onClick={() => setLocation(\"/\")}\n              className=\"w-full\"\n              data-testid=\"go-home\"\n            >\n              Go Home\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  const renderGroupInfo = () => (\n    <div className=\"space-y-6\">\n      {/* Group Header */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"w-12 h-12 bg-green-600 rounded-lg flex items-center justify-center\">\n              <Users className=\"text-white h-6 w-6\" />\n            </div>\n            <div>\n              <CardTitle className=\"text-2xl text-green-600 dark:text-green-400\">\n                {group.name}\n              </CardTitle>\n              <p className=\"text-gray-600 dark:text-gray-300\">\n                {group.description}\n              </p>\n            </div>\n          </div>\n        </CardHeader>\n      </Card>\n\n      {/* Purses List */}\n      {purses.length > 0 && (\n        <div className=\"space-y-4\">\n          <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n            Available Purses\n          </h3>\n          {purses.map((purse) => (\n            <Card key={purse.id} className=\"p-4\">\n              <div className=\"space-y-3\">\n                <div className=\"flex justify-between items-start\">\n                  <h4 className=\"font-medium text-gray-900 dark:text-white\">\n                    {purse.name}\n                  </h4>\n                  <Badge variant=\"outline\">\n                    {Math.round(\n                      (Number(purse.collectedAmount) /\n                        Number(purse.targetAmount)) *\n                        100,\n                    )}\n                    %\n                  </Badge>\n                </div>\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <p className=\"text-sm text-gray-500\">Target</p>\n                    <p className=\"font-semibold\">\n                      {formatNaira(Number(purse.targetAmount))}\n                    </p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-gray-500\">Deadline</p>\n                    <p className=\"font-semibold\">\n                      {new Date(purse.deadline || \"\").toLocaleDateString()}\n                    </p>\n                  </div>\n                </div>\n                <Progress\n                  value={Math.round(\n                    (Number(purse.collectedAmount) /\n                      Number(purse.targetAmount)) *\n                      100,\n                  )}\n                  className=\"h-2\"\n                />\n              </div>\n            </Card>\n          ))}\n        </div>\n      )}\n\n      {/* Action Buttons */}\n      <div className=\"space-y-3\">\n        <Button\n          onClick={handleJoinGroup}\n          className=\"w-full bg-green-600 hover:bg-green-700 text-white\"\n          data-testid=\"join-group\"\n        >\n          <Users className=\"h-4 w-4 mr-2\" />\n          Join Group\n        </Button>\n        {user && (\n          <Button\n            variant=\"outline\"\n            onClick={handleLoginRedirect}\n            className=\"w-full\"\n            data-testid=\"login-existing\"\n          >\n            Already have an account? Login\n          </Button>\n        )}\n      </div>\n    </div>\n  );\n\n  const renderRegistration = () => (\n    <div className=\"space-y-6\">\n      <div className=\"text-center\">\n        <Button\n          variant=\"ghost\"\n          onClick={() => setStep(\"group-info\")}\n          className=\"mb-4\"\n          data-testid=\"back-to-group\"\n        >\n          <ArrowLeft className=\"h-4 w-4 mr-2\" />\n          Back to Group Info\n        </Button>\n        <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n          Join {group.name}\n        </h2>\n        <p className=\"text-gray-600 dark:text-gray-300\">\n          Create your account to join this group\n        </p>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Your Information</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <Form {...registrationForm}>\n            <form\n              onSubmit={registrationForm.handleSubmit(handleRegistrationSubmit)}\n              className=\"space-y-4\"\n            >\n              <FormField\n                control={registrationForm.control}\n                name=\"fullName\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Full Name</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"Enter your full name\"\n                        {...field}\n                        data-testid=\"input-fullname\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={registrationForm.control}\n                name=\"username\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Username (WhatsApp Group Nickname)</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"Your nickname in the WhatsApp group\"\n                        {...field}\n                        data-testid=\"input-username\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                    <p className=\"text-sm text-gray-500\">\n                      Use the same name you have in the WhatsApp group\n                    </p>\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={registrationForm.control}\n                name=\"phoneNumber\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>WhatsApp Phone Number</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"e.g., +2348012345678, +1234567890, +441234567890\"\n                        {...field}\n                        data-testid=\"input-phone\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                    <p className=\"text-sm text-gray-500\">\n                      We'll send an OTP to this number via WhatsApp for\n                      verification\n                    </p>\n                  </FormItem>\n                )}\n              />\n\n              <Button\n                type=\"submit\"\n                className=\"w-full bg-green-600 hover:bg-green-700\"\n                disabled={sendOtpMutation.isPending}\n                data-testid=\"send-otp\"\n              >\n                {sendOtpMutation.isPending ? (\n                  \"Sending OTP...\"\n                ) : (\n                  <>\n                    <MessageSquare className=\"h-4 w-4 mr-2\" />\n                    Send OTP via WhatsApp\n                  </>\n                )}\n              </Button>\n            </form>\n          </Form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n\n  const renderOtpVerification = () => (\n    <div className=\"space-y-6\">\n      <div className=\"text-center\">\n        <Button\n          variant=\"ghost\"\n          onClick={() => setStep(\"registration\")}\n          className=\"mb-4\"\n          data-testid=\"back-to-registration\"\n        >\n          <ArrowLeft className=\"h-4 w-4 mr-2\" />\n          Back to Registration\n        </Button>\n        <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n          Verify Your Phone\n        </h2>\n        <p className=\"text-gray-600 dark:text-gray-300\">\n          Enter the 6-digit code sent to {otpData?.phoneNumber}\n        </p>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Phone className=\"h-5 w-5\" />\n            OTP Verification\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <Form {...otpForm}>\n            <form\n              onSubmit={otpForm.handleSubmit(handleOtpSubmit)}\n              className=\"space-y-4\"\n            >\n              <FormField\n                control={otpForm.control}\n                name=\"otp\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Verification Code</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"Enter 6-digit code\"\n                        {...field}\n                        maxLength={6}\n                        className=\"text-center text-2xl tracking-widest\"\n                        data-testid=\"input-otp\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <Button\n                type=\"submit\"\n                className=\"w-full bg-green-600 hover:bg-green-700\"\n                disabled={registerMutation.isPending}\n                data-testid=\"verify-otp\"\n              >\n                {registerMutation.isPending\n                  ? \"Verifying...\"\n                  : \"Verify & Join Group\"}\n              </Button>\n            </form>\n          </Form>\n\n          <div className=\"mt-4 text-center\">\n            <Button\n              variant=\"link\"\n              onClick={() => sendOtpMutation.mutate(otpData?.phoneNumber || \"\")}\n              disabled={sendOtpMutation.isPending}\n              data-testid=\"resend-otp\"\n            >\n              Resend Code\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n\n  const renderSuccess = () => (\n    <div className=\"space-y-6\">\n      <div className=\"text-center\">\n        <div className=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n          <CheckCircle className=\"h-8 w-8 text-green-600\" />\n        </div>\n        <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n          Welcome to {group.name}!\n        </h2>\n        <p className=\"text-gray-600 dark:text-gray-300\">\n          You've successfully joined the group and can now make contributions\n        </p>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Your Account</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-3\">\n            <div>\n              <Label className=\"text-sm text-gray-500\">Full Name</Label>\n              <p className=\"font-medium\">{newUser?.fullName}</p>\n            </div>\n            <div>\n              <Label className=\"text-sm text-gray-500\">\n                Username (WhatsApp Group Nickname)\n              </Label>\n              <p className=\"font-medium\">{newUser?.username}</p>\n            </div>\n            <div>\n              <Label className=\"text-sm text-gray-500\">\n                WhatsApp Phone Number\n              </Label>\n              <p className=\"font-medium\">{newUser?.phoneNumber}</p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <div className=\"space-y-3\">\n        <Button\n          onClick={() => setLocation(\"/member\")}\n          className=\"w-full bg-green-600 hover:bg-green-700\"\n          data-testid=\"go-to-dashboard\"\n        >\n          Go to Dashboard\n        </Button>\n        <Button\n          onClick={() => setLocation(\"/join-group\")}\n          variant=\"outline\"\n          className=\"w-full\"\n          data-testid=\"join-another-group\"\n        >\n          Join Another Group\n        </Button>\n      </div>\n    </div>\n  );\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 p-4\">\n      <div className=\"max-w-md mx-auto pt-8\">\n        {step === \"group-info\" && renderGroupInfo()}\n        {step === \"registration\" && renderRegistration()}\n        {step === \"otp-verification\" && renderOtpVerification()}\n        {step === \"success\" && renderSuccess()}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":19557,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { whatsappService } from \"./whatsapp-service\";\nimport { \n  insertUserSchema, insertGroupSchema, insertGroupMemberSchema,\n  insertProjectSchema, insertAccountabilityPartnerSchema, insertContributionSchema,\n  insertNotificationSchema, insertOtpVerificationSchema\n} from \"@shared/schema\";\nimport { z } from \"zod\";\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  \n  // Auth routes\n  app.post(\"/api/auth/register\", async (req, res) => {\n    try {\n      const userData = insertUserSchema.parse(req.body);\n      \n      // Check if username already exists\n      const existingUser = await storage.getUserByUsername(userData.username);\n      if (existingUser) {\n        return res.status(400).json({ message: \"Username already exists\" });\n      }\n      \n      const user = await storage.createUser(userData);\n      res.json({ user: { ...user, password: undefined } });\n    } catch (error) {\n      console.error(\"Registration error:\", error);\n      res.status(400).json({ message: \"Invalid user data\" });\n    }\n  });\n\n  app.post(\"/api/auth/login\", async (req, res) => {\n    try {\n      const { username, password } = req.body;\n      const user = await storage.getUserByUsername(username);\n      \n      if (!user || user.password !== password) {\n        return res.status(401).json({ message: \"Invalid credentials\" });\n      }\n      \n      res.json({ user: { ...user, password: undefined } });\n    } catch (error) {\n      console.error(\"Login error:\", error);\n      res.status(500).json({ message: \"Login failed\" });\n    }\n  });\n\n  // Instant login with phone number only - no OTP required\n  app.post(\"/api/auth/instant-login\", async (req, res) => {\n    try {\n      const { phoneNumber } = req.body;\n      \n      if (!phoneNumber || typeof phoneNumber !== 'string' || phoneNumber.length < 10) {\n        return res.status(400).json({ message: \"Please enter a valid phone number\" });\n      }\n      \n      // Normalize phone number (remove spaces, ensure + prefix for international)\n      let normalizedPhone = phoneNumber.replace(/\\s+/g, '');\n      if (!normalizedPhone.startsWith('+')) {\n        // Default to Nigerian country code if no prefix\n        normalizedPhone = '+234' + normalizedPhone.replace(/^0/, '');\n      }\n      \n      // Find or create user by phone number\n      const user = await storage.findOrCreateUserByPhone(normalizedPhone);\n      \n      res.json({ \n        user: { ...user, password: undefined },\n        isNewUser: !user.fullName, // If no fullName, they need to complete profile\n      });\n    } catch (error) {\n      console.error(\"Instant login error:\", error);\n      res.status(500).json({ message: \"Login failed. Please try again.\" });\n    }\n  });\n\n  // Update user profile (name, role) after instant login\n  app.post(\"/api/auth/update-profile\", async (req, res) => {\n    try {\n      const { userId, fullName, role } = req.body;\n      \n      if (!userId) {\n        return res.status(400).json({ message: \"User ID is required\" });\n      }\n      \n      if (fullName && (typeof fullName !== 'string' || fullName.length < 2)) {\n        return res.status(400).json({ message: \"Please enter your full name\" });\n      }\n      \n      // Validate role - only allow 'admin' or 'member'\n      const validRoles = ['admin', 'member'];\n      if (role && !validRoles.includes(role)) {\n        return res.status(400).json({ message: \"Invalid role\" });\n      }\n      \n      const user = await storage.updateUserProfile(userId, { fullName, role });\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      res.json({ user: { ...user, password: undefined } });\n    } catch (error) {\n      console.error(\"Update profile error:\", error);\n      res.status(500).json({ message: \"Failed to update profile\" });\n    }\n  });\n\n  // Group routes\n  app.get(\"/api/groups/admin/:adminId\", async (req, res) => {\n    try {\n      const { adminId } = req.params;\n      const groups = await storage.getGroupsByAdmin(adminId);\n      res.json(groups);\n    } catch (error) {\n      console.error(\"Get admin groups error:\", error);\n      res.status(500).json({ message: \"Failed to fetch groups\" });\n    }\n  });\n\n  app.get(\"/api/groups/user/:userId\", async (req, res) => {\n    try {\n      const { userId } = req.params;\n      const userGroups = await storage.getUserGroups(userId);\n      res.json(userGroups);\n    } catch (error) {\n      console.error(\"Get user groups error:\", error);\n      res.status(500).json({ message: \"Failed to fetch user groups\" });\n    }\n  });\n\n  app.get(\"/api/groups/all/:userId\", async (req, res) => {\n    try {\n      const { userId } = req.params;\n      const allGroups = await storage.getAllUserGroups(userId);\n      res.json(allGroups);\n    } catch (error) {\n      console.error(\"Get all user groups error:\", error);\n      res.status(500).json({ message: \"Failed to fetch groups\" });\n    }\n  });\n\n  app.get(\"/api/groups/registration/:link\", async (req, res) => {\n    try {\n      const { link } = req.params;\n      const { userId } = req.query; // Get userId from query parameter\n      const group = await storage.getGroupByRegistrationLink(link);\n      \n      if (!group) {\n        return res.status(404).json({ message: \"Group not found\" });\n      }\n\n      // Get projects for this group\n      const projects = await storage.getProjectsByGroup(group.id);\n      \n      // Get member count\n      const members = await storage.getGroupMembers(group.id);\n      \n      // Check if current user is already a member\n      let isMember = false;\n      if (userId && typeof userId === 'string') {\n        const membership = await storage.getGroupMember(group.id, userId);\n        isMember = !!membership;\n      }\n      \n      // Calculate totals across all projects\n      const totalTarget = projects.reduce((sum: number, project: any) => \n        sum + parseFloat(project.targetAmount || \"0\"), 0\n      ).toString();\n      \n      const totalCollected = projects.reduce((sum: number, project: any) => \n        sum + parseFloat(project.collectedAmount || \"0\"), 0\n      ).toString();\n      \n      const landingData = {\n        group,\n        projects: projects.map((project: any) => ({\n          id: project.id,\n          name: project.name,\n          targetAmount: project.targetAmount,\n          collectedAmount: project.collectedAmount,\n          deadline: project.deadline\n        })),\n        memberCount: members.length,\n        totalTarget,\n        totalCollected,\n        isMember\n      };\n      \n      res.json(landingData);\n    } catch (error) {\n      console.error(\"Get group by link error:\", error);\n      res.status(500).json({ message: \"Failed to fetch group\" });\n    }\n  });\n\n  app.get(\"/api/groups/slug/:slug\", async (req, res) => {\n    try {\n      const { slug } = req.params;\n      const { userId } = req.query; // Get userId from query parameter\n      let group = await storage.getGroupByCustomSlug(slug);\n      \n      // If not found by custom slug, try registration link as fallback\n      if (!group) {\n        group = await storage.getGroupByRegistrationLink(slug);\n      }\n      \n      if (!group) {\n        return res.status(404).json({ message: \"Group not found\" });\n      }\n\n      // Get projects for this group\n      const projects = await storage.getProjectsByGroup(group.id);\n      \n      // Get member count\n      const members = await storage.getGroupMembers(group.id);\n      \n      // Check if current user is already a member\n      let isMember = false;\n      if (userId && typeof userId === 'string') {\n        const membership = await storage.getGroupMember(group.id, userId);\n        isMember = !!membership;\n      }\n      \n      // Calculate totals across all projects\n      const totalTarget = projects.reduce((sum: number, project: any) => \n        sum + parseFloat(project.targetAmount || \"0\"), 0\n      ).toString();\n      \n      const totalCollected = projects.reduce((sum: number, project: any) => \n        sum + parseFloat(project.collectedAmount || \"0\"), 0\n      ).toString();\n      \n      const landingData = {\n        group,\n        projects: projects.map((project: any) => ({\n          id: project.id,\n          name: project.name,\n          targetAmount: project.targetAmount,\n          collectedAmount: project.collectedAmount,\n          deadline: project.deadline\n        })),\n        memberCount: members.length,\n        totalTarget,\n        totalCollected,\n        isMember\n      };\n      \n      res.json(landingData);\n    } catch (error) {\n      console.error(\"Get group by custom slug error:\", error);\n      res.status(500).json({ message: \"Failed to fetch group\" });\n    }\n  });\n\n  // New clean deep link format: /join/groupname/projectname\n  app.get(\"/api/groups/join/:groupSlug/:projectSlug\", async (req, res) => {\n    try {\n      const { groupSlug, projectSlug } = req.params;\n      const { userId } = req.query;\n      \n      // Find group by custom slug or registration link\n      let group = await storage.getGroupByCustomSlug(groupSlug);\n      if (!group) {\n        group = await storage.getGroupByRegistrationLink(groupSlug);\n      }\n      \n      if (!group) {\n        return res.status(404).json({ message: \"Group not found\" });\n      }\n\n      // Get projects for this group\n      const projects = await storage.getProjectsByGroup(group.id);\n      \n      // Find specific project by slug match\n      const targetProject = projects.find((project: any) => {\n        const slug = project.name\n          .toLowerCase()\n          .replace(/[^a-z0-9\\s-]/g, '')\n          .replace(/\\s+/g, '')\n          .slice(0, 50);\n        return slug === projectSlug;\n      });\n      \n      // Get member count\n      const members = await storage.getGroupMembers(group.id);\n      \n      // Check if current user is already a member\n      let isMember = false;\n      if (userId && typeof userId === 'string') {\n        const membership = await storage.getGroupMember(group.id, userId);\n        isMember = !!membership;\n      }\n      \n      // Calculate totals - if project found, use its data; otherwise use group totals\n      const projectsToShow = targetProject ? [targetProject] : projects;\n      const totalTarget = projectsToShow.reduce((sum: number, project: any) => \n        sum + parseFloat(project.targetAmount || \"0\"), 0\n      ).toString();\n      \n      const totalCollected = projectsToShow.reduce((sum: number, project: any) => \n        sum + parseFloat(project.collectedAmount || \"0\"), 0\n      ).toString();\n      \n      const landingData = {\n        group,\n        projects: projectsToShow.map((project: any) => ({\n          id: project.id,\n          name: project.name,\n          description: project.description,\n          targetAmount: project.targetAmount,\n          collectedAmount: project.collectedAmount,\n          deadline: project.deadline\n        })),\n        memberCount: members.length,\n        totalTarget,\n        totalCollected,\n        isMember\n      };\n      \n      res.json(landingData);\n    } catch (error) {\n      console.error(\"Get group by join link error:\", error);\n      res.status(500).json({ message: \"Failed to fetch group\" });\n    }\n  });\n\n  app.post(\"/api/groups\", async (req, res) => {\n    try {\n      const { adminId, deadline, ...restData } = req.body;\n      \n      if (!adminId) {\n        return res.status(400).json({ message: \"Admin ID is required\" });\n      }\n      \n      // Convert deadline string to Date if provided\n      const processedData = {\n        ...restData,\n        deadline: deadline ? new Date(deadline) : null,\n      };\n      \n      // Skip validation for deadline field and validate the rest\n      const groupData = { ...processedData };\n      const group = await storage.createGroup(groupData, adminId);\n      res.json(group);\n    } catch (error) {\n      console.error(\"Create group error:\", error);\n      res.status(400).json({ message: \"Invalid group data\" });\n    }\n  });\n\n  app.post(\"/api/groups/:groupId/join\", async (req, res) => {\n    try {\n      const { groupId } = req.params;\n      const { userId } = req.body;\n      \n      if (!userId) {\n        return res.status(400).json({ message: \"User ID is required\" });\n      }\n      \n      // Check if user is already a member\n      const existingMember = await storage.getGroupMember(groupId, userId);\n      if (existingMember) {\n        return res.status(400).json({ message: \"User is already a member of this group\" });\n      }\n      \n      const membership = await storage.addGroupMember({ groupId, userId });\n      \n      // Get group and new member details for notification\n      const group = await storage.getGroup(groupId);\n      const user = await storage.getUser(userId);\n      \n      if (group && user) {\n        // Create notification for group admin about new member\n        await storage.createNotification({\n          userId: group.adminId,\n          type: \"member_joined\",\n          title: \"New Member Joined\",\n          message: `${user.fullName} (@${user.username}) has joined your group \"${group.name}\"`\n        });\n      }\n      \n      res.json(membership);\n    } catch (error) {\n      console.error(\"Join group error:\", error);\n      res.status(500).json({ message: \"Failed to join group\" });\n    }\n  });\n\n  // Get group by ID\n  app.get(\"/api/groups/:groupId\", async (req, res) => {\n    try {\n      const { groupId } = req.params;\n      const group = await storage.getGroup(groupId);\n      \n      if (!group) {\n        return res.status(404).json({ message: \"Group not found\" });\n      }\n      \n      res.json(group);\n    } catch (error) {\n      console.error(\"Get group by ID error:\", error);\n      res.status(500).json({ message: \"Failed to fetch group\" });\n    }\n  });\n\n  app.get(\"/api/groups/:groupId/members\", async (req, res) => {\n    try {\n      const { groupId } = req.params;\n      const members = await storage.getGroupMembers(groupId);\n      res.json(members);\n    } catch (error) {\n      console.error(\"Get group members error:\", error);\n      res.status(500).json({ message: \"Failed to fetch group members\" });\n    }\n  });\n\n  // Remove member from group (admin only)\n  app.delete(\"/api/groups/:groupId/members/:memberId\", async (req, res) => {\n    try {\n      const { groupId, memberId } = req.params;\n      const { adminId } = req.body; // The requesting user's ID\n      \n      if (!adminId) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n      \n      // Get the group to verify admin\n      const group = await storage.getGroup(groupId);\n      if (!group) {\n        return res.status(404).json({ message: \"Group not found\" });\n      }\n      \n      // Verify the requesting user is the group admin\n      if (group.adminId !== adminId) {\n        return res.status(403).json({ message: \"Only the group admin can remove members\" });\n      }\n      \n      // Get the member to get user info for notification\n      const members = await storage.getGroupMembers(groupId);\n      const memberToRemove = members.find(m => m.id === memberId);\n      \n      if (!memberToRemove) {\n        return res.status(404).json({ message: \"Member not found\" });\n      }\n      \n      // Don't allow removing the group admin\n      if (memberToRemove.userId === group.adminId) {\n        return res.status(400).json({ message: \"Cannot remove the group admin\" });\n      }\n      \n      // Remove the member\n      const success = await storage.removeGroupMember(memberId);\n      \n      if (!success) {\n        return res.status(500).json({ message: \"Failed to remove member\" });\n      }\n      \n      // Send notification to the removed member\n      await storage.createNotification({\n        userId: memberToRemove.userId,\n        type: \"member_removed\",\n        title: \"Removed from Group\",\n        message: `You have been removed from the group \"${group.name}\"`\n      });\n      \n      res.json({ success: true, message: \"Member removed successfully\" });\n    } catch (error) {\n      console.error(\"Remove member error:\", error);\n      res.status(500).json({ message: \"Failed to remove member\" });\n    }\n  });\n\n  // Project routes\n  \n  // Get all projects for an admin (across all their groups)\n  app.get(\"/api/projects/admin/:adminId\", async (req, res) => {\n    try {\n      const { adminId } = req.params;\n      const groups = await storage.getGroupsByAdmin(adminId);\n      const projectsWithGroup: any[] = [];\n      \n      for (const group of groups) {\n        const groupProjects = await storage.getProjectsByGroup(group.id);\n        for (const project of groupProjects) {\n          projectsWithGroup.push({\n            ...project,\n            groupId: group.id,\n            groupName: group.name,\n          });\n        }\n      }\n      \n      res.json(projectsWithGroup);\n    } catch (error) {\n      console.error(\"Get admin projects error:\", error);\n      res.status(500).json({ message: \"Failed to fetch admin projects\" });\n    }\n  });\n  \n  app.get(\"/api/groups/:groupId/projects\", async (req, res) => {\n    try {\n      const { groupId } = req.params;\n      const projects = await storage.getProjectsByGroup(groupId);\n      res.json(projects);\n    } catch (error) {\n      console.error(\"Get group projects error:\", error);\n      res.status(500).json({ message: \"Failed to fetch projects\" });\n    }\n  });\n\n  app.get(\"/api/projects/slug/:groupSlug/:projectSlug\", async (req, res) => {\n    try {\n      const { groupSlug, projectSlug } = req.params;\n      const customSlug = `${groupSlug}/${projectSlug}`;\n      const project = await storage.getProjectByCustomSlug(customSlug);\n      \n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n      \n      res.json(project);\n    } catch (error) {\n      console.error(\"Get project by slug error:\", error);\n      res.status(500).json({ message: \"Failed to fetch project\" });\n    }\n  });\n\n  app.post(\"/api/groups/:groupId/projects\", async (req, res) => {\n    try {\n      const { groupId } = req.params;\n      const projectData = { ...req.body, groupId };\n      \n      // Handle deadline conversion - ensure it's a Date object\n      if (projectData.deadline && typeof projectData.deadline === 'string') {\n        projectData.deadline = new Date(projectData.deadline);\n      }\n      \n      const project = await storage.createProject(projectData);\n      res.json(project);\n    } catch (error) {\n      console.error(\"Create project error:\", error);\n      res.status(400).json({ message: \"Invalid project data\" });\n    }\n  });\n\n  app.get(\"/api/projects/:projectId\", async (req, res) => {\n    try {\n      const { projectId } = req.params;\n      const project = await storage.getProject(projectId);\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n      res.json(project);\n    } catch (error) {\n      console.error(\"Get project error:\", error);\n      res.status(500).json({ message: \"Failed to fetch project\" });\n    }\n  });\n\n  app.patch(\"/api/projects/:projectId\", async (req, res) => {\n    try {\n      const { projectId } = req.params;\n      const updates = { ...req.body };\n      \n      // Handle deadline conversion\n      if (updates.deadline) {\n        updates.deadline = new Date(updates.deadline);\n      }\n      \n      const project = await storage.updateProject(projectId, updates);\n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n      res.json(project);\n    } catch (error) {\n      console.error(\"Update project error:\", error);\n      res.status(400).json({ message: \"Failed to update project\" });\n    }\n  });\n\n  // Accountability Partner routes\n  app.get(\"/api/groups/:groupId/accountability-partners\", async (req, res) => {\n    try {\n      const { groupId } = req.params;\n      const partners = await storage.getGroupAccountabilityPartners(groupId);\n      res.json(partners);\n    } catch (error) {\n      console.error(\"Get accountability partners error:\", error);\n      res.status(500).json({ message: \"Failed to fetch accountability partners\" });\n    }\n  });\n\n  app.post(\"/api/groups/:groupId/accountability-partners\", async (req, res) => {\n    try {\n      const { groupId } = req.params;\n      const { userId } = req.body;\n      \n      if (!userId) {\n        return res.status(400).json({ message: \"User ID is required\" });\n      }\n      \n      // Check if user is already an accountability partner\n      const existingPartners = await storage.getGroupAccountabilityPartners(groupId);\n      if (existingPartners.length >= 2) {\n        return res.status(400).json({ message: \"Maximum 2 accountability partners allowed per group\" });\n      }\n      \n      if (existingPartners.some(p => p.userId === userId)) {\n        return res.status(400).json({ message: \"User is already an accountability partner\" });\n      }\n      \n      const partner = await storage.addAccountabilityPartner({ groupId, userId });\n      res.json(partner);\n    } catch (error) {\n      console.error(\"Add accountability partner error:\", error);\n      res.status(500).json({ message: \"Failed to add accountability partner\" });\n    }\n  });\n\n  app.delete(\"/api/groups/:groupId/accountability-partners/:userId\", async (req, res) => {\n    try {\n      const { groupId, userId } = req.params;\n      const success = await storage.removeAccountabilityPartner(groupId, userId);\n      \n      if (!success) {\n        return res.status(404).json({ message: \"Accountability partner not found\" });\n      }\n      \n      res.json({ message: \"Accountability partner removed successfully\" });\n    } catch (error) {\n      console.error(\"Remove accountability partner error:\", error);\n      res.status(500).json({ message: \"Failed to remove accountability partner\" });\n    }\n  });\n\n  // Contribution routes\n  app.get(\"/api/contributions/group/:groupId\", async (req, res) => {\n    try {\n      const { groupId } = req.params;\n      const contributions = await storage.getGroupContributions(groupId);\n      res.json(contributions);\n    } catch (error) {\n      console.error(\"Get group contributions error:\", error);\n      res.status(500).json({ message: \"Failed to fetch contributions\" });\n    }\n  });\n\n  app.get(\"/api/contributions/project/:projectId\", async (req, res) => {\n    try {\n      const { projectId } = req.params;\n      const contributions = await storage.getProjectContributions(projectId);\n      res.json(contributions);\n    } catch (error) {\n      console.error(\"Get project contributions error:\", error);\n      res.status(500).json({ message: \"Failed to fetch project contributions\" });\n    }\n  });\n\n  app.get(\"/api/contributions/user/:userId\", async (req, res) => {\n    try {\n      const { userId } = req.params;\n      const contributions = await storage.getUserContributions(userId);\n      res.json(contributions);\n    } catch (error) {\n      console.error(\"Get user contributions error:\", error);\n      res.status(500).json({ message: \"Failed to fetch contributions\" });\n    }\n  });\n\n  app.get(\"/api/contributions/admin/:adminId\", async (req, res) => {\n    try {\n      const { adminId } = req.params;\n      const contributions = await storage.getAdminContributions(adminId);\n      res.json(contributions);\n    } catch (error) {\n      console.error(\"Get admin contributions error:\", error);\n      res.status(500).json({ message: \"Failed to fetch admin contributions\" });\n    }\n  });\n\n  app.post(\"/api/contributions\", async (req, res) => {\n    try {\n      console.log(\"Received contribution data:\", req.body);\n      const contributionData = insertContributionSchema.parse(req.body);\n      console.log(\"Parsed contribution data:\", contributionData);\n      const contribution = await storage.createContribution(contributionData);\n      res.json(contribution);\n    } catch (error) {\n      console.error(\"Create contribution error:\", error);\n      if (error instanceof Error) {\n        console.error(\"Error details:\", error.message);\n      }\n      res.status(400).json({ \n        message: \"Invalid contribution data\",\n        error: error instanceof Error ? error.message : \"Unknown error\"\n      });\n    }\n  });\n\n  app.patch(\"/api/contributions/:id/confirm\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const contribution = await storage.confirmContribution(id);\n      if (!contribution) {\n        return res.status(404).json({ message: \"Contribution not found\" });\n      }\n      res.json(contribution);\n    } catch (error) {\n      console.error(\"Confirm contribution error:\", error);\n      res.status(500).json({ message: \"Failed to confirm contribution\" });\n    }\n  });\n\n  app.patch(\"/api/contributions/:id/reject\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const { reason } = req.body;\n      const contribution = await storage.updateContribution(id, { \n        status: \"rejected\" \n      });\n      \n      if (!contribution) {\n        return res.status(404).json({ message: \"Contribution not found\" });\n      }\n\n      // Send rejection notification\n      await storage.createRejectionNotification(contribution, reason);\n      \n      res.json(contribution);\n    } catch (error) {\n      console.error(\"Reject contribution error:\", error);\n      res.status(500).json({ message: \"Failed to reject contribution\" });\n    }\n  });\n\n  // Notification routes\n  app.get(\"/api/notifications/:userId\", async (req, res) => {\n    try {\n      const { userId } = req.params;\n      const notifications = await storage.getUserNotifications(userId);\n      res.json(notifications);\n    } catch (error) {\n      console.error(\"Get notifications error:\", error);\n      res.status(500).json({ message: \"Failed to fetch notifications\" });\n    }\n  });\n\n  app.patch(\"/api/notifications/:id/read\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      await storage.markNotificationRead(id);\n      res.json({ message: \"Notification marked as read\" });\n    } catch (error) {\n      console.error(\"Mark notification read error:\", error);\n      res.status(500).json({ message: \"Failed to mark notification as read\" });\n    }\n  });\n\n  // Stats routes\n  app.get(\"/api/stats/user/:userId\", async (req, res) => {\n    try {\n      const { userId } = req.params;\n      const stats = await storage.getUserStats(userId);\n      res.json(stats);\n    } catch (error) {\n      console.error(\"Get user stats error:\", error);\n      res.status(500).json({ message: \"Failed to fetch user stats\" });\n    }\n  });\n\n  app.get(\"/api/stats/admin/:adminId\", async (req, res) => {\n    try {\n      const { adminId } = req.params;\n      const stats = await storage.getAdminStats(adminId);\n      res.json(stats);\n    } catch (error) {\n      console.error(\"Get admin stats error:\", error);\n      res.status(500).json({ message: \"Failed to fetch admin stats\" });\n    }\n  });\n\n  // OTP Verification routes\n  app.post(\"/api/auth/send-otp\", async (req, res) => {\n    try {\n      const { phoneNumber } = req.body;\n      \n      if (!phoneNumber) {\n        return res.status(400).json({ message: \"Phone number is required\" });\n      }\n      \n      // Validate WhatsApp number format\n      if (!whatsappService.isValidWhatsAppNumber(phoneNumber)) {\n        return res.status(400).json({ \n          message: \"Please enter a valid WhatsApp number with country code (e.g., +234, +1, +44)\" \n        });\n      }\n      \n      // Generate random 6-digit OTP\n      const otp = Math.floor(100000 + Math.random() * 900000).toString();\n      \n      // Set expiration to 10 minutes from now\n      const expiresAt = new Date(Date.now() + 10 * 60 * 1000);\n      \n      const otpVerification = await storage.createOtpVerification({\n        phoneNumber,\n        otp,\n        expiresAt\n      });\n      \n      // Send OTP via WhatsApp\n      const sent = await whatsappService.sendOTP(phoneNumber, otp);\n      const isDevelopment = process.env.NODE_ENV === \"development\";\n      \n      if (!sent) {\n        console.error(\"Failed to send WhatsApp OTP, using fallback\");\n        \n        // In development, allow testing even if WhatsApp fails\n        if (isDevelopment) {\n          console.log(`Development OTP for ${phoneNumber}: ${otp}`);\n          return res.json({ \n            message: \"OTP sent successfully (development mode)\",\n            expiresAt: otpVerification.expiresAt,\n            developmentOtp: otp,\n            fallback: true\n          });\n        }\n        \n        // In production, return error but don't expose OTP\n        return res.status(503).json({ \n          message: \"Unable to send WhatsApp message. Please check your WhatsApp number and try again.\" \n        });\n      }\n      \n      // When WhatsApp sending is successful, behave like production (no OTP in response)\n      res.json({ \n        message: \"OTP sent successfully via WhatsApp\",\n        expiresAt: otpVerification.expiresAt\n        // OTP codes are not included in response when WhatsApp delivery is successful\n      });\n    } catch (error) {\n      console.error(\"Send OTP error:\", error);\n      res.status(500).json({ message: \"Failed to send OTP\" });\n    }\n  });\n\n  app.post(\"/api/auth/verify-otp\", async (req, res) => {\n    try {\n      const { phoneNumber, otp, deviceInfo } = req.body;\n      \n      if (!phoneNumber || !otp) {\n        return res.status(400).json({ message: \"Phone number and OTP are required\" });\n      }\n      \n      const isValid = await storage.verifyOtp(phoneNumber, otp);\n      \n      if (isValid) {\n        // Find or create user\n        const user = await storage.findOrCreateUserByPhone(phoneNumber);\n        const isNewUser = !user.fullName;\n        \n        // Create device token for \"remember this device\"\n        const deviceToken = await storage.createDeviceToken(user.id, deviceInfo);\n        \n        res.json({ \n          message: \"OTP verified successfully\", \n          verified: true,\n          user: { ...user, password: undefined },\n          isNewUser,\n          deviceToken\n        });\n      } else {\n        res.status(400).json({ message: \"Invalid or expired OTP\", verified: false });\n      }\n    } catch (error) {\n      console.error(\"Verify OTP error:\", error);\n      res.status(500).json({ message: \"OTP verification failed\" });\n    }\n  });\n\n  // Validate device token for auto-login (remembered device)\n  app.post(\"/api/auth/validate-device\", async (req, res) => {\n    try {\n      const { deviceToken } = req.body;\n      \n      if (!deviceToken) {\n        return res.status(400).json({ message: \"Device token is required\", valid: false });\n      }\n      \n      const user = await storage.validateDeviceToken(deviceToken);\n      \n      if (user) {\n        res.json({ \n          valid: true, \n          user: { ...user, password: undefined },\n          isNewUser: !user.fullName\n        });\n      } else {\n        res.status(401).json({ message: \"Invalid or expired device token\", valid: false });\n      }\n    } catch (error) {\n      console.error(\"Validate device error:\", error);\n      res.status(500).json({ message: \"Device validation failed\", valid: false });\n    }\n  });\n\n  // Logout - remove device token\n  app.post(\"/api/auth/logout\", async (req, res) => {\n    try {\n      const { deviceToken } = req.body;\n      \n      if (deviceToken) {\n        await storage.removeDeviceToken(deviceToken);\n      }\n      \n      res.json({ message: \"Logged out successfully\" });\n    } catch (error) {\n      console.error(\"Logout error:\", error);\n      res.status(500).json({ message: \"Logout failed\" });\n    }\n  });\n\n  // Group registration with OTP verification\n  app.post(\"/api/groups/:groupId/register-with-otp\", async (req, res) => {\n    try {\n      const { groupId } = req.params;\n      const { username, fullName, phoneNumber, otp } = req.body;\n      \n      if (!username || !fullName || !phoneNumber || !otp) {\n        return res.status(400).json({ message: \"All fields are required\" });\n      }\n      \n      // Verify OTP first\n      const isOtpValid = await storage.verifyOtp(phoneNumber, otp);\n      if (!isOtpValid) {\n        return res.status(400).json({ message: \"Invalid or expired OTP\" });\n      }\n      \n      // Check if username already exists\n      const existingUser = await storage.getUserByUsername(username);\n      if (existingUser) {\n        return res.status(400).json({ message: \"Username already exists\" });\n      }\n      \n      // Check if group exists\n      const group = await storage.getGroup(groupId);\n      if (!group) {\n        return res.status(404).json({ message: \"Group not found\" });\n      }\n      \n      // Create user without password (OTP-based auth)\n      const user = await storage.createUser({\n        username,\n        fullName,\n        phoneNumber,\n        password: \"otp-auth\", // Special marker for OTP-only accounts\n        role: \"member\"\n      });\n      \n      // Add user to group\n      await storage.addGroupMember({\n        groupId,\n        userId: user.id\n      });\n      \n      res.json({ \n        message: \"Registration successful\",\n        user: { ...user, password: undefined },\n        group\n      });\n    } catch (error) {\n      console.error(\"Group registration error:\", error);\n      res.status(500).json({ message: \"Registration failed\" });\n    }\n  });\n\n  // Send login OTP route\n  app.post(\"/api/auth/send-login-otp\", async (req, res) => {\n    try {\n      const { username, phoneNumber } = req.body;\n      \n      if (!username || !phoneNumber) {\n        return res.status(400).json({ message: \"Username and phone number are required\" });\n      }\n      \n      // Validate WhatsApp number format\n      if (!whatsappService.isValidWhatsAppNumber(phoneNumber)) {\n        return res.status(400).json({ \n          message: \"Please enter a valid WhatsApp number with country code (e.g., +234, +1, +44)\" \n        });\n      }\n      \n      // Check if user exists with this username and phone number\n      const user = await storage.getUserByUsername(username);\n      if (!user || user.phoneNumber !== phoneNumber) {\n        return res.status(400).json({ message: \"Invalid username or phone number\" });\n      }\n      \n      // Generate and send OTP using existing storage method\n      const otpData = await storage.sendOtp(phoneNumber);\n      \n      // When WhatsApp sending is successful, behave like production (no OTP in response)\n      res.json({\n        message: \"Login OTP sent successfully via WhatsApp\",\n        expiresAt: otpData.expiresAt\n        // OTP codes are not included in response when WhatsApp delivery is successful\n      });\n    } catch (error) {\n      console.error(\"Send login OTP error:\", error);\n      res.status(500).json({ message: \"Failed to send login OTP\" });\n    }\n  });\n\n  // Login with OTP route\n  app.post(\"/api/auth/login-with-otp\", async (req, res) => {\n    try {\n      const { username, phoneNumber, otp } = req.body;\n      \n      if (!username || !phoneNumber || !otp) {\n        return res.status(400).json({ message: \"All fields are required\" });\n      }\n      \n      // Verify OTP first\n      const isOtpValid = await storage.verifyOtp(phoneNumber, otp);\n      if (!isOtpValid) {\n        return res.status(400).json({ message: \"Invalid or expired OTP\" });\n      }\n      \n      // Get user by username and verify phone number\n      const user = await storage.getUserByUsername(username);\n      if (!user || user.phoneNumber !== phoneNumber) {\n        return res.status(400).json({ message: \"Invalid login credentials\" });\n      }\n      \n      res.json({ \n        message: \"Login successful\",\n        user: { ...user, password: undefined }\n      });\n    } catch (error) {\n      console.error(\"Login with OTP error:\", error);\n      res.status(500).json({ message: \"Login failed\" });\n    }\n  });\n\n  // Validate user session - used on page refresh\n  app.get(\"/api/auth/me\", async (req, res) => {\n    try {\n      const { userId } = req.query;\n      \n      if (!userId || typeof userId !== 'string') {\n        return res.status(401).json({ message: \"Unauthorized - no user ID provided\" });\n      }\n      \n      // Verify user exists in database\n      const user = await storage.getUser(userId);\n      if (!user) {\n        return res.status(401).json({ message: \"Unauthorized - user not found\" });\n      }\n      \n      res.json({ \n        user: { ...user, password: undefined }\n      });\n    } catch (error) {\n      console.error(\"Auth validation error:\", error);\n      res.status(500).json({ message: \"Failed to validate session\" });\n    }\n  });\n\n  // OTP-based registration route\n  app.post(\"/api/auth/register-with-otp\", async (req, res) => {\n    try {\n      const { username, fullName, phoneNumber, otp, role } = req.body;\n      \n      if (!username || !fullName || !phoneNumber || !otp) {\n        return res.status(400).json({ message: \"All fields are required\" });\n      }\n      \n      // Verify OTP first\n      const isOtpValid = await storage.verifyOtp(phoneNumber, otp);\n      if (!isOtpValid) {\n        return res.status(400).json({ message: \"Invalid or expired OTP\" });\n      }\n      \n      // Check if username already exists\n      const existingUser = await storage.getUserByUsername(username);\n      if (existingUser) {\n        return res.status(400).json({ message: \"Username already exists\" });\n      }\n      \n      // Create user with OTP auth\n      const user = await storage.createUser({\n        username,\n        fullName,\n        phoneNumber,\n        password: \"otp-auth\", // OTP-based auth marker\n        role: role || \"member\"\n      });\n      \n      res.json({ \n        message: \"Registration successful\",\n        user: { ...user, password: undefined }\n      });\n    } catch (error) {\n      console.error(\"OTP registration error:\", error);\n      res.status(500).json({ message: \"Registration failed\" });\n    }\n  });\n\n  // Bank details endpoint for payment instructions\n  app.get(\"/api/bank-details/:projectId\", async (req, res) => {\n    try {\n      const { projectId } = req.params;\n      const project = await storage.getProject(projectId);\n      \n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n      \n      const group = await storage.getGroup(project.groupId);\n      if (!group) {\n        return res.status(404).json({ message: \"Group not found\" });\n      }\n      \n      const admin = await storage.getUser(group.adminId);\n      if (!admin) {\n        return res.status(404).json({ message: \"Admin not found\" });\n      }\n      \n      // Mock bank details for demo - in production this would come from admin settings\n      const bankDetails = {\n        bankName: \"Access Bank\",\n        accountNumber: \"0123456789\", \n        accountName: admin.fullName || \"Admin User\"\n      };\n      \n      res.json(bankDetails);\n    } catch (error) {\n      console.error(\"Get bank details error:\", error);\n      res.status(500).json({ message: \"Failed to fetch bank details\" });\n    }\n  });\n\n  // Member projects endpoint for payment selection\n  app.get(\"/api/contributions/member/:userId/projects\", async (req, res) => {\n    try {\n      const { userId } = req.params;\n      const memberGroups = await storage.getUserGroups(userId);\n      const projects = [];\n      \n      for (const groupMember of memberGroups) {\n        const group = await storage.getGroup(groupMember.groupId);\n        const groupProjects = await storage.getProjectsByGroup(groupMember.groupId);\n        \n        for (const project of groupProjects) {\n          projects.push({\n            id: project.id,\n            name: project.name,\n            targetAmount: project.targetAmount,\n            collectedAmount: project.collectedAmount,\n            deadline: project.deadline,\n            groupId: group?.id,\n            groupName: group?.name\n          });\n        }\n      }\n      \n      res.json(projects);\n    } catch (error) {\n      console.error(\"Get member projects error:\", error);\n      res.status(500).json({ message: \"Failed to fetch member projects\" });\n    }\n  });\n\n  // OG Image Generation\n  const { generateOGImage } = await import('./og-image');\n  \n  // Route with optional project slug\n  app.get(\"/api/og-image/:identifier/:projectSlug?\", async (req, res) => {\n    try {\n      const { identifier, projectSlug } = req.params;\n      const imageBuffer = await generateOGImage(identifier, projectSlug);\n      \n      if (!imageBuffer) {\n        return res.status(404).json({ message: \"Group not found\" });\n      }\n\n      res.setHeader('Content-Type', 'image/png');\n      res.setHeader('Cache-Control', 'public, max-age=86400'); // Cache for 24 hours\n      res.send(imageBuffer);\n    } catch (error) {\n      console.error(\"OG image generation error:\", error);\n      res.status(500).json({ message: \"Failed to generate OG image\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","path":null,"size_bytes":40637,"size_tokens":null},"client/src/components/group-card.tsx":{"content":"import { Group, GroupWithStats } from \"@shared/schema\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { MessageCircle, Settings, Users, FolderKanban, ChevronRight, Bell } from \"lucide-react\";\nimport { formatNaira } from \"@/lib/currency\";\n\ninterface GroupCardProps {\n  group: Group | GroupWithStats;\n  isAdmin?: boolean;\n  onManage?: (group: Group) => void;\n  onShare?: (group: Group) => void;\n  onMakePayment?: (group: Group) => void;\n  onViewDetails?: (group: Group) => void;\n  userContribution?: string;\n}\n\nexport function GroupCard({\n  group,\n  isAdmin = false,\n  onManage,\n  onShare,\n  onMakePayment,\n  onViewDetails,\n  userContribution,\n}: GroupCardProps) {\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case \"completed\":\n        return \"bg-green-100 text-green-800\";\n      case \"active\":\n        return \"bg-blue-100 text-blue-800\";\n      case \"paused\":\n        return \"bg-orange-100 text-orange-800\";\n      default:\n        return \"bg-gray-100 text-gray-800\";\n    }\n  };\n\n  const hasStats = \"memberCount\" in group;\n  const groupWithStats = group as GroupWithStats;\n\n  return (\n    <Card \n      className=\"hover:shadow-md transition-all cursor-pointer active:scale-[0.99] border border-gray-100\"\n      onClick={() => onViewDetails?.(group)}\n      data-testid={`group-card-${group.id}`}\n    >\n      <CardContent className=\"p-5\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between mb-4\">\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-center gap-2 mb-1\">\n              <h4 className=\"font-bold text-gray-900 dark:text-white truncate\">\n                {group.name}\n              </h4>\n              <Badge className={`${getStatusColor(group.status)} text-xs`}>\n                {group.status}\n              </Badge>\n            </div>\n            {group.description && (\n              <p className=\"text-sm text-gray-500 dark:text-gray-400 line-clamp-1\">\n                {group.description}\n              </p>\n            )}\n          </div>\n          <ChevronRight className=\"h-5 w-5 text-gray-300 flex-shrink-0 ml-2\" />\n        </div>\n\n        {/* Stats Row */}\n        {hasStats && (\n          <div className=\"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400 mb-4\">\n            <div className=\"flex items-center gap-1.5\">\n              <Users className=\"h-4 w-4\" />\n              <span>{groupWithStats.memberCount || 0} members</span>\n            </div>\n            <div className=\"flex items-center gap-1.5\">\n              <FolderKanban className=\"h-4 w-4\" />\n              <span>{groupWithStats.projectCount || 0} projects</span>\n            </div>\n          </div>\n        )}\n\n        {/* Admin: Pending payments alert */}\n        {isAdmin && hasStats && groupWithStats.pendingPayments > 0 && (\n          <div className=\"flex items-center gap-2 p-3 bg-orange-50 dark:bg-orange-900/20 rounded-xl mb-4\">\n            <Bell className=\"h-4 w-4 text-orange-600\" />\n            <span className=\"text-sm font-medium text-orange-800 dark:text-orange-200\">\n              {groupWithStats.pendingPayments} pending approval{groupWithStats.pendingPayments > 1 ? 's' : ''}\n            </span>\n          </div>\n        )}\n\n        {/* Member: My contribution */}\n        {!isAdmin && userContribution && parseFloat(userContribution) > 0 && (\n          <div className=\"p-3 bg-green-50 dark:bg-green-900/20 rounded-xl mb-4\">\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mb-0.5\">My Contribution</p>\n            <p className=\"font-bold text-green-700 dark:text-green-400\">\n              {formatNaira(userContribution)}\n            </p>\n          </div>\n        )}\n\n        {/* Action Buttons */}\n        <div \n          className=\"flex gap-2 pt-2\"\n          onClick={(e) => e.stopPropagation()}\n        >\n          {isAdmin ? (\n            <>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => onShare?.(group)}\n                className=\"flex-1 h-10\"\n                data-testid={`share-group-${group.id}`}\n              >\n                <MessageCircle className=\"h-4 w-4 mr-2\" />\n                Share\n              </Button>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => onManage?.(group)}\n                className=\"flex-1 h-10\"\n                data-testid={`manage-group-${group.id}`}\n              >\n                <Settings className=\"h-4 w-4 mr-2\" />\n                Manage\n              </Button>\n            </>\n          ) : (\n            <Button\n              onClick={() => onMakePayment?.(group)}\n              className=\"w-full h-11 bg-nigerian-green hover:bg-forest-green font-medium\"\n              data-testid={`submit-proof-${group.id}`}\n            >\n              Submit Payment Proof\n            </Button>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":5060,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg max-h-[90vh] overflow-y-auto\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3877,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"server/db.ts":{"content":"import { neon } from \"@neondatabase/serverless\";\nimport { drizzle } from \"drizzle-orm/neon-http\";\nimport * as schema from \"@shared/schema\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL environment variable is not set\");\n}\n\nconst sql = neon(process.env.DATABASE_URL);\nexport const db = drizzle(sql, { schema });\n","path":null,"size_bytes":332,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"server/og-middleware.ts":{"content":"import { storage } from \"./storage\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nconst CRAWLER_USER_AGENTS = [\n  'facebookexternalhit',\n  'WhatsApp',\n  'Twitterbot',\n  'LinkedInBot',\n  'Slackbot',\n  'TelegramBot',\n  'Discordbot',\n  'instagram',\n];\n\nfunction isCrawler(userAgent: string): boolean {\n  const ua = userAgent.toLowerCase();\n  return CRAWLER_USER_AGENTS.some(crawler => ua.includes(crawler.toLowerCase()));\n}\n\nfunction generateOGHtml(options: {\n  title: string;\n  description: string;\n  imageUrl: string;\n  url: string;\n  baseHtml?: string;\n}): string {\n  const { title, description, imageUrl, url, baseHtml } = options;\n  \n  const ogTags = `\n    <!-- Open Graph / Facebook / WhatsApp -->\n    <meta property=\"og:title\" content=\"${escapeHtml(title)}\" />\n    <meta property=\"og:description\" content=\"${escapeHtml(description)}\" />\n    <meta property=\"og:image\" content=\"${imageUrl}\" />\n    <meta property=\"og:image:width\" content=\"1200\" />\n    <meta property=\"og:image:height\" content=\"630\" />\n    <meta property=\"og:url\" content=\"${url}\" />\n    <meta property=\"og:type\" content=\"website\" />\n    \n    <!-- Twitter Card -->\n    <meta name=\"twitter:card\" content=\"summary_large_image\" />\n    <meta name=\"twitter:title\" content=\"${escapeHtml(title)}\" />\n    <meta name=\"twitter:description\" content=\"${escapeHtml(description)}\" />\n    <meta name=\"twitter:image\" content=\"${imageUrl}\" />\n  `;\n\n  if (baseHtml) {\n    const ogStartIndex = baseHtml.indexOf('<!-- Open Graph');\n    const ogEndIndex = baseHtml.indexOf('<meta name=\"twitter:image\"');\n    \n    if (ogStartIndex !== -1 && ogEndIndex !== -1) {\n      const endTagClose = baseHtml.indexOf('>', ogEndIndex) + 1;\n      const before = baseHtml.substring(0, ogStartIndex);\n      const after = baseHtml.substring(endTagClose);\n      return before + ogTags + after;\n    }\n  }\n\n  return `<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1\" />\n    <title>${escapeHtml(title)}</title>\n    ${ogTags}\n  </head>\n  <body>\n    <div id=\"root\"></div>\n    <script type=\"module\" src=\"/src/main.tsx\"></script>\n  </body>\n</html>`;\n}\n\nfunction escapeHtml(text: string): string {\n  const map: Record<string, string> = {\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;',\n    '\"': '&quot;',\n    \"'\": '&#039;'\n  };\n  return text.replace(/[&<>\"']/g, m => map[m]);\n}\n\nexport async function handleDynamicOGTags(\n  req: any,\n  res: any,\n  next: any,\n  baseHtml?: string\n): Promise<boolean> {\n  const userAgent = req.headers['user-agent'] || '';\n  \n  if (!isCrawler(userAgent)) {\n    return false;\n  }\n\n  const urlPath = req.path || req.originalUrl;\n  \n  // Skip API routes\n  if (urlPath.startsWith('/api/')) {\n    return false;\n  }\n  \n  // Match multiple route patterns:\n  // 1. /register/:groupLink\n  // 2. /join/:groupLink\n  // 3. /join/:groupLink/:projectSlug\n  // 4. /:groupLink (short URL pattern, but exclude reserved routes)\n  // 5. /:groupLink/:projectSlug\n  const registerMatch = urlPath.match(/^\\/register\\/([^\\/]+)/);\n  const joinMatch = urlPath.match(/^\\/join\\/([^\\/]+)(?:\\/([^\\/]+))?/);\n  const shortMatch = urlPath.match(/^\\/([^\\/]+)(?:\\/([^\\/]+))?$/);\n  \n  let groupLink: string | null = null;\n  let projectSlug: string | null = null;\n  \n  if (registerMatch) {\n    groupLink = registerMatch[1];\n  } else if (joinMatch) {\n    groupLink = joinMatch[1];\n    projectSlug = joinMatch[2] || null;\n  } else if (shortMatch) {\n    // Exclude reserved routes like /api, /assets, etc.\n    const reservedRoutes = ['api', 'assets', 'login', 'register', 'join', 'admin', 'dashboard', 'groups', 'group', 'project', 'pay', 'history'];\n    const potentialLink = shortMatch[1];\n    \n    if (!reservedRoutes.includes(potentialLink.toLowerCase())) {\n      groupLink = potentialLink;\n      projectSlug = shortMatch[2] || null;\n    }\n  }\n  \n  if (!groupLink) {\n    return false;\n  }\n  \n  try {\n    // Try custom slug first, then fall back to registration link\n    let group = await storage.getGroupByCustomSlug(groupLink);\n    \n    if (!group) {\n      group = await storage.getGroupByRegistrationLink(groupLink);\n    }\n    \n    if (!group) {\n      return false;\n    }\n\n    // Get projects for this group\n    const projects = await storage.getProjectsByGroup(group.id);\n    let targetProject = projects[0];\n    \n    // If projectSlug is provided, find that specific project\n    // Slug generation: lowercase, remove special chars, remove spaces, limit 50 chars\n    if (projectSlug && projects.length > 0) {\n      const matchedProject = projects.find(p => {\n        const generatedSlug = p.name\n          .toLowerCase()\n          .replace(/[^a-z0-9\\s-]/g, '')\n          .replace(/\\s+/g, '')\n          .slice(0, 50);\n        return generatedSlug === projectSlug;\n      });\n      if (matchedProject) {\n        targetProject = matchedProject;\n      }\n    }\n\n    const host = req.get('host');\n    const protocol = host.includes('localhost') ? 'http' : 'https';\n    const baseUrl = `${protocol}://${host}`;\n    const pageUrl = `${baseUrl}${urlPath}`;\n    const imageUrl = `${baseUrl}/api/og-image/${groupLink}${projectSlug ? `/${projectSlug}` : ''}`;\n    \n    // New title format: \"Track Group Money | Kontrib\"\n    const title = \"Track Group Money | Kontrib\";\n    \n    // New description format with group name and project name\n    const projectName = targetProject?.name || 'this project';\n    const description = `You've been invited to join ${group.name} on Kontrib! 🎉 Click to submit payment to ${projectName}.`;\n    \n    const html = generateOGHtml({\n      title,\n      description,\n      imageUrl,\n      url: pageUrl,\n      baseHtml\n    });\n\n    res.status(200).set({ 'Content-Type': 'text/html' }).send(html);\n    return true;\n  } catch (error) {\n    console.error('Error generating dynamic OG tags:', error);\n    return false;\n  }\n}\n","path":null,"size_bytes":5877,"size_tokens":null},"server/og-image.ts":{"content":"import { createCanvas, loadImage } from 'canvas';\nimport { storage } from './storage';\nimport path from 'path';\n\nexport async function generateOGImage(groupIdentifier: string, projectSlug?: string): Promise<Buffer | null> {\n  try {\n    // Try custom slug first, then fall back to registration link\n    let group = await storage.getGroupByCustomSlug(groupIdentifier);\n    \n    if (!group) {\n      group = await storage.getGroupByRegistrationLink(groupIdentifier);\n    }\n    \n    if (!group) {\n      return null;\n    }\n\n    // Get projects for this group\n    const projects = await storage.getProjectsByGroup(group.id);\n    let targetProject = projects[0];\n    \n    // If projectSlug is provided, find that specific project\n    // Slug generation: lowercase, remove special chars, remove spaces, limit 50 chars\n    if (projectSlug && projects.length > 0) {\n      const matchedProject = projects.find(p => {\n        const generatedSlug = p.name\n          .toLowerCase()\n          .replace(/[^a-z0-9\\s-]/g, '')\n          .replace(/\\s+/g, '')\n          .slice(0, 50);\n        return generatedSlug === projectSlug;\n      });\n      if (matchedProject) {\n        targetProject = matchedProject;\n      }\n    }\n\n    // Create canvas\n    const width = 1200;\n    const height = 630;\n    const canvas = createCanvas(width, height);\n    const ctx = canvas.getContext('2d');\n\n    // Background - Clean white\n    ctx.fillStyle = '#ffffff';\n    ctx.fillRect(0, 0, width, height);\n\n    // Add subtle green accent bar at top\n    ctx.fillStyle = '#16a34a';\n    ctx.fillRect(0, 0, width, 8);\n\n    let yPos = 60;\n\n    // === LOGO SECTION ===\n    try {\n      const logoPath = path.join(process.cwd(), 'server', 'assets', 'kontrib-logo.jpg');\n      const logo = await loadImage(logoPath);\n      \n      // Logo dimensions - centered, reasonable size\n      const logoHeight = 80;\n      const logoWidth = (logo.width / logo.height) * logoHeight;\n      const logoX = (width - logoWidth) / 2;\n      \n      ctx.drawImage(logo, logoX, yPos, logoWidth, logoHeight);\n      yPos += logoHeight + 20;\n    } catch (error) {\n      console.error('Error loading Kontrib logo:', error);\n      // Fallback text logo\n      ctx.fillStyle = '#16a34a';\n      ctx.font = 'bold 36px sans-serif';\n      const kontribText = 'Kontrib';\n      const kontribWidth = ctx.measureText(kontribText).width;\n      ctx.fillText(kontribText, (width - kontribWidth) / 2, yPos + 30);\n      yPos += 60;\n    }\n\n    // === \"Kontrib\" small text ===\n    ctx.fillStyle = '#6b7280';\n    ctx.font = '24px sans-serif';\n    const smallText = 'Kontrib';\n    const smallWidth = ctx.measureText(smallText).width;\n    ctx.fillText(smallText, (width - smallWidth) / 2, yPos);\n    yPos += 50;\n\n    // === \"Track Group Money\" - Bold, Big ===\n    ctx.fillStyle = '#000000';\n    ctx.font = 'bold 64px sans-serif';\n    const mainHeadline = 'Track Group Money';\n    const mainWidth = ctx.measureText(mainHeadline).width;\n    ctx.fillText(mainHeadline, (width - mainWidth) / 2, yPos);\n    yPos += 80;\n\n    // === Invitation message ===\n    const projectName = targetProject?.name || 'this project';\n    \n    // Line 1: \"You've been invited to join\"\n    ctx.fillStyle = '#374151';\n    ctx.font = '28px sans-serif';\n    const inviteLine1 = \"You've been invited to join\";\n    const invite1Width = ctx.measureText(inviteLine1).width;\n    ctx.fillText(inviteLine1, (width - invite1Width) / 2, yPos);\n    yPos += 50;\n\n    // Line 2: Group name (bold, green)\n    ctx.fillStyle = '#16a34a';\n    ctx.font = 'bold 42px sans-serif';\n    const groupNameDisplay = group.name.length > 35 ? group.name.substring(0, 35) + '...' : group.name;\n    const groupNameWidth = ctx.measureText(groupNameDisplay).width;\n    ctx.fillText(groupNameDisplay, (width - groupNameWidth) / 2, yPos);\n    yPos += 50;\n\n    // Line 3: \"on Kontrib! 🎉\"\n    ctx.fillStyle = '#374151';\n    ctx.font = '28px sans-serif';\n    const onKontrib = 'on Kontrib! 🎉';\n    const onKontribWidth = ctx.measureText(onKontrib).width;\n    ctx.fillText(onKontrib, (width - onKontribWidth) / 2, yPos);\n    yPos += 60;\n\n    // Line 4: \"Click to submit payment to [project]\"\n    ctx.fillStyle = '#6b7280';\n    ctx.font = '24px sans-serif';\n    const projectDisplay = projectName.length > 40 ? projectName.substring(0, 40) + '...' : projectName;\n    const ctaLine = `Click to submit payment to ${projectDisplay}`;\n    const ctaWidth = ctx.measureText(ctaLine).width;\n    ctx.fillText(ctaLine, (width - ctaWidth) / 2, yPos);\n\n    // === Bottom green accent bar ===\n    ctx.fillStyle = '#16a34a';\n    ctx.fillRect(0, height - 8, width, 8);\n\n    // Return PNG buffer\n    return canvas.toBuffer('image/png');\n  } catch (error) {\n    console.error('Error generating OG image:', error);\n    return null;\n  }\n}\n","path":null,"size_bytes":4763,"size_tokens":null},"client/src/components/project-selection-modal.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Group, Project } from \"@shared/schema\";\nimport { formatNaira } from \"@/lib/currency\";\nimport { Target, Calendar, TrendingUp, Loader2, AlertCircle } from \"lucide-react\";\nimport { format } from \"date-fns\";\n\ninterface ProjectSelectionModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  group: Group | null;\n  onSelectProject: (project: Project) => void;\n}\n\nexport function ProjectSelectionModal({ \n  open, \n  onOpenChange, \n  group,\n  onSelectProject \n}: ProjectSelectionModalProps) {\n  const { data: projects = [], isLoading, error } = useQuery<Project[]>({\n    queryKey: [\"/api/groups\", group?.id, \"projects\"],\n    queryFn: async () => {\n      if (!group) return [];\n      const response = await fetch(`/api/groups/${group.id}/projects`);\n      if (!response.ok) throw new Error(\"Failed to fetch projects\");\n      return response.json();\n    },\n    enabled: !!group && open,\n  });\n\n  const calculateProgress = (collected: string, target: string) => {\n    const collectedNum = Number(collected);\n    const targetNum = Number(target);\n    if (targetNum === 0) return 0;\n    return Math.min(Math.round((collectedNum / targetNum) * 100), 100);\n  };\n\n  const handleSelectProject = (project: Project) => {\n    onSelectProject(project);\n    onOpenChange(false);\n  };\n\n  if (!group) return null;\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-2xl max-h-[80vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle>Select a Project</DialogTitle>\n          <p className=\"text-sm text-gray-600\">\n            Choose which project in <span className=\"font-medium\">{group.name}</span> you'd like to contribute to\n          </p>\n        </DialogHeader>\n\n        {isLoading ? (\n          <div className=\"py-12 text-center\">\n            <Loader2 className=\"w-8 h-8 animate-spin mx-auto mb-4 text-green-600\" />\n            <p className=\"text-gray-600\">Loading projects...</p>\n          </div>\n        ) : error ? (\n          <div className=\"py-12 text-center\">\n            <AlertCircle className=\"w-12 h-12 text-red-500 mx-auto mb-4\" />\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Failed to Load Projects</h3>\n            <p className=\"text-gray-600 mb-4\">\n              {error instanceof Error ? error.message : \"Please try again later\"}\n            </p>\n            <Button \n              variant=\"outline\" \n              onClick={() => onOpenChange(false)}\n              data-testid=\"close-error-modal\"\n            >\n              Close\n            </Button>\n          </div>\n        ) : projects.length === 0 ? (\n          <div className=\"py-12 text-center\">\n            <Target className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No Projects Available</h3>\n            <p className=\"text-gray-600\">\n              This group doesn't have any active projects yet. Contact the admin to add projects.\n            </p>\n          </div>\n        ) : (\n          <div className=\"space-y-4\">\n            {projects.map((project) => {\n              const progress = calculateProgress(project.collectedAmount, project.targetAmount);\n              const remaining = Number(project.targetAmount) - Number(project.collectedAmount);\n              \n              return (\n                <Card \n                  key={project.id} \n                  className=\"hover:shadow-md transition-shadow cursor-pointer border-2 hover:border-green-200\"\n                  onClick={() => handleSelectProject(project)}\n                  data-testid={`project-card-${project.id}`}\n                >\n                  <CardContent className=\"p-6\">\n                    <div className=\"space-y-4\">\n                      {/* Project Header */}\n                      <div>\n                        <h3 className=\"text-lg font-semibold text-gray-900 mb-1\">\n                          {project.name}\n                        </h3>\n                        {project.description && (\n                          <p className=\"text-sm text-gray-600\">{project.description}</p>\n                        )}\n                      </div>\n\n                      {/* Progress Bar - only show if target exists */}\n                      {project.targetAmount && parseFloat(project.targetAmount) > 0 && (\n                        <div className=\"space-y-2\">\n                          <div className=\"flex justify-between items-center\">\n                            <span className=\"text-sm font-medium text-gray-600\">Progress</span>\n                            <span className=\"text-sm font-bold text-green-600\">{progress}%</span>\n                          </div>\n                          <Progress value={progress} className=\"h-2\" />\n                          <div className=\"flex justify-between text-xs text-gray-500\">\n                            <span>Raised: {formatNaira(project.collectedAmount)}</span>\n                            <span>Remaining: {formatNaira(remaining.toString())}</span>\n                          </div>\n                        </div>\n                      )}\n\n                      {/* Project Stats */}\n                      <div className={`grid gap-4 ${project.targetAmount && parseFloat(project.targetAmount) > 0 ? 'grid-cols-2' : 'grid-cols-1'}`}>\n                        {project.targetAmount && parseFloat(project.targetAmount) > 0 && (\n                          <div className=\"bg-green-50 rounded-lg p-3\">\n                            <div className=\"flex items-center gap-2 mb-1\">\n                              <Target className=\"w-4 h-4 text-green-600\" />\n                              <span className=\"text-xs text-gray-600\">Target</span>\n                            </div>\n                            <p className=\"text-sm font-semibold text-green-700\">\n                              {formatNaira(project.targetAmount)}\n                            </p>\n                          </div>\n                        )}\n                        \n                        {project.deadline && (\n                          <div className=\"bg-blue-50 rounded-lg p-3\">\n                            <div className=\"flex items-center gap-2 mb-1\">\n                              <Calendar className=\"w-4 h-4 text-blue-600\" />\n                              <span className=\"text-xs text-gray-600\">Deadline</span>\n                            </div>\n                            <p className=\"text-sm font-semibold text-blue-700\">\n                              {format(new Date(project.deadline), \"MMM dd, yyyy\")}\n                            </p>\n                          </div>\n                        )}\n                      </div>\n\n                      {/* Action Button */}\n                      <Button \n                        className=\"w-full bg-nigerian-green hover:bg-forest-green\"\n                        data-testid={`select-project-${project.id}`}\n                      >\n                        <TrendingUp className=\"w-4 h-4 mr-2\" />\n                        Contribute to this Project\n                      </Button>\n                    </div>\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n        )}\n\n        <div className=\"flex justify-end pt-4 border-t\">\n          <Button \n            variant=\"outline\" \n            onClick={() => onOpenChange(false)}\n            data-testid=\"cancel-project-selection\"\n          >\n            Cancel\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":7827,"size_tokens":null},"client/src/pages/group-details.tsx":{"content":"import { useParams, useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Navigation } from \"@/components/navigation\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  Collapsible,\n  CollapsibleContent,\n  CollapsibleTrigger,\n} from \"@/components/ui/collapsible\";\nimport {\n  ArrowLeft,\n  Users,\n  FolderKanban,\n  ChevronRight,\n  ChevronDown,\n  Shield,\n  UserCheck,\n  CreditCard,\n  Bell,\n  Plus,\n} from \"lucide-react\";\nimport { getCurrentUser } from \"@/lib/auth\";\nimport { formatNaira } from \"@/lib/currency\";\nimport { Group, Project, User as UserType, ContributionWithDetails } from \"@shared/schema\";\nimport { useState } from \"react\";\nimport { CreateProjectModal } from \"@/components/create-project-modal\";\n\ninterface GroupMemberWithUser {\n  id: string;\n  groupId: string;\n  userId: string;\n  contributedAmount: string;\n  status: string;\n  joinedAt: Date;\n  user: UserType;\n}\n\nexport default function GroupDetails() {\n  const { groupId } = useParams();\n  const [, setLocation] = useLocation();\n  const user = getCurrentUser();\n  const [createProjectModalOpen, setCreateProjectModalOpen] = useState(false);\n\n  const { data: group, isLoading: groupLoading } = useQuery<Group>({\n    queryKey: [\"/api/groups\", groupId],\n    enabled: !!groupId,\n  });\n\n  const { data: projects = [], isLoading: projectsLoading } = useQuery<Project[]>({\n    queryKey: [\"/api/groups\", groupId, \"projects\"],\n    enabled: !!groupId,\n  });\n\n  const { data: members = [], isLoading: membersLoading } = useQuery<GroupMemberWithUser[]>({\n    queryKey: [\"/api/groups\", groupId, \"members\"],\n    enabled: !!groupId,\n  });\n\n  const { data: contributions = [] } = useQuery<ContributionWithDetails[]>({\n    queryKey: [\"/api/contributions/group\", groupId],\n    enabled: !!groupId,\n  });\n\n  const isLoading = groupLoading || projectsLoading || membersLoading;\n  const isAdmin = user?.id === group?.adminId;\n  const isMember = members.some(m => m.userId === user?.id);\n  const isBoth = isAdmin && isMember;\n\n  const pendingApprovals = contributions.filter(c => c.status === \"pending\").length;\n  const myContributions = contributions.filter(c => c.userId === user?.id);\n  const myPendingPayments = myContributions.filter(c => c.status === \"pending\").length;\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <Navigation />\n        <div className=\"max-w-lg mx-auto px-4 py-6\">\n          <div className=\"flex items-center justify-center py-12\">\n            <div className=\"h-8 w-8 animate-spin rounded-full border-4 border-solid border-green-600 border-r-transparent\"></div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!group) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <Navigation />\n        <div className=\"max-w-lg mx-auto px-4 py-6\">\n          <div className=\"text-center py-12\">\n            <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">Group Not Found</h2>\n            <p className=\"text-gray-600 mb-6\">The group you're looking for doesn't exist.</p>\n            <Button onClick={() => setLocation(\"/groups\")} data-testid=\"button-back-groups\">\n              <ArrowLeft className=\"w-4 h-4 mr-2\" />\n              Back to Groups\n            </Button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  const totalCollected = projects.reduce(\n    (sum, project) => sum + (parseFloat(project.collectedAmount || \"0\") || 0),\n    0,\n  );\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case \"completed\": return \"bg-green-100 text-green-800\";\n      case \"active\": return \"bg-blue-100 text-blue-800\";\n      case \"paused\": return \"bg-orange-100 text-orange-800\";\n      default: return \"bg-gray-100 text-gray-800\";\n    }\n  };\n\n  const getRoleBadge = () => {\n    if (isBoth) {\n      return (\n        <div className=\"flex gap-1\">\n          <Badge className=\"bg-green-100 text-green-700 text-xs\">\n            <Shield className=\"h-3 w-3 mr-1\" />\n            Admin\n          </Badge>\n          <Badge className=\"bg-blue-100 text-blue-700 text-xs\">\n            <UserCheck className=\"h-3 w-3 mr-1\" />\n            Member\n          </Badge>\n        </div>\n      );\n    }\n    if (isAdmin) {\n      return (\n        <Badge className=\"bg-green-100 text-green-700 text-xs\">\n          <Shield className=\"h-3 w-3 mr-1\" />\n          Admin\n        </Badge>\n      );\n    }\n    return (\n      <Badge className=\"bg-blue-100 text-blue-700 text-xs\">\n        <UserCheck className=\"h-3 w-3 mr-1\" />\n        Member\n      </Badge>\n    );\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 pb-24 sm:pb-8\">\n      <Navigation />\n\n      <main className=\"max-w-lg mx-auto px-4 py-6 space-y-6\">\n        <Button\n          variant=\"ghost\"\n          onClick={() => setLocation(\"/groups\")}\n          className=\"mb-2 -ml-2\"\n          data-testid=\"button-back\"\n        >\n          <ArrowLeft className=\"w-4 h-4 mr-2\" />\n          Back to Groups\n        </Button>\n\n        <div className={`rounded-2xl p-6 text-white ${\n          isAdmin ? 'bg-gradient-to-r from-green-600 to-green-700' : 'bg-gradient-to-r from-blue-600 to-blue-700'\n        }`}>\n          <div className=\"flex items-center gap-2 mb-2\">\n            <h1 className=\"text-2xl font-bold\" data-testid=\"text-group-name\">\n              {group.name}\n            </h1>\n            <Badge className={getStatusColor(group.status)}>\n              {group.status}\n            </Badge>\n          </div>\n          {group.description && (\n            <p className=\"text-white/80 mb-3\" data-testid=\"text-group-description\">\n              {group.description}\n            </p>\n          )}\n          \n          <div className=\"bg-white/10 rounded-xl p-3 mb-4\">\n            <p className=\"text-white/70 text-xs mb-1\">Total Generated</p>\n            <p className=\"font-bold text-2xl\" data-testid=\"text-total-generated\">{formatNaira(totalCollected.toString())}</p>\n          </div>\n          \n          <div className=\"flex items-center gap-3\">\n            {getRoleBadge()}\n            <span className=\"text-white/70 text-sm\">{members.length} members</span>\n            <span className=\"text-white/70 text-sm\">{projects.length} projects</span>\n          </div>\n        </div>\n\n        {isBoth ? (\n          <Tabs defaultValue=\"admin\" className=\"w-full\">\n            <TabsList className=\"grid w-full grid-cols-2\">\n              <TabsTrigger value=\"admin\" className=\"flex items-center gap-2\" data-testid=\"tab-admin\">\n                <Shield className=\"h-4 w-4\" />\n                Admin View\n                {pendingApprovals > 0 && (\n                  <span className=\"bg-orange-500 text-white text-xs px-1.5 rounded-full\">{pendingApprovals}</span>\n                )}\n              </TabsTrigger>\n              <TabsTrigger value=\"member\" className=\"flex items-center gap-2\" data-testid=\"tab-member\">\n                <UserCheck className=\"h-4 w-4\" />\n                My Contributions\n              </TabsTrigger>\n            </TabsList>\n            \n            <TabsContent value=\"admin\" className=\"space-y-4 mt-4\">\n              <AdminContent \n                groupId={groupId!}\n                projects={projects}\n                members={members}\n                pendingApprovals={pendingApprovals}\n                setLocation={setLocation}\n                onCreateProject={() => setCreateProjectModalOpen(true)}\n              />\n            </TabsContent>\n            \n            <TabsContent value=\"member\" className=\"space-y-4 mt-4\">\n              <MemberContent\n                groupId={groupId!}\n                projects={projects}\n                myContributions={myContributions}\n                myPendingPayments={myPendingPayments}\n                setLocation={setLocation}\n              />\n            </TabsContent>\n          </Tabs>\n        ) : isAdmin ? (\n          <AdminContent \n            groupId={groupId!}\n            projects={projects}\n            members={members}\n            pendingApprovals={pendingApprovals}\n            setLocation={setLocation}\n            onCreateProject={() => setCreateProjectModalOpen(true)}\n          />\n        ) : (\n          <MemberContent\n            groupId={groupId!}\n            projects={projects}\n            myContributions={myContributions}\n            myPendingPayments={myPendingPayments}\n            setLocation={setLocation}\n          />\n        )}\n      </main>\n\n      {group && (\n        <CreateProjectModal\n          open={createProjectModalOpen}\n          onOpenChange={setCreateProjectModalOpen}\n          groupId={groupId!}\n          groupName={group.name}\n        />\n      )}\n    </div>\n  );\n}\n\nfunction AdminContent({\n  groupId,\n  projects,\n  members,\n  pendingApprovals,\n  setLocation,\n  onCreateProject,\n}: {\n  groupId: string;\n  projects: Project[];\n  members: GroupMemberWithUser[];\n  pendingApprovals: number;\n  setLocation: (path: string) => void;\n  onCreateProject: () => void;\n}) {\n  return (\n    <>\n      {pendingApprovals > 0 && (\n        <Card className=\"bg-orange-50 border-orange-200 rounded-2xl\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center\">\n                  <Bell className=\"h-5 w-5 text-orange-600\" />\n                </div>\n                <div>\n                  <h3 className=\"font-bold text-orange-900\">{pendingApprovals} Pending Approval{pendingApprovals > 1 ? 's' : ''}</h3>\n                  <p className=\"text-sm text-orange-700\">Payment proofs waiting for review</p>\n                </div>\n              </div>\n              <Button\n                size=\"sm\"\n                className=\"bg-orange-600 hover:bg-orange-700\"\n                onClick={() => setLocation(`/admin/projects`)}\n                data-testid=\"button-review-payments\"\n              >\n                Review\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      <div className=\"space-y-3\">\n        <ProjectsDropdown \n          groupId={groupId} \n          projects={projects} \n          setLocation={setLocation}\n          onCreateProject={onCreateProject}\n        />\n\n        <Card\n          className=\"bg-white rounded-2xl border border-gray-100 shadow-sm hover:shadow-md transition-all cursor-pointer active:scale-[0.99]\"\n          onClick={() => setLocation(`/group/${groupId}/members`)}\n          data-testid=\"nav-card-members\"\n        >\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center\">\n                  <Users className=\"h-6 w-6 text-green-600\" />\n                </div>\n                <div>\n                  <h3 className=\"font-bold text-gray-900\">Members</h3>\n                  <p className=\"text-sm text-gray-500\">\n                    {members.length} {members.length === 1 ? \"member\" : \"members\"}\n                  </p>\n                </div>\n              </div>\n              <ChevronRight className=\"h-5 w-5 text-gray-300\" />\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </>\n  );\n}\n\nfunction MemberContent({\n  groupId,\n  projects,\n  myContributions,\n  myPendingPayments,\n  setLocation,\n}: {\n  groupId: string;\n  projects: Project[];\n  myContributions: ContributionWithDetails[];\n  myPendingPayments: number;\n  setLocation: (path: string) => void;\n}) {\n  const myTotalContributed = myContributions\n    .filter(c => c.status === \"confirmed\")\n    .reduce((sum, c) => sum + parseFloat(c.amount), 0);\n\n  return (\n    <>\n      <Card className=\"bg-white rounded-2xl\">\n        <CardContent className=\"p-4 text-center\">\n          <p className=\"text-sm text-gray-500 mb-1\">My Contributions</p>\n          <p className=\"text-xl font-bold text-primary\">{formatNaira(myTotalContributed.toString())}</p>\n        </CardContent>\n      </Card>\n\n      {myPendingPayments > 0 && (\n        <Card className=\"bg-yellow-50 border-yellow-200 rounded-2xl\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center\">\n                <Bell className=\"h-5 w-5 text-yellow-600\" />\n              </div>\n              <div>\n                <h3 className=\"font-bold text-yellow-900\">{myPendingPayments} Pending Payment{myPendingPayments > 1 ? 's' : ''}</h3>\n                <p className=\"text-sm text-yellow-700\">Awaiting admin approval</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      <Card\n        className=\"bg-white rounded-2xl border border-gray-100 shadow-sm hover:shadow-md transition-all cursor-pointer active:scale-[0.99]\"\n        onClick={() => setLocation(`/group/${groupId}/projects`)}\n        data-testid=\"nav-card-projects-member\"\n      >\n        <CardContent className=\"p-4\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-12 h-12 bg-primary/10 rounded-xl flex items-center justify-center\">\n                <CreditCard className=\"h-6 w-6 text-primary\" />\n              </div>\n              <div>\n                <h3 className=\"font-bold text-gray-900\">Submit a Payment</h3>\n                <p className=\"text-sm text-gray-500\">\n                  {projects.length} active {projects.length === 1 ? \"project\" : \"projects\"}\n                </p>\n              </div>\n            </div>\n            <ChevronRight className=\"h-5 w-5 text-gray-300\" />\n          </div>\n        </CardContent>\n      </Card>\n\n      {myContributions.length > 0 && (\n        <Card className=\"bg-white rounded-2xl\">\n          <CardContent className=\"p-5\">\n            <h3 className=\"font-bold text-gray-900 mb-3\">Recent Payments</h3>\n            <div className=\"space-y-3\">\n              {myContributions.slice(0, 5).map((contribution) => (\n                <div key={contribution.id} className=\"flex items-center justify-between py-2 border-b border-gray-100 last:border-0\">\n                  <div>\n                    <p className=\"font-medium text-gray-900\">{contribution.projectName || \"General\"}</p>\n                    <p className=\"text-xs text-gray-500\">\n                      {new Date(contribution.createdAt).toLocaleDateString(\"en-NG\", { \n                        day: \"numeric\", month: \"short\", year: \"numeric\" \n                      })}\n                    </p>\n                  </div>\n                  <div className=\"text-right\">\n                    <p className=\"font-bold text-gray-900\">{formatNaira(contribution.amount)}</p>\n                    <Badge className={\n                      contribution.status === \"confirmed\" \n                        ? \"bg-green-100 text-green-700\" \n                        : \"bg-yellow-100 text-yellow-700\"\n                    }>\n                      {contribution.status}\n                    </Badge>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </>\n  );\n}\n\nfunction ProjectsDropdown({\n  groupId,\n  projects,\n  setLocation,\n  onCreateProject,\n}: {\n  groupId: string;\n  projects: Project[];\n  setLocation: (path: string) => void;\n  onCreateProject: () => void;\n}) {\n  const [isOpen, setIsOpen] = useState(false);\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case \"completed\": return \"bg-green-100 text-green-700\";\n      case \"active\": return \"bg-blue-100 text-blue-700\";\n      case \"paused\": return \"bg-orange-100 text-orange-700\";\n      default: return \"bg-gray-100 text-gray-700\";\n    }\n  };\n\n  return (\n    <Collapsible open={isOpen} onOpenChange={setIsOpen}>\n      <Card className=\"bg-white rounded-2xl border border-gray-100 shadow-sm\">\n        <CollapsibleTrigger asChild>\n          <CardContent className=\"p-4 cursor-pointer hover:bg-gray-50 transition-colors\" data-testid=\"dropdown-projects\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center\">\n                  <FolderKanban className=\"h-6 w-6 text-blue-600\" />\n                </div>\n                <div>\n                  <h3 className=\"font-bold text-gray-900\">Projects</h3>\n                  <p className=\"text-sm text-gray-500\">\n                    {projects.length} {projects.length === 1 ? \"project\" : \"projects\"}\n                  </p>\n                </div>\n              </div>\n              <ChevronDown className={`h-5 w-5 text-gray-400 transition-transform ${isOpen ? 'rotate-180' : ''}`} />\n            </div>\n          </CardContent>\n        </CollapsibleTrigger>\n        \n        <CollapsibleContent>\n          <div className=\"px-4 pb-4 space-y-2\">\n            {projects.length === 0 ? (\n              <div className=\"text-center py-4\">\n                <p className=\"text-sm text-gray-500 mb-3\">No projects yet</p>\n                <Button\n                  size=\"sm\"\n                  onClick={onCreateProject}\n                  data-testid=\"button-create-project\"\n                >\n                  <Plus className=\"h-4 w-4 mr-1\" />\n                  Create Project\n                </Button>\n              </div>\n            ) : (\n              <>\n                {projects.map((project) => (\n                  <div\n                    key={project.id}\n                    className=\"flex items-center justify-between p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition-colors\"\n                    onClick={() => setLocation(`/project/${project.id}`)}\n                    data-testid={`project-item-${project.id}`}\n                  >\n                    <div className=\"flex-1 min-w-0\">\n                      <p className=\"font-medium text-gray-900 truncate\">{project.name}</p>\n                      <div className=\"flex items-center gap-2 mt-1\">\n                        <Badge className={`text-xs ${getStatusColor(project.status)}`}>\n                          {project.status}\n                        </Badge>\n                        {project.targetAmount && parseFloat(project.targetAmount) > 0 && (\n                          <span className=\"text-xs text-gray-500\">\n                            {formatNaira(project.collectedAmount || \"0\")} / {formatNaira(project.targetAmount)}\n                          </span>\n                        )}\n                      </div>\n                    </div>\n                    <ChevronRight className=\"h-4 w-4 text-gray-400 flex-shrink-0\" />\n                  </div>\n                ))}\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"w-full mt-2\"\n                  onClick={onCreateProject}\n                  data-testid=\"button-add-project\"\n                >\n                  <Plus className=\"h-4 w-4 mr-1\" />\n                  Add New Project\n                </Button>\n              </>\n            )}\n          </div>\n        </CollapsibleContent>\n      </Card>\n    </Collapsible>\n  );\n}\n","path":null,"size_bytes":19506,"size_tokens":null},"client/src/pages/project-details.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useLocation, useParams } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Navigation } from \"@/components/navigation\";\nimport { PaymentModal } from \"@/components/payment-modal\";\nimport {\n  ArrowLeft,\n  Target,\n  Calendar,\n  Users,\n  Loader2,\n  Building2,\n  Copy,\n  Check,\n  CreditCard,\n  Share2,\n  FileImage,\n  ChevronRight,\n  Eye,\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { formatNaira } from \"@/lib/currency\";\nimport { getCurrentUser } from \"@/lib/auth\";\nimport type { Project, ContributionWithDetails, Group } from \"@shared/schema\";\n\nexport default function ProjectDetails() {\n  const { projectId } = useParams();\n  const [, setLocation] = useLocation();\n  const [paymentOpen, setPaymentOpen] = useState(false);\n  const [copiedField, setCopiedField] = useState<string | null>(null);\n  const [linkCopied, setLinkCopied] = useState(false);\n  const [selectedProof, setSelectedProof] = useState<string | null>(null);\n  const { toast } = useToast();\n  const user = getCurrentUser();\n\n  const { data: project, isLoading: projectLoading } = useQuery<Project>({\n    queryKey: [`/api/projects/${projectId}`],\n    enabled: !!projectId,\n  });\n\n  const { data: group } = useQuery<Group>({\n    queryKey: [`/api/groups/${project?.groupId}`],\n    enabled: !!project?.groupId,\n  });\n\n  const { data: contributions = [], isLoading: contributionsLoading } =\n    useQuery<ContributionWithDetails[]>({\n      queryKey: [`/api/contributions/project/${projectId}`],\n      enabled: !!projectId,\n    });\n\n  const isLoading = projectLoading || contributionsLoading;\n  const isAdmin = user?.id === group?.adminId;\n\n  const confirmedContributions = contributions.filter(\n    (c) => c.status === \"confirmed\",\n  );\n  const totalContributed = confirmedContributions.reduce(\n    (sum, contribution) => sum + parseFloat(contribution.amount || \"0\"),\n    0,\n  );\n\n  const hasTarget = project?.targetAmount && parseFloat(project.targetAmount) > 0;\n  const progress = project && hasTarget\n    ? Math.min(\n        Math.round(\n          (parseFloat(project.collectedAmount) /\n            parseFloat(project.targetAmount!)) *\n            100,\n        ),\n        100,\n      )\n    : 0;\n\n  const copyToClipboard = async (text: string, fieldName: string) => {\n    try {\n      await navigator.clipboard.writeText(text);\n      setCopiedField(fieldName);\n      setTimeout(() => setCopiedField(null), 2000);\n    } catch (err) {\n      console.error(\"Failed to copy:\", err);\n    }\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case \"completed\":\n        return \"bg-green-100 text-green-800\";\n      case \"active\":\n        return \"bg-blue-100 text-blue-800\";\n      case \"paused\":\n        return \"bg-orange-100 text-orange-800\";\n      default:\n        return \"bg-gray-100 text-gray-800\";\n    }\n  };\n\n  const getProjectTypeLabel = (type: string | undefined) => {\n    switch (type) {\n      case \"monthly\": return \"Monthly Dues\";\n      case \"yearly\": return \"Yearly Dues\";\n      case \"event\": return \"Event Collection\";\n      case \"emergency\": return \"Emergency Fund\";\n      default: return \"Target Goal\";\n    }\n  };\n\n  const formatDeadline = (deadline: string | Date | null) => {\n    if (!deadline) return null;\n    const date = new Date(deadline);\n    return date.toLocaleDateString(\"en-NG\", {\n      day: \"numeric\",\n      month: \"long\",\n      year: \"numeric\",\n    });\n  };\n\n  const sortedContributions = [...confirmedContributions].sort(\n    (a, b) => parseFloat(b.amount) - parseFloat(a.amount),\n  );\n\n  const projectUrl = `${window.location.origin}/project/${projectId}`;\n\n  const handleCopyLink = async () => {\n    try {\n      await navigator.clipboard.writeText(projectUrl);\n      setLinkCopied(true);\n      toast({ title: \"Link copied!\", description: \"Share it with group members\" });\n      setTimeout(() => setLinkCopied(false), 2000);\n    } catch (err) {\n      toast({ title: \"Failed to copy\", variant: \"destructive\" });\n    }\n  };\n\n  const generateProjectSlug = (name: string) => {\n    return name\n      .toLowerCase()\n      .replace(/[^a-z0-9\\s-]/g, '')\n      .replace(/\\s+/g, '')\n      .slice(0, 50);\n  };\n\n  const handleShareWhatsApp = () => {\n    if (!project || !group) return;\n    \n    const groupSlug = group.customSlug || group.registrationLink;\n    const projectSlug = generateProjectSlug(project.name);\n    const joinLink = `kontrib.app/join/${groupSlug}/${projectSlug}`;\n    const groupName = group.name;\n    \n    const shareText = `${joinLink}\\n\\nYou have been invited to join ${groupName} on Kontrib!\\n\\nLogin to submit your contributions to ${project.name}\\n\\nLet's keep it transparent\\n\\nKontrib.app`;\n    \n    const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(shareText)}`;\n    window.open(whatsappUrl, '_blank');\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <Navigation />\n        <div className=\"max-w-lg mx-auto px-4 py-12 flex items-center justify-center\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n        </div>\n      </div>\n    );\n  }\n\n  if (!project) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <Navigation />\n        <div className=\"max-w-lg mx-auto px-4 py-12 text-center\">\n          <h2 className=\"text-xl font-bold text-gray-900 mb-2\">\n            Project Not Found\n          </h2>\n          <p className=\"text-gray-500 mb-6\">\n            This project doesn't exist or has been removed.\n          </p>\n          <button\n            onClick={() => setLocation(\"/dashboard\")}\n            className=\"text-primary font-medium\"\n          >\n            Back to Dashboard\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  const hasPaymentDetails = project.accountNumber || project.bankName || project.paymentInstructions;\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 pb-24\">\n      <Navigation />\n\n      <div className=\"max-w-lg mx-auto px-4 py-6 space-y-6\">\n        {/* Back Button */}\n        <button\n          onClick={() => window.history.back()}\n          className=\"flex items-center gap-2 text-gray-600 hover:text-gray-900\"\n          data-testid=\"button-back\"\n        >\n          <ArrowLeft className=\"w-5 h-5\" />\n          <span>Back</span>\n        </button>\n\n        {/* Project Header */}\n        <div className=\"bg-primary rounded-2xl p-5 text-white\">\n          <div className=\"flex items-center gap-2 mb-2\">\n            <Badge className=\"bg-white/20 text-white border-0 text-xs\">\n              {getProjectTypeLabel(project.projectType)}\n            </Badge>\n            <Badge className={`${getStatusColor(project.status)} text-xs`}>\n              {project.status}\n            </Badge>\n          </div>\n          <h1 className=\"text-2xl font-bold mb-2\" data-testid=\"text-project-name\">\n            {project.name}\n          </h1>\n          {project.description && (\n            <p className=\"text-green-100 text-sm mb-4\">\n              {project.description}\n            </p>\n          )}\n          \n          {/* Stats */}\n          <div className=\"grid grid-cols-2 gap-3 mt-4\">\n            {hasTarget && (\n              <div className=\"bg-white/10 rounded-xl p-3\">\n                <p className=\"text-green-200 text-xs flex items-center gap-1\">\n                  <Target className=\"h-3 w-3\" />\n                  Target\n                </p>\n                <p className=\"font-bold text-lg\">{formatNaira(project.targetAmount!)}</p>\n              </div>\n            )}\n            <div className={`bg-white/10 rounded-xl p-3 ${!hasTarget ? 'col-span-2' : ''}`}>\n              <p className=\"text-green-200 text-xs\">Collected</p>\n              <p className=\"font-bold text-lg\">{formatNaira(project.collectedAmount)}</p>\n            </div>\n          </div>\n\n          {project.deadline && (\n            <div className=\"flex items-center gap-2 mt-4 text-sm text-green-100\">\n              <Calendar className=\"h-4 w-4\" />\n              <span>Due: {formatDeadline(project.deadline)}</span>\n            </div>\n          )}\n        </div>\n\n        {/* Progress Card - only for target-based projects */}\n        {hasTarget && (\n          <Card className=\"rounded-2xl border-0 shadow-sm\">\n            <CardContent className=\"p-5\">\n              <div className=\"flex justify-between items-center mb-2\">\n                <span className=\"text-sm font-medium text-gray-600\">\n                  Progress\n                </span>\n                <span className=\"text-lg font-bold text-primary\">\n                  {progress}%\n                </span>\n              </div>\n              <Progress value={progress} className=\"h-3 mb-3\" />\n              <div className=\"flex justify-between text-sm text-gray-500\">\n                <span>Collected: {formatNaira(project.collectedAmount)}</span>\n                <span>\n                  Remaining: {formatNaira(\n                    Math.max(0, parseFloat(project.targetAmount!) - parseFloat(project.collectedAmount))\n                  )}\n                </span>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Payment Details */}\n        {hasPaymentDetails && (\n          <div className=\"bg-blue-50 border border-blue-100 rounded-2xl p-4 space-y-3\">\n            <div className=\"flex items-center gap-2 text-blue-700 font-medium\">\n              <Building2 className=\"h-5 w-5\" />\n              <span>Payment Details</span>\n            </div>\n            \n            {project.bankName && (\n              <div className=\"flex items-center justify-between bg-white rounded-xl p-3\">\n                <div>\n                  <p className=\"text-xs text-gray-500\">Bank</p>\n                  <p className=\"font-medium text-gray-900\">{project.bankName}</p>\n                </div>\n                <button\n                  onClick={() => copyToClipboard(project.bankName!, \"bank\")}\n                  className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n                >\n                  {copiedField === \"bank\" ? (\n                    <Check className=\"h-4 w-4 text-green-600\" />\n                  ) : (\n                    <Copy className=\"h-4 w-4 text-gray-400\" />\n                  )}\n                </button>\n              </div>\n            )}\n\n            {project.accountNumber && (\n              <div className=\"flex items-center justify-between bg-white rounded-xl p-3\">\n                <div>\n                  <p className=\"text-xs text-gray-500\">Account Number</p>\n                  <p className=\"font-bold text-gray-900 text-lg tracking-wider\">{project.accountNumber}</p>\n                </div>\n                <button\n                  onClick={() => copyToClipboard(project.accountNumber!, \"account\")}\n                  className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n                >\n                  {copiedField === \"account\" ? (\n                    <Check className=\"h-4 w-4 text-green-600\" />\n                  ) : (\n                    <Copy className=\"h-4 w-4 text-gray-400\" />\n                  )}\n                </button>\n              </div>\n            )}\n\n            {project.accountName && (\n              <div className=\"flex items-center justify-between bg-white rounded-xl p-3\">\n                <div>\n                  <p className=\"text-xs text-gray-500\">Account Name</p>\n                  <p className=\"font-medium text-gray-900\">{project.accountName}</p>\n                </div>\n                <button\n                  onClick={() => copyToClipboard(project.accountName!, \"name\")}\n                  className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n                >\n                  {copiedField === \"name\" ? (\n                    <Check className=\"h-4 w-4 text-green-600\" />\n                  ) : (\n                    <Copy className=\"h-4 w-4 text-gray-400\" />\n                  )}\n                </button>\n              </div>\n            )}\n\n            {project.paymentInstructions && (\n              <div className=\"bg-white rounded-xl p-3\">\n                <p className=\"text-xs text-gray-500 mb-1\">Additional Instructions</p>\n                <p className=\"text-gray-700 text-sm\">{project.paymentInstructions}</p>\n              </div>\n            )}\n          </div>\n        )}\n\n        {/* Share Project */}\n        <Card className=\"rounded-2xl border-0 shadow-sm bg-green-50 border-green-100\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-2 mb-3\">\n              <Share2 className=\"h-5 w-5 text-green-700\" />\n              <h3 className=\"font-bold text-green-900\">Share This Project</h3>\n            </div>\n            <p className=\"text-sm text-green-700 mb-4\">\n              Invite group members to contribute by sharing the project details on WhatsApp\n            </p>\n            <div className=\"flex gap-3\">\n              <Button\n                variant=\"outline\"\n                className=\"flex-1 border-green-200 hover:bg-green-100\"\n                onClick={handleCopyLink}\n                data-testid=\"button-copy-project-link\"\n              >\n                {linkCopied ? (\n                  <>\n                    <Check className=\"h-4 w-4 mr-2 text-green-600\" />\n                    Copied!\n                  </>\n                ) : (\n                  <>\n                    <Copy className=\"h-4 w-4 mr-2\" />\n                    Copy Link\n                  </>\n                )}\n              </Button>\n              <Button\n                className=\"flex-1 bg-green-600 hover:bg-green-700\"\n                onClick={handleShareWhatsApp}\n                data-testid=\"button-share-whatsapp\"\n              >\n                <Share2 className=\"h-4 w-4 mr-2\" />\n                WhatsApp\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Payment Proofs - Admin Only */}\n        {isAdmin && (\n          <Card className=\"rounded-2xl border-0 shadow-sm\">\n            <CardHeader className=\"pb-3\">\n              <div className=\"flex items-center justify-between\">\n                <CardTitle className=\"flex items-center gap-2 text-lg\">\n                  <FileImage className=\"w-5 h-5 text-orange-600\" />\n                  Payment Proofs\n                </CardTitle>\n                <Badge variant=\"secondary\" className=\"text-xs\">\n                  {contributions.filter(c => c.proofOfPayment).length}\n                </Badge>\n              </div>\n            </CardHeader>\n            <CardContent>\n              {contributions.filter(c => c.proofOfPayment).length === 0 ? (\n                <div className=\"text-center py-6\">\n                  <div className=\"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3\">\n                    <FileImage className=\"w-6 h-6 text-gray-400\" />\n                  </div>\n                  <p className=\"text-sm text-gray-500\">No payment proofs uploaded yet</p>\n                </div>\n              ) : (\n                <div className=\"space-y-2\">\n                  {contributions\n                    .filter(c => c.proofOfPayment)\n                    .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime())\n                    .map((contribution) => (\n                      <div\n                        key={contribution.id}\n                        className=\"flex items-center justify-between p-3 bg-gray-50 rounded-xl hover:bg-gray-100 cursor-pointer transition-colors\"\n                        onClick={() => setSelectedProof(contribution.proofOfPayment!)}\n                        data-testid={`payment-proof-${contribution.id}`}\n                      >\n                        <div className=\"flex items-center gap-3\">\n                          <div className={`w-10 h-10 rounded-full flex items-center justify-center ${\n                            contribution.status === 'confirmed' \n                              ? 'bg-green-100' \n                              : contribution.status === 'pending'\n                              ? 'bg-yellow-100'\n                              : 'bg-red-100'\n                          }`}>\n                            <FileImage className={`w-5 h-5 ${\n                              contribution.status === 'confirmed' \n                                ? 'text-green-600' \n                                : contribution.status === 'pending'\n                                ? 'text-yellow-600'\n                                : 'text-red-600'\n                            }`} />\n                          </div>\n                          <div>\n                            <p className=\"font-medium text-gray-900\">{contribution.userName}</p>\n                            <div className=\"flex items-center gap-2\">\n                              <p className=\"text-xs text-gray-500\">\n                                {new Date(contribution.createdAt).toLocaleDateString(\"en-NG\", { \n                                  day: \"numeric\", month: \"short\" \n                                })}\n                              </p>\n                              <Badge className={`text-xs ${\n                                contribution.status === 'confirmed' \n                                  ? 'bg-green-100 text-green-700' \n                                  : contribution.status === 'pending'\n                                  ? 'bg-yellow-100 text-yellow-700'\n                                  : 'bg-red-100 text-red-700'\n                              }`}>\n                                {contribution.status}\n                              </Badge>\n                            </div>\n                          </div>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"font-bold text-gray-900\">{formatNaira(contribution.amount)}</span>\n                          <Eye className=\"w-4 h-4 text-gray-400\" />\n                        </div>\n                      </div>\n                    ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Payment Proof Viewer Modal */}\n        {selectedProof && (\n          <div \n            className=\"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4\"\n            onClick={() => setSelectedProof(null)}\n          >\n            <div className=\"relative max-w-lg w-full max-h-[80vh] overflow-auto bg-white rounded-2xl p-2\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"absolute top-2 right-2 z-10\"\n                onClick={() => setSelectedProof(null)}\n              >\n                ✕\n              </Button>\n              <img \n                src={selectedProof} \n                alt=\"Payment proof\" \n                className=\"w-full h-auto rounded-xl\"\n                onClick={(e) => e.stopPropagation()}\n              />\n            </div>\n          </div>\n        )}\n\n        {/* Contributors Section */}\n        <Card className=\"rounded-2xl border-0 shadow-sm\">\n          <CardHeader className=\"pb-3\">\n            <div className=\"flex items-center justify-between\">\n              <CardTitle className=\"flex items-center gap-2 text-lg\">\n                <Users className=\"w-5 h-5 text-primary\" />\n                Contributors\n              </CardTitle>\n              <Badge variant=\"secondary\" className=\"text-xs\">\n                {confirmedContributions.length}\n              </Badge>\n            </div>\n          </CardHeader>\n          <CardContent>\n            {sortedContributions.length === 0 ? (\n              <div className=\"text-center py-8\">\n                <div className=\"w-14 h-14 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3\">\n                  <Users className=\"w-7 h-7 text-gray-400\" />\n                </div>\n                <p className=\"font-medium text-gray-900 mb-1\">No Contributors Yet</p>\n                <p className=\"text-sm text-gray-500\">\n                  Be the first to contribute!\n                </p>\n              </div>\n            ) : (\n              <div className=\"space-y-2\">\n                {sortedContributions.map((contribution, index) => (\n                  <div\n                    key={contribution.id}\n                    className=\"flex items-center justify-between py-3 px-3 bg-gray-50 rounded-xl\"\n                    data-testid={`contributor-row-${index}`}\n                  >\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center\">\n                        <span className=\"font-semibold text-primary\">\n                          {contribution.userName?.charAt(0)?.toUpperCase() || \"?\"}\n                        </span>\n                      </div>\n                      <span className=\"font-medium text-gray-900\">\n                        {contribution.userName}\n                      </span>\n                    </div>\n                    <span className=\"font-bold text-gray-900\">\n                      {formatNaira(contribution.amount)}\n                    </span>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Submit Proof Button */}\n        <div className=\"fixed bottom-6 left-4 right-4 max-w-lg mx-auto\">\n          <button\n            onClick={() => setPaymentOpen(true)}\n            className=\"w-full bg-primary hover:bg-primary/90 text-white font-semibold text-lg py-4 rounded-full shadow-lg flex items-center justify-center gap-2 transition-all active:scale-[0.98]\"\n            data-testid=\"button-submit-proof\"\n          >\n            <CreditCard className=\"h-5 w-5\" />\n            Submit Payment Proof\n          </button>\n        </div>\n      </div>\n\n      <PaymentModal\n        open={paymentOpen}\n        onOpenChange={setPaymentOpen}\n        project={project}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":22194,"size_tokens":null},"render.yaml":{"content":"services:\n  - type: web\n    name: kontrib\n    runtime: node\n    env: node\n    buildCommand: npm install --production=false && npm run build\n    startCommand: npm start\n    envVars:\n      - key: DATABASE_URL\n        sync: false\n","path":null,"size_bytes":227,"size_tokens":null},"client/src/components/ui/kontrib-ui.tsx":{"content":"import { cn } from \"@/lib/utils\";\nimport { Check, X, Clock, Upload, Share2 } from \"lucide-react\";\nimport { SiWhatsapp } from \"react-icons/si\";\n\ninterface ProgressCircleProps {\n  percentage: number;\n  size?: number;\n  strokeWidth?: number;\n  className?: string;\n  showLabel?: boolean;\n  collected?: string;\n  target?: string;\n}\n\nexport function ProgressCircle({\n  percentage,\n  size = 120,\n  strokeWidth = 10,\n  className,\n  showLabel = true,\n  collected,\n  target,\n}: ProgressCircleProps) {\n  const radius = (size - strokeWidth) / 2;\n  const circumference = radius * 2 * Math.PI;\n  const offset = circumference - (Math.min(percentage, 100) / 100) * circumference;\n\n  return (\n    <div className={cn(\"relative inline-flex items-center justify-center\", className)}>\n      <svg width={size} height={size} className=\"-rotate-90\">\n        <circle\n          cx={size / 2}\n          cy={size / 2}\n          r={radius}\n          fill=\"none\"\n          className=\"stroke-gray-200\"\n          strokeWidth={strokeWidth}\n        />\n        <circle\n          cx={size / 2}\n          cy={size / 2}\n          r={radius}\n          fill=\"none\"\n          className=\"stroke-primary transition-all duration-500 ease-out\"\n          strokeWidth={strokeWidth}\n          strokeDasharray={circumference}\n          strokeDashoffset={offset}\n          strokeLinecap=\"round\"\n        />\n      </svg>\n      {showLabel && (\n        <div className=\"absolute inset-0 flex flex-col items-center justify-center\">\n          <span className=\"text-2xl font-bold text-gray-900 dark:text-white\">{Math.round(percentage)}%</span>\n          {collected && target && (\n            <span className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">of target</span>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\ninterface StatusBadgeProps {\n  status: \"paid\" | \"pending\" | \"unpaid\" | \"confirmed\" | \"rejected\";\n  className?: string;\n  size?: \"sm\" | \"md\" | \"lg\";\n}\n\nexport function StatusBadge({ status, className, size = \"md\" }: StatusBadgeProps) {\n  const sizeClasses = {\n    sm: \"px-2 py-0.5 text-xs\",\n    md: \"px-3 py-1.5 text-sm\",\n    lg: \"px-4 py-2 text-base\",\n  };\n\n  const statusConfig = {\n    paid: {\n      bg: \"bg-green-100\",\n      text: \"text-green-800\",\n      icon: Check,\n      label: \"Paid\",\n    },\n    confirmed: {\n      bg: \"bg-green-100\",\n      text: \"text-green-800\",\n      icon: Check,\n      label: \"Confirmed\",\n    },\n    pending: {\n      bg: \"bg-amber-100\",\n      text: \"text-amber-800\",\n      icon: Clock,\n      label: \"Pending\",\n    },\n    unpaid: {\n      bg: \"bg-red-100\",\n      text: \"text-red-800\",\n      icon: X,\n      label: \"Not Paid\",\n    },\n    rejected: {\n      bg: \"bg-red-100\",\n      text: \"text-red-800\",\n      icon: X,\n      label: \"Rejected\",\n    },\n  };\n\n  const config = statusConfig[status];\n  const Icon = config.icon;\n\n  return (\n    <span\n      className={cn(\n        \"inline-flex items-center gap-1.5 font-medium rounded-full\",\n        sizeClasses[size],\n        config.bg,\n        config.text,\n        className\n      )}\n      data-testid={`badge-status-${status}`}\n    >\n      <Icon className=\"h-3.5 w-3.5\" />\n      {config.label}\n    </span>\n  );\n}\n\ninterface BigButtonProps {\n  children: React.ReactNode;\n  onClick?: () => void;\n  disabled?: boolean;\n  loading?: boolean;\n  variant?: \"primary\" | \"outline\" | \"whatsapp\";\n  className?: string;\n  icon?: React.ReactNode;\n  type?: \"button\" | \"submit\";\n  \"data-testid\"?: string;\n}\n\nexport function BigButton({\n  children,\n  onClick,\n  disabled,\n  loading,\n  variant = \"primary\",\n  className,\n  icon,\n  type = \"button\",\n  \"data-testid\": testId,\n}: BigButtonProps) {\n  const baseClasses =\n    \"inline-flex items-center justify-center gap-3 px-6 py-4 text-lg font-semibold rounded-xl transition-all duration-200 active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed min-h-[56px] w-full touch-action-manipulation\";\n\n  const variantClasses = {\n    primary: \"bg-primary hover:bg-primary/90 text-white\",\n    outline: \"border-2 border-primary text-primary hover:bg-primary/5 bg-white dark:bg-transparent\",\n    whatsapp: \"bg-[#25D366] hover:bg-[#20bd5a] text-white\",\n  };\n\n  return (\n    <button\n      type={type}\n      onClick={onClick}\n      disabled={disabled || loading}\n      className={cn(baseClasses, variantClasses[variant], className)}\n      data-testid={testId}\n    >\n      {loading ? (\n        <div className=\"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\n      ) : (\n        icon\n      )}\n      {children}\n    </button>\n  );\n}\n\ninterface WhatsAppShareButtonProps {\n  message: string;\n  className?: string;\n  size?: \"sm\" | \"md\" | \"lg\";\n}\n\nexport function WhatsAppShareButton({ message, className, size = \"md\" }: WhatsAppShareButtonProps) {\n  const sizeClasses = {\n    sm: \"px-4 py-2 text-sm\",\n    md: \"px-6 py-4 text-lg\",\n    lg: \"px-8 py-5 text-xl\",\n  };\n\n  const iconSizes = {\n    sm: \"h-4 w-4\",\n    md: \"h-5 w-5\",\n    lg: \"h-6 w-6\",\n  };\n\n  const handleShare = () => {\n    const encodedMessage = encodeURIComponent(message);\n    window.open(`https://wa.me/?text=${encodedMessage}`, \"_blank\");\n  };\n\n  return (\n    <button\n      onClick={handleShare}\n      className={cn(\n        \"inline-flex items-center justify-center gap-2 font-semibold text-white rounded-xl transition-all duration-200 active:scale-[0.98] bg-[#25D366] hover:bg-[#20bd5a]\",\n        sizeClasses[size],\n        className\n      )}\n      data-testid=\"button-whatsapp-share\"\n    >\n      <SiWhatsapp className={iconSizes[size]} />\n      Share on WhatsApp\n    </button>\n  );\n}\n\ninterface UploadProofButtonProps {\n  onClick?: () => void;\n  className?: string;\n}\n\nexport function UploadProofButton({ onClick, className }: UploadProofButtonProps) {\n  return (\n    <BigButton\n      onClick={onClick}\n      variant=\"primary\"\n      icon={<Upload className=\"h-5 w-5\" />}\n      className={className}\n      data-testid=\"button-upload-proof\"\n    >\n      Upload Payment Proof\n    </BigButton>\n  );\n}\n\ninterface MemberListItemProps {\n  name: string;\n  amount?: string;\n  status: \"paid\" | \"pending\" | \"unpaid\";\n  avatarUrl?: string;\n  className?: string;\n}\n\nexport function MemberListItem({\n  name,\n  amount,\n  status,\n  avatarUrl,\n  className,\n}: MemberListItemProps) {\n  return (\n    <div\n      className={cn(\n        \"flex items-center justify-between p-4 bg-white rounded-xl border border-gray-100\",\n        className\n      )}\n      data-testid={`member-item-${name.toLowerCase().replace(/\\s/g, \"-\")}`}\n    >\n      <div className=\"flex items-center gap-3\">\n        <div className=\"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 font-medium\">\n          {avatarUrl ? (\n            <img src={avatarUrl} alt={name} className=\"w-full h-full rounded-full object-cover\" />\n          ) : (\n            name.charAt(0).toUpperCase()\n          )}\n        </div>\n        <div>\n          <p className=\"font-medium text-gray-900\">{name}</p>\n          {amount && <p className=\"text-sm text-gray-500\">₦{amount}</p>}\n        </div>\n      </div>\n      <StatusBadge status={status} size=\"sm\" />\n    </div>\n  );\n}\n\ninterface AmountDisplayProps {\n  amount: string | number;\n  label?: string;\n  size?: \"sm\" | \"md\" | \"lg\";\n  className?: string;\n}\n\nexport function AmountDisplay({ amount, label, size = \"md\", className }: AmountDisplayProps) {\n  const sizeClasses = {\n    sm: \"text-lg\",\n    md: \"text-2xl\",\n    lg: \"text-4xl\",\n  };\n\n  const formattedAmount =\n    typeof amount === \"number\"\n      ? amount.toLocaleString(\"en-NG\")\n      : parseFloat(amount).toLocaleString(\"en-NG\");\n\n  return (\n    <div className={cn(\"flex flex-col\", className)}>\n      {label && <span className=\"text-sm text-gray-500 mb-1\">{label}</span>}\n      <span className={cn(\"font-bold text-primary\", sizeClasses[size])} data-testid=\"text-amount\">\n        ₦{formattedAmount}\n      </span>\n    </div>\n  );\n}\n\ninterface CardKontribProps {\n  children: React.ReactNode;\n  className?: string;\n  onClick?: () => void;\n}\n\nexport function CardKontrib({ children, className, onClick }: CardKontribProps) {\n  return (\n    <div\n      onClick={onClick}\n      className={cn(\n        \"bg-white rounded-2xl border border-gray-100 shadow-sm p-5\",\n        onClick && \"cursor-pointer hover:shadow-md transition-shadow\",\n        className\n      )}\n    >\n      {children}\n    </div>\n  );\n}\n\ninterface SkeletonProps {\n  className?: string;\n}\n\nexport function Skeleton({ className }: SkeletonProps) {\n  return <div className={cn(\"animate-pulse bg-gray-200 rounded-lg\", className)} />;\n}\n\nexport function CardSkeleton() {\n  return (\n    <div className=\"bg-white rounded-2xl border border-gray-100 p-5 space-y-4\">\n      <Skeleton className=\"h-6 w-3/4\" />\n      <Skeleton className=\"h-4 w-1/2\" />\n      <div className=\"flex gap-2\">\n        <Skeleton className=\"h-10 w-24\" />\n        <Skeleton className=\"h-10 w-24\" />\n      </div>\n    </div>\n  );\n}\n\nexport function DashboardSkeleton() {\n  return (\n    <div className=\"space-y-6 p-4\">\n      <Skeleton className=\"h-32 w-full rounded-2xl\" />\n      <div className=\"grid gap-4\">\n        <CardSkeleton />\n        <CardSkeleton />\n        <CardSkeleton />\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":9149,"size_tokens":null},"client/src/pages/group-members.tsx":{"content":"import { useLocation, useRoute } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { ArrowLeft, Users, Trash2 } from \"lucide-react\";\nimport { Navigation } from \"@/components/navigation\";\nimport { useState } from \"react\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { getCurrentUser } from \"@/lib/auth\";\n\ninterface MemberWithUser {\n  id: string;\n  userId: string;\n  groupId: string;\n  status: string;\n  user: {\n    id: string;\n    fullName: string;\n    phoneNumber?: string;\n    phone_number?: string;\n    username: string | null;\n  };\n}\n\ninterface Group {\n  id: string;\n  name: string;\n  adminId: string;\n}\n\nexport default function GroupMembers() {\n  const [, setLocation] = useLocation();\n  const [, params] = useRoute(\"/group/:groupId/members\");\n  const groupId = params?.groupId;\n  const { toast } = useToast();\n  const [memberToDelete, setMemberToDelete] = useState<MemberWithUser | null>(null);\n  const currentUser = getCurrentUser();\n\n  const { data: group, isLoading: groupLoading } = useQuery<Group>({\n    queryKey: [\"/api/groups\", groupId],\n    enabled: !!groupId,\n  });\n\n  const { data: members = [], isLoading: membersLoading } = useQuery<MemberWithUser[]>({\n    queryKey: [\"/api/groups\", groupId, \"members\"],\n    enabled: !!groupId,\n  });\n\n  // Check if the current user is the group admin\n  const isAdmin = currentUser?.id === group?.adminId;\n\n  const removeMemberMutation = useMutation({\n    mutationFn: async (memberId: string) => {\n      return apiRequest(\"DELETE\", `/api/groups/${groupId}/members/${memberId}`, { \n        adminId: currentUser?.id \n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/groups\", groupId, \"members\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/groups\", groupId] });\n      toast({\n        title: \"Member Removed\",\n        description: \"The member has been removed and notified.\",\n      });\n      setMemberToDelete(null);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to remove member\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const isLoading = groupLoading || membersLoading;\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <Navigation />\n        <div className=\"max-w-2xl mx-auto px-4 py-6\">\n          <div className=\"flex items-center justify-center py-12\">\n            <div className=\"h-8 w-8 animate-spin rounded-full border-4 border-solid border-green-600 border-r-transparent\"></div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!group) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <Navigation />\n        <div className=\"max-w-2xl mx-auto px-4 py-6\">\n          <div className=\"text-center py-12\">\n            <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">Group Not Found</h2>\n            <p className=\"text-gray-600 mb-6\">The group you're looking for doesn't exist.</p>\n            <Button onClick={() => setLocation(\"/dashboard\")} data-testid=\"button-back-dashboard\">\n              <ArrowLeft className=\"w-4 h-4 mr-2\" />\n              Back to Dashboard\n            </Button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  const formatPhone = (phone: string) => {\n    if (!phone) return \"\";\n    if (phone.startsWith(\"+234\")) {\n      return phone.replace(\"+234\", \"0\");\n    }\n    return phone;\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 pb-20 sm:pb-0\">\n      <Navigation />\n\n      <div className=\"max-w-2xl mx-auto px-4 py-6\">\n        <Button\n          variant=\"ghost\"\n          onClick={() => setLocation(`/group/${groupId}`)}\n          className=\"mb-6\"\n          data-testid=\"button-back\"\n        >\n          <ArrowLeft className=\"w-4 h-4 mr-2\" />\n          Back to Group\n        </Button>\n\n        <div className=\"mb-6\">\n          <h1 className=\"text-2xl font-bold text-gray-900\" data-testid=\"text-page-title\">\n            Group Members\n          </h1>\n          <p className=\"text-gray-600\">{group.name}</p>\n        </div>\n\n        {members.length === 0 ? (\n          <Card>\n            <CardContent className=\"py-12\">\n              <div className=\"text-center\">\n                <Users className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                <p className=\"text-gray-600\">No members yet</p>\n              </div>\n            </CardContent>\n          </Card>\n        ) : (\n          <div className=\"bg-white rounded-xl border border-gray-200 divide-y divide-gray-100\">\n            {members.map((member) => {\n              const isGroupAdmin = member.userId === group.adminId;\n              const initials = (member.user?.fullName || \"M\").split(\" \").map(n => n[0]).join(\"\").slice(0, 2).toUpperCase();\n              return (\n                <div key={member.id} className=\"flex items-center justify-between px-4 py-3\" data-testid={`member-card-${member.id}`}>\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-12 h-12 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center text-white font-semibold text-sm\">\n                      {initials}\n                    </div>\n                    <div className=\"min-w-0\">\n                      <div className=\"flex items-center gap-2\">\n                        <p className=\"font-medium text-gray-900 truncate\" data-testid={`text-member-name-${member.id}`}>\n                          {member.user?.fullName || \"Member\"}\n                        </p>\n                        {isGroupAdmin && (\n                          <span className=\"text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full font-medium flex-shrink-0\">\n                            Admin\n                          </span>\n                        )}\n                      </div>\n                      <p className=\"text-sm text-gray-500\" data-testid={`text-member-phone-${member.id}`}>\n                        {formatPhone(member.user?.phoneNumber || member.user?.phone_number || \"\")}\n                      </p>\n                    </div>\n                  </div>\n\n                  {isAdmin && !isGroupAdmin && (\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      className=\"text-red-600 hover:text-red-700 hover:bg-red-50 flex-shrink-0\"\n                      onClick={() => setMemberToDelete(member)}\n                      data-testid={`button-delete-member-${member.id}`}\n                    >\n                      <Trash2 className=\"w-4 h-4\" />\n                    </Button>\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        )}\n\n        <div className=\"mt-6 text-center text-sm text-gray-500\">\n          {members.length} {members.length === 1 ? \"member\" : \"members\"} in this group\n        </div>\n      </div>\n\n      <AlertDialog open={!!memberToDelete} onOpenChange={() => setMemberToDelete(null)}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Remove Member</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to remove{\" \"}\n              <span className=\"font-semibold\">{memberToDelete?.user?.fullName}</span> from this\n              group? They will be notified immediately.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel data-testid=\"button-cancel-delete\">Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => memberToDelete && removeMemberMutation.mutate(memberToDelete.id)}\n              className=\"bg-red-600 hover:bg-red-700\"\n              disabled={removeMemberMutation.isPending}\n              data-testid=\"button-confirm-delete\"\n            >\n              {removeMemberMutation.isPending ? \"Removing...\" : \"Remove Member\"}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":8450,"size_tokens":null}},"version":2}